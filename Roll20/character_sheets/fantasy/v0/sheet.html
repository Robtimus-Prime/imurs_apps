<div>
<!-- begin sheet -->

<div class="sheet-2colrow">
	<div class="sheet-col">	

		<div>
			<label class="longlabel"> Character Type </label>
			<input name="attr_character_type" type="text" class="longtext" />
			&nbsp;
			<label class="magic-type-container">
				<input name="attr_gm_rolls" type="checkbox" />
				<span class="magic-type gm-rolls"> GM Rolls </span>
			</label>
			<input name="attr_gm_rolls_text" value="" type="hidden" />
		</div>
		<div>
			<label class="longlabel"> Character Points </label>
			<input name="attr_cp_total" type="text" class="final-number final-number-large" readonly />
		</div>
		<div>
			<span class="skill-attribute default-attribute"> Combat Score </span>
			<input name="attr_combat_score" type="text" class="final-number" readonly />
			&nbsp; &nbsp; 
			<span class="skill-attribute default-attribute"> Non-Combat Score </span>
			<input name="attr_non_combat_score" type="text" class="final-number" readonly />
		</div>

	</div>

	<div class="sheet-col">	
		<h1>IMURS</h1>
	</div>
</div>

<div class="sheet-3colrow top-space">
	<div class="sheet-col">
		<div class="section-header">
			<label> Attributes </label>
		</div>
	
		<div>
			<label> Physique </label>
			<input name="attr_physique" type="text" />
			<input name="attr_physique_modifier" type="text" readonly />
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Physique}} {{Physique check=[[2d6 + @{physique_modifier}]]}}'" />
		</div>

		<div>
			<label> Agility </label>
			<input name="attr_agility" type="text"></input>
			<input name="attr_agility_modifier" type="text" readonly />
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Agility}} {{Agility check=[[2d6 + @{agility_modifier}]]}}'" />
		</div>

		<div>
			<label> Intelligence </label>
			<input name="attr_intelligence" type="text"></input>
			<input name="attr_intelligence_modifier" type="text" readonly />
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Intelligence}} {{Intelligence check=[[2d6 + @{intelligence_modifier}]]}}'" />
		</div>

		<div>
			<label> Wit </label>
			<input name="attr_wit" type="text"></input>
			<input name="attr_wit_modifier" type="text" readonly />
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Wit}} {{Wit check=[[2d6 + @{wit_modifier}]]}}'" />
		</div>

		<div class="section-header top-space">
			<label> Rest </label>
		</div>

		<div>
			<button type="action" name="act-shortrest" />
			<label class="col2"> Short Rest </label>
			<input name="attr_short_rest_hp_roll" type="hidden" value="1" />
			<input name="attr_short_rest_ep_roll" type="hidden" value="1" />

			<button type="action" name="act-longrest" />
			<label class="col2"> Long Rest </label>
			<input name="attr_long_rest_hp_roll" type="hidden" value="1" />
			<input name="attr_long_rest_ep_roll" type="hidden" value="1" />
		</div>

		<div class="section-header top-space">
			<label> Healing Potions </label>
		</div>

		<div>
			<button type="action" name="act-magichealingpotion" />
			<label class="potion-short"> Magic </label>
			<input name="attr_magic_healing_potion_count" type="text" value="0" />

			<button type="action" name="act-eldritchhealingpotion" />
			<label class="potion-long"> Eldritch </label>
			<input name="attr_eldritch_healing_potion_count" type="text" value="0" />
		</div>

		<div>
			<button type="action" name="act-epichealingpotion" />
			<label class="potion-short"> Epic </label>
			<input name="attr_epic_healing_potion_count" type="text" value="0" />
			
			<button type="action" name="act-legendaryhealingpotion" />
			<label class="potion-long"> Legendary </label>
			<input name="attr_legendary_healing_potion_count" type="text" value="0" />
		</div>

	</div>

	<div class="sheet-col">	
		<div class="section-header">
			<label> Hit Points (HP) </label>
		</div>

		<div>
			<span class="tiny-text"> Total </span>
			<span class="tiny-text vital-stats"> Extra </span>
			<span class="tiny-text vital-stats"> Current </span>
		</div>
		<div>
			<input name="attr_hit_points_max" type="text" class="longnumber" readonly />
			&nbsp; &nbsp;
			<input name="attr_hit_points_extra" type="text" class="longnumber" />
			&nbsp; &nbsp;
			<input name="attr_hit_points" type="text" class="longnumber" />
		</div>

		<div class="section-header top-space">
			<label> Recovery </label>
		</div>

		<div>
			<button type="action" name="act-recovery" />
			<b> Roll </b>
			&nbsp; S
			<input name="attr_recovery_successes" type="text" class="recovery" />
			&nbsp; F
			<input name="attr_recovery_failures" type="text" class="recovery" />
			&nbsp;
			<button type="action" name="act-resetrecovery" />
			<b> Reset </b>
			<button type="action" name="act_recoveryinfo" class="info-button" />
		</div>

		<div class="section-header top-space">
			<label> Speed </label>
		</div>

		<div>
			<input name="attr_speed_total" type="text" readonly />
			<label class="nowidth"> Squares </label>
			<span class="skill-attribute default-attribute"> Temporary Modifier </span>
			<input name="attr_speed_temporary_modifier" type="text" />
		</div>

		<div>
			<input name="attr_bb_burrow" type="hidden" class="show-ability" value="false" />
			<span class="ability bottom-space">
				<div>
					<label class="col2"> Burrow </label>
					<input name="attr_bb_burrow_speed" type="text" readonly />
					<label class="nowidth"> Squares </label>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_bb_climb" type="hidden" class="show-ability" value="false" />
			<span class="ability bottom-space">
				<div>
					<label class="col2"> Climb </label>
					<input name="attr_bb_climb_speed" type="text" readonly />
					<label class="nowidth"> Squares </label>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_bb_fly" type="hidden" class="show-ability" value="false" />
			<span class="ability bottom-space">
				<div>
					<label class="col2"> Fly </label>
					<input name="attr_bb_fly_speed" type="text" readonly />
					<label class="nowidth"> Squares </label>
					<div style="margin-top: -12px;">
						<input name="attr_bb_supernatural_flight" type="hidden" class="show-ability" value="false" />
						<span class="ability tiny-text"> Supernatural </span>
					</div>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_bb_swim" type="hidden" class="show-ability" value="false" />
			<span class="ability bottom-space">
				<div>
					<label class="col2"> Swim </label>
					<input name="attr_bb_swim_speed" type="text" readonly />
					<label class="nowidth"> Squares </label>
				</div>
			</span>
		</div>

	</div>

	<div class="sheet-col">
		<div class="section-header">
			<label> Perception </label>
		</div>

		<div>
			<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
		</div>
		<div class="skillname">
			<label> 
				Perception 
				<br />
				<span class="skill-attribute"> Wit </span> 
			</label>
			<input name="attr_perception_total" type="text" readonly />
			<input name="attr_perception_points" type="text" />
		</div>
		
		<div>
			<div class="advantage-toolbar">
				<input type="radio" id="radioGreatDisadvantagePerception" name="attr_perception_advantage" value="GreatDisadvantage">
				<label for="radioGreatDisadvantagePerception" class="left-end">GD</label>

				<input type="radio" id="radioDisadvantagePerception" name="attr_perception_advantage" value="Disadvantage">
				<label for="radioDisadvantagePerception">Dis</label>

				<input type="radio" id="radioNovantagePerception" name="attr_perception_advantage" value="Novantage" checked>
				<label for="radioNovantagePerception">N</label>

				<input type="radio" id="radioAdvantagePerception" name="attr_perception_advantage" value="Advantage">
				<label for="radioAdvantagePerception">Adv</label>

				<input type="radio" id="radioGreatAdvantagePerception" name="attr_perception_advantage" value="GreatAdvantage">
				<label for="radioGreatAdvantagePerception" class="right-end">GA</label> 

				<input name="attr_perception_advantage_text" type="hidden" />
			</div>
			
			<div class="explode">
				<label class="tierpool"> Expl </label>
				<input name="attr_perception_explode" type="text" value="10" />
				+
			</div>
		</div>
		
		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Perception}} {{Perception (notice) @{perception_advantage_text}=[[@{perception_notice_roll} + @{perception_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_perceptionnoticeinfo" class="info-button" />
			<label class="skillapp"> Notice </label>
			<label class="skill-tem-container">
				<input name="attr_perception_notice_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_perception_notice_roll" type="hidden" value="2d6" />
		</div>
		
		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Perception}} {{Perception (scan) @{perception_advantage_text}=[[@{perception_scan_roll} + @{perception_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_perceptionscaninfo" class="info-button" />
			<label class="skillapp"> Scan </label>
			<label class="skill-tem-container">
				<input name="attr_perception_scan_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_perception_scan_roll" type="hidden" value="2d6" />
		</div>
		
		<div>
			<label class="tierpool"> Tier </label>
			<input name="attr_perception_tier" type="text" value="0" readonly />
			<label class="tierpool"> Pool </label>
			<input name="attr_perception_pool_total" type="text" readonly />
			<input name="attr_perception_pool_extra" type="text" />
		</div>
		<div>
			<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
		</div>

		<div class="skillname top-space top-line-bold">
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Reflex}} {{Reflex @{perception_advantage_text}=[[@{perception_notice_roll} + @{reflex_total} + ( @{agility} / 100 ) + ( ( d10 - 1 ) / 1000 ) &{tracker}]]}} {{desc=Reflex = [ Reflex check ] **.** [ Agility | d10 - 1 roll ]}}'" />
			<button type="action" name="act_reflexinfo" class="info-button" />
			<label class="reflex"> 
				Reflex 
				<br />
				<span class="skill-attribute"> Agility </span>
			</label>
			<input name="attr_reflex_total" type="text" readonly />
		</div>

	</div>
</div>

<div class="sheet-2colrow top-space">
	<div class="sheet-col">
		<div class="section-header">
			<label> Offense </label>
		</div>
		
		<div class="top-space bottom-pad">
			<label class="magic-type-container">
				<input name="attr_use_charge" type="checkbox" />
				<span class="magic-type combat-action"> Charge </span>
			</label>
			&nbsp;
			<label class="magic-type-container combat-action-container-right">
				<input name="attr_use_precise_strike" type="checkbox" />
				<span class="magic-type combat-action"> Precise Strike </span>
			</label>
			&nbsp;
			<label class="magic-type-container combat-action-container-far-right">
				<input name="attr_use_sneak_attack" type="checkbox" />
				<input name="attr_ps_sneak_attack" type="hidden" class="show-rage" value="false" />
				<span class="magic-type combat-action"> Sneak Attack </span>
			</label>
		</div>
	
		<div class="top-space bottom-pad">
			<label class="magic-type-container">
				<input name="attr_use_fight_recklessly" type="checkbox" />
				<span class="magic-type combat-action"> Fight Recklessly </span>
			</label>
			&nbsp;
			<label class="magic-type-container combat-action-container-right">
				<input name="attr_use_rage" type="checkbox" />
				<input name="attr_ps_rage" type="hidden" class="show-rage" value="false" />
				<span class="magic-type combat-action"> Rage </span>
			</label>
			&nbsp;
			<label class="magic-type-container combat-action-container-far-right">
				<input name="attr_use_wild_rage" type="checkbox" />
				<input name="attr_ps_wild_rage" type="hidden" class="show-rage" value="false" />
				<span class="magic-type combat-action"> Wild Rage </span>
			</label>
		</div>
	
		<div>
			<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
		</div>
		<div class="skillname">
			<label>
				Attack
				<button type="action" name="act_togglecombatstyles" class="toggle" />
				<br />
				<input name="attr_ps_dexterous_strike" type="hidden" class="show-replacement-attribute" value="false" />
				<span class="skill-attribute default-attribute"> Physique </span>
				&shy;
				<span class="skill-attribute replacement-attribute"> Agility </span>
			</label>
			<input name="attr_attack_total" type="text" readonly />
			<input name="attr_attack_points" type="text" />
			<input name="attr_attack_attribute_modifier" type="hidden" />
			<input name="attr_attack_attribute_name" type="hidden" />
			<input name="attr_deadly_aim_damage" type="hidden" value="0" />
			<input name="attr_powerful_blow_damage" type="hidden" value="0" />
		</div>
		
		<div>
			<div class="advantage-toolbar">
				<input type="radio" id="radioGreatDisadvantageAttack" name="attr_attack_advantage" value="GreatDisadvantage">
				<label for="radioGreatDisadvantageAttack" class="left-end">GD</label>

				<input type="radio" id="radioDisadvantageAttack" name="attr_attack_advantage" value="Disadvantage">
				<label for="radioDisadvantageAttack">Dis</label>

				<input type="radio" id="radioNovantageAttack" name="attr_attack_advantage" value="Novantage" checked>
				<label for="radioNovantageAttack">N</label>

				<input type="radio" id="radioAdvantageAttack" name="attr_attack_advantage" value="Advantage">
				<label for="radioAdvantageAttack">Adv</label>

				<input type="radio" id="radioGreatAdvantageAttack" name="attr_attack_advantage" value="GreatAdvantage">
				<label for="radioGreatAdvantageAttack" class="right-end">GA</label> 

				<input name="attr_attack_advantage_text" type="hidden" />			
			</div>
			
			<div class="explode">
				<label class="tierpool"> Expl </label>
				<input name="attr_attack_explode" type="text" value="10" />
				+
			</div>
		</div>
		
		<div class="top-space bottom-space">
			<label class="skill-tem-container">
				<input name="attr_use_attack_pool_points" type="checkbox" />
				<span class="skill-tem magic-focus"> Use Pool Points </span>
			</label>
			<input name="attr_attack_pool_points_to_use" type="text" style="margin-left: 100px" />
			points
		</div>

		<div>
			<label style="width: 125px;"> Damage Modifier </label>
			<div class="input-group">
				<input name="attr_attack_damage_dice_modifier" type="text" />
				<span class="input-group-addon" style="width: 10%"> d6 </span>
			</div>
			&nbsp; +
			<input name="attr_attack_damage_static_modifier" type="text" />
		</div>

		<div>
			<input type="hidden" name="attr_show_dw_melee" class="show-combat-style" value="true" />
			<span class="combat-style">
				<div class="top-line">
					<button type="action" name="act_attackdwmeleeinfo" class="info-button" />
					<label class="skillappcombat">
						Dual wield melee
						<input name="attr_ps_multiattack" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							(multiattack)
						</span>
					</label>
					<label class="skill-tem-container">
						<input name="attr_attack_dw_melee_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_attack_dw_melee_roll" type="hidden" value="2d6" />
				</div>
				<div class="weapon">
					<button type="roll" value="@{dw_melee_weapon1_roll_text}" />
					<label> Weapon 1 </label>
					<input class="weapon" name="attr_dw_melee_weapon1_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_dw_melee_weapon1_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{dw_melee_weapon2_roll_text}" />
					<label> Weapon 2 </label>
					<input class="weapon" name="attr_dw_melee_weapon2_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_dw_melee_weapon2_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{dw_melee_weapon3_roll_text}" />
					<label> Weapon 3 </label>
					<input class="weapon" name="attr_dw_melee_weapon3_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_dw_melee_weapon3_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{dw_melee_weapon4_roll_text}" />
					<label> Weapon 4 </label>
					<input class="weapon" name="attr_dw_melee_weapon4_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_dw_melee_weapon4_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				
				<!-- Multiattack -->
				<div>
					<input type="hidden" name="attr_ps_multiattack" class="show-ability" value="true" />
					<span class="ability">
						<div class="weapon">
							<button type="roll" value="@{dw_melee_weapon5_roll_text}" />
							<label> Weapon 5 </label>
							<input class="weapon" name="attr_dw_melee_weapon5_name" type="text" placeholder="weapon name" />
							<div class="input-group">
								<input name="attr_dw_melee_weapon5_damage" type="text" readonly />
								<span class="input-group-addon">
									d6<span name="attr_attack_attribute_modifier_display"></span>
								</span>
							</div>
						</div>
						<div class="weapon">
							<button type="roll" value="@{dw_melee_weapon6_roll_text}" />
							<label> Weapon 6 </label>
							<input class="weapon" name="attr_dw_melee_weapon6_name" type="text" placeholder="weapon name" />
							<div class="input-group">
								<input name="attr_dw_melee_weapon6_damage" type="text" readonly />
								<span class="input-group-addon">
									d6<span name="attr_attack_attribute_modifier_display"></span>
								</span>
							</div>
						</div>
					</span>
				</div>

			</span>
		</div>

		<div>
			<input type="hidden" name="attr_show_dw_missile" class="show-combat-style" value="true" />
			<span class="combat-style">		
				<div class="top-line">
					<button type="action" name="act_attackdwmissileinfo" class="info-button" />
					<label class="skillappcombat"> 
						Dual wield missile 
						<input name="attr_ps_multiattack" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							(multiattack)
						</span>
					</label>
					<label class="skill-tem-container">
						<input name="attr_attack_dw_missile_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_attack_dw_missile_roll" type="hidden" value="2d6" />
				</div>
				<div class="weapon">
					<button type="roll" value="@{dw_missile_weapon1_roll_text}" />
					<label> Weapon 1 </label>
					<input class="weapon" name="attr_dw_missile_weapon1_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_dw_missile_weapon1_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{dw_missile_weapon2_roll_text}" />
					<label> Weapon 2 </label>
					<input class="weapon" name="attr_dw_missile_weapon2_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_dw_missile_weapon2_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{dw_missile_weapon3_roll_text}" />
					<label> Weapon 3 </label>
					<input class="weapon" name="attr_dw_missile_weapon3_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_dw_missile_weapon3_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{dw_missile_weapon4_roll_text}" />
					<label> Weapon 4 </label>
					<input class="weapon" name="attr_dw_missile_weapon4_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_dw_missile_weapon4_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
			</span>
		</div>

		<div>
			<input type="hidden" name="attr_show_free_hand_melee" class="show-combat-style" value="true" />
			<span class="combat-style">		
				<div class="top-line">
					<button type="action" name="act_attackfreehandmeleeinfo" class="info-button" />
					<label class="skillappcombat"> Free hand melee </label>
					<label class="skill-tem-container">
						<input name="attr_attack_free_hand_melee_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_attack_free_hand_melee_roll" type="hidden" value="2d6" />
				</div>
				<div class="weapon">
					<button type="roll" value="@{free_hand_melee_weapon1_roll_text}" />
					<label> Weapon 1 </label>
					<input class="weapon" name="attr_free_hand_melee_weapon1_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_free_hand_melee_weapon1_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{free_hand_melee_weapon2_roll_text}" />
					<label> Weapon 2 </label>
					<input class="weapon" name="attr_free_hand_melee_weapon2_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_free_hand_melee_weapon2_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
			</span>
		</div>

		<div>
			<input type="hidden" name="attr_show_free_hand_missile" class="show-combat-style" value="true" />
			<span class="combat-style">		
				<div class="top-line">
					<button type="action" name="act_attackfreehandmissileinfo" class="info-button" />
					<label class="skillappcombat"> Free hand missile </label>
					<label class="skill-tem-container">
						<input name="attr_attack_free_hand_missile_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_attack_free_hand_missile_roll" type="hidden" value="2d6" />
				</div>
				<div class="weapon">
					<button type="roll" value="@{free_hand_missile_weapon1_roll_text}" />
					<label> Weapon 1 </label>
					<input class="weapon" name="attr_free_hand_missile_weapon1_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_free_hand_missile_weapon1_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{free_hand_missile_weapon2_roll_text}" />
					<label> Weapon 2 </label>
					<input class="weapon" name="attr_free_hand_missile_weapon2_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_free_hand_missile_weapon2_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
			</span>
		</div>

		<div>
			<input type="hidden" name="attr_show_melee_with_shield" class="show-combat-style" value="true" />
			<span class="combat-style">		
				<div class="top-line">
					<button type="action" name="act_attackmeleewithshieldinfo" class="info-button" />
					<label class="skillappcombat"> Melee with shield </label>
					<label class="skill-tem-container">
						<input name="attr_attack_melee_with_shield_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_attack_melee_with_shield_roll" type="hidden" value="2d6" />
				</div>
				<div class="weapon">
					<button type="roll" value="@{melee_with_shield_weapon1_roll_text}" />
					<label> Weapon 1 </label>
					<input class="weapon" name="attr_melee_with_shield_weapon1_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_melee_with_shield_weapon1_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{melee_with_shield_weapon2_roll_text}" />
					<label> Weapon 2 </label>
					<input class="weapon" name="attr_melee_with_shield_weapon2_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_melee_with_shield_weapon2_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
			</span>
		</div>

		<div>
			<input type="hidden" name="attr_show_missile_with_shield" class="show-combat-style" value="true" />
			<span class="combat-style">		
				<div class="top-line">
					<button type="action" name="act_attackmissilewithshieldinfo" class="info-button" />
					<label class="skillappcombat"> Missile with shield </label>
					<label class="skill-tem-container">
						<input name="attr_attack_missile_with_shield_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_attack_missile_with_shield_roll" type="hidden" value="2d6" />
				</div>
				<div class="weapon">
					<button type="roll" value="@{missile_with_shield_weapon1_roll_text}" />
					<label> Weapon 1 </label>
					<input class="weapon" name="attr_missile_with_shield_weapon1_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_missile_with_shield_weapon1_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{missile_with_shield_weapon2_roll_text}" />
					<label> Weapon 2 </label>
					<input class="weapon" name="attr_missile_with_shield_weapon2_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_missile_with_shield_weapon2_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_attack_attribute_modifier_display"></span>
						</span>
					</div>
				</div>
			</span>
		</div>

		<div>
			<input type="hidden" name="attr_show_two_handed_melee" class="show-combat-style" value="true" />
			<span class="combat-style">		
				<div class="top-line">
					<button type="action" name="act_attacktwohandedmeleeinfo" class="info-button" />
					<label class="skillappcombat"> Two-handed melee </label>
					<label class="skill-tem-container">
						<input name="attr_attack_two_handed_melee_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_attack_two_handed_melee_roll" type="hidden" value="2d6" />
				</div>
				<div class="weapon">
					<button type="roll" value="@{two_handed_melee_weapon1_roll_text}" />
					<label> Weapon 1 </label>
					<input class="weapon" name="attr_two_handed_melee_weapon1_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_two_handed_melee_weapon1_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_two_handed_melee_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{two_handed_melee_weapon2_roll_text}" />
					<label> Weapon 2 </label>
					<input class="weapon" name="attr_two_handed_melee_weapon2_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_two_handed_melee_weapon2_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_two_handed_melee_modifier_display"></span>
						</span>
					</div>
				</div>
			</span>
		</div>

		<div>
			<input type="hidden" name="attr_show_two_handed_missile" class="show-combat-style" value="true" />
			<span class="combat-style">		
				<div class="top-line">
					<button type="action" name="act_attacktwohandedmissileinfo" class="info-button" />
					<label class="skillappcombat"> Two-handed missile </label>
					<label class="skill-tem-container">
						<input name="attr_attack_two_handed_missile_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_attack_two_handed_missile_roll" type="hidden" value="2d6" />
				</div>
				<div class="weapon">
					<button type="roll" value="@{two_handed_missile_weapon1_roll_text}" />
					<label> Weapon 1 </label>
					<input class="weapon" name="attr_two_handed_missile_weapon1_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_two_handed_missile_weapon1_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_two_handed_missile_modifier_display"></span>
						</span>
					</div>
				</div>
				<div class="weapon">
					<button type="roll" value="@{two_handed_missile_weapon2_roll_text}" />
					<label> Weapon 2 </label>
					<input class="weapon" name="attr_two_handed_missile_weapon2_name" type="text" placeholder="weapon name" />
					<div class="input-group">
						<input name="attr_two_handed_missile_weapon2_damage" type="text" readonly />
						<span class="input-group-addon">
							d6<span name="attr_two_handed_missile_modifier_display"></span>
						</span>
					</div>
				</div>
			</span>
		</div>

		<div class="top-line">
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Attack}} {{Attack (grapple) @{attack_advantage_text}=[[@{attack_grapple_roll} + @{attack_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_attackgrappleinfo" class="info-button" />
			<label class="skillappcombat"> Grapple </label>
			<label class="skill-tem-container">
				<input name="attr_attack_grapple_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_attack_grapple_roll" type="hidden" value="2d6" />
		</div>

		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Attack}} {{Attack (reposition) @{attack_advantage_text}=[[@{attack_reposition_roll} + @{attack_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_attackrepositioninfo" class="info-button" />
			<label class="skillappcombat"> Reposition </label>
			<label class="skill-tem-container">
				<input name="attr_attack_reposition_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_attack_reposition_roll" type="hidden" value="2d6" />
		</div>

		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Attack}} {{Attack (tactical combat) @{attack_advantage_text}=[[@{attack_tactical_combat_roll} + @{attack_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_attacktacticalcombatinfo" class="info-button" />
			<label class="skillappcombat"> Tactical Combat </label>
			<label class="skill-tem-container">
				<input name="attr_attack_tactical_combat_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_attack_tactical_combat_roll" type="hidden" value="2d6" />
		</div>

		<div>
			<label class="tierpool"> Tier </label>
			<input name="attr_attack_tier" type="text" value="0" readonly />
			<label class="tierpool"> Pool </label>
			<input name="attr_attack_pool_total" type="text" readonly />
			<input name="attr_attack_pool_extra" type="text" />
		</div>
		<div>
			<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
		</div>
		
		<!-- Aura of Damage -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_arcane" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Arcane damage=[[@{bb_aura_of_damage_arcane_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_arcane_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_chemical" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Chemical damage=[[@{bb_aura_of_damage_chemical_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_chemical_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_cold" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Cold damage=[[@{bb_aura_of_damage_cold_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_cold_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_disease" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Disease damage=[[@{bb_aura_of_damage_disease_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_disease_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_electricity" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Electricity damage=[[@{bb_aura_of_damage_electricity_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_electricity_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_heat" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Heat damage=[[@{bb_aura_of_damage_heat_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_heat_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_mental" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Mental damage=[[@{bb_aura_of_damage_mental_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_mental_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_physical" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Physical damage=[[@{bb_aura_of_damage_physical_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_physical_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_poison" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Poison damage=[[@{bb_aura_of_damage_poison_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_poison_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_sonic" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Sonic damage=[[@{bb_aura_of_damage_sonic_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_sonic_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_spectral" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Spectral damage=[[@{bb_aura_of_damage_spectral_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_spectral_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_damage_vibrant" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Damage </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Damage}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Vibrant damage=[[@{bb_aura_of_damage_vibrant_damage} + @{wit_modifier}]]}}'" />
					<input class="custom" name="attr_bb_aura_of_damage_vibrant_description" type="text" readonly />
				</div>
			</span>
		</div>

		<!-- Aura of Fear -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_fear" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Fear </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Fear}} {{Mental Resilience (willpower)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Failure=Scared}} {{Critical failure=Terrified}} {{Duration=Short rest ([[{0d0+3, 0d0+@{mr_tier}}kl1]] successes)}} {{desc=**Scared:** Disadvantage on all actions%NEWLINE%%NEWLINE%**Terrified:** Great disadvantage on all actions, must use any means necessary to flee the source of terror}}'" />
					<input class="custom" name="attr_aura_of_fear_description" type="text" readonly />
				</div>
			</span>
		</div>

		<!-- Aura of Slowness -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_slowness" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Slowness </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Slowness}} {{Mental Resilience (willpower)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Failure=Slowed (-1 AP)}} {{Critical failure=Slowed (-2 AP)}} {{Duration=Short rest ([[{0d0+3, 0d0+@{mr_tier}}kl1]] successes)}}'" />
					<input class="custom" name="attr_aura_of_slowness_description" type="text" readonly />
				</div>
			</span>
		</div>

		<!-- Aura of Stench -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_aura_of_stench" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Aura of Stench </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Aura of Stench}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{Failure=Sickened}} {{Duration=Short rest ([[{0d0+3, 0d0+@{mr_tier}}kl1]] successes)}} {{desc=**Sickened:** Disadvantage on all actions; if exposed to anything stomach-upsetting, 10% chance each round to become nauseated until your next short rest.}}'" />
					<input class="custom" name="attr_aura_of_stench_description" type="text" readonly />
				</div>
			</span>
		</div>

		<!-- Blood Drain -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_blood_drain" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Blood Drain <button type="action" name="act_blooddraininfo" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Blood Drain}} {{Blood drain damage=[[(@{attack_tier} + @{pr_tier})d6]]}}'" />
					Roll Blood Drain Damage
				</div>
			</span>
		</div>

		<!-- Breath Weapon  -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_breath_weapon_blast_1" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbminorbreathweaponblast1info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_minor_breath_weapon_blast_1_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_minor_breath_weapon_blast_1_damage_type} damage=[[@{bb_minor_breath_weapon_blast_1_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_minor_breath_weapon_blast_1_description" type="text" readonly />
					<input name="attr_bb_minor_breath_weapon_blast_1_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_minor_breath_weapon_blast_1_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_breath_weapon_blast_2" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbminorbreathweaponblast2info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_minor_breath_weapon_blast_2_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_minor_breath_weapon_blast_2_damage_type} damage=[[@{bb_minor_breath_weapon_blast_2_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_minor_breath_weapon_blast_2_description" type="text" readonly />
					<input name="attr_bb_minor_breath_weapon_blast_2_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_minor_breath_weapon_blast_2_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_breath_weapon_blast_3" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbminorbreathweaponblast3info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_minor_breath_weapon_blast_3_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_minor_breath_weapon_blast_3_damage_type} damage=[[@{bb_minor_breath_weapon_blast_3_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_minor_breath_weapon_blast_3_description" type="text" readonly />
					<input name="attr_bb_minor_breath_weapon_blast_3_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_minor_breath_weapon_blast_3_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_breath_weapon_line_1" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbminorbreathweaponline1info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_minor_breath_weapon_line_1_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_minor_breath_weapon_line_1_damage_type} damage=[[@{bb_minor_breath_weapon_line_1_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_minor_breath_weapon_line_1_description" type="text" readonly />
					<input name="attr_bb_minor_breath_weapon_line_1_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_minor_breath_weapon_line_1_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_breath_weapon_line_2" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbminorbreathweaponline2info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_minor_breath_weapon_line_2_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_minor_breath_weapon_line_2_damage_type} damage=[[@{bb_minor_breath_weapon_line_2_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_minor_breath_weapon_line_2_description" type="text" readonly />
					<input name="attr_bb_minor_breath_weapon_line_2_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_minor_breath_weapon_line_2_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_breath_weapon_line_3" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbminorbreathweaponline3info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_minor_breath_weapon_line_3_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_minor_breath_weapon_line_3_damage_type} damage=[[@{bb_minor_breath_weapon_line_3_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_minor_breath_weapon_line_3_description" type="text" readonly />
					<input name="attr_bb_minor_breath_weapon_line_3_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_minor_breath_weapon_line_3_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_breath_weapon_blast_1" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbmajorbreathweaponblast1info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_major_breath_weapon_blast_1_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_major_breath_weapon_blast_1_damage_type} damage=[[@{bb_major_breath_weapon_blast_1_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_major_breath_weapon_blast_1_description" type="text" readonly />
					<input name="attr_bb_major_breath_weapon_blast_1_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_major_breath_weapon_blast_1_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_breath_weapon_blast_2" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbmajorbreathweaponblast2info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_major_breath_weapon_blast_2_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_major_breath_weapon_blast_2_damage_type} damage=[[@{bb_major_breath_weapon_blast_2_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_major_breath_weapon_blast_2_description" type="text" readonly />
					<input name="attr_bb_major_breath_weapon_blast_2_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_major_breath_weapon_blast_2_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_breath_weapon_blast_3" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbmajorbreathweaponblast3info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_major_breath_weapon_blast_3_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_major_breath_weapon_blast_3_damage_type} damage=[[@{bb_major_breath_weapon_blast_3_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_major_breath_weapon_blast_3_description" type="text" readonly />
					<input name="attr_bb_major_breath_weapon_blast_3_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_major_breath_weapon_blast_3_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_breath_weapon_line_1" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbmajorbreathweaponline1info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_major_breath_weapon_line_1_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_major_breath_weapon_line_1_damage_type} damage=[[@{bb_major_breath_weapon_line_1_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_major_breath_weapon_line_1_description" type="text" readonly />
					<input name="attr_bb_major_breath_weapon_line_1_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_major_breath_weapon_line_1_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_breath_weapon_line_2" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbmajorbreathweaponline2info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_major_breath_weapon_line_2_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_major_breath_weapon_line_2_damage_type} damage=[[@{bb_major_breath_weapon_line_2_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_major_breath_weapon_line_2_description" type="text" readonly />
					<input name="attr_bb_major_breath_weapon_line_2_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_major_breath_weapon_line_2_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_breath_weapon_line_3" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Breath Weapon <button type="action" name="act_bbmajorbreathweaponline3info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<input name="attr_bb_major_breath_weapon_line_3_ps_tier_bonus" type="hidden" value="0" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Physical Resilience (fortitude)=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{@{bb_major_breath_weapon_line_3_damage_type} damage=[[@{bb_major_breath_weapon_line_3_damage_total}d6]]}}'" />
					<input class="custom" name="attr_bb_major_breath_weapon_line_3_description" type="text" readonly />
					<input name="attr_bb_major_breath_weapon_line_3_recharge_roll" type="hidden" />
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Breath Weapon}} {{Recharge=[[@{bb_major_breath_weapon_line_3_recharge_roll}]]}}'" />
					Check Recharge
				</div>
			</span>
		</div>
		
		<!-- Corrosive Blood -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_corrosive_blood" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Corrosive Blood </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Corrosive Blood }} {{Reflex=**TN** [[12 + @{pr_total} + @{mob_skill_bonus}]]}} {{Chemical damage=[[@{corrosive_blood_damage}]]}}'" />
					Roll Corrosive Blood
				</div>
			</span>
		</div>

		<!-- Crush -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_crush" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Crush </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Crush}} {{Crush damage=[[@{pr_tier}d6]]}}'" />
					Roll Crush Damage
				</div>
			</span>
		</div>

		<!-- Desert Thirst -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_desert_thirst" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Desert Thirst </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Desert Thirst}} {{Range=[[@{mr_total} + @{mob_skill_bonus}]] squares}} {{Area=Burst ([[@{desert_thirst_area_size}]] sq)}} {{Mental Resilience (willpower)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Effect=Liquids turned to sand}}'" />
					Roll Desert Thirst
				</div>
			</span>
		</div>

		<!-- Disease Attack -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_disease_attack_1" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Disease Attack <button type="action" name="act_bbdiseaseattack1info" class="info-button generic-skill" /> </label>
				</div>
				<input class="custom" name="attr_bb_disease_attack_1_name" type="text" placeholder="Disease Name" />
				<textarea class="large" name="attr_bb_disease_attack_1_detail" placeholder="Disease Detail"></textarea>
			</span>
		</div>	

		<div class="monstrous-boon top-line">
			<input name="attr_bb_disease_attack_2" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Disease Attack <button type="action" name="act_bbdiseaseattack2info" class="info-button generic-skill" /> </label>
				</div>
				<input class="custom" name="attr_bb_disease_attack_2_name" type="text" placeholder="Disease Name" />
				<textarea class="large" name="attr_bb_disease_attack_2_detail" placeholder="Disease Detail"></textarea>
			</span>
		</div>	

		<div class="monstrous-boon top-line">
			<input name="attr_bb_disease_attack_3" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Disease Attack <button type="action" name="act_bbdiseaseattack3info" class="info-button generic-skill" /> </label>
				</div>
				<input class="custom" name="attr_bb_disease_attack_3_name" type="text" placeholder="Disease Name" />
				<textarea class="large" name="attr_bb_disease_attack_3_detail" placeholder="Disease Detail"></textarea>
			</span>
		</div>	

		<!-- Energy Drain -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_energy_drain" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Energy Drain </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Energy Drain}} {{Physical Resilience (fortitude)=TN [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{desc=Affected creatures are fatigued; if already fatigued by this ability, they are sickened. Both conditions last until the creature's next long rest. The monster heals HP equal to the magic damage of its attack.}}'" />
					Roll Energy Drain
				</div>
			</span>
		</div>

		<!-- Engulf -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_engulf" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Engulf <button type="action" name="act_engulfinfo" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>

		<!-- Explosive Death -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_arcane" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Arcane damage=[[@{bb_minor_explosive_death_arcane_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as disease, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_arcane_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_chemical" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Chemical damage=[[@{bb_minor_explosive_death_chemical_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as disease, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_chemical_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_cold" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Cold damage=[[@{bb_minor_explosive_death_cold_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as disease, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_cold_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_disease" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Disease damage=[[@{bb_minor_explosive_death_disease_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as disease, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_disease_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_electricity" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Electricity damage=[[@{bb_minor_explosive_death_electricity_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as electricity, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_electricity_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_heat" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Heat damage=[[@{bb_minor_explosive_death_heat_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as heat, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_heat_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_mental" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Mental damage=[[@{bb_minor_explosive_death_mental_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as mental, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_mental_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_physical" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Physical damage=[[@{bb_minor_explosive_death_physical_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as physical, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_physical_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_poison" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Poison damage=[[@{bb_minor_explosive_death_poison_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as poison, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_poison_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_sonic" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Sonic damage=[[@{bb_minor_explosive_death_sonic_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as sonic, sonic, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_sonic_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_spectral" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Spectral damage=[[@{bb_minor_explosive_death_spectral_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as spectral, spectral, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_spectral_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_minor_explosive_death_vibrant" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Vibrant damage=[[@{bb_minor_explosive_death_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as vibrant, vibrant, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_minor_explosive_death_vibrant_description" type="text" readonly />
				</div>
			</span>
		</div>
		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_arcane" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Arcane damage=[[@{bb_major_explosive_death_arcane_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as disease, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_arcane_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_chemical" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Chemical damage=[[@{bb_major_explosive_death_chemical_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as disease, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_chemical_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_cold" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Cold damage=[[@{bb_major_explosive_death_cold_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as disease, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_cold_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_disease" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Disease damage=[[@{bb_major_explosive_death_disease_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as disease, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_disease_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_electricity" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Electricity damage=[[@{bb_major_explosive_death_electricity_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as electricity, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_electricity_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_heat" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Heat damage=[[@{bb_major_explosive_death_heat_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as heat, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_heat_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_mental" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Mental damage=[[@{bb_major_explosive_death_mental_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as mental, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_mental_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_physical" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Physical damage=[[@{bb_major_explosive_death_physical_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as physical, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_physical_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_poison" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Poison damage=[[@{bb_major_explosive_death_poison_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as poison, poison, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_poison_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_sonic" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Sonic damage=[[@{bb_major_explosive_death_sonic_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as sonic, sonic, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_sonic_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_spectral" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Spectral damage=[[@{bb_major_explosive_death_spectral_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as spectral, spectral, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_spectral_description" type="text" readonly />
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_major_explosive_death_vibrant" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Explosive Death </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Explosive Death}} {{Physical Resilience (fortitude)=**TN** [[12 + @{mr_total} + @{mob_skill_bonus}]]}} {{Vibrant damage=[[@{bb_major_explosive_death_damage_total}d6]]}} {{desc=In addition, if the monster has any ability that causes a special effect on an attack, such as vibrant, vibrant, or paralysis, creatures caught in the explosion must make a resilience check to resist that effect, even if they previously resisted it. If the monster has more than one such ability, the GM will decide which one applies.}}'" />
					<input class="custom" name="attr_bb_major_explosive_death_vibrant_description" type="text" readonly />
				</div>
			</span>
		</div>

		<!-- Facehugger -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_facehugger" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Facehugger <button type="action" name="act_facehuggerinfo" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>

		<!-- Gaze Attack -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_gaze_attack_1" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Gaze Attack <button type="action" name="act_bbgazeattack1info" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_gaze_attack_2" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Gaze Attack <button type="action" name="act_bbgazeattack2info" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_gaze_attack_3" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Gaze Attack <button type="action" name="act_bbgazeattack3info" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>

		<!-- Lair Action 1 -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_lair_action_1" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<input name="attr_bb_lair_action_2" type="hidden" class="show-ability" value="false" />
				<span class="ability">
					<div class="skillname">
						<label> Lair Actions </label>
					</div>
				</span>
				<span class="no-ability">
					<div class="skillname">
						<label> Lair Action </label>
					</div>
				</span>
				<div class="top-space">
					<button type="roll" value="@{bb_lair_action_1_roll_text}" />
					<input class="custom-long" name="attr_bb_lair_action_1_text" type="text" readonly />
				</div>
			</span>
		</div>

		<!-- Lair Action 2 -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_lair_action_2" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="top-space">
					<button type="roll" value="@{bb_lair_action_2_roll_text}" />
					<input class="custom-long" name="attr_bb_lair_action_2_text" type="text" readonly />
				</div>
			</span>
		</div>

		<!-- Lair Action 3 -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_lair_action_3" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="top-space">
					<button type="roll" value="@{bb_lair_action_3_roll_text}" />
					<input class="custom-long" name="attr_bb_lair_action_3_text" type="text" readonly />
				</div>
			</span>
		</div>

		<!-- Legendary Action -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_legendary_monster" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label class="legendary"> Legendary Action <button type="action" name="act_legendaryactioninfo" class="info-button generic-skill" /> </label>
				</div>
				<textarea class="legendary" name="attr_legendary_action"></textarea>
			</span>
		</div>

		<!-- Lycanthropy -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_lycanthropy" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Lycanthropy <button type="action" name="act_lycanthropyinfo" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>

		<!-- Mob -->
		<div class="monstrous-boon top-line">
			<input name="attr_ps_mob" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Mob <button type="action" name="act_mobinfo" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					Total Members <input name="attr_mob_member_count" type="text" />
				</div>
				<div class="top-space">
					Mob Hit Points <input name="attr_mob_hit_points_max" type="text" readonly />
					&nbsp;
					Current <input name="attr_mob_hit_points" type="text" />
				</div>
				<div class="top-space">
					Skill Bonus +<input name="attr_mob_skill_bonus" type="text" readonly />
					&nbsp;
					Damage Bonus +<input name="attr_mob_damage_bonus" type="text" readonly />
				</div>
			</span>
		</div>

		<!-- Poison Attack -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_poison_attack_1" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Poison Attack <button type="action" name="act_bbpoisonattack1info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{bb_poison_attack_1_roll_text}" />
					Roll Poison
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_poison_attack_2" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Poison Attack <button type="action" name="act_bbpoisonattack2info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{bb_poison_attack_2_roll_text}" />
					Roll Poison
				</div>
			</span>
		</div>

		<div class="monstrous-boon top-line">
			<input name="attr_bb_poison_attack_3" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Poison Attack <button type="action" name="act_bbpoisonattack3info" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{bb_poison_attack_3_roll_text}" />
					Roll Poison
				</div>
			</span>
		</div>

		<!-- Rend -->
		<div class="monstrous-boon top-line">
			<input name="attr_ps_rend" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Rend <button type="action" name="act_rendinfo" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Rend}} {{Rend damage=[[@{attack_tier}d6 + @{attack_attribute_modifier}]]}}'" />
					Roll Rend Damage
				</div>
			</span>
		</div>

		<!-- Shatter Weapons -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_shatter_weapons" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Shatter Weapons <button type="action" name="act_shatterweaponsinfo" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>
	
		<!-- Swallow Whole -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_swallow_whole" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Swallow Whole <button type="action" name="act_swallowwholeinfo" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{swallow_whole_roll_text}" />
					Roll Swallow Whole
				</div>
			</span>
		</div>
	
		<!-- Swarm -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_swarm" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Swarm <button type="action" name="act_swarminfo" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<button type="roll" value="@{swarm_reform_roll_text}" />
					Roll Swarm Reform
				</div>
				<div class="top-space">
					<button type="action" name="act-resetswarmhp" />
					Reset Swarm Hit Points
				</div>
			</span>
		</div>
	
		<!-- Tomb Rot -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_tomb_rot" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Tomb Rot <button type="action" name="act_tombrotinfo" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>

	</div>

	<div class="sheet-col">
		<div class="section-header">
			<label>	Defense	</label>
		</div>
		
		<div class="top-space bottom-pad">
			<label class="magic-type-container">
				<input name="attr_use_guard" type="checkbox" />
				<span class="magic-type combat-action"> Guard </span>
			</label>
			&nbsp;
			<label class="magic-type-container combat-action-container-right">
				<input name="attr_use_fight_defensively" type="checkbox" />
				<span class="magic-type combat-action"> Fight Defensively </span>
			</label>
			&nbsp;
			<label class="magic-type-container combat-action-container-far-right">
				<input name="attr_use_defensive_stance" type="checkbox" />
				<input name="attr_show_defensive_stance" type="hidden" class="show-rage" value="false" />
				<span class="magic-type combat-action"> Defensive Stance </span>
			</label>
		</div>

		<div class="top-space bottom-pad">
			<label class="magic-type-container">
				<input name="attr_use_protect" type="checkbox" />
				<span class="magic-type combat-action"> Protect </span>
			</label>
		</div>
	
		<div>
			<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
		</div>
		<div class="skillname">
			<label>
				Defend
				<br />
				<input name="attr_ps_stoic_defense" type="hidden" class="show-replacement-attribute" value="false" />
				<span class="skill-attribute default-attribute"> Agility </span>
				&shy;
				<span class="skill-attribute replacement-attribute"> Physique </span>
			</label>
			<input name="attr_defend_total" type="text" readonly />
			<input name="attr_defend_points" type="text" />
		</div>
		
		<div>
			<div class="advantage-toolbar">
				<input type="radio" id="radioGreatDisadvantageDefend" name="attr_defend_advantage" value="GreatDisadvantage">
				<label for="radioGreatDisadvantageDefend" class="left-end">GD</label>

				<input type="radio" id="radioDisadvantageDefend" name="attr_defend_advantage" value="Disadvantage">
				<label for="radioDisadvantageDefend">Dis</label>

				<input type="radio" id="radioNovantageDefend" name="attr_defend_advantage" value="Novantage" checked>
				<label for="radioNovantageDefend">N</label>

				<input type="radio" id="radioAdvantageDefend" name="attr_defend_advantage" value="Advantage">
				<label for="radioAdvantageDefend">Adv</label>

				<input type="radio" id="radioGreatAdvantageDefend" name="attr_defend_advantage" value="GreatAdvantage">
				<label for="radioGreatAdvantageDefend" class="right-end">GA</label> 
				
				<input name="attr_defend_advantage_text" type="hidden" />			
			</div>
			
			<div class="explode">
				<label class="tierpool"> Expl </label>
				<input name="attr_defend_explode" type="text" value="10" />
				+
			</div>
		</div>
		
		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Defend}} {{Defend (block) @{defend_advantage_text}=[[@{defend_block_roll} + @{defend_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_defendblockinfo" class="info-button" />
			<label class="skillapp"> Block </label>
			<label class="skill-tem-container">
				<input name="attr_defend_block_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_defend_block_roll" type="hidden" value="2d6" />
		</div>
		
		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Defend}} {{Defend (dodge) @{defend_advantage_text}=[[@{defend_dodge_roll} + @{defend_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_defenddodgeinfo" class="info-button" />
			<label class="skillapp"> Dodge </label>
			<label class="skill-tem-container">
				<input name="attr_defend_dodge_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_defend_dodge_roll" type="hidden" value="2d6" />
		</div>
		
		<div>
			<label class="tierpool"> Tier </label>
			<input name="attr_defend_tier" type="text" value="0" readonly />
			<label class="tierpool"> Pool </label>
			<input name="attr_defend_pool_total" type="text" readonly />
			<input name="attr_defend_pool_extra" type="text" />
		</div>
		<div>
			<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
		</div>

		<div class="skillname top-space top-line-bold">
			<label> Damage Resistance </label>
		</div>

		<div class="damage-resistance top-space">
			<span class="tiny-text dr-header">Total &nbsp; &nbsp; Natural &nbsp; &nbsp; Item &nbsp; &nbsp; Spell</span>
			<span class="tiny-text dr-header">Total &nbsp; &nbsp; Natural &nbsp; &nbsp; Item &nbsp; &nbsp; Spell</span>
			<div>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_physical" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Physical </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_physical" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Physical </label>
						</span>
						<span class="no-ability">
							<label> Physical </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_physical" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_physical_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_physical_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_physical_item" type="text" />
						<input name="attr_dr_physical_spell" type="text" />
					</span>
				</span>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_heat" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Heat </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_heat" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Heat </label>
						</span>
						<span class="no-ability">
							<label> Heat </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_heat" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_heat_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_heat_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_heat_item" type="text" />
						<input name="attr_dr_heat_spell" type="text" />
					</span>
				</span>
			</div>
			<div>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_arcane" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Arcane </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_arcane" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Arcane </label>
						</span>
						<span class="no-ability">
							<label> Arcane </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_arcane" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_arcane_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_arcane_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_arcane_item" type="text" />
						<input name="attr_dr_arcane_spell" type="text" />
					</span>
				</span>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_mental" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Mental </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_mental" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Mental </label>
						</span>
						<span class="no-ability">
							<label> Mental </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_mental" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_mental_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_mental_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_mental_item" type="text" />
						<input name="attr_dr_mental_spell" type="text" />
					</span>
				</span>
			</div>
			<div>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_chemical" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Chemical </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_chemical" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Chemical </label>
						</span>
						<span class="no-ability">
							<label> Chemical </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_chemical" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_chemical_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_chemical_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_chemical_item" type="text" />
						<input name="attr_dr_chemical_spell" type="text" />
					</span>
				</span>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_poison" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Poison </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_poison" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Poison </label>
						</span>
						<span class="no-ability">
							<label> Poison </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_poison" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_poison_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_poison_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_poison_item" type="text" />
						<input name="attr_dr_poison_spell" type="text" />
					</span>
				</span>
			</div>
			<div>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_cold" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Cold </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_cold" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Cold </label>
						</span>
						<span class="no-ability">
							<label> Cold </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_cold" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_cold_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_cold_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_cold_item" type="text" />
						<input name="attr_dr_cold_spell" type="text" />
					</span>
				</span>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_sonic" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Sonic </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_sonic" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Sonic </label>
						</span>
						<span class="no-ability">
							<label> Sonic </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_sonic" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_sonic_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_sonic_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_sonic_item" type="text" />
						<input name="attr_dr_sonic_spell" type="text" />
					</span>
				</span>
			</div>
			<div>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_disease" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Disease </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_disease" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Disease </label>
						</span>
						<span class="no-ability">
							<label> Disease </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_disease" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_disease_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_disease_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_disease_item" type="text" />
						<input name="attr_dr_disease_spell" type="text" />
					</span>
				</span>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_spectral" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Spectral </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_spectral" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Spectral </label>
						</span>
						<span class="no-ability">
							<label> Spectral </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_spectral" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_spectral_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_spectral_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_spectral_item" type="text" />
						<input name="attr_dr_spectral_spell" type="text" />
					</span>
				</span>
			</div>
			<div>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_electricity" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Electricity </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_electricity" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Electricity </label>
						</span>
						<span class="no-ability">
							<label> Electricity </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_electricity" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_electricity_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_electricity_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_electricity_item" type="text" />
						<input name="attr_dr_electricity_spell" type="text" />
					</span>
				</span>
				<span>
					<input name="attr_bb_major_natural_damage_vulnerability_vibrant" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="major-vulnerability"> Vibrant </label>
					</span>
					<span class="no-ability">
						<input name="attr_bb_minor_natural_damage_vulnerability_vibrant" type="hidden" class="show-ability" value="false" />
						<span class="ability">
							<label class="minor-vulnerability"> Vibrant </label>
						</span>
						<span class="no-ability">
							<label> Vibrant </label>
						</span>
					</span>
				</span>
				<span>
					<input name="attr_bb_natural_damage_immunity_vibrant" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<label class="immunity"> Immune </label>
					</span>
					<span class="no-ability">
						<input name="attr_dr_vibrant_total" type="text" class="final-number final-number-small" readonly />
						<input name="attr_dr_vibrant_natural" type="text" class="final-number partial-number-small" readonly />
						<input name="attr_dr_vibrant_item" type="text" />
						<input name="attr_dr_vibrant_spell" type="text" />
					</span>
				</span>
			</div>
		</div>
		
		<div class="damage-resistance top-space">
			<label> Armor </label>
			<input name="attr_armor_name" type="text" class="weapon armor" />
		</div>

		<div class="section-header top-space">
			<label> Resilience </label>
		</div>
		
		<div>
			<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
		</div>
		<div class="skillname">
			<label>
				Physical Resilience
				<br />
				<span class="skill-attribute"> Physique </span> 
			</label>
			<input name="attr_pr_total" type="text" readonly />
			<input name="attr_pr_points" type="text" />
		</div>
		
		<div>
			<div class="advantage-toolbar">
				<input type="radio" id="radioGreatDisadvantagePr" name="attr_pr_advantage" value="GreatDisadvantage">
				<label for="radioGreatDisadvantagePr" class="left-end">GD</label>

				<input type="radio" id="radioDisadvantagePr" name="attr_pr_advantage" value="Disadvantage">
				<label for="radioDisadvantagePr">Dis</label>

				<input type="radio" id="radioNovantagePr" name="attr_pr_advantage" value="Novantage" checked>
				<label for="radioNovantagePr">N</label>

				<input type="radio" id="radioAdvantagePr" name="attr_pr_advantage" value="Advantage">
				<label for="radioAdvantagePr">Adv</label>

				<input type="radio" id="radioGreatAdvantagePr" name="attr_pr_advantage" value="GreatAdvantage">
				<label for="radioGreatAdvantagePr" class="right-end">GA</label> 
				
				<input name="attr_pr_advantage_text" type="hidden" />			
			</div>
			
			<div class="explode">
				<label class="tierpool"> Expl </label>
				<input name="attr_pr_explode" type="text" value="10" />
				+
			</div>
		</div>
		
		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Physical Resilience}} {{Physical Resilience (constitution) @{pr_advantage_text}=[[@{pr_constitution_roll} + @{pr_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_prconstitutioninfo" class="info-button" />
			<label class="skillapp"> Constitution </label>
			<label class="skill-tem-container">
				<input name="attr_pr_constitution_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_pr_constitution_roll" type="hidden" value="2d6" />
		</div>
		
		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Physical Resilience}} {{Physical Resilience (fortitude) @{pr_advantage_text}=[[@{pr_fortitude_roll} + @{pr_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_prfortitudeinfo" class="info-button" />
			<label class="skillapp"> Fortitude </label>
			<label class="skill-tem-container">
				<input name="attr_pr_fortitude_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_pr_fortitude_roll" type="hidden" value="2d6" />
		</div>
		
		<div>
			<label class="tierpool"> Tier </label>
			<input name="attr_pr_tier" type="text" value="0" readonly />
			<label class="tierpool"> Pool </label>
			<input name="attr_pr_pool_total" type="text" readonly />
			<input name="attr_pr_pool_extra" type="text" />
		</div>
		<div>
			<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
		</div>

		<div class="top-line-bold">
			<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
		</div>
		<div class="skillname">
			<label>
				Mental Resilience
				<br />
				<span class="skill-attribute"> Wit </span> 
			</label>
			<input name="attr_mr_total" type="text" readonly />
			<input name="attr_mr_points" type="text" />
		</div>
		
		<div>
			<div class="advantage-toolbar">
				<input type="radio" id="radioGreatDisadvantageMr" name="attr_mr_advantage" value="GreatDisadvantage">
				<label for="radioGreatDisadvantageMr" class="left-end">GD</label>

				<input type="radio" id="radioDisadvantageMr" name="attr_mr_advantage" value="Disadvantage">
				<label for="radioDisadvantageMr">Dis</label>

				<input type="radio" id="radioNovantageMr" name="attr_mr_advantage" value="Novantage" checked>
				<label for="radioNovantageMr">N</label>

				<input type="radio" id="radioAdvantageMr" name="attr_mr_advantage" value="Advantage">
				<label for="radioAdvantageMr">Adv</label>

				<input type="radio" id="radioGreatAdvantageMr" name="attr_mr_advantage" value="GreatAdvantage">
				<label for="radioGreatAdvantageMr" class="right-end">GA</label> 
				
				<input name="attr_mr_advantage_text" type="hidden" />			
			</div>
			
			<div class="explode">
				<label class="tierpool"> Expl </label>
				<input name="attr_mr_explode" type="text" value="10" />
				+
			</div>
		</div>
		
		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Mental Resilience}} {{Mental Resilience (concentration) @{mr_advantage_text}=[[@{mr_concentration_roll} + @{mr_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_mrconcentrationinfo" class="info-button" />
			<label class="skillapp"> Concentration </label>
			<label class="skill-tem-container">
				<input name="attr_mr_concentration_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_mr_concentration_roll" type="hidden" value="2d6" />
		</div>
		
		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Mental Resilience}} {{Mental Resilience (willpower) @{mr_advantage_text}=[[@{mr_willpower_roll} + @{mr_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_mrwillpowerinfo" class="info-button" />
			<label class="skillapp"> Willpower </label>
			<label class="skill-tem-container">
				<input name="attr_mr_willpower_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_mr_willpower_roll" type="hidden" value="2d6" />
		</div>
		
		<div>
			<label class="tierpool"> Tier </label>
			<input name="attr_mr_tier" type="text" value="0" readonly />
			<label class="tierpool"> Pool </label>
			<input name="attr_mr_pool_total" type="text" readonly />
			<input name="attr_mr_pool_extra" type="text" />
		</div>
		<div>
			<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
		</div>

		<!-- Minor Aura of Protection -->
		<div class="monstrous-boon top-line long-boon-name">
			<input name="attr_bb_minor_aura_of_protection" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Minor Aura of Protection <button type="action" name="act_minorauraofprotectioninfo" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>

		<!-- Major Aura of Protection -->
		<div class="monstrous-boon top-line long-boon-name">
			<input name="attr_bb_major_aura_of_protection" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Major Aura of Protection <button type="action" name="act_majorauraofprotectioninfo" class="info-button generic-skill" /> </label>
				</div>
			</span>
		</div>

		<!-- Regenerate -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_regenerate" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label> Regenerate <button type="action" name="act_regenerateinfo" class="info-button generic-skill" /> </label>
				</div>
				<div class="top-space">
					<button type="action" name="act_rollregeneratehealing" />
					Roll Regenerate Healing
				</div>
			</span>
		</div>

		<!-- Total Magic Immunity -->
		<div class="monstrous-boon top-line">
			<input name="attr_bb_total_magic_immunity" type="hidden" class="show-ability" value="false" />
			<span class="ability">
				<div class="skillname">
					<label class="legendary"> Total Magic Immunity <button type="action" name="act_totalmagicimmunityinfo" class="info-button generic-skill" /> </label>
				</div>
				<textarea class="large" name="attr_total_magic_immunity_exceptions"></textarea>
			</span>
		</div>

	</div>

</div>

<div class="sheet-3colrow top-space">
	<div class="sheet-col">
		<div class="section-header">
			<label> Active Skills </label>
			<button type="action" name="act_toggleactiveskills" class="toggle" />
		</div>
	</div>
	<div class="sheet-col">
		<div class="section-header">
			&shy;
		</div>
	</div>
	<div class="sheet-col">
		<div class="section-header">
			<label> Passive Skills </label>
			<button type="action" name="act_togglepassiveskills" class="toggle" />
		</div>
	</div>
</div>

<div class="sheet-3colrow">
	<div class="sheet-col">
	
		<div>
			<input name="attr_show_athletics" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div>
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Athletics
						<br />
						<input name="attr_ps_dexterous_athletics" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Physique </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Agility </span>
					</label>
					<input name="attr_athletics_total" type="text" readonly />
					<input name="attr_athletics_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageAthletics" name="attr_athletics_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageAthletics" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageAthletics" name="attr_athletics_advantage" value="Disadvantage">
						<label for="radioDisadvantageAthletics">Dis</label>

						<input type="radio" id="radioNovantageAthletics" name="attr_athletics_advantage" value="Novantage" checked>
						<label for="radioNovantageAthletics">N</label>

						<input type="radio" id="radioAdvantageAthletics" name="attr_athletics_advantage" value="Advantage">
						<label for="radioAdvantageAthletics">Adv</label>

						<input type="radio" id="radioGreatAdvantageAthletics" name="attr_athletics_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageAthletics" class="right-end">GA</label> 
						
						<input name="attr_athletics_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_athletics_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Athletics}} {{Athletics (climb) @{athletics_advantage_text}=[[@{athletics_climb_roll} + @{athletics_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_athleticsclimbinfo" class="info-button" />
					<label class="skillapp"> Climb </label>
					<label class="skill-tem-container">
						<input name="attr_athletics_climb_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_athletics_climb_roll" type="hidden" value="2d6" />
				</div>

				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Athletics}} {{Athletics (elusive movement) @{athletics_advantage_text}=[[@{athletics_elusive_movement_roll} + @{athletics_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_athleticselusivemovementinfo" class="info-button" />
					<label class="skillapp longname"> Elusive Movement </label>
					<label class="skill-tem-container">
						<input name="attr_athletics_elusive_movement_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_athletics_elusive_movement_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Athletics}} {{Athletics (feat) @{athletics_advantage_text}=[[@{athletics_feat_roll} + @{athletics_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_athleticsfeatinfo" class="info-button" />
					<label class="skillapp"> Feat </label>
					<label class="skill-tem-container">
						<input name="attr_athletics_feat_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_athletics_feat_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Athletics}} {{Athletics (gymnastics) @{athletics_advantage_text}=[[@{athletics_gymnastics_roll} + @{athletics_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_athleticsgymnasticsinfo" class="info-button" />
					<label class="skillapp"> Gymnastics </label>
					<label class="skill-tem-container">
						<input name="attr_athletics_gymnastics_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_athletics_gymnastics_roll" type="hidden" value="2d6" />
				</div>

				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Athletics}} {{Athletics (jump) @{athletics_advantage_text}=[[@{athletics_jump_roll} + @{athletics_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_athleticsjumpinfo" class="info-button" />
					<label class="skillapp"> Jump </label>
					<label class="skill-tem-container">
						<input name="attr_athletics_jump_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_athletics_jump_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Athletics}} {{Athletics (swim) @{athletics_advantage_text}=[[@{athletics_swim_roll} + @{athletics_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_athleticsswiminfo" class="info-button" />
					<label class="skillapp"> Swim </label>
					<label class="skill-tem-container">
						<input name="attr_athletics_swim_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_athletics_swim_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<label class="tierpool"> Tier </label>
					<input name="attr_athletics_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_athletics_pool_total" type="text" readonly />
					<input name="attr_athletics_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_medicine" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Medicine
						<br />
						<span class="skill-attribute"> Intelligence </span> 
					</label>
					<input name="attr_medicine_total" type="text" readonly />
					<input name="attr_medicine_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageMedicine" name="attr_medicine_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageMedicine" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageMedicine" name="attr_medicine_advantage" value="Disadvantage">
						<label for="radioDisadvantageMedicine">Dis</label>

						<input type="radio" id="radioNovantageMedicine" name="attr_medicine_advantage" value="Novantage" checked>
						<label for="radioNovantageMedicine">N</label>

						<input type="radio" id="radioAdvantageMedicine" name="attr_medicine_advantage" value="Advantage">
						<label for="radioAdvantageMedicine">Adv</label>

						<input type="radio" id="radioGreatAdvantageMedicine" name="attr_medicine_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageMedicine" class="right-end">GA</label> 

						<input name="attr_medicine_advantage_text" type="hidden" />
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_medicine_explode" type="text" value="10" />
						+
					</div>
				</div>

				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Medicine}} {{Medicine (diagnose) @{medicine_advantage_text}=[[@{medicine_diagnose_roll} + @{medicine_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_medicinediagnoseinfo" class="info-button" />
					<label class="skillapp"> Diagnose </label>
					<label class="skill-tem-container">
						<input name="attr_medicine_diagnose_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_medicine_diagnose_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Medicine}} {{Medicine (first aid) @{medicine_advantage_text}=[[@{medicine_first_aid_roll} + @{medicine_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_medicinefirstaidinfo" class="info-button" />
					<label class="skillapp"> First Aid </label>
					<label class="skill-tem-container">
						<input name="attr_medicine_first_aid_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_medicine_first_aid_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Medicine}} {{Medicine (long-term care) @{medicine_advantage_text}=[[@{medicine_long_term_care_roll} + @{medicine_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_medicinelongtermcareinfo" class="info-button" />
					<label class="skillapp"> Long-term Care </label>
					<label class="skill-tem-container">
						<input name="attr_medicine_long_term_care_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_medicine_long_term_care_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<label class="tierpool"> Tier </label>
					<input name="attr_medicine_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_medicine_pool_total" type="text" readonly />
					<input name="attr_medicine_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_nature" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Nature
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_nature_total" type="text" readonly />
					<input name="attr_nature_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageNature" name="attr_nature_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageNature" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageNature" name="attr_nature_advantage" value="Disadvantage">
						<label for="radioDisadvantageNature">Dis</label>

						<input type="radio" id="radioNovantageNature" name="attr_nature_advantage" value="Novantage" checked>
						<label for="radioNovantageNature">N</label>

						<input type="radio" id="radioAdvantageNature" name="attr_nature_advantage" value="Advantage">
						<label for="radioAdvantageNature">Adv</label>

						<input type="radio" id="radioGreatAdvantageNature" name="attr_nature_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageNature" class="right-end">GA</label> 

						<input name="attr_nature_advantage_text" type="hidden" />
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_nature_explode" type="text" value="10" />
						+
					</div>
				</div>

				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Nature}} {{Nature (handle animal) @{nature_advantage_text}=[[@{nature_handle_animal_roll} + @{nature_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_naturehandleanimalinfo" class="info-button" />
					<label class="skillapp"> Handle Animal </label>
					<label class="skill-tem-container">
						<input name="attr_nature_handle_animal_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_nature_handle_animal_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Nature}} {{Nature (sustain) @{nature_advantage_text}=[[@{nature_sustain_roll} + @{nature_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_naturesustaininfo" class="info-button" />
					<label class="skillapp"> Sustain </label>
					<label class="skill-tem-container">
						<input name="attr_nature_sustain_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_nature_sustain_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Nature}} {{Nature (track) @{nature_advantage_text}=[[@{nature_track_roll} + @{nature_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_naturetrackinfo" class="info-button" />
					<label class="skillapp"> Track </label>
					<label class="skill-tem-container">
						<input name="attr_nature_track_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_nature_track_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<label class="tierpool"> Tier </label>
					<input name="attr_nature_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_nature_pool_total" type="text" readonly />
					<input name="attr_nature_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

	</div>

	<div class="sheet-col">

		<div>
			<input name="attr_show_persuade" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div>
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Persuade
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_persuade_total" type="text" readonly />
					<input name="attr_persuade_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantagePersuade" name="attr_persuade_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantagePersuade" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantagePersuade" name="attr_persuade_advantage" value="Disadvantage">
						<label for="radioDisadvantagePersuade">Dis</label>

						<input type="radio" id="radioNovantagePersuade" name="attr_persuade_advantage" value="Novantage" checked>
						<label for="radioNovantagePersuade">N</label>

						<input type="radio" id="radioAdvantagePersuade" name="attr_persuade_advantage" value="Advantage">
						<label for="radioAdvantagePersuade">Adv</label>

						<input type="radio" id="radioGreatAdvantagePersuade" name="attr_persuade_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantagePersuade" class="right-end">GA</label> 
						
						<input name="attr_persuade_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_persuade_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Persuade}} {{Persuade (bluff) @{persuade_advantage_text}=[[@{persuade_bluff_roll} + @{persuade_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_persuadebluffinfo" class="info-button" />
					<label class="skillapp"> Bluff </label>
					<label class="skill-tem-container">
						<input name="attr_persuade_bluff_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_persuade_bluff_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Persuade}} {{Persuade (diplomacy) @{persuade_advantage_text}=[[@{persuade_diplomacy_roll} + @{persuade_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_persuadediplomacyinfo" class="info-button" />
					<label class="skillapp"> Diplomacy </label>
					<label class="skill-tem-container">
						<input name="attr_persuade_diplomacy_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_persuade_diplomacy_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Persuade}} {{Persuade (intimidate) @{persuade_advantage_text}=[[@{persuade_intimidate_roll} + @{persuade_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_persuadeintimidateinfo" class="info-button" />
					<label class="skillapp"> Intimidate </label>
					<label class="skill-tem-container">
						<input name="attr_persuade_intimidate_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_persuade_intimidate_roll" type="hidden" value="2d6" />
				</div>

				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Persuade}} {{Persuade (intuition) @{persuade_advantage_text}=[[@{persuade_intuition_roll} + @{persuade_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_persuadeintuitioninfo" class="info-button" />
					<label class="skillapp"> Intuition </label>
					<label class="skill-tem-container">
						<input name="attr_persuade_intuition_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_persuade_intuition_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<label class="tierpool"> Tier </label>
					<input name="attr_persuade_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_persuade_pool_total" type="text" readonly />
					<input name="attr_persuade_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_security" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Security
						<br />
						<span class="skill-attribute"> Agility </span> 
					</label>
					<input name="attr_security_total" type="text" readonly />
					<input name="attr_security_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageSecurity" name="attr_security_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageSecurity" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageSecurity" name="attr_security_advantage" value="Disadvantage">
						<label for="radioDisadvantageSecurity">Dis</label>

						<input type="radio" id="radioNovantageSecurity" name="attr_security_advantage" value="Novantage" checked>
						<label for="radioNovantageSecurity">N</label>

						<input type="radio" id="radioAdvantageSecurity" name="attr_security_advantage" value="Advantage">
						<label for="radioAdvantageSecurity">Adv</label>

						<input type="radio" id="radioGreatAdvantageSecurity" name="attr_security_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageSecurity" class="right-end">GA</label> 

						<input name="attr_security_advantage_text" type="hidden" />
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_security_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Security}} {{Security (disable device) @{security_advantage_text}=[[@{security_disable_device_roll} + @{security_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_securitydisabledeviceinfo" class="info-button" />
					<label class="skillapp"> Disable Device </label>
					<label class="skill-tem-container">
						<input name="attr_security_disable_device_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_security_disable_device_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Security}} {{Security (pick locks) @{security_advantage_text}=[[@{security_pick_locks_roll} + @{security_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_securitypicklocksinfo" class="info-button" />
					<label class="skillapp"> Pick Locks </label>
					<label class="skill-tem-container">
						<input name="attr_security_pick_locks_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_security_pick_locks_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<label class="tierpool"> Tier </label>
					<input name="attr_security_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_security_pool_total" type="text" readonly />
					<input name="attr_security_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_sneak" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Sneak
						<br />
						<span class="skill-attribute"> Agility </span> 
					</label>
					<input name="attr_sneak_total" type="text" readonly />
					<input name="attr_sneak_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageSneak" name="attr_sneak_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageSneak" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageSneak" name="attr_sneak_advantage" value="Disadvantage">
						<label for="radioDisadvantageSneak">Dis</label>

						<input type="radio" id="radioNovantageSneak" name="attr_sneak_advantage" value="Novantage" checked>
						<label for="radioNovantageSneak">N</label>

						<input type="radio" id="radioAdvantageSneak" name="attr_sneak_advantage" value="Advantage">
						<label for="radioAdvantageSneak">Adv</label>

						<input type="radio" id="radioGreatAdvantageSneak" name="attr_sneak_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageSneak" class="right-end">GA</label> 
						
						<input name="attr_sneak_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_sneak_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Sneak}} {{Sneak (escapology) @{sneak_advantage_text}=[[@{sneak_escapology_roll} + @{sneak_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_sneakescapologyinfo" class="info-button" />
					<label class="skillapp"> Escapology </label>
					<label class="skill-tem-container">
						<input name="attr_sneak_escapology_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_sneak_escapology_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Sneak}} {{Sneak (sleight of hand) @{sneak_advantage_text}=[[@{sneak_sleight_of_hand_roll} + @{sneak_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_sneaksleightofhandinfo" class="info-button" />
					<label class="skillapp"> Sleight of Hand </label>
					<label class="skill-tem-container">
						<input name="attr_sneak_sleight_of_hand_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_sneak_sleight_of_hand_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Sneak}} {{Sneak (stealth) @{sneak_advantage_text}=[[@{sneak_stealth_roll} + @{sneak_total} + @{mob_skill_bonus}]]}}'" />
					<button type="action" name="act_sneakstealthinfo" class="info-button" />
					<label class="skillapp"> Stealth </label>
					<label class="skill-tem-container">
						<input name="attr_sneak_stealth_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_sneak_stealth_roll" type="hidden" value="2d6" />
				</div>
				
				<div>
					<label class="tierpool"> Tier </label>
					<input name="attr_sneak_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_sneak_pool_total" type="text" readonly />
					<input name="attr_sneak_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

	</div>

	<div class="sheet-col">
		<div>
			<input name="attr_show_passive_skills" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<textarea name="attr_passive_skills" rows="7" />
			</span>
		</div>

		<div class="section-header top-space">
			<label> Boons &amp; Banes </label>
			<button type="action" name="act_toggleboonsbanes" class="toggle" />
		</div>

		<div>
			<input name="attr_show_boons_and_banes" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<textarea name="attr_boons_and_banes" rows="10" class="boons-banes" />
			</span>
		</div>

		<div class="section-header top-space">
			<label> Carry </label>
			<button type="action" name="act_togglecarry" class="toggle" />
		</div>
		
		<div>
			<input name="attr_show_carry" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<b> Current </b>
				<input name="attr_carry_current" type="text" readonly />
				<b> &nbsp; Carry </b>
				<input name="attr_carry" type="text" readonly />
				<b> &nbsp; Max </b>
				<input name="attr_carry_max" type="text" readonly />

				<div class="section-header top-space">
					<label> Equipment (Carry) </label>
				</div>

				<textarea name="attr_equipment_carry" rows="7" />

				<div class="section-header top-space">
					<label> Equipment (Non-Carry) </label>
				</div>

				<textarea name="attr_equipment_non_carry" rows="7" />

				<div class="section-header top-space">
					<label> Money </label>
				</div>

				<b> GC </b>
				<input name="attr_money_gold_coins" type="text" class="longnumber" />
				<b> &nbsp; SC </b>
				<input name="attr_money_silver_coins" type="text" class="longnumber" />
				<b> &nbsp; CC </b>
				<input name="attr_money_copper_coins" type="text" class="longnumber" />
			</span>
		</div>
		
		<div>
			<!-- <input name="attr_show_carry" type="hidden" class="show-ability" value="true" /> -->
			<span class="ability">
				<div class="section-header top-space">
					<label> Cinema Points </label>
				</div>
				<button type="action" name="act_cinemapointsinfo" class="info-button" />
				<b> Cinema Points </b>
				<input name="attr_cinema_points" type="text" />
			</span>
		</div>

	</div>
</div>

<div class="sheet-3colrow top-space">
	<div class="sheet-col">
		<div class="section-header">
			<label> Proficiencies </label>
			<button type="action" name="act_toggleproficiencies" class="toggle" />
		</div>
	</div>
	<div class="sheet-col">
		<div class="section-header">
			&shy;
		</div>
	</div>
	<div class="sheet-col">
		<div class="section-header">
			<label> Languages </label>
			<button type="action" name="act_togglelanguages" class="toggle" />
		</div>
	</div>
</div>

<div class="sheet-3colrow">

	<div class="sheet-col">

		<div>
			<input name="attr_show_craft1" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div>
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Craft 1
						<button type="action" name="act_craftinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Physique </span> 
					</label>
					<input name="attr_craft1_total" type="text" readonly />
					<input name="attr_craft1_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageCraft" name="attr_craft1_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageCraft" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageCraft" name="attr_craft1_advantage" value="Disadvantage">
						<label for="radioDisadvantageCraft">Dis</label>

						<input type="radio" id="radioNovantageCraft" name="attr_craft1_advantage" value="Novantage" checked>
						<label for="radioNovantageCraft">N</label>

						<input type="radio" id="radioAdvantageCraft" name="attr_craft1_advantage" value="Advantage">
						<label for="radioAdvantageCraft">Adv</label>

						<input type="radio" id="radioGreatAdvantageCraft" name="attr_craft1_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageCraft" class="right-end">GA</label> 
						
						<input name="attr_craft1_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_craft1_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Craft}} {{Craft (@{craft1_type_name}) @{craft1_advantage_text}=[[@{craft1_type_roll} + @{craft1_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_craft1_type_name" type="text" placeholder="type of craft" />
					<label class="skill-tem-container">
						<input name="attr_craft1_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_craft1_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_craft2" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Craft 2
						<button type="action" name="act_craftinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Physique </span> 
					</label>
					<input name="attr_craft2_total" type="text" readonly />
					<input name="attr_craft2_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageCraft" name="attr_craft2_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageCraft" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageCraft" name="attr_craft2_advantage" value="Disadvantage">
						<label for="radioDisadvantageCraft">Dis</label>

						<input type="radio" id="radioNovantageCraft" name="attr_craft2_advantage" value="Novantage" checked>
						<label for="radioNovantageCraft">N</label>

						<input type="radio" id="radioAdvantageCraft" name="attr_craft2_advantage" value="Advantage">
						<label for="radioAdvantageCraft">Adv</label>

						<input type="radio" id="radioGreatAdvantageCraft" name="attr_craft2_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageCraft" class="right-end">GA</label> 
						
						<input name="attr_craft2_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_craft2_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Craft}} {{Craft (@{craft2_type_name}) @{craft2_advantage_text}=[[@{craft2_type_roll} + @{craft2_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_craft2_type_name" type="text" placeholder="type of craft" />
					<label class="skill-tem-container">
						<input name="attr_craft2_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_craft2_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_craft3" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Craft 3
						<button type="action" name="act_craftinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Physique </span> 
					</label>
					<input name="attr_craft3_total" type="text" readonly />
					<input name="attr_craft3_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageCraft" name="attr_craft3_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageCraft" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageCraft" name="attr_craft3_advantage" value="Disadvantage">
						<label for="radioDisadvantageCraft">Dis</label>

						<input type="radio" id="radioNovantageCraft" name="attr_craft3_advantage" value="Novantage" checked>
						<label for="radioNovantageCraft">N</label>

						<input type="radio" id="radioAdvantageCraft" name="attr_craft3_advantage" value="Advantage">
						<label for="radioAdvantageCraft">Adv</label>

						<input type="radio" id="radioGreatAdvantageCraft" name="attr_craft3_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageCraft" class="right-end">GA</label> 
						
						<input name="attr_craft3_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_craft3_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Craft}} {{Craft (@{craft3_type_name}) @{craft3_advantage_text}=[[@{craft3_type_roll} + @{craft3_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_craft3_type_name" type="text" placeholder="type of craft" />
					<label class="skill-tem-container">
						<input name="attr_craft3_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_craft3_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_craft4" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Craft 4
						<button type="action" name="act_craftinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Physique </span> 
					</label>
					<input name="attr_craft4_total" type="text" readonly />
					<input name="attr_craft4_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageCraft" name="attr_craft4_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageCraft" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageCraft" name="attr_craft4_advantage" value="Disadvantage">
						<label for="radioDisadvantageCraft">Dis</label>

						<input type="radio" id="radioNovantageCraft" name="attr_craft4_advantage" value="Novantage" checked>
						<label for="radioNovantageCraft">N</label>

						<input type="radio" id="radioAdvantageCraft" name="attr_craft4_advantage" value="Advantage">
						<label for="radioAdvantageCraft">Adv</label>

						<input type="radio" id="radioGreatAdvantageCraft" name="attr_craft4_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageCraft" class="right-end">GA</label> 
						
						<input name="attr_craft4_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_craft4_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Craft}} {{Craft (@{craft4_type_name}) @{craft4_advantage_text}=[[@{craft4_type_roll} + @{craft4_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_craft4_type_name" type="text" placeholder="type of craft" />
					<label class="skill-tem-container">
						<input name="attr_craft4_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_craft4_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_craft5" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Craft 5
						<button type="action" name="act_craftinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Physique </span> 
					</label>
					<input name="attr_craft5_total" type="text" readonly />
					<input name="attr_craft5_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageCraft" name="attr_craft5_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageCraft" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageCraft" name="attr_craft5_advantage" value="Disadvantage">
						<label for="radioDisadvantageCraft">Dis</label>

						<input type="radio" id="radioNovantageCraft" name="attr_craft5_advantage" value="Novantage" checked>
						<label for="radioNovantageCraft">N</label>

						<input type="radio" id="radioAdvantageCraft" name="attr_craft5_advantage" value="Advantage">
						<label for="radioAdvantageCraft">Adv</label>

						<input type="radio" id="radioGreatAdvantageCraft" name="attr_craft5_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageCraft" class="right-end">GA</label> 
						
						<input name="attr_craft5_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_craft5_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Craft}} {{Craft (@{craft5_type_name}) @{craft5_advantage_text}=[[@{craft5_type_roll} + @{craft5_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_craft5_type_name" type="text" placeholder="type of craft" />
					<label class="skill-tem-container">
						<input name="attr_craft5_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_craft5_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_craft_tier" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_craft_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_craft_pool_total" type="text" readonly />
					<input name="attr_craft_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_knowledge1" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Knowledge 1
						<button type="action" name="act_knowledgeinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Intelligence </span> 
					</label>
					<input name="attr_knowledge1_total" type="text" readonly />
					<input name="attr_knowledge1_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageKnowledge" name="attr_knowledge1_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageKnowledge" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageKnowledge" name="attr_knowledge1_advantage" value="Disadvantage">
						<label for="radioDisadvantageKnowledge">Dis</label>

						<input type="radio" id="radioNovantageKnowledge" name="attr_knowledge1_advantage" value="Novantage" checked>
						<label for="radioNovantageKnowledge">N</label>

						<input type="radio" id="radioAdvantageKnowledge" name="attr_knowledge1_advantage" value="Advantage">
						<label for="radioAdvantageKnowledge">Adv</label>

						<input type="radio" id="radioGreatAdvantageKnowledge" name="attr_knowledge1_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageKnowledge" class="right-end">GA</label> 
						
						<input name="attr_knowledge1_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_knowledge1_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Knowledge}} {{Knowledge (@{knowledge1_type_name}) @{knowledge1_advantage_text}=[[@{knowledge1_type_roll} + @{knowledge1_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_knowledge1_type_name" type="text" placeholder="type of knowledge" />
					<label class="skill-tem-container">
						<input name="attr_knowledge1_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_knowledge1_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_knowledge2" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Knowledge 2
						<button type="action" name="act_knowledgeinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Intelligence </span> 
					</label>
					<input name="attr_knowledge2_total" type="text" readonly />
					<input name="attr_knowledge2_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageKnowledge" name="attr_knowledge2_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageKnowledge" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageKnowledge" name="attr_knowledge2_advantage" value="Disadvantage">
						<label for="radioDisadvantageKnowledge">Dis</label>

						<input type="radio" id="radioNovantageKnowledge" name="attr_knowledge2_advantage" value="Novantage" checked>
						<label for="radioNovantageKnowledge">N</label>

						<input type="radio" id="radioAdvantageKnowledge" name="attr_knowledge2_advantage" value="Advantage">
						<label for="radioAdvantageKnowledge">Adv</label>

						<input type="radio" id="radioGreatAdvantageKnowledge" name="attr_knowledge2_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageKnowledge" class="right-end">GA</label> 
						
						<input name="attr_knowledge2_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_knowledge2_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Knowledge}} {{Knowledge (@{knowledge2_type_name}) @{knowledge2_advantage_text}=[[@{knowledge2_type_roll} + @{knowledge2_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_knowledge2_type_name" type="text" placeholder="type of knowledge" />
					<label class="skill-tem-container">
						<input name="attr_knowledge2_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_knowledge2_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_knowledge3" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Knowledge 3
						<button type="action" name="act_knowledgeinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Intelligence </span> 
					</label>
					<input name="attr_knowledge3_total" type="text" readonly />
					<input name="attr_knowledge3_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageKnowledge" name="attr_knowledge3_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageKnowledge" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageKnowledge" name="attr_knowledge3_advantage" value="Disadvantage">
						<label for="radioDisadvantageKnowledge">Dis</label>

						<input type="radio" id="radioNovantageKnowledge" name="attr_knowledge3_advantage" value="Novantage" checked>
						<label for="radioNovantageKnowledge">N</label>

						<input type="radio" id="radioAdvantageKnowledge" name="attr_knowledge3_advantage" value="Advantage">
						<label for="radioAdvantageKnowledge">Adv</label>

						<input type="radio" id="radioGreatAdvantageKnowledge" name="attr_knowledge3_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageKnowledge" class="right-end">GA</label> 
						
						<input name="attr_knowledge3_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_knowledge3_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Knowledge}} {{Knowledge (@{knowledge3_type_name}) @{knowledge3_advantage_text}=[[@{knowledge3_type_roll} + @{knowledge3_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_knowledge3_type_name" type="text" placeholder="type of knowledge" />
					<label class="skill-tem-container">
						<input name="attr_knowledge3_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_knowledge3_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

	</div>

	<div class="sheet-col">
	
		<div>
			<input name="attr_show_knowledge4" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div>
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Knowledge 4
						<button type="action" name="act_knowledgeinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Intelligence </span> 
					</label>
					<input name="attr_knowledge4_total" type="text" readonly />
					<input name="attr_knowledge4_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageKnowledge" name="attr_knowledge4_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageKnowledge" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageKnowledge" name="attr_knowledge4_advantage" value="Disadvantage">
						<label for="radioDisadvantageKnowledge">Dis</label>

						<input type="radio" id="radioNovantageKnowledge" name="attr_knowledge4_advantage" value="Novantage" checked>
						<label for="radioNovantageKnowledge">N</label>

						<input type="radio" id="radioAdvantageKnowledge" name="attr_knowledge4_advantage" value="Advantage">
						<label for="radioAdvantageKnowledge">Adv</label>

						<input type="radio" id="radioGreatAdvantageKnowledge" name="attr_knowledge4_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageKnowledge" class="right-end">GA</label> 
						
						<input name="attr_knowledge4_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_knowledge4_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Knowledge}} {{Knowledge (@{knowledge4_type_name}) @{knowledge4_advantage_text}=[[@{knowledge4_type_roll} + @{knowledge4_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_knowledge4_type_name" type="text" placeholder="type of knowledge" />
					<label class="skill-tem-container">
						<input name="attr_knowledge4_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_knowledge4_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_knowledge5" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Knowledge 5
						<button type="action" name="act_knowledgeinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Intelligence </span> 
					</label>
					<input name="attr_knowledge5_total" type="text" readonly />
					<input name="attr_knowledge5_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageKnowledge" name="attr_knowledge5_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageKnowledge" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageKnowledge" name="attr_knowledge5_advantage" value="Disadvantage">
						<label for="radioDisadvantageKnowledge">Dis</label>

						<input type="radio" id="radioNovantageKnowledge" name="attr_knowledge5_advantage" value="Novantage" checked>
						<label for="radioNovantageKnowledge">N</label>

						<input type="radio" id="radioAdvantageKnowledge" name="attr_knowledge5_advantage" value="Advantage">
						<label for="radioAdvantageKnowledge">Adv</label>

						<input type="radio" id="radioGreatAdvantageKnowledge" name="attr_knowledge5_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageKnowledge" class="right-end">GA</label> 
						
						<input name="attr_knowledge5_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_knowledge5_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Knowledge}} {{Knowledge (@{knowledge5_type_name}) @{knowledge5_advantage_text}=[[@{knowledge5_type_roll} + @{knowledge5_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_knowledge5_type_name" type="text" placeholder="type of knowledge" />
					<label class="skill-tem-container">
						<input name="attr_knowledge5_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_knowledge5_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_knowledge_tier" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_knowledge_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_knowledge_pool_total" type="text" readonly />
					<input name="attr_knowledge_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_perform1" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Perform 1
						<button type="action" name="act_performinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_perform1_total" type="text" readonly />
					<input name="attr_perform1_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantagePerform" name="attr_perform1_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantagePerform" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantagePerform" name="attr_perform1_advantage" value="Disadvantage">
						<label for="radioDisadvantagePerform">Dis</label>

						<input type="radio" id="radioNovantagePerform" name="attr_perform1_advantage" value="Novantage" checked>
						<label for="radioNovantagePerform">N</label>

						<input type="radio" id="radioAdvantagePerform" name="attr_perform1_advantage" value="Advantage">
						<label for="radioAdvantagePerform">Adv</label>

						<input type="radio" id="radioGreatAdvantagePerform" name="attr_perform1_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantagePerform" class="right-end">GA</label> 
						
						<input name="attr_perform1_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_perform1_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Perform}} {{Perform (@{perform1_type_name}) @{perform1_advantage_text}=[[@{perform1_type_roll} + @{perform1_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_perform1_type_name" type="text" placeholder="type of perform" />
					<label class="skill-tem-container">
						<input name="attr_perform1_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_perform1_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_perform2" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Perform 2
						<button type="action" name="act_performinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_perform2_total" type="text" readonly />
					<input name="attr_perform2_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantagePerform" name="attr_perform2_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantagePerform" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantagePerform" name="attr_perform2_advantage" value="Disadvantage">
						<label for="radioDisadvantagePerform">Dis</label>

						<input type="radio" id="radioNovantagePerform" name="attr_perform2_advantage" value="Novantage" checked>
						<label for="radioNovantagePerform">N</label>

						<input type="radio" id="radioAdvantagePerform" name="attr_perform2_advantage" value="Advantage">
						<label for="radioAdvantagePerform">Adv</label>

						<input type="radio" id="radioGreatAdvantagePerform" name="attr_perform2_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantagePerform" class="right-end">GA</label> 
						
						<input name="attr_perform2_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_perform2_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Perform}} {{Perform (@{perform2_type_name}) @{perform2_advantage_text}=[[@{perform2_type_roll} + @{perform2_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_perform2_type_name" type="text" placeholder="type of perform" />
					<label class="skill-tem-container">
						<input name="attr_perform2_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_perform2_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_perform3" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Perform 3
						<button type="action" name="act_performinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_perform3_total" type="text" readonly />
					<input name="attr_perform3_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantagePerform" name="attr_perform3_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantagePerform" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantagePerform" name="attr_perform3_advantage" value="Disadvantage">
						<label for="radioDisadvantagePerform">Dis</label>

						<input type="radio" id="radioNovantagePerform" name="attr_perform3_advantage" value="Novantage" checked>
						<label for="radioNovantagePerform">N</label>

						<input type="radio" id="radioAdvantagePerform" name="attr_perform3_advantage" value="Advantage">
						<label for="radioAdvantagePerform">Adv</label>

						<input type="radio" id="radioGreatAdvantagePerform" name="attr_perform3_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantagePerform" class="right-end">GA</label> 
						
						<input name="attr_perform3_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_perform3_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Perform}} {{Perform (@{perform3_type_name}) @{perform3_advantage_text}=[[@{perform3_type_roll} + @{perform3_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_perform3_type_name" type="text" placeholder="type of perform" />
					<label class="skill-tem-container">
						<input name="attr_perform3_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_perform3_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_perform4" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Perform 4
						<button type="action" name="act_performinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_perform4_total" type="text" readonly />
					<input name="attr_perform4_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantagePerform" name="attr_perform4_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantagePerform" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantagePerform" name="attr_perform4_advantage" value="Disadvantage">
						<label for="radioDisadvantagePerform">Dis</label>

						<input type="radio" id="radioNovantagePerform" name="attr_perform4_advantage" value="Novantage" checked>
						<label for="radioNovantagePerform">N</label>

						<input type="radio" id="radioAdvantagePerform" name="attr_perform4_advantage" value="Advantage">
						<label for="radioAdvantagePerform">Adv</label>

						<input type="radio" id="radioGreatAdvantagePerform" name="attr_perform4_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantagePerform" class="right-end">GA</label> 
						
						<input name="attr_perform4_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_perform4_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Perform}} {{Perform (@{perform4_type_name}) @{perform4_advantage_text}=[[@{perform4_type_roll} + @{perform4_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_perform4_type_name" type="text" placeholder="type of perform" />
					<label class="skill-tem-container">
						<input name="attr_perform4_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_perform4_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_perform5" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Perform 5
						<button type="action" name="act_performinfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_perform5_total" type="text" readonly />
					<input name="attr_perform5_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantagePerform" name="attr_perform5_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantagePerform" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantagePerform" name="attr_perform5_advantage" value="Disadvantage">
						<label for="radioDisadvantagePerform">Dis</label>

						<input type="radio" id="radioNovantagePerform" name="attr_perform5_advantage" value="Novantage" checked>
						<label for="radioNovantagePerform">N</label>

						<input type="radio" id="radioAdvantagePerform" name="attr_perform5_advantage" value="Advantage">
						<label for="radioAdvantagePerform">Adv</label>

						<input type="radio" id="radioGreatAdvantagePerform" name="attr_perform5_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantagePerform" class="right-end">GA</label> 
						
						<input name="attr_perform5_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_perform5_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Perform}} {{Perform (@{perform5_type_name}) @{perform5_advantage_text}=[[@{perform5_type_roll} + @{perform5_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_perform5_type_name" type="text" placeholder="type of perform" />
					<label class="skill-tem-container">
						<input name="attr_perform5_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_perform5_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_perform_tier" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_perform_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_perform_pool_total" type="text" readonly />
					<input name="attr_perform_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_profession1" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Profession 1
						<button type="action" name="act_professioninfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_profession1_total" type="text" readonly />
					<input name="attr_profession1_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageProfession" name="attr_profession1_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageProfession" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageProfession" name="attr_profession1_advantage" value="Disadvantage">
						<label for="radioDisadvantageProfession">Dis</label>

						<input type="radio" id="radioNovantageProfession" name="attr_profession1_advantage" value="Novantage" checked>
						<label for="radioNovantageProfession">N</label>

						<input type="radio" id="radioAdvantageProfession" name="attr_profession1_advantage" value="Advantage">
						<label for="radioAdvantageProfession">Adv</label>

						<input type="radio" id="radioGreatAdvantageProfession" name="attr_profession1_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageProfession" class="right-end">GA</label> 
						
						<input name="attr_profession1_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_profession1_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Profession}} {{Profession (@{profession1_type_name}) @{profession1_advantage_text}=[[@{profession1_type_roll} + @{profession1_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_profession1_type_name" type="text" placeholder="type of profession" />
					<label class="skill-tem-container">
						<input name="attr_profession1_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_profession1_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

	</div>

	<div class="sheet-col">
		<div>
			<input name="attr_show_languages" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<textarea name="attr_languages" rows="10" />
			</span>
		</div>
		
		<div class="section-header top-space">
			<label> Modes of Conveyance </label>
			<button type="action" name="act_togglemodesofconveyance" class="toggle" />
		</div>

		<div>
			<input name="attr_show_modes_of_conveyance" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<textarea name="attr_modes_of_conveyance" rows="10" />
			</span>
		</div>

		<div>
			<input name="attr_show_profession2" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div>
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Profession 2
						<button type="action" name="act_professioninfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_profession2_total" type="text" readonly />
					<input name="attr_profession2_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageProfession" name="attr_profession2_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageProfession" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageProfession" name="attr_profession2_advantage" value="Disadvantage">
						<label for="radioDisadvantageProfession">Dis</label>

						<input type="radio" id="radioNovantageProfession" name="attr_profession2_advantage" value="Novantage" checked>
						<label for="radioNovantageProfession">N</label>

						<input type="radio" id="radioAdvantageProfession" name="attr_profession2_advantage" value="Advantage">
						<label for="radioAdvantageProfession">Adv</label>

						<input type="radio" id="radioGreatAdvantageProfession" name="attr_profession2_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageProfession" class="right-end">GA</label> 
						
						<input name="attr_profession2_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_profession2_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Profession}} {{Profession (@{profession2_type_name}) @{profession2_advantage_text}=[[@{profession2_type_roll} + @{profession2_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_profession2_type_name" type="text" placeholder="type of profession" />
					<label class="skill-tem-container">
						<input name="attr_profession2_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_profession2_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_profession3" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Profession 3
						<button type="action" name="act_professioninfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_profession3_total" type="text" readonly />
					<input name="attr_profession3_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageProfession" name="attr_profession3_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageProfession" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageProfession" name="attr_profession3_advantage" value="Disadvantage">
						<label for="radioDisadvantageProfession">Dis</label>

						<input type="radio" id="radioNovantageProfession" name="attr_profession3_advantage" value="Novantage" checked>
						<label for="radioNovantageProfession">N</label>

						<input type="radio" id="radioAdvantageProfession" name="attr_profession3_advantage" value="Advantage">
						<label for="radioAdvantageProfession">Adv</label>

						<input type="radio" id="radioGreatAdvantageProfession" name="attr_profession3_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageProfession" class="right-end">GA</label> 
						
						<input name="attr_profession3_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_profession3_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Profession}} {{Profession (@{profession3_type_name}) @{profession3_advantage_text}=[[@{profession3_type_roll} + @{profession3_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_profession3_type_name" type="text" placeholder="type of profession" />
					<label class="skill-tem-container">
						<input name="attr_profession3_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_profession3_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_profession4" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Profession 4
						<button type="action" name="act_professioninfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_profession4_total" type="text" readonly />
					<input name="attr_profession4_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageProfession" name="attr_profession4_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageProfession" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageProfession" name="attr_profession4_advantage" value="Disadvantage">
						<label for="radioDisadvantageProfession">Dis</label>

						<input type="radio" id="radioNovantageProfession" name="attr_profession4_advantage" value="Novantage" checked>
						<label for="radioNovantageProfession">N</label>

						<input type="radio" id="radioAdvantageProfession" name="attr_profession4_advantage" value="Advantage">
						<label for="radioAdvantageProfession">Adv</label>

						<input type="radio" id="radioGreatAdvantageProfession" name="attr_profession4_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageProfession" class="right-end">GA</label> 
						
						<input name="attr_profession4_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_profession4_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Profession}} {{Profession (@{profession4_type_name}) @{profession4_advantage_text}=[[@{profession4_type_roll} + @{profession4_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_profession4_type_name" type="text" placeholder="type of profession" />
					<label class="skill-tem-container">
						<input name="attr_profession4_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_profession4_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_profession5" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Profession 5
						<button type="action" name="act_professioninfo" class="info-button generic-skill" />
						<br />
						<span class="skill-attribute"> Wit </span> 
					</label>
					<input name="attr_profession5_total" type="text" readonly />
					<input name="attr_profession5_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageProfession" name="attr_profession5_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageProfession" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageProfession" name="attr_profession5_advantage" value="Disadvantage">
						<label for="radioDisadvantageProfession">Dis</label>

						<input type="radio" id="radioNovantageProfession" name="attr_profession5_advantage" value="Novantage" checked>
						<label for="radioNovantageProfession">N</label>

						<input type="radio" id="radioAdvantageProfession" name="attr_profession5_advantage" value="Advantage">
						<label for="radioAdvantageProfession">Adv</label>

						<input type="radio" id="radioGreatAdvantageProfession" name="attr_profession5_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageProfession" class="right-end">GA</label> 
						
						<input name="attr_profession5_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_profession5_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Profession}} {{Profession (@{profession5_type_name}) @{profession5_advantage_text}=[[@{profession5_type_roll} + @{profession5_total} + @{mob_skill_bonus}]]}}'" />
					<input class="custom" name="attr_profession5_type_name" type="text" placeholder="type of profession" />
					<label class="skill-tem-container">
						<input name="attr_profession5_type_training" type="checkbox" />
						<span class="skill-tem skill-training"> Training </span>
					</label>
					<input name="attr_profession5_type_roll" type="hidden" value="2d6" />
				</div>

			</span>
		</div>

		<div>
			<input name="attr_show_profession_tier" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_profession_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_profession_pool_total" type="text" readonly />
					<input name="attr_profession_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

	</div>
</div>

<div class="sheet-3colrow top-space">

	<div class="sheet-col">

		<div class="section-header top-space">
			<label>  Essence Points (EP) </label>
		</div>

		<div>
			<span class="tiny-text"> Total </span>
			<span class="tiny-text vital-stats"> Extra </span>
			<span class="tiny-text vital-stats"> Current </span>
			<span class="tiny-text vital-stats"> In Use </span>
		</div>
		<div>
			<input name="attr_essence_points_max" type="text" class="longnumber" readonly />
			&nbsp; &nbsp;
			<input name="attr_essence_points_extra" type="text" class="longnumber" />
			&nbsp; &nbsp;
			<input name="attr_essence_points" type="text" class="longnumber" />
			&nbsp; &nbsp;
			<input name="attr_essence_points_in_use" type="text" class="longnumber" />
		</div>

		<div class="section-header top-space">
			<label> Arcana </label>
		</div>

		<div>
			<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
		</div>
		<div class="skillname">
			<label>
				Arcana
				<br />
				<input name="attr_ps_intuitive_magic_versatility_arcana" type="hidden" class="show-replacement-attribute" value="false" />
				<span class="skill-attribute default-attribute"> Intelligence </span>
				&shy;
				<span class="skill-attribute replacement-attribute"> Wit </span>
			</label>
			<input name="attr_arcana_total" type="text" readonly />
			<input name="attr_arcana_points" type="text" />
		</div>
		
		<div>
			<div class="advantage-toolbar">
				<input type="radio" id="radioGreatDisadvantageArcana" name="attr_arcana_advantage" value="GreatDisadvantage">
				<label for="radioGreatDisadvantageArcana" class="left-end">GD</label>

				<input type="radio" id="radioDisadvantageArcana" name="attr_arcana_advantage" value="Disadvantage">
				<label for="radioDisadvantageArcana">Dis</label>

				<input type="radio" id="radioNovantageArcana" name="attr_arcana_advantage" value="Novantage" checked>
				<label for="radioNovantageArcana">N</label>

				<input type="radio" id="radioAdvantageArcana" name="attr_arcana_advantage" value="Advantage">
				<label for="radioAdvantageArcana">Adv</label>

				<input type="radio" id="radioGreatAdvantageArcana" name="attr_arcana_advantage" value="GreatAdvantage">
				<label for="radioGreatAdvantageArcana" class="right-end">GA</label> 
				
				<input name="attr_arcana_advantage_text" type="hidden" />			
			</div>
			
			<div class="explode">
				<label class="tierpool"> Expl </label>
				<input name="attr_arcana_explode" type="text" value="10" />
				+
			</div>
		</div>
		
		<div>
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Arcana}} {{Arcana @{arcana_advantage_text}=[[@{arcana_arcana_roll} + @{arcana_total} + @{mob_skill_bonus}]]}}'" />
			<button type="action" name="act_arcanainfo" class="info-button" />
			<label class="skillapp"> Arcana </label>
			<label class="skill-tem-container">
				<input name="attr_arcana_arcana_training" type="checkbox" />
				<span class="skill-tem skill-training"> Training </span>
			</label>
			<input name="attr_arcana_arcana_roll" type="hidden" value="2d6" />
		</div>
				
		<div>
			<label class="tierpool"> Tier </label>
			<input name="attr_arcana_tier" type="text" value="0" readonly />
			<label class="tierpool"> Pool </label>
			<input name="attr_arcana_pool_total" type="text" readonly />
			<input name="attr_arcana_pool_extra" type="text" />
		</div>
		<div>
			<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
		</div>

	</div>
	
	<div class="sheet-col">

		<div class="section-header top-space">
			<label> Spell Statistics </label>
		</div>

		<div>
			<label class="col2"> Range </label>
			<input name="attr_spell_range" type="text" readonly />
			<label class="col2-right"> Extra </label>
			<input name="attr_spell_range_extra" type="text" />
		</div>

		<div>
			<label class="col2"> Area Size </label>
			<input name="attr_spell_area_size" type="text" readonly />
			<label class="col2-right"> Extra </label>
			<input name="attr_spell_area_size_extra" type="text" />
		</div>

		<div>
			<label class="col2"> Duration </label>
			<input name="attr_spell_duration_text" type="text" class="custom" readonly value="Base" />		
		</div>

		<div class="top-space">
			<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Arcana Duration Linger}} {{Recharge=[[@{arcana_duration_linger_roll}]]}}'" />
			Check Linger
		</div>

	</div>

	<div class="sheet-col">

		<div class="section-header top-space">
			<label> Area Types </label>
		</div>

		<div class="magic-type-container">
			<label class="magic-type-container">
				<input name="attr_area_type_blast" type="checkbox" />
				<span class="magic-type"> Blast </span>
			</label>

			<label class="magic-type-container magic-type-container-right">
				<input name="attr_area_type_nova" type="checkbox" />
				<span class="magic-type"> Nova </span>
			</label>
		</div>
		<div class="magic-type-container">
			<label class="magic-type-container">
				<input name="attr_area_type_bolt" type="checkbox" />
				<span class="magic-type"> Bolt </span>
			</label>

			<label class="magic-type-container magic-type-container-right">
				<input name="attr_area_type_self" type="checkbox" />
				<span class="magic-type"> Self </span>
			</label>
		</div>
		<div class="magic-type-container">
			<label class="magic-type-container">
				<input name="attr_area_type_burst" type="checkbox" />
				<span class="magic-type"> Burst </span>
			</label>

			<label class="magic-type-container magic-type-container-right">
				<input name="attr_area_type_touch" type="checkbox" />
				<span class="magic-type"> Touch </span>
			</label>
		</div>
		<div class="magic-type-container bottom-space">
			<label class="magic-type-container">
				<input name="attr_area_type_line" type="checkbox" />
				<span class="magic-type"> Line </span>
			</label>

			<label class="magic-type-container magic-type-container-right">
				<input name="attr_area_type_wall" type="checkbox" />
				<span class="magic-type"> Wall </span>
			</label>
		</div>

		<div class="top-space bottom-space"> &shy; </div>
		
		<div class="top-space bottom-space">
			<input name="attr_ps_beam" type="hidden" class="show-ability" value="false" />
			<span class="ability bottom-space">
				<div class="bottom-space">
					<label class="magic-type-container">
						<input name="attr_use_beam" type="checkbox" />
						<span class="magic-type"> Use Beam </span>
					</label>
				</div>
				<div>
					<span class="tiny-text"> &nbsp; (after round 1) </span>
				</div>
			</span>
		</div>
	</div>

</div>

<div class="sheet-row top-space">
	<div class="sheet-col full-width">
		<div class="section-header">
			<label> Damage Types </label>
			<button type="action" name="act_toggledamagetypes" class="toggle" />
		</div>
	</div>
</div>

<div class="sheet-3colrow top-space">

	<div class="sheet-col">

		<div>
			<input name="attr_show_damage_type_arcane" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_arcane" type="checkbox" />
						<span class="magic-type"> Arcane </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_arcane_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypearcaneinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_damage_type_chemical" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_chemical" type="checkbox" />
						<span class="magic-type"> Chemical </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_chemical_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypechemicalinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_damage_type_cold" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_cold" type="checkbox" />
						<span class="magic-type"> Cold </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_cold_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypecoldinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_damage_type_disease" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_disease" type="checkbox" />
						<span class="magic-type"> Disease </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_disease_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypediseaseinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

	</div>

	<div class="sheet-col">

		<div>
			<input name="attr_show_damage_type_electricity" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_electricity" type="checkbox" />
						<span class="magic-type"> Electricity </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_electricity_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypeelectricityinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_damage_type_heat" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_heat" type="checkbox" />
						<span class="magic-type"> Heat </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_heat_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypeheatinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_damage_type_mental" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_mental" type="checkbox" />
						<span class="magic-type"> Mental </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_mental_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypementalinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_damage_type_physical" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_physical" type="checkbox" />
						<span class="magic-type"> Physical </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_physical_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypephysicalinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

	</div>

	<div class="sheet-col">

		<div>
			<input name="attr_show_damage_type_poison" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_poison" type="checkbox" />
						<span class="magic-type"> Poison </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_poison_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypepoisoninfo" class="info-button secondary" />
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_damage_type_sonic" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_sonic" type="checkbox" />
						<span class="magic-type"> Sonic </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_sonic_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypesonicinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_damage_type_spectral" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_spectral" type="checkbox" />
						<span class="magic-type"> Spectral </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_spectral_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypespectralinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_damage_type_vibrant" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="magic-type-container">
					<label class="magic-type-container">
						<input name="attr_damage_type_vibrant" type="checkbox" />
						<span class="magic-type"> Vibrant </span>
					</label>

					<label class="magic-type-container magic-type-container-secondary">
						<input name="attr_damage_type_vibrant_secondary" type="checkbox" />
						<span class="magic-type secondary"> Secondary </span>
					</label>

					<button type="action" name="act_damagetypevibrantinfo" class="info-button secondary" />
				</div>
			</span>
		</div>

	</div>

</div>

<div class="sheet-row top-space">
	<div class="sheet-col full-width">
		<div class="section-header">
			<label> Active Magic Skills </label>
			<button type="action" name="act_togglemagicskills" class="toggle" />
		</div>
	</div>
</div>

<div class="sheet-3colrow">

	<div class="sheet-col">

		<div>
			<input name="attr_show_alteration" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div>
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						<input name="attr_bb_natural_magic_alteration" type="hidden" class="show-ability" value="false" />
						<span class="ability"> Natural <br /> Alteration </span> 
						<span class="no-ability"> Alteration </span> 
						<button type="action" name="act_togglealterationspells" class="toggle" />
						<br />
						<input name="attr_ps_intuitive_magic_versatility_alteration" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Intelligence </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Wit </span>
					</label>
					<input name="attr_alteration_total" type="text" readonly />
					<input name="attr_alteration_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageAlteration" name="attr_alteration_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageAlteration" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageAlteration" name="attr_alteration_advantage" value="Disadvantage">
						<label for="radioDisadvantageAlteration">Dis</label>

						<input type="radio" id="radioNovantageAlteration" name="attr_alteration_advantage" value="Novantage" checked>
						<label for="radioNovantageAlteration">N</label>

						<input type="radio" id="radioAdvantageAlteration" name="attr_alteration_advantage" value="Advantage">
						<label for="radioAdvantageAlteration">Adv</label>

						<input type="radio" id="radioGreatAdvantageAlteration" name="attr_alteration_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageAlteration" class="right-end">GA</label> 
						
						<input name="attr_alteration_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_alteration_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<!-- Natural Alteration -->
				<div class="top-space bottom-space">
					<input name="attr_bb_natural_magic_alteration" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<div>
							<input class="custom" name="attr_natural_magic_alteration_recharge_roll" type="hidden" />
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Natural Alteration}} {{Recharge=[[@{natural_magic_alteration_recharge_roll}]]}}'" />
							Check Recharge
						</div>
					</span>
				</div>
							
				<div>
					<input name="attr_show_alteration_adopt_aspect" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Alteration}} {{Alteration (adopt aspect) @{alteration_advantage_text}=[[@{alteration_adopt_aspect_roll} + @{alteration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_alterationadoptaspectinfo" class="info-button" />
							<label class="skillapp"> Adopt Aspect </label>
							<label class="skill-tem-container">
								<input name="attr_alteration_adopt_aspect_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_alteration_adopt_aspect_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_alteration_adopt_aspect_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_alteration_adopt_aspect_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_alteration_adopt_aspect_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_alterationadoptaspect5ep" /> 5
									&nbsp;
									<button type="action" name="act_alterationadoptaspect10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_alterationadoptaspect20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_alterationadoptaspect30ep" /> 30
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_alteration_alter_armor" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Alteration}} {{Alteration (alter armor) @{alteration_advantage_text}=[[@{alteration_alter_armor_roll} + @{alteration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_alterationalterarmorinfo" class="info-button" />
							<label class="skillapp"> Alter Armor </label>
							<label class="skill-tem-container">
								<input name="attr_alteration_alter_armor_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_alteration_alter_armor_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_alteration_alter_armor_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_alteration_alter_armor_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_alteration_alter_armor_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_alteration_alter_armor_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_alterationalterarmor10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_alterationalterarmor20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_alterationalterarmor30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_alterationalterarmor40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_alteration_alter_weapon" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Alteration}} {{Alteration (alter weapon) @{alteration_advantage_text}=[[@{alteration_alter_weapon_roll} + @{alteration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_alterationalterweaponinfo" class="info-button" />
							<label class="skillapp"> Alter Weapon </label>
							<label class="skill-tem-container">
								<input name="attr_alteration_alter_weapon_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_alteration_alter_weapon_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_alteration_alter_weapon_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_alteration_alter_weapon_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_alteration_alter_weapon_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_alteration_alter_weapon_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_alterationalterweapon10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_alterationalterweapon20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_alterationalterweapon30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_alterationalterweapon40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_alteration_change_size" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Alteration}} {{Alteration (change size) @{alteration_advantage_text}=[[@{alteration_change_size_roll} + @{alteration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_alterationchangesizeinfo" class="info-button" />
							<label class="skillapp"> Change Size </label>
							<label class="skill-tem-container">
								<input name="attr_alteration_change_size_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_alteration_change_size_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_alteration_change_size_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_alteration_change_size_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_alteration_change_size_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_alterationchangesize10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_alterationchangesize20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_alterationchangesize30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_alteration_illuminate" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Alteration}} {{Alteration (illuminate) @{alteration_advantage_text}=[[@{alteration_illuminate_roll} + @{alteration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_alterationilluminateinfo" class="info-button" />
							<label class="skillapp"> Illuminate </label>
							<label class="skill-tem-container">
								<input name="attr_alteration_illuminate_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_alteration_illuminate_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_alteration_illuminate_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_alteration_illuminate_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_alteration_illuminate_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_alterationilluminate10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_alterationilluminate20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_alterationilluminate30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_alteration_indurate" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Alteration}} {{Alteration (indurate) @{alteration_advantage_text}=[[@{alteration_indurate_roll} + @{alteration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_alterationindurateinfo" class="info-button" />
							<label class="skillapp"> Indurate </label>
							<label class="skill-tem-container">
								<input name="attr_alteration_indurate_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_alteration_indurate_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_alteration_indurate_15_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_alteration_indurate_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_alteration_indurate_45_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-20">
									<button type="action" name="act_alterationindurate15ep" /> 15 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_alterationindurate30ep" /> 30 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_alterationindurate45ep" /> 45 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_alteration_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_alteration_pool_total" type="text" readonly />
					<input name="attr_alteration_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_biomancy" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Biomancy
						<button type="action" name="act_togglebiomancyspells" class="toggle" />
						<br />
						<input name="attr_ps_academic_magic_versatility_biomancy" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Wit </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Intelligence </span>
					</label>
					<input name="attr_biomancy_total" type="text" readonly />
					<input name="attr_biomancy_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageBiomancy" name="attr_biomancy_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageBiomancy" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageBiomancy" name="attr_biomancy_advantage" value="Disadvantage">
						<label for="radioDisadvantageBiomancy">Dis</label>

						<input type="radio" id="radioNovantageBiomancy" name="attr_biomancy_advantage" value="Novantage" checked>
						<label for="radioNovantageBiomancy">N</label>

						<input type="radio" id="radioAdvantageBiomancy" name="attr_biomancy_advantage" value="Advantage">
						<label for="radioAdvantageBiomancy">Adv</label>

						<input type="radio" id="radioGreatAdvantageBiomancy" name="attr_biomancy_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageBiomancy" class="right-end">GA</label> 
						
						<input name="attr_biomancy_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_biomancy_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<!-- Focused Healing -->
				<div>
					<input name="attr_ps_focused_healing" type="hidden" class="show-ability" value="false" />
					<span class="ability bottom-space">
						<div class="top-space bottom-space">
							<label class="skill-tem-container">
								<input name="attr_use_focused_healing" type="checkbox" />
								<span class="skill-tem magic-focus"> Focused Healing </span>
							</label>
						</div>
					</span>
				</div>
				
				<div>
					<input name="attr_show_biomancy_detoxify" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Biomancy}} {{Biomancy (detoxify) @{biomancy_advantage_text}=[[@{biomancy_detoxify_roll} + @{biomancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_biomancydetoxifyinfo" class="info-button" />
							<label class="skillapp"> Detoxify </label>
							<label class="skill-tem-container">
								<input name="attr_biomancy_detoxify_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_biomancy_detoxify_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_biomancy_detoxify_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_biomancy_detoxify_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_biomancy_detoxify_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_biomancy_detoxify_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_biomancydetoxify5ep" /> 5 EP
									&nbsp;
									<button type="action" name="act_biomancydetoxify10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_biomancydetoxify20ep" /> 20 EP
								</span>
								<span class="ep-30">
									<br />
									<button type="action" name="act_biomancydetoxify30ep" /> 30 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_biomancydetoxify40ep" /> 40 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_biomancy_heal_damage" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Biomancy}} {{Biomancy (heal damage) @{biomancy_advantage_text}=[[@{biomancy_heal_damage_roll} + @{biomancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_biomancyhealdamageinfo" class="info-button" />
							<label class="skillapp"> Heal Damage </label>
							<label class="skill-tem-container">
								<input name="attr_biomancy_heal_damage_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_biomancy_heal_damage_roll" type="hidden" value="2d6" />
							<input name="attr_show_biomancy_heal_damage_10_ep" type="hidden" class="show-ep-10" value="false" />
							<span class="ep-10">
								<div class="top-space bottom-space">
									<label class="skill-tem-container">
										<input name="attr_use_biomancy_pool_points" type="checkbox" />
										<span class="skill-tem magic-focus"> Use Pool Points </span>
									</label>
									<input name="attr_biomancy_pool_points_to_use" type="text" style="margin-left: 100px" />
									points
								</div>
								<div>
									<label style="width: 125px;"> Healing Modifier </label>
									<div class="input-group">
										<input name="attr_biomancy_healing_dice_modifier" type="text" />
										<span class="input-group-addon" style="width: 10%"> d </span>
									</div>
									&nbsp; +
									<input name="attr_biomancy_healing_static_modifier" type="text" />
								</div>
							</span>
							<div>
								<input name="attr_show_biomancy_heal_damage_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_biomancy_heal_damage_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_biomancy_heal_damage_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_biomancy_heal_damage_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_biomancyhealdamage5ep" /> 5 EP 
									&nbsp;
									<button type="action" name="act_biomancyhealdamage10ep" /> 10 EP 
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_biomancyhealdamage20ep" /> 20 EP
								</span>
								<span class="ep-30">
									<br />
									<button type="action" name="act_biomancyhealdamage30ep" /> 30 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_biomancyhealdamage40ep" /> 40 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_biomancy_regenerate" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Biomancy}} {{Biomancy (regenerate) @{biomancy_advantage_text}=[[@{biomancy_regenerate_roll} + @{biomancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_biomancyregenerateinfo" class="info-button" />
							<label class="skillapp"> Regenerate </label>
							<label class="skill-tem-container">
								<input name="attr_biomancy_regenerate_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_biomancy_regenerate_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_biomancy_regenerate_30_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_biomancy_regenerate_60_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_biomancy_regenerate_90_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_biomancy_regenerate_120_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_biomancyregenerate30ep" /> 30 
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_biomancyregenerate60ep" /> 60 
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_biomancyregenerate90ep" /> 90 
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_biomancyregenerate120ep" /> 120 
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_biomancy_revivify" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Biomancy}} {{Biomancy (revivify) @{biomancy_advantage_text}=[[@{biomancy_revivify_roll} + @{biomancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_biomancyrevivifyinfo" class="info-button" />
							<label class="skillapp"> Revivify </label>
							<label class="skill-tem-container">
								<input name="attr_biomancy_revivify_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_biomancy_revivify_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_biomancy_revivify_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_biomancy_revivify_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_biomancy_revivify_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_biomancyrevivify10ep" /> 10 EP 
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_biomancyrevivify20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_biomancyrevivify30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_biomancy_sustain" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Biomancy}} {{Biomancy (sustain) @{biomancy_advantage_text}=[[@{biomancy_sustain_roll} + @{biomancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_biomancysustaininfo" class="info-button" />
							<label class="skillapp"> Sustain </label>
							<label class="skill-tem-container">
								<input name="attr_biomancy_sustain_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_biomancy_sustain_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_biomancy_sustain_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_biomancy_sustain_20_ep" type="hidden" class="show-ep-20" value="false" />
								<span class="ep-10">
									<button type="action" name="act_biomancysustain5ep" /> 5 EP 
									&nbsp;
									<button type="action" name="act_biomancysustain10ep" /> 10 EP 
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_biomancysustain20ep" /> 20 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_biomancy_turn_undead" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Biomancy}} {{Biomancy (turn undead) @{biomancy_advantage_text}=[[@{biomancy_turn_undead_roll} + @{biomancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_biomancyturnundeadinfo" class="info-button" />
							<label class="skillapp"> Turn Undead </label>
							<label class="skill-tem-container">
								<input name="attr_biomancy_turn_undead_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_biomancy_turn_undead_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_biomancy_turn_undead_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_biomancy_turn_undead_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-20">
									<button type="action" name="act_biomancyturnundead10ep" /> 10 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_biomancyturnundead30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_biomancy_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_biomancy_pool_total" type="text" readonly />
					<input name="attr_biomancy_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_conjuration" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						<input name="attr_bb_natural_magic_conjuration" type="hidden" class="show-ability" value="false" />
						<span class="ability"> Natural <br /> Conjuration </span> 
						<span class="no-ability"> Conjuration </span> 
						<button type="action" name="act_toggleconjurationspells" class="toggle" />
						<br />
						<input name="attr_ps_intuitive_magic_versatility_conjuration" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Intelligence </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Wit </span>
					</label>
					<input name="attr_conjuration_total" type="text" readonly />
					<input name="attr_conjuration_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageConjuration" name="attr_conjuration_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageConjuration" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageConjuration" name="attr_conjuration_advantage" value="Disadvantage">
						<label for="radioDisadvantageConjuration">Dis</label>

						<input type="radio" id="radioNovantageConjuration" name="attr_conjuration_advantage" value="Novantage" checked>
						<label for="radioNovantageConjuration">N</label>

						<input type="radio" id="radioAdvantageConjuration" name="attr_conjuration_advantage" value="Advantage">
						<label for="radioAdvantageConjuration">Adv</label>

						<input type="radio" id="radioGreatAdvantageConjuration" name="attr_conjuration_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageConjuration" class="right-end">GA</label> 
						
						<input name="attr_conjuration_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_conjuration_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<!-- Natural Conjuration -->
				<div class="top-space bottom-space">
					<input name="attr_bb_natural_magic_conjuration" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<div>
							<input class="custom" name="attr_natural_magic_conjuration_recharge_roll" type="hidden" />
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Natural Conjuration}} {{Recharge=[[@{natural_magic_conjuration_recharge_roll}]]}}'" />
							Check Recharge
						</div>
					</span>
				</div>
							
				<div>
					<input name="attr_show_conjuration_armor" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Conjuration}} {{Conjuration (armor) @{conjuration_advantage_text}=[[@{conjuration_armor_roll} + @{conjuration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_conjurationarmorinfo" class="info-button" />
							<label class="skillapp"> Armor </label>
							<label class="skill-tem-container">
								<input name="attr_conjuration_armor_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_conjuration_armor_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_conjuration_armor_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_conjuration_armor_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_conjuration_armor_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_conjuration_armor_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_conjurationarmor5ep" /> 5 EP 
									&nbsp;
									<button type="action" name="act_conjurationarmor10ep" /> 10 EP 
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_conjurationarmor20ep" /> 20 EP
								</span>
								<span class="ep-30">
									<br />
									<button type="action" name="act_conjurationarmor30ep" /> 30 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_conjurationarmor40ep" /> 40 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_conjuration_barrier" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Conjuration}} {{Conjuration (barrier) @{conjuration_advantage_text}=[[@{conjuration_barrier_roll} + @{conjuration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_conjurationbarrierinfo" class="info-button" />
							<label class="skillapp"> Barrier </label>
							<label class="skill-tem-container">
								<input name="attr_conjuration_barrier_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_conjuration_barrier_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_conjuration_barrier_15_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_conjuration_barrier_30_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_conjuration_barrier_45_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_conjuration_barrier_60_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_conjurationbarrier15ep" /> 15
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_conjurationbarrier30ep" /> 30
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_conjurationbarrier45ep" /> 45
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_conjurationbarrier60ep" /> 60
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_conjuration_difficult_terrain" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Conjuration}} {{Conjuration (difficult terrain) @{conjuration_advantage_text}=[[@{conjuration_difficult_terrain_roll} + @{conjuration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_conjurationdifficultterraininfo" class="info-button" />
							<label class="skillapp"> Difficult Terrain </label>
							<label class="skill-tem-container">
								<input name="attr_conjuration_difficult_terrain_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_conjuration_difficult_terrain_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_conjuration_difficult_terrain_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_conjuration_difficult_terrain_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_conjuration_difficult_terrain_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_conjuration_difficult_terrain_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_conjurationdifficultterrain5ep" /> 5 EP 
									&nbsp;
									<button type="action" name="act_conjurationdifficultterrain10ep" /> 10 EP 
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_conjurationdifficultterrain20ep" /> 20 EP
								</span>
								<span class="ep-30">
									<br />
									<button type="action" name="act_conjurationdifficultterrain30ep" /> 30 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_conjurationdifficultterrain40ep" /> 40 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_conjuration_fabricate" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Conjuration}} {{Conjuration (fabricate) @{conjuration_advantage_text}=[[@{conjuration_fabricate_roll} + @{conjuration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_conjurationfabricateinfo" class="info-button" />
							<label class="skillapp"> Fabricate </label>
							<label class="skill-tem-container">
								<input name="attr_conjuration_fabricate_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_conjuration_fabricate_roll" type="hidden" value="2d6" />
							<input name="attr_show_conjuration_fabricate_10_ep" type="hidden" class="show-ep-10" value="false" />
							<span class="ep-10">
								<div class="top-space bottom-space">
									<label class="skill-tem-container">
										<input name="attr_use_conjuration_pool_points" type="checkbox" />
										<span class="skill-tem magic-focus"> Use Pool Points </span>
									</label>
									<input name="attr_conjuration_pool_points_to_use" type="text" style="margin-left: 100px" />
									points
								</div>
							</span>
							<div>
								<input name="attr_show_conjuration_fabricate_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_conjuration_fabricate_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_conjuration_fabricate_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_conjuration_fabricate_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<b> Create </b> <br />
									<button type="action" name="act_conjurationfabricatecreate5ep" /> 5 EP
									&nbsp;
									<button type="action" name="act_conjurationfabricatecreate10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_conjurationfabricatecreate20ep" /> 20 EP
								</span>
								<span class="ep-30">
									<br />
									<button type="action" name="act_conjurationfabricatecreate30ep" /> 30 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_conjurationfabricatecreate40ep" /> 40 EP
								</span>
							</div>
							<input name="attr_show_conjuration_fabricate_10_ep" type="hidden" class="show-ep-10" value="false" />
							<span class="ep-10">
								<div class="top-space">
									<label style="width: 125px;"> Healing Modifier </label>
									<div class="input-group">
										<input name="attr_conjuration_healing_dice_modifier" type="text" />
										<span class="input-group-addon" style="width: 10%"> d </span>
									</div>
									&nbsp; +
									<input name="attr_conjuration_healing_static_modifier" type="text" />
								</div>
							</span>
							<div>
								<input name="attr_show_conjuration_fabricate_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_conjuration_fabricate_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_conjuration_fabricate_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_conjuration_fabricate_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<b> Repair/Heal </b> <br />
									<button type="action" name="act_conjurationfabricaterepair5ep" /> 5 EP
									&nbsp;
									<button type="action" name="act_conjurationfabricaterepair10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_conjurationfabricaterepair20ep" /> 20 EP
								</span>
								<span class="ep-30">
									<br />
									<button type="action" name="act_conjurationfabricaterepair30ep" /> 30 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_conjurationfabricaterepair40ep" /> 40 EP
								</span>
							</div>
							<input name="attr_ps_conjuration_attack" type="hidden" class="show-ability" value="false" />
							<span class="ability">

								<div class="top-space">
									<label style="width: 125px;"> Damage Modifier </label>
									<div class="input-group">
										<input name="attr_conjuration_damage_dice_modifier" type="text" />
										<span class="input-group-addon" style="width: 10%"> d6 </span>
									</div>
									&nbsp; +
									<input name="attr_conjuration_damage_static_modifier" type="text" />
								</div>

								<div>
									<input name="attr_show_conjuration_fabricate_10_ep" type="hidden" class="show-ep-10" value="false" />
									<input name="attr_show_conjuration_fabricate_20_ep" type="hidden" class="show-ep-20" value="false" />
									<input name="attr_show_conjuration_fabricate_30_ep" type="hidden" class="show-ep-30" value="false" />
									<input name="attr_show_conjuration_fabricate_40_ep" type="hidden" class="show-ep-40" value="false" />
									<span class="ep-10">
										<b> Attack </b> <br />
										<button type="action" name="act_conjurationfabricateattack0ep" /> Basic
										&nbsp;
										<button type="action" name="act_conjurationfabricateattack5ep" /> 5 EP
										&nbsp;
										<button type="action" name="act_conjurationfabricateattack10ep" /> 10 EP
									</span>
									<span class="ep-20">
										<br />
										<button type="action" name="act_conjurationfabricateattack20ep" /> 20 EP
									</span>
									<span class="ep-30">
										&nbsp;
										<button type="action" name="act_conjurationfabricateattack30ep" /> 30 EP
									</span>
									<span class="ep-40">
										&nbsp;
										<button type="action" name="act_conjurationfabricateattack40ep" /> 40 EP
									</span>
								</div>
							</span>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_conjuration_shelter" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Conjuration}} {{Conjuration (shelter) @{conjuration_advantage_text}=[[@{conjuration_shelter_roll} + @{conjuration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_conjurationshelterinfo" class="info-button" />
							<label class="skillapp"> Shelter </label>
							<label class="skill-tem-container">
								<input name="attr_conjuration_shelter_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_conjuration_shelter_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_conjuration_shelter_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_conjuration_shelter_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_conjuration_shelter_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_conjuration_shelter_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_conjurationshelter10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_conjurationshelter20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_conjurationshelter30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_conjurationshelter40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_conjuration_shield" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Conjuration}} {{Conjuration (shield) @{conjuration_advantage_text}=[[@{conjuration_shield_roll} + @{conjuration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_conjurationshieldinfo" class="info-button" />
							<label class="skillapp"> Shield </label>
							<label class="skill-tem-container">
								<input name="attr_conjuration_shield_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_conjuration_shield_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_conjuration_shield_15_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_conjuration_shield_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-20">
									<button type="action" name="act_conjurationshield15epdef" /> Def 15 &nbsp;
									<button type="action" name="act_conjurationshield15epmr" />   MR 15 &nbsp;
									<button type="action" name="act_conjurationshield15eppr" />   PR 15 
								</span>
								<span class="ep-30">
									<br />
									<button type="action" name="act_conjurationshield30epdef" /> Def 30 &nbsp;
									<button type="action" name="act_conjurationshield30epmr" />   MR 30 &nbsp;
									<button type="action" name="act_conjurationshield30eppr" />   PR 30
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_conjuration_summon_ally" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Conjuration}} {{Conjuration (summon ally) @{conjuration_advantage_text}=[[@{conjuration_summon_ally_roll} + @{conjuration_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_conjurationsummonallyinfo" class="info-button" />
							<label class="skillapp"> Summon Ally </label>
							<label class="skill-tem-container">
								<input name="attr_conjuration_summon_ally_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_conjuration_summon_ally_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_conjuration_summon_ally_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_conjuration_summon_ally_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_conjuration_summon_ally_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_familiarinfo" class="info-button" />
									<label class="skillapp"> Familiar </label>
									<br />
									<button type="action" name="act_conjurationsummonallycombatant10ep" /> Combatant 10 EP 
									&nbsp;
									<button type="action" name="act_conjurationsummonallyporter10ep" /> Porter 10 EP 
								</span>
								<span class="ep-20">
									<br />
									<button type="action" name="act_conjurationsummonallycombatant20ep" /> Combatant 20 EP
									&nbsp;
									<button type="action" name="act_conjurationsummonallyporter20ep" /> Porter 20 EP
								</span>
								<span class="ep-30">
									<br />
									<button type="action" name="act_conjurationsummonallycombatant30ep" /> Combatant 30 EP
									&nbsp;
									<button type="action" name="act_conjurationsummonallyporter30ep" /> Porter 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>
						
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_conjuration_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_conjuration_pool_total" type="text" readonly />
					<input name="attr_conjuration_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>

				<div>
					<input type="hidden" name="attr_show_summoned_ally" class="show-ability" value="false" />
					<span class="ability">
						<div class="section-header top-space">
							<input type="hidden" name="attr_show_porter_ally" class="show-porter-ally" value="false" />
							<span class="combatant-ally section-header"> Combatant </span>
							<span class="porter-ally section-header"> Porter </span>
							Ally
						</div>

						<div>
							<input type="hidden" name="attr_show_porter_ally" class="show-porter-ally" value="false" />

							<label class="col2"> Physique </label>
							<input name="attr_summon_ally_physique" type="text" value="0" readonly />
							
							<label class="col2"> Modifier </label>
							<input name="attr_summon_ally_physique_modifier" type="text" value="0" readonly />

							<label class="col2"> Hit Points </label>
							<input name="attr_summon_ally_hit_points" type="text" value="0" readonly />

							<label class="col2"> Untrained </label>
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{summon_ally_type} Ally: Untrained skill check}} {{Skill (untrained) @{conjuration_advantage_text}=[[@{summon_ally_untrained_dice}+@{conjuration_attribute_modifier}]]}}" />

							<span class="combatant-ally">
								<label class="col2"> Damage </label>
								<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{summon_ally_type} Ally: Damage}} {{Physical damage=[[@{summon_ally_damage_dice}d6+@{summon_ally_damage_modifier}]]}}" />

								<label class="col2"> DR (phys) </label>
								<input name="attr_summon_ally_dr_physical" type="text" value="0" readonly />

								<div>
									<label style="width: 125px;"> Damage Modifier </label>
									<div class="input-group">
										<input name="attr_summon_ally_damage_dice_modifier" type="text" />
										<span class="input-group-addon" style="width: 10%"> d6 </span>
									</div>
									&nbsp; +
									<input name="attr_summon_ally_damage_static_modifier" type="text" />
								</div>
							</span>

							<span class="porter-ally">
								<label class="col2"> Carry </label>
								<input name="attr_summon_ally_carry" type="text" value="0" readonly />

								<label class="col2"> Max Carry </label>
								<input name="attr_summon_ally_carry_max" type="text" value="0" readonly />
							</span>
							
							<div class="top-line">
								<label class="longlabel"> Trained Skills </label>
								<textarea name="attr_summon_ally_trained_skills" class="skillappcombat"></textarea>
							</div>
						</div>
						
						<button type="action" name="act_endsummonally" class="end-spell" text="End Spell" />
					</span>
				</div>

			</span>
		</div>

	</div>

	<div class="sheet-col">

		<div>
			<input name="attr_show_displacement" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div>
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						<input name="attr_bb_natural_magic_displacement" type="hidden" class="show-ability" value="false" />
						<span class="ability"> Natural <br /> Displacement </span> 
						<span class="no-ability"> Displacement </span> 
						<button type="action" name="act_toggledisplacementspells" class="toggle" />
						<br />
						<input name="attr_ps_intuitive_magic_versatility_displacement" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Intelligence </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Wit </span>
					</label>
					<input name="attr_displacement_total" type="text" readonly />
					<input name="attr_displacement_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageDisplacement" name="attr_displacement_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageDisplacement" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageDisplacement" name="attr_displacement_advantage" value="Disadvantage">
						<label for="radioDisadvantageDisplacement">Dis</label>

						<input type="radio" id="radioNovantageDisplacement" name="attr_displacement_advantage" value="Novantage" checked>
						<label for="radioNovantageDisplacement">N</label>

						<input type="radio" id="radioAdvantageDisplacement" name="attr_displacement_advantage" value="Advantage">
						<label for="radioAdvantageDisplacement">Adv</label>

						<input type="radio" id="radioGreatAdvantageDisplacement" name="attr_displacement_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageDisplacement" class="right-end">GA</label> 
						
						<input name="attr_displacement_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_displacement_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<!-- Natural Displacement -->
				<div class="top-space bottom-space">
					<input name="attr_bb_natural_magic_displacement" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<div>
							<input class="custom" name="attr_natural_magic_displacement_recharge_roll" type="hidden" />
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Natural Displacement}} {{Recharge=[[@{natural_magic_displacement_recharge_roll}]]}}'" />
							Check Recharge
						</div>
					</span>
				</div>
							
				<div>
					<input name="attr_show_displacement_bind" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Displacement}} {{Displacement (bind) @{displacement_advantage_text}=[[@{displacement_bind_roll} + @{displacement_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_displacementbindinfo" class="info-button" />
							<label class="skillapp"> Bind </label>
							<label class="skill-tem-container">
								<input name="attr_displacement_bind_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_displacement_bind_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_displacement_bind_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_displacement_bind_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_displacement_bind_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_displacementbind10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_displacementbind20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_displacementbind30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_displacement_chronofield" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Displacement}} {{Displacement (chronofield) @{displacement_advantage_text}=[[@{displacement_chronofield_roll} + @{displacement_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_displacementchronofieldinfo" class="info-button" />
							<label class="skillapp"> Chronofield </label>
							<label class="skill-tem-container">
								<input name="attr_displacement_chronofield_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_displacement_chronofield_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_displacement_chronofield_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_displacement_chronofield_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_displacement_chronofield_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_displacement_chronofield_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_displacementchronofield10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_displacementchronofield20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_displacementchronofield30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_displacementchronofield40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_displacement_levitate" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Displacement}} {{Displacement (levitate) @{displacement_advantage_text}=[[@{displacement_levitate_roll} + @{displacement_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_displacementlevitateinfo" class="info-button" />
							<label class="skillapp"> Levitate </label>
							<label class="skill-tem-container">
								<input name="attr_displacement_levitate_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_displacement_levitate_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_displacement_levitate_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_displacement_levitate_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_displacement_levitate_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_displacementlevitate10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_displacementlevitate20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_displacementlevitate30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_displacement_stasis" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Displacement}} {{Displacement (stasis) @{displacement_advantage_text}=[[@{displacement_stasis_roll} + @{displacement_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_displacementstasisinfo" class="info-button" />
							<label class="skillapp"> Stasis </label>
							<label class="skill-tem-container">
								<input name="attr_displacement_stasis_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_displacement_stasis_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_displacement_stasis_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_displacement_stasis_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_displacement_stasis_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_displacementstasis10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_displacementstasis20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_displacementstasis30ep" /> 30
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_displacement_telekinesis" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Displacement}} {{Displacement (telekinesis) @{displacement_advantage_text}=[[@{displacement_telekinesis_roll} + @{displacement_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_displacementtelekinesisinfo" class="info-button" />
							<label class="skillapp"> Telekinesis </label>
							<label class="skill-tem-container">
								<input name="attr_displacement_telekinesis_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_displacement_telekinesis_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_displacement_telekinesis_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_displacement_telekinesis_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_displacement_telekinesis_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_displacement_telekinesis_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_displacementtelekinesis10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_displacementtelekinesis20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_displacementtelekinesis30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_displacementtelekinesis40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_displacement_teleport" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Displacement}} {{Displacement (teleport) @{displacement_advantage_text}=[[@{displacement_teleport_roll} + @{displacement_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_displacementteleportinfo" class="info-button" />
							<label class="skillapp"> Teleport </label>
							<label class="skill-tem-container">
								<input name="attr_displacement_teleport_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_displacement_teleport_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_displacement_teleport_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_displacement_teleport_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_displacement_teleport_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_displacement_teleport_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_displacementteleport10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_displacementteleport20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_displacementteleport30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_displacementteleport40ep" /> 40
								</span>
							</div>
							<input name="attr_ps_displacement_attack" type="hidden" class="show-ability" value="false" />
							<span class="ability">

								<div class="top-space bottom-space">
									<label class="skill-tem-container">
										<input name="attr_use_displacement_pool_points" type="checkbox" />
										<span class="skill-tem magic-focus"> Use Pool Points </span>
									</label>
									<input name="attr_displacement_pool_points_to_use" type="text" style="margin-left: 100px" />
									points
								</div>

								<div>
									<label style="width: 125px;"> Damage Modifier </label>
									<div class="input-group">
										<input name="attr_displacement_damage_dice_modifier" type="text" />
										<span class="input-group-addon" style="width: 10%"> d6 </span>
									</div>
									&nbsp; +
									<input name="attr_displacement_damage_static_modifier" type="text" />
								</div>

								<div>
									<input name="attr_show_displacement_teleport_10_ep" type="hidden" class="show-ep-10" value="false" />
									<input name="attr_show_displacement_teleport_20_ep" type="hidden" class="show-ep-20" value="false" />
									<input name="attr_show_displacement_teleport_30_ep" type="hidden" class="show-ep-30" value="false" />
									<input name="attr_show_displacement_teleport_40_ep" type="hidden" class="show-ep-40" value="false" />
									<span class="ep-10">
										<b> Attack </b> <br />
										<button type="action" name="act_displacementteleportattack0ep" /> Basic
										&nbsp;
										<button type="action" name="act_displacementteleportattack5ep" /> 5 EP
										&nbsp;
										<button type="action" name="act_displacementteleportattack10ep" /> 10 EP
									</span>
									<span class="ep-20">
										<br />
										<button type="action" name="act_displacementteleportattack20ep" /> 20 EP
									</span>
									<span class="ep-30">
										&nbsp;
										<button type="action" name="act_displacementteleportattack30ep" /> 30 EP
									</span>
									<span class="ep-40">
										&nbsp;
										<button type="action" name="act_displacementteleportattack40ep" /> 40 EP
									</span>
								</div>
							</span>
						</div>
					</span>
				</div>
						
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_displacement_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_displacement_pool_total" type="text" readonly />
					<input name="attr_displacement_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_divination" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						<input name="attr_bb_natural_magic_divination" type="hidden" class="show-ability" value="false" />
						<span class="ability"> Natural <br /> Divination </span> 
						<span class="no-ability"> Divination </span> 
						<button type="action" name="act_toggledivinationspells" class="toggle" />
						<br />
						<input name="attr_ps_academic_magic_versatility_divination" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Wit </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Intelligence </span>
					</label>
					<input name="attr_divination_total" type="text" readonly />
					<input name="attr_divination_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageDivination" name="attr_divination_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageDivination" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageDivination" name="attr_divination_advantage" value="Disadvantage">
						<label for="radioDisadvantageDivination">Dis</label>

						<input type="radio" id="radioNovantageDivination" name="attr_divination_advantage" value="Novantage" checked>
						<label for="radioNovantageDivination">N</label>

						<input type="radio" id="radioAdvantageDivination" name="attr_divination_advantage" value="Advantage">
						<label for="radioAdvantageDivination">Adv</label>

						<input type="radio" id="radioGreatAdvantageDivination" name="attr_divination_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageDivination" class="right-end">GA</label> 
						
						<input name="attr_divination_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_divination_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<!-- Natural Divination -->
				<div class="top-space bottom-space">
					<input name="attr_bb_natural_magic_divination" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<div>
							<input class="custom" name="attr_natural_magic_divination_recharge_roll" type="hidden" />
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Natural Divination}} {{Recharge=[[@{natural_magic_divination_recharge_roll}]]}}'" />
							Check Recharge
						</div>
					</span>
				</div>
							
				<div>
					<input name="attr_show_divination_analyze" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Divination}} {{Divination (analyze) @{divination_advantage_text}=[[@{divination_analyze_roll} + @{divination_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_divinationanalyzeinfo" class="info-button" />
							<label class="skillapp"> Analyze </label>
							<label class="skill-tem-container">
								<input name="attr_divination_analyze_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_divination_analyze_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_divination_analyze_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_divination_analyze_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_divination_analyze_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_divinationanalyze10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_divinationanalyze20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_divinationanalyze30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_divination_comprehend" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Divination}} {{Divination (comprehend) @{divination_advantage_text}=[[@{divination_comprehend_roll} + @{divination_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_divinationcomprehendinfo" class="info-button" />
							<label class="skillapp"> Comprehend </label>
							<label class="skill-tem-container">
								<input name="attr_divination_comprehend_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_divination_comprehend_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_divination_comprehend_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_divination_comprehend_20_ep" type="hidden" class="show-ep-20" value="false" />
								<span class="ep-10">
									<button type="action" name="act_divinationcomprehend10ep" /> 10 EP
								</span>
								<span class="ep-20">
									<button type="action" name="act_divinationcomprehend20ep" /> 20 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_divination_detect" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Divination}} {{Divination (detect) @{divination_advantage_text}=[[@{divination_detect_roll} + @{divination_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_divinationdetectinfo" class="info-button" />
							<label class="skillapp"> Detect </label>
							<label class="skill-tem-container">
								<input name="attr_divination_detect_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_divination_detect_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_divination_detect_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_divination_detect_20_ep" type="hidden" class="show-ep-20" value="false" />
								<span class="ep-10">
									<button type="action" name="act_divinationdetect5ep" /> 5 EP
									&nbsp;
									<button type="action" name="act_divinationdetect10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_divinationdetect20ep" /> 20 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_divination_prowess" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Divination}} {{Divination (prowess) @{divination_advantage_text}=[[@{divination_prowess_roll} + @{divination_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_divinationprowessinfo" class="info-button" />
							<label class="skillapp"> Prowess </label>
							<label class="skill-tem-container">
								<input name="attr_divination_prowess_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_divination_prowess_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_divination_prowess_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_divination_prowess_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_divination_prowess_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_divination_prowess_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_divinationprowess10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_divinationprowess20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_divinationprowess30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_divinationprowess40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_divination_scry" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Divination}} {{Divination (scry) @{divination_advantage_text}=[[@{divination_scry_roll} + @{divination_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_divinationscryinfo" class="info-button" />
							<label class="skillapp"> Scry </label>
							<label class="skill-tem-container">
								<input name="attr_divination_scry_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_divination_scry_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_divination_scry_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_divination_scry_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_divination_scry_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_divinationscry10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_divinationscry20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_divinationscry30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div>
					<input name="attr_show_divination_status" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Divination}} {{Divination (status) @{divination_advantage_text}=[[@{divination_status_roll} + @{divination_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_divinationstatusinfo" class="info-button" />
							<label class="skillapp"> Status </label>
							<label class="skill-tem-container">
								<input name="attr_divination_status_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_divination_status_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_divination_status_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_divination_status_20_ep" type="hidden" class="show-ep-20" value="false" />
								<span class="ep-10">
									<button type="action" name="act_divinationstatus10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_divinationstatus20ep" /> 20 EP
								</span>
							</div>
						</div>
					</span>
				</div>
								
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_divination_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_divination_pool_total" type="text" readonly />
					<input name="attr_divination_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_dynamancy" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						<input name="attr_bb_natural_magic_dynamancy" type="hidden" class="show-ability" value="false" />
						<span class="ability"> Natural <br /> Dynamancy </span> 
						<span class="no-ability"> Dynamancy </span>  
						<button type="action" name="act_toggledynamancyspells" class="toggle" />
						<br />
						<input name="attr_ps_intuitive_magic_versatility_dynamancy" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Intelligence </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Wit </span>
					</label>
					<input name="attr_dynamancy_total" type="text" readonly />
					<input name="attr_dynamancy_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageDynamancy" name="attr_dynamancy_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageDynamancy" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageDynamancy" name="attr_dynamancy_advantage" value="Disadvantage">
						<label for="radioDisadvantageDynamancy">Dis</label>

						<input type="radio" id="radioNovantageDynamancy" name="attr_dynamancy_advantage" value="Novantage" checked>
						<label for="radioNovantageDynamancy">N</label>

						<input type="radio" id="radioAdvantageDynamancy" name="attr_dynamancy_advantage" value="Advantage">
						<label for="radioAdvantageDynamancy">Adv</label>

						<input type="radio" id="radioGreatAdvantageDynamancy" name="attr_dynamancy_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageDynamancy" class="right-end">GA</label> 
						
						<input name="attr_dynamancy_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_dynamancy_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<!-- Natural Dynamancy -->
				<div class="top-space bottom-space">
					<input name="attr_bb_natural_magic_dynamancy" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<div>
							<input class="custom" name="attr_natural_magic_dynamancy_recharge_roll" type="hidden" />
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Natural Dynamancy}} {{Recharge=[[@{natural_magic_dynamancy_recharge_roll}]]}}'" />
							Check Recharge
						</div>
					</span>
				</div>
				
				<!-- Focused Blasting -->
				<div class="top-space bottom-space">
					<input name="attr_ps_focused_blasting" type="hidden" class="show-ability" value="false" />
					<span class="ability bottom-space">
						<div>
							<label class="skill-tem-container">
								<input name="attr_use_focused_blasting" type="checkbox" />
								<span class="skill-tem magic-focus"> Focused Blasting </span>
							</label>
						</div>
					</span>
				</div>
				
				<!-- Mage Rage -->
				<div class="top-space bottom-space">
					<input name="attr_ps_mage_rage" type="hidden" class="show-ability" value="false" />
					<span class="ability bottom-space">
						<div>
							<label class="skill-tem-container">
								<input name="attr_use_mage_rage" type="checkbox" />
								<span class="skill-tem magic-focus"> Mage Rage </span>
							</label>
						</div>
					</span>
				</div>
				
				<div class="top-space bottom-space">
					<label class="skill-tem-container">
						<input name="attr_use_dynamancy_pool_points" type="checkbox" />
						<span class="skill-tem magic-focus"> Use Pool Points </span>
					</label>
					<input name="attr_dynamancy_pool_points_to_use" type="text" style="margin-left: 100px" />
					points
				</div>

				<div>
					<input name="attr_show_dynamancy_attack" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Dynamancy}} {{Dynamancy (attack) @{dynamancy_advantage_text}=[[@{dynamancy_attack_roll} + @{dynamancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_dynamancyattackinfo" class="info-button" />
							<label class="skillapp"> Attack </label>
							<label class="skill-tem-container">
								<input name="attr_dynamancy_attack_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<div>
								<label style="width: 125px;"> Damage Modifier </label>
								<div class="input-group">
									<input name="attr_dynamancy_damage_dice_modifier" type="text" />
									<span class="input-group-addon" style="width: 10%"> d6 </span>
								</div>
								&nbsp; +
								<input name="attr_dynamancy_damage_static_modifier" type="text" />
							</div>
							<input name="attr_dynamancy_attack_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_dynamancy_attack_0_ep" type="hidden" class="show-ep-0" value="false" />
								<input name="attr_show_dynamancy_attack_5_ep" type="hidden" class="show-ep-5" value="false" />
								<input name="attr_show_dynamancy_attack_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_dynamancy_attack_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_dynamancy_attack_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_dynamancy_attack_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-0">
									<button type="action" name="act_dynamancyattackbasic" /> Basic 
								</span>
								<span class="ep-5">
									&nbsp;
									<button type="action" name="act_dynamancyattack5ep" /> 5 EP
								</span>
								<span class="ep-10">
									&nbsp;
									<button type="action" name="act_dynamancyattack10ep" /> 10 EP
								</span>
								<span class="ep-20">
									<br />
									<button type="action" name="act_dynamancyattack20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_dynamancyattack30ep" /> 30 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_dynamancyattack40ep" /> 40 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_dynamancy_duration_attack" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Dynamancy}} {{Dynamancy (duration attack) @{dynamancy_advantage_text}=[[@{dynamancy_duration_attack_roll} + @{dynamancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_dynamancydurationattackinfo" class="info-button" />
							<label class="skillapp"> Duration Attack </label>
							<label class="skill-tem-container">
								<input name="attr_dynamancy_duration_attack_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<div>
								<label style="width: 125px;"> Damage Modifier </label>
								<div class="input-group">
									<input name="attr_duration_attack_damage_dice_modifier" type="text" />
									<span class="input-group-addon" style="width: 10%"> d6 </span>
								</div>
							</div>
							<input name="attr_dynamancy_duration_attack_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_dynamancy_duration_attack_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_dynamancy_duration_attack_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_dynamancy_duration_attack_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_dynamancy_duration_attack_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_dynamancydurationattack10ep" /> 10
									&nbsp;
								</span>
								<span class="ep-20">
									<button type="action" name="act_dynamancydurationattack20ep" /> 20
									&nbsp;
								</span>
								<span class="ep-30">
									<button type="action" name="act_dynamancydurationattack30ep" /> 30
									&nbsp;
								</span>
								<span class="ep-40">
									<button type="action" name="act_dynamancydurationattack40ep" /> 40
								</span>
								<span class="ep-10">
									<br />
									<input name="attr_dynamancy_duration_attack_last_damage_roll" type="hidden" />
									<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Dynamancy}} {{Dynamancy (duration attack) @{dynamancy_advantage_text}=[[@{dynamancy_attack_roll} + @{dynamancy_total} + @{mob_skill_bonus}]]}} {{Damage=[[@{dynamancy_duration_attack_last_damage_roll} + @{dynamancy_attribute_modifier}]]}}'" />
									Reroll Last
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_dynamancy_force_effect" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Dynamancy}} {{Dynamancy (force effect) @{dynamancy_advantage_text}=[[@{dynamancy_force_effect_roll} + @{dynamancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_dynamancyforceeffectinfo" class="info-button" />
							<label class="skillapp"> Force Effect </label>
							<label class="skill-tem-container">
								<input name="attr_dynamancy_force_effect_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_dynamancy_force_effect_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_dynamancy_force_effect_newline" type="hidden" class="show-break-newline" value="false" />
								<input name="attr_show_dynamancy_force_effect_15_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_dynamancy_force_effect_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-20">
									<button type="action" name="act_dynamancyforceeffectoffensive15ep" /> Offensive 15 EP
									&nbsp;
									<button type="action" name="act_dynamancyforceeffectdefensive15ep" /> Defensive 15 EP
								</span>
								<span class="break-newline">
									<br />
								</span>
								<span class="ep-30">
									<button type="action" name="act_dynamancyforceeffectoffensive30ep" /> Offensive 30 EP
									&nbsp;
									<button type="action" name="act_dynamancyforceeffectdefensive30ep" /> Defensive 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>
						
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_dynamancy_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_dynamancy_pool_total" type="text" readonly />
					<input name="attr_dynamancy_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>

			</span>
		</div>
	
	</div>

	<div class="sheet-col">

		<div>
			<input name="attr_show_illusion" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div>
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						<input name="attr_bb_natural_magic_illusion" type="hidden" class="show-ability" value="false" />
						<span class="ability"> Natural <br /> Illusion </span> 
						<span class="no-ability"> Illusion </span>  
						<button type="action" name="act_toggleillusionspells" class="toggle" />
						<br />
						<input name="attr_ps_academic_magic_versatility_illusion" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Wit </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Intelligence </span>
					</label>
					<input name="attr_illusion_total" type="text" readonly />
					<input name="attr_illusion_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageIllusion" name="attr_illusion_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageIllusion" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageIllusion" name="attr_illusion_advantage" value="Disadvantage">
						<label for="radioDisadvantageIllusion">Dis</label>

						<input type="radio" id="radioNovantageIllusion" name="attr_illusion_advantage" value="Novantage" checked>
						<label for="radioNovantageIllusion">N</label>

						<input type="radio" id="radioAdvantageIllusion" name="attr_illusion_advantage" value="Advantage">
						<label for="radioAdvantageIllusion">Adv</label>

						<input type="radio" id="radioGreatAdvantageIllusion" name="attr_illusion_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageIllusion" class="right-end">GA</label> 
						
						<input name="attr_illusion_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_illusion_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<!-- Natural Illusion -->
				<div class="top-space bottom-space">
					<input name="attr_bb_natural_magic_illusion" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<div>
							<input class="custom" name="attr_natural_magic_illusion_recharge_roll" type="hidden" />
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Natural Illusion}} {{Recharge=[[@{natural_magic_illusion_recharge_roll}]]}}'" />
							Check Recharge
						</div>
					</span>
				</div>
				
				<div>
					<input name="attr_show_illusion_disguise" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Illusion}} {{Illusion (disguise) @{illusion_advantage_text}=[[@{illusion_disguise_roll} + @{illusion_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_illusiondisguiseinfo" class="info-button" />
							<label class="skillapp"> Disguise </label>
							<label class="skill-tem-container">
								<input name="attr_illusion_disguise_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_illusion_disguise_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_illusion_disguise_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_illusion_disguise_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_illusion_disguise_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_illusion_disguise_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_illusiondisguise10ep" /> 10 
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_illusiondisguise20ep" /> 20 
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_illusiondisguise30ep" /> 30 
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_illusiondisguise40ep" /> 40 
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_illusion_hologram" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Illusion}} {{Illusion (hologram) @{illusion_advantage_text}=[[@{illusion_hologram_roll} + @{illusion_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_illusionholograminfo" class="info-button" />
							<label class="skillapp"> Hologram </label>
							<label class="skill-tem-container">
								<input name="attr_illusion_hologram_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_illusion_hologram_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_illusion_hologram_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_illusion_hologram_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_illusion_hologram_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_illusion_hologram_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_illusionhologram10ep" /> 10 
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_illusionhologram20ep" /> 20 
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_illusionhologram30ep" /> 30 
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_illusionhologram40ep" /> 40 
								</span>
								<span class="ep-30">
									<div class="top-space">
										<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Hologram Attack}} {{Illusion (hologram) @{illusion_advantage_text}=[[@{illusion_hologram_roll} + @{illusion_total} + @{mob_skill_bonus}]]}} {{Damage=[[@{illusion_tier}d6+@{illusion_attribute_modifier}]]}}'" />
										Roll Hologram Attack
									</div>
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_illusion_mirror_image" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Illusion}} {{Illusion (mirror image) @{illusion_advantage_text}=[[@{illusion_mirror_image_roll} + @{illusion_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_illusionmirrorimageinfo" class="info-button" />
							<label class="skillapp"> Mirror Image </label>
							<label class="skill-tem-container">
								<input name="attr_illusion_mirror_image_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_illusion_mirror_image_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_illusion_mirror_image_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_illusion_mirror_image_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_illusion_mirror_image_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_illusionmirrorimage10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_illusionmirrorimage20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_illusionmirrorimage30ep" /> 30 EP
								</span>
								<span class="ep-20">
									<div class="top-space">
										<input class="custom" name="attr_mirror_image_recharge_roll" type="hidden" />
										<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Mirror Image}} {{Recharge=[[@{mirror_image_recharge_roll}]]}}'" />
										Check Recharge
									</div>
								</span>
								<span class="ep-30">
									<div class="top-space">
										<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Mirror Image}} {{Extra Damage=[[@{illusion_tier}d6]] + the number of doubles that are left}}'" />
										Roll Extra Damage
									</div>
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_illusion_obscure" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Illusion}} {{Illusion (obscure) @{illusion_advantage_text}=[[@{illusion_obscure_roll} + @{illusion_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_illusionobscureinfo" class="info-button" />
							<label class="skillapp"> Obscure </label>
							<label class="skill-tem-container">
								<input name="attr_illusion_obscure_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_illusion_obscure_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_illusion_obscure_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_illusion_obscure_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_illusion_obscure_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_illusionobscure10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_illusionobscure20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_illusionobscure30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_illusion_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_illusion_pool_total" type="text" readonly />
					<input name="attr_illusion_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_metamancy" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Metamancy
						<button type="action" name="act_togglemetamancyspells" class="toggle" />
						<br />
						<input name="attr_ps_intuitive_magic_versatility_metamancy" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Intelligence </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Wit </span>
					</label>
					<input name="attr_metamancy_total" type="text" readonly />
					<input name="attr_metamancy_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageMetamancy" name="attr_metamancy_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageMetamancy" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageMetamancy" name="attr_metamancy_advantage" value="Disadvantage">
						<label for="radioDisadvantageMetamancy">Dis</label>

						<input type="radio" id="radioNovantageMetamancy" name="attr_metamancy_advantage" value="Novantage" checked>
						<label for="radioNovantageMetamancy">N</label>

						<input type="radio" id="radioAdvantageMetamancy" name="attr_metamancy_advantage" value="Advantage">
						<label for="radioAdvantageMetamancy">Adv</label>

						<input type="radio" id="radioGreatAdvantageMetamancy" name="attr_metamancy_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageMetamancy" class="right-end">GA</label> 
						
						<input name="attr_metamancy_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_metamancy_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<!-- Keep EP in use -->
				<div>
					<span>
						<div class="top-space bottom-space">
							<label class="skill-tem-container">
								<input name="attr_keep_ep_in_use" type="checkbox" />
								<span class="skill-tem magic-focus"> Keep EP in use </span>
							</label>
						</div>
					</span>
				</div>
				
				<div>
					<input name="attr_show_metamancy_dispel_magic" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Metamancy}} {{Metamancy (dispel magic) @{metamancy_advantage_text}=[[@{metamancy_dispel_magic_roll} + @{metamancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_metamancydispelmagicinfo" class="info-button" />
							<label class="skillapp"> Dispel Magic </label>
							<label class="skill-tem-container">
								<input name="attr_metamancy_dispel_magic_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_metamancy_dispel_magic_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_metamancy_dispel_magic_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_metamancy_dispel_magic_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_metamancy_dispel_magic_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_metamancy_dispel_magic_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_metamancydispelmagic10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_metamancydispelmagic20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_metamancydispelmagic30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_metamancydispelmagic40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_metamancy_inscribe_charge_rune" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Metamancy}} {{Metamancy (inscribe charge rune) @{metamancy_advantage_text}=[[@{metamancy_inscribe_charge_rune_roll} + @{metamancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_metamancyinscribechargeruneinfo" class="info-button" />
							<label class="skillapp"> Inscribe Charge Rune </label>
							<label class="skill-tem-container">
								<input name="attr_metamancy_inscribe_charge_rune_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_metamancy_inscribe_charge_rune_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_metamancy_inscribe_charge_rune_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_metamancy_inscribe_charge_rune_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_metamancy_inscribe_charge_rune_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_metamancy_inscribe_charge_rune_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_metamancyinscribechargerune10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_metamancyinscribechargerune20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_metamancyinscribechargerune30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_metamancyinscribechargerune40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_metamancy_inscribe_duration_rune" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Metamancy}} {{Metamancy (inscribe duration rune) @{metamancy_advantage_text}=[[@{metamancy_inscribe_duration_rune_roll} + @{metamancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_metamancyinscribedurationruneinfo" class="info-button" />
							<label class="skillapp"> Inscribe Duration Rune </label>
							<label class="skill-tem-container">
								<input name="attr_metamancy_inscribe_duration_rune_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_metamancy_inscribe_duration_rune_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_metamancy_inscribe_duration_rune_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_metamancy_inscribe_duration_rune_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_metamancy_inscribe_duration_rune_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_metamancy_inscribe_duration_rune_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_metamancyinscribedurationrune10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_metamancyinscribedurationrune20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_metamancyinscribedurationrune30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_metamancyinscribedurationrune40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_metamancy_imbue" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Metamancy}} {{Metamancy (imbue) @{metamancy_advantage_text}=[[@{metamancy_imbue_roll} + @{metamancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_metamancyimbueinfo" class="info-button" />
							<label class="skillapp"> Imbue </label>
							<label class="skill-tem-container">
								<input name="attr_metamancy_imbue_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_metamancy_imbue_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_metamancy_imbue_20_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_metamancy_imbue_40_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_metamancy_imbue_60_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_metamancy_imbue_80_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_metamancyimbue20ep" /> 20
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_metamancyimbue40ep" /> 40
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_metamancyimbue60ep" /> 60
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_metamancyimbue80ep" /> 80
								</span>
							</div>
						</div>
					</span>
				</div>
						
				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_metamancy_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_metamancy_pool_total" type="text" readonly />
					<input name="attr_metamancy_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_necromancy" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						Necromancy
						<button type="action" name="act_togglenecromancyspells" class="toggle" />
						<br />
						<input name="attr_ps_intuitive_magic_versatility_necromancy" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Intelligence </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Wit </span>
					</label>
					<input name="attr_necromancy_total" type="text" readonly />
					<input name="attr_necromancy_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageNecromancy" name="attr_necromancy_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageNecromancy" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageNecromancy" name="attr_necromancy_advantage" value="Disadvantage">
						<label for="radioDisadvantageNecromancy">Dis</label>

						<input type="radio" id="radioNovantageNecromancy" name="attr_necromancy_advantage" value="Novantage" checked>
						<label for="radioNovantageNecromancy">N</label>

						<input type="radio" id="radioAdvantageNecromancy" name="attr_necromancy_advantage" value="Advantage">
						<label for="radioAdvantageNecromancy">Adv</label>

						<input type="radio" id="radioGreatAdvantageNecromancy" name="attr_necromancy_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageNecromancy" class="right-end">GA</label> 
						
						<input name="attr_necromancy_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_necromancy_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<div>
					<input name="attr_show_necromancy_control_undead" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Necromancy}} {{Necromancy (control undead) @{necromancy_advantage_text}=[[@{necromancy_control_undead_roll} + @{necromancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_necromancycontrolundeadinfo" class="info-button" />
							<label class="skillapp"> Control Undead </label>
							<label class="skill-tem-container">
								<input name="attr_necromancy_control_undead_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_necromancy_control_undead_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_necromancy_control_undead_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_necromancy_control_undead_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-20">
									<button type="action" name="act_necromancycontrolundead20ep" /> 20 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_necromancycontrolundead40ep" /> 40 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_necromancy_create_undead" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Necromancy}} {{Necromancy (create undead) @{necromancy_advantage_text}=[[@{necromancy_create_undead_roll} + @{necromancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_necromancycreateundeadinfo" class="info-button" />
							<label class="skillapp"> Create Undead </label>
							<label class="skill-tem-container">
								<input name="attr_necromancy_create_undead_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_necromancy_create_undead_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_necromancy_create_undead_20_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_necromancy_create_undead_40_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_necromancy_create_undead_60_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_necromancy_create_undead_80_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_necromancycreateundead20ep" /> 20
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_necromancycreateundead40ep" /> 40
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_necromancycreateundead60ep" /> 60
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_necromancycreateundead80ep" /> 80
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_necromancy_decrepify" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Necromancy}} {{Necromancy (decrepify) @{necromancy_advantage_text}=[[@{necromancy_decrepify_roll} + @{necromancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_necromancydecrepifyinfo" class="info-button" />
							<label class="skillapp"> Decrepify </label>
							<label class="skill-tem-container">
								<input name="attr_necromancy_decrepify_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_necromancy_decrepify_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_necromancy_decrepify_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_necromancy_decrepify_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_necromancy_decrepify_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_necromancydecrepify10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_necromancydecrepify20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_necromancydecrepify30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_necromancy_shape_corpse" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Necromancy}} {{Necromancy (shape corpse) @{necromancy_advantage_text}=[[@{necromancy_shape_corpse_roll} + @{necromancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_necromancyshapecorpseinfo" class="info-button" />
							<label class="skillapp"> Shape Corpse </label>
							<label class="skill-tem-container">
								<input name="attr_necromancy_shape_corpse_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_necromancy_shape_corpse_roll" type="hidden" value="2d6" />
							<input name="attr_show_necromancy_shape_corpse_10_ep" type="hidden" class="show-ep-10" value="false" />
							<span class="ep-10">
								<div class="top-space bottom-space">
									<label class="skill-tem-container">
										<input name="attr_use_necromancy_pool_points" type="checkbox" />
										<span class="skill-tem magic-focus"> Use Pool Points </span>
									</label>
									<input name="attr_necromancy_pool_points_to_use" type="text" style="margin-left: 100px" />
									points
								</div>
								<div>
									<label style="width: 125px;"> Healing Modifier </label>
									<div class="input-group">
										<input name="attr_necromancy_healing_dice_modifier" type="text" />
										<span class="input-group-addon" style="width: 10%"> d </span>
									</div>
									&nbsp; +
									<input name="attr_necromancy_healing_static_modifier" type="text" />
								</div>
							</span>
							<div>
								<input name="attr_show_necromancy_shape_corpse_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_necromancy_shape_corpse_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_necromancy_shape_corpse_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_necromancy_shape_corpse_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_necromancyshapecorpse5ep" /> 5 EP
									&nbsp;
									<button type="action" name="act_necromancyshapecorpse10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_necromancyshapecorpse20ep" /> 20 EP
								</span>
								<span class="ep-30">
									<br />
									<button type="action" name="act_necromancyshapecorpse30ep" /> 30 EP
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_necromancyshapecorpse40ep" /> 40 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_necromancy_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_necromancy_pool_total" type="text" readonly />
					<input name="attr_necromancy_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

		<div>
			<input name="attr_show_neuromancy" type="hidden" class="show-ability" value="true" />
			<span class="ability">
				<div class="top-line-bold">
					<span class="tiny-text skill-points-header">Total &nbsp; &nbsp; Points</span>
				</div>
				<div class="skillname">
					<label>
						<input name="attr_bb_natural_magic_neuromancy" type="hidden" class="show-ability" value="false" />
						<span class="ability"> Natural <br /> Neuromancy </span> 
						<span class="no-ability"> Neuromancy </span>  
						<button type="action" name="act_toggleneuromancyspells" class="toggle" />
						<br />
						<input name="attr_ps_academic_magic_versatility_neuromancy" type="hidden" class="show-replacement-attribute" value="false" />
						<span class="skill-attribute default-attribute"> Wit </span>
						&shy;
						<span class="skill-attribute replacement-attribute"> Intelligence </span>
					</label>
					<input name="attr_neuromancy_total" type="text" readonly />
					<input name="attr_neuromancy_points" type="text" />
				</div>
				
				<div>
					<div class="advantage-toolbar">
						<input type="radio" id="radioGreatDisadvantageNeuromancy" name="attr_neuromancy_advantage" value="GreatDisadvantage">
						<label for="radioGreatDisadvantageNeuromancy" class="left-end">GD</label>

						<input type="radio" id="radioDisadvantageNeuromancy" name="attr_neuromancy_advantage" value="Disadvantage">
						<label for="radioDisadvantageNeuromancy">Dis</label>

						<input type="radio" id="radioNovantageNeuromancy" name="attr_neuromancy_advantage" value="Novantage" checked>
						<label for="radioNovantageNeuromancy">N</label>

						<input type="radio" id="radioAdvantageNeuromancy" name="attr_neuromancy_advantage" value="Advantage">
						<label for="radioAdvantageNeuromancy">Adv</label>

						<input type="radio" id="radioGreatAdvantageNeuromancy" name="attr_neuromancy_advantage" value="GreatAdvantage">
						<label for="radioGreatAdvantageNeuromancy" class="right-end">GA</label> 
						
						<input name="attr_neuromancy_advantage_text" type="hidden" />			
					</div>
					
					<div class="explode">
						<label class="tierpool"> Expl </label>
						<input name="attr_neuromancy_explode" type="text" value="10" />
						+
					</div>
				</div>
				
				<!-- Natural Neuromancy -->
				<div class="top-space bottom-space">
					<input name="attr_bb_natural_magic_neuromancy" type="hidden" class="show-ability" value="false" />
					<span class="ability">
						<div>
							<input class="custom" name="attr_natural_magic_neuromancy_recharge_roll" type="hidden" />
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Natural Neuromancy}} {{Recharge=[[@{natural_magic_neuromancy_recharge_roll}]]}}'" />
							Check Recharge
						</div>
					</span>
				</div>
				
				<div>
					<input name="attr_show_neuromancy_charm" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-space">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Neuromancy}} {{Neuromancy (charm) @{neuromancy_advantage_text}=[[@{neuromancy_charm_roll} + @{neuromancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_neuromancycharminfo" class="info-button" />
							<label class="skillapp"> Charm </label>
							<label class="skill-tem-container">
								<input name="attr_neuromancy_charm_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_neuromancy_charm_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_neuromancy_charm_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_neuromancy_charm_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_neuromancy_charm_30_ep" type="hidden" class="show-ep-30" value="false" />
								<input name="attr_show_neuromancy_charm_40_ep" type="hidden" class="show-ep-40" value="false" />
								<span class="ep-10">
									<button type="action" name="act_neuromancycharm10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_neuromancycharm20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_neuromancycharm30ep" /> 30
								</span>
								<span class="ep-40">
									&nbsp;
									<button type="action" name="act_neuromancycharm40ep" /> 40
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_neuromancy_fear" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Neuromancy}} {{Neuromancy (fear) @{neuromancy_advantage_text}=[[@{neuromancy_fear_roll} + @{neuromancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_neuromancyfearinfo" class="info-button" />
							<label class="skillapp"> Fear </label>
							<label class="skill-tem-container">
								<input name="attr_neuromancy_fear_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_neuromancy_fear_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_neuromancy_fear_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_neuromancy_fear_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_neuromancyfear10ep" /> 10 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_neuromancyfear30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_neuromancy_influence" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Neuromancy}} {{Neuromancy (influence) @{neuromancy_advantage_text}=[[@{neuromancy_influence_roll} + @{neuromancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_neuromancyinfluenceinfo" class="info-button" />
							<label class="skillapp"> Influence </label>
							<label class="skill-tem-container">
								<input name="attr_neuromancy_influence_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_neuromancy_influence_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_neuromancy_influence_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_neuromancy_influence_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_neuromancy_influence_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_neuromancyinfluence10ep" /> 10 EP
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_neuromancyinfluence20ep" /> 20 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_neuromancyinfluence30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_neuromancy_sleep" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Neuromancy}} {{Neuromancy (sleep) @{neuromancy_advantage_text}=[[@{neuromancy_sleep_roll} + @{neuromancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_neuromancysleepinfo" class="info-button" />
							<label class="skillapp top-space"> Sleep </label>
							<label class="skill-tem-container">
								<input name="attr_neuromancy_sleep_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_neuromancy_sleep_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_neuromancy_sleep_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_neuromancy_sleep_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_neuromancysleep10ep" /> 10 EP
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_neuromancysleep30ep" /> 30 EP
								</span>
							</div>
						</div>
					</span>
				</div>

				<div>
					<input name="attr_show_neuromancy_telepathy" type="hidden" class="show-ability" value="true" />
					<span class="ability">
						<div class="top-line">
							<button type="roll" value="@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Neuromancy}} {{Neuromancy (telepathy) @{neuromancy_advantage_text}=[[@{neuromancy_telepathy_roll} + @{neuromancy_total} + @{mob_skill_bonus}]]}}'" />
							<button type="action" name="act_neuromancytelepathyinfo" class="info-button" />
							<label class="skillapp"> Telepathy </label>
							<label class="skill-tem-container">
								<input name="attr_neuromancy_telepathy_training" type="checkbox" />
								<span class="skill-tem skill-training"> Training </span>
							</label>
							<input name="attr_neuromancy_telepathy_roll" type="hidden" value="2d6" />
							<div>
								<input name="attr_show_neuromancy_telepathy_10_ep" type="hidden" class="show-ep-10" value="false" />
								<input name="attr_show_neuromancy_telepathy_20_ep" type="hidden" class="show-ep-20" value="false" />
								<input name="attr_show_neuromancy_telepathy_30_ep" type="hidden" class="show-ep-30" value="false" />
								<span class="ep-10">
									<button type="action" name="act_neuromancytelepathy5ep" /> 5
									&nbsp;
									<button type="action" name="act_neuromancytelepathy10ep" /> 10
								</span>
								<span class="ep-20">
									&nbsp;
									<button type="action" name="act_neuromancytelepathy20ep" /> 20
								</span>
								<span class="ep-30">
									&nbsp;
									<button type="action" name="act_neuromancytelepathy30ep" /> 30
								</span>
							</div>
						</div>
					</span>
				</div>

				<div class="top-space">
					<label class="tierpool"> Tier </label>
					<input name="attr_neuromancy_tier" type="text" value="0" readonly />
					<label class="tierpool"> Pool </label>
					<input name="attr_neuromancy_pool_total" type="text" readonly />
					<input name="attr_neuromancy_pool_extra" type="text" />
				</div>
				<div>
					<span class="tiny-text pool-footer">Total &nbsp; &nbsp; Extra</span>
				</div>
			</span>
		</div>

	</div>

</div>

<!-- end sheet -->
</div> 


<!-- Custom roll template from here: https://wiki.roll20.net/Building_Character_Sheets/Roll_Templates#Jakob.27s_Better_Default_Rolltemplate -->
<rolltemplate class="sheet-rolltemplate-custom">
  <div class="sheet-container sheet-color-{{color}}">
    <div class="sheet-header">
      {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
      {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
    </div>
    <div class="sheet-content">
      {{#allprops() title subtitle desc color}}
      <div class="sheet-key">{{key}}</div>
      <div class="sheet-value">{{value}}</div>
      {{/allprops() title subtitle desc color}}
      {{#desc}}<div class="sheet-desc">{{desc}}</div>{{/desc}}
    </div>
  </div>
</rolltemplate>

<!-- TODO: Custom roll template for Biomancy (resurrect) -->


<script type="text/worker">

const _n = '%NEWLINE%';
const _rn = _n + _n;
const _or = _n + '&mdash; or &mdash;' + _n;
const _bull = _n + ' &#183; ';
const _star = '&#9734;';
const _pow = _rn + '**Power:** ';
const _bolt_touch = `Bolt${_n}Touch`;
const minor_major_array = ['minor', 'major'];

function get_int_or_zero(value) {
	if (!value) {
		return 0;
	}
	return parseInt(value.toString())||0;
}

function get_float_or_zero(value) {
	if (!value) {
		return 0;
	}
	return parseFloat(value.toString())||0;
}

function get_bool(value) {
	if (!value) {
		return false;
	}
	return (value.toString().toLowerCase() === 'true');
}

function capitalize_first_letter(word) {
	return word.charAt(0).toUpperCase() + word.slice(1);
}

function get_modifier(attribute) {
	if (attribute == 0) {
		return 0;
	}
	let modifier = Math.floor(attribute / 2 - 7);
	if (attribute < 14) {
		modifier++;
	}
	return modifier;
}

function get_tier(skill_points) {
	if (skill_points == 0) {
		return 0;
	}
	return Math.ceil( (skill_points + 1 ) / 10 );
}

function get_roll(training, advantage, explode) {
	//console.log(`get_roll: training = ${training}; advantage = ${advantage}; explode = ${explode}`);
	let roll = 'd6';
	if (training == 'on') { 
		roll = 'd10!!'; 
		if (explode < 10) {
			roll += '>' + explode;
		}
	}
	else if (training != 'on' && explode <= 6) {
		roll += '!!>' + explode;
	}

	let numberOfDice = (advantage.includes('Great') ? '4' : (advantage.includes('No') ? '2' : '3'));
  
	let keep = '';
	if (!advantage.includes('No')) {
		let lower = (advantage.includes('Dis') ? 'l' : '');
		keep = 'k' + lower + '2';
	}

	roll = numberOfDice + roll + keep;
	
	return roll;
}

function get_advantage_text(advantage) {
	return advantage.replace('tA', 't A').replace('tD', 't D').replace('Novantage', '');
}

function apply_advantage(current_advantage, index_modifier, disadvantage = false) {
	let advantage_array = ['GreatDisadvantage', 'Disadvantage', 'Novantage', 'Advantage', 'GreatAdvantage'];
	let last            = advantage_array.length - 1;
	let index           = advantage_array.indexOf(current_advantage) + index_modifier;
	let new_index       = (disadvantage ? index - 1 : index + 1);
	let new_advantage   = advantage_array[Math.max(Math.min(new_index, last), 0)];
	if (new_index > last) {
		index_modifier = new_index - last;
	}
	else if (new_index < 0) {
		index_modifier = new_index;
	}
	else {
		index_modifier = 0;
	}
	//console.log(`new_index: ${new_index}, new_advantage: ${new_advantage}, index_modifier: ${index_modifier}`);
	return { 'advantage': new_advantage, 'index_modifier': index_modifier };
}

const magic_item_bonus_array = [
	{ name: 'magic',     tier: 1, damage_bonus_by_tier: [ 0, 1, 1, 2, 2 ], dr_bonus_by_tier: [ 0, 4,  6,  8,  8 ], explode_value_by_tier: [ 10, 9, 9, 8, 8 ] },
	{ name: 'eldritch',  tier: 2, damage_bonus_by_tier: [ 0, 1, 2, 3, 4 ], dr_bonus_by_tier: [ 0, 4,  8, 12, 16 ], explode_value_by_tier: [ 10, 9, 8, 7, 7 ] },
	{ name: 'epic',      tier: 3, damage_bonus_by_tier: [ 0, 2, 3, 5, 6 ], dr_bonus_by_tier: [ 0, 6, 12, 18, 24 ], explode_value_by_tier: [ 10, 8, 7, 7, 6 ] },
	{ name: 'legendary', tier: 4, damage_bonus_by_tier: [ 0, 2, 4, 6, 8 ], dr_bonus_by_tier: [ 0, 8, 16, 24, 36 ], explode_value_by_tier: [ 10, 7, 7, 6, 6 ] }
];

function is_magic_item(text) {
	return magic_item_bonus_array.map(i => i.name).some(t => text.includes(t));
}

function get_magic_item_object(item_name) {
	let magic_item_object = null;
	let text = parse_textarea(item_name);
	
	for (let item of magic_item_bonus_array) {
		if (text.includes(item.name)) {
			magic_item_object = item;
		}
	}
	
	return magic_item_object;
}

function get_rake_bonus_damage(weapon_name) {
	let bonus = 0;
	let regex = /rake[ \(]+(\d+) claws/;
	let matches = weapon_name.match(regex);
	if (matches) {
		//console.log(matches);
		let claws = get_int_or_zero(matches[1]);
		bonus = claws - 1;
	}
	return bonus;
}

function get_swarm_bonus_damage(weapon_name) {
	let bonus = 0;
	if (weapon_name.toLowerCase().includes('swarm')) {
		bonus = 2;
	}
	return bonus;
}

function get_charge_damage(weapon_name, has_devastating_charge, has_flying_kick, athletics_tier) {
	let charge_modifier = (has_devastating_charge ? 1 : 0);
	let weapon_name_lc = weapon_name.toLowerCase();
	if (weapon_name_lc.includes('lance') || weapon_name_lc.includes('spear') || weapon_name_lc.includes('pike') ||
		(has_flying_kick && weapon_name_lc.replaceAll(' ', '').includes('flyingkick'))) {
		charge_modifier += (has_devastating_charge ? athletics_tier : 1);
	}
	//console.log(`get_charge_damage; weapon_name: ${weapon_name}, has_devastating_charge: ${has_devastating_charge}, has_flying_kick: ${has_flying_kick}, athletics_tier: ${athletics_tier}, charge_modifier: ${charge_modifier}`);
	return charge_modifier;
}

function get_weapon_damage(weapon_name, tier, modifier = 0) {
	let weapon_dice = 0;
	let base_damage = (weapon_name.toLowerCase().includes('improvised') ? 0 : 1);
	if (weapon_name) {
		weapon_dice = base_damage + tier + get_rake_bonus_damage(weapon_name) + get_swarm_bonus_damage(weapon_name) + modifier;
	}
	//console.log(`get_weapon_damage; base_damage: ${base_damage}, tier: ${tier}, rake_bonus_damage: ${get_rake_bonus_damage(weapon_name)}, swarm_bonus_damage: ${get_swarm_bonus_damage(weapon_name)}, modifier: ${modifier}`);
	return weapon_dice;
}

function get_weapon_roll_text(weapon_name, style_name, style_friendly_name, number, style_extra_damage, damage_static_modifier, has_magic_damage) {
	
	if (!weapon_name) {
		return `/w @{character_name} ***You have no weapon in slot ${number} of Attack (${style_friendly_name})***`;
	}

	let extra_damage    = (style_extra_damage ? ' + @{' + style_extra_damage + '}' : '');
	if (damage_static_modifier) {
		extra_damage += ' + ' + damage_static_modifier;
	}
	let damage_roll     = "[[@{" + style_name + "_weapon" + number + "_physical_damage}d6 + @{attack_attribute_modifier}" + extra_damage + "]]";
	let damage_calc     = '';
	let damage_display  = damage_roll;
	if (has_magic_damage) {
		damage_calc     = "[[ " + damage_roll + " + [[@{" + style_name + "_weapon" + number + "_magic_damage}d6]] ]]";
		damage_display  = `$[[3]] total${_rn}$[[1]] physical${_n}$[[2]] magic`;
	}
	let roll_text       = "@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Attack (" + style_friendly_name + ") Weapon " + number + 
	" @{attack_advantage_text}}} {{" + weapon_name + " attack=[[@{attack_" + style_name + "_roll} + @{attack_total} + @{mob_skill_bonus}]]}} " +
	damage_calc + " {{" + weapon_name + " damage=" + damage_display + "}}'";
	
	return roll_text;
}

function get_modified_ep_cost(ep_cost, bb_inner_magic, use_beam) {
	if (ep_cost > 5 && (get_bool(bb_inner_magic) || use_beam == 'on')) {
		ep_cost = Math.max(5, ep_cost - 10);
	}
	
	return ep_cost;
}

function parse_textarea(text) {
	return text.replace(/[\n;]+/g, ',').replace(/\s+/g, '').replace(/[^a-zA-Z0-9,]/g, '').replace(/,$/, '').toLowerCase();
}

function decrement_item_count(equipment, regex){
	let matches = equipment.match(regex);
	console.log(matches);
	let item_text = '';
	let item_count = 0;
	if (matches) {
		item_text = matches[1];
		item_count = matches[2];
	}
	if (item_count < 1) {
		return null;
	}
	else {
		return (equipment.replace(regex, item_text + --item_count));
	}
}

function header_text(header, newline_after = true) {
	let newline = (newline_after ? _n : '');
	return `${_rn}**${header}**${newline}`;
}

function tier_effect(tier, effect_per_tier, effect_description, skill_name, prefix = '', base_count = 0, maximum = 0) {
	let tier_text                   = 'tier';
	let effect_per_tier_display     = effect_per_tier;
	let effect_description_per_tier = effect_description;
	let base_count_text             = '';
	let maximum_text                = ''

	if (maximum > 0) {
		tier         = Math.min(tier, maximum);
		maximum_text = `, maximum ${maximum}`; 
	}
	if (prefix != '') {
		prefix = `**${prefix}**`;
	}
	if (effect_per_tier == 1 && effect_description == '') {
		if (base_count > 0) {
			base_count_text = ' + ' + base_count;
		}
		return `${prefix}[[${tier + base_count} : This is your tier in ${skill_name}${base_count_text}${maximum_text}]]`;
	}
	if (effect_per_tier < 1) {
		tier_text = (1 / effect_per_tier) + ' tiers';
		effect_per_tier_display = 1;
	}
	if (effect_per_tier == 1 && effect_description.endsWith('s')) {
		if (effect_description.endsWith('ies')) {
			effect_description_per_tier = effect_description.substring(0, effect_description.length - 3) + 'y';
		}
		else {
			effect_description_per_tier = effect_description.substring(0, effect_description.length - 1);
		}
		if (tier == 1 && base_count == 0) {
			effect_description = effect_description_per_tier;
		}
	}
	if (base_count > 0) {
		base_count_text = `${effect_per_tier * base_count}${effect_description}, plus `;
		if (effect_description.startsWith(' ')) {
			effect_description_per_tier = '';
		}
	}
	
	return `${prefix}[[${Math.floor((base_count + tier) * effect_per_tier)} : This is ${base_count_text}${effect_per_tier_display}${effect_description_per_tier} per ${tier_text} you have in ${skill_name}${maximum_text}]]**${effect_description}**`;
}

function tier_effect_attack(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Attack', prefix, base_count);
}

function tier_effect_medicine(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Medicine', prefix, base_count);
}

function tier_effect_alteration(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Alteration', prefix, base_count);
}

function tier_effect_biomancy(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Biomancy', prefix, base_count);
}

function tier_effect_conjuration(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Conjuration', prefix, base_count);
}

function tier_effect_displacement(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Displacement', prefix, base_count);
}

function tier_effect_divination(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Divination', prefix, base_count);
}

function tier_effect_dynamancy(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Dynamancy', prefix, base_count);
}

function tier_effect_illusion(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Illusion', prefix, base_count);
}

function tier_effect_necromancy(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Necromancy', prefix, base_count);
}

function tier_effect_neuromancy(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Neuromancy', prefix, base_count);
}

function tier_effect_metamancy(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Metamancy', prefix, base_count);
}

function tier_effect_pr(tier, effect_per_tier, effect_description, prefix = '', base_count = 0) {
	return tier_effect(tier, effect_per_tier, effect_description, 'Physical Resilience', prefix, base_count);
}

function tier_effect_combat(tier, tier_1, tier_3, description = '', prefix = '') {
	let effect = (tier >= 3 ? tier_3 : tier_1);
	return `**${prefix}**[[${effect} : This is ${tier_1}${description}, or ${tier_3}${description} if you have at least tier 3 in Attack]]**${description}**`;
}

function tier_effect_combat_range(trained, tier, base, per_tier, type = '', attribute_name = '', attribute_mod = 0, minimum = 1) {
	let type_text = '';
	if (type) {
		type_text = ` (${type})`;
	}

	let range = base + (trained ? tier * per_tier : 0);
	let attribute_text = '';
	if (attribute_name) {
		attribute_text = `, plus your ${attribute_name} modifier (minimum ${minimum} square)`;
		range = Math.max(range + attribute_mod, minimum);
	}
	return `${_rn}**Range${type_text}:** [[${range} : This is ${base} squares, plus ${per_tier} squares per tier you have in Attack (if you are trained in [combat style])${attribute_text}]] squares`;
} 

function value_effect(value_name, value, minimum = false, minimum_val = 0) {
	let minimum_text = '';
	if (minimum) {
		minimum_text = ', minimum ' + minimum_val;
		value = Math.max(value, minimum_val);
	}
	return `[[${value} : This is your ${value_name}${minimum_text}]]`;
}

function attribute_mod_effect(attribute_name, attribute_mod, minimum = false, minimum_val = 0) {
	let minimum_text = '';
	if (minimum) {
		minimum_text = ', minimum ' + minimum_val;
		attribute_mod = Math.max(attribute_mod, minimum_val);
	}
	let prefix = '';
	if (attribute_mod >= 0) {
		prefix = '**+**';
	}
	return `${prefix}[[${attribute_mod} : This is your ${attribute_name} modifier${minimum_text}]]`;
}

function skill_total_effect(skill_name, skill_total, base_value = 0) {
	let base_value_text = '';
	if (base_value > 0) {
		base_value_text = `${base_value}, plus `;
	}
	
	return `[[${skill_total + base_value} : This is ${base_value_text}your ${skill_name} total]]`;
}

function skill_total_effect_pr(skill_total, base_value = 0) {
	return skill_total_effect('Physical Resilience', skill_total, base_value);
}

function skill_total_effect_mr(skill_total, base_value = 0) {
	return skill_total_effect('Mental Resilience', skill_total, base_value);
}

function spend_pool(skill_name, description) {
	return `${_rn}${_star} You can spend ${skill_name} pool points to ${description}`;
}

function spend_pool_attack(description) {
	return spend_pool('Attack', description);
}

function spend_pool_athletics(description) {
	return spend_pool('Athletics', description);
}

function spend_pool_security(description) {
	return spend_pool('Security', description);
}

function spend_pool_nature(description) {
	return spend_pool('Nature', description);
}

function spend_pool_arcana(description) {
	return spend_pool('Arcana', description);
}

function spend_pool_alteration(description) {
	return spend_pool('Alteration', description);
}

function spend_pool_biomancy(description) {
	return spend_pool('Biomancy', description);
}

function spend_pool_conjuration(description) {
	return spend_pool('Conjuration', description);
}

function spend_pool_displacement(description) {
	return spend_pool('Displacement', description);
}

function spend_pool_divination(description) {
	return spend_pool('Divination', description);
}

function spend_pool_dynamancy(description) {
	return spend_pool('Dynamancy', description);
}

function spend_pool_illusion(description) {
	return spend_pool('Illusion', description);
}

function spend_pool_necromancy(description) {
	return spend_pool('Necromancy', description);
}

function spend_pool_neuromancy(description) {
	return spend_pool('Neuromancy', description);
}

function spend_pool_metamancy(description) {
	return spend_pool('Metamancy', description);
}

function spend_pool_perception(description) {
	return spend_pool('Perception', description);
}

function get_crit_text(success, failure, single_target_spell = false) {
	let success_text = '';
	let failure_text = '';
	let single_target_text = (single_target_spell ? ' (bolt or touch only)' : '');
	if (success) {
		success_text = `${_rn}*Critical Success${single_target_text}:* ${success}`;
	}
	if (failure) {
		failure_text = `${_rn}*Critical Failure${single_target_text}:* ` + 
		failure.replace('[fumble]', 'you drop or fumble with your weapon, spill ammo, or some other minor inconvenience, and must spend 1 AP to recover');
	}
	
	return success_text + failure_text;
}

function get_info_text(subject, template_items, description) {
	return "/w @{character_name} '&{template:custom} {{title=" + subject + " info}} " + template_items + " {{desc=" + description + "}}'";
}

function get_spell_info(spell, casting_time, range, base_duration, duration_bonus, area_types, target, resist, effects, description, collapse_high_duration_bonus = false) {
	let template_items = '';
	if (casting_time) {
		template_items += `{{Casting Time=${casting_time}}} `;
	}
	if (range) {
		template_items += `{{Range=${range}}} `;
	}
	if (base_duration || base_duration == 0) {
		template_items += get_duration_text(base_duration, duration_bonus, collapse_high_duration_bonus);
	}
	if (area_types) {
		if (typeof area_types ==='string' || area_types instanceof String) {
			template_items += `{{Area Types=${area_types}}} `;
		}
		else {
			area_types.forEach( function(area) {
				let space = (area.name.length > 10 ? _n : ' ');
				template_items += `{{Area Types${space}(${area.name})=${area.types}}} `;
			});
		}
	}
	if (target) {
		template_items += `{{Target=${target}}} `;
	}
	if (resist) {
		template_items += `{{Resist=${resist}}} `;
	}
	template_items += effects;

	return get_info_text(spell, template_items, description);
}

function get_area_type_list(spell_area_size, area_type_blast, area_type_burst, area_type_line, area_type_nova, area_type_wall) {
	let area_type_list = "Bolt";
	
	if (area_type_blast == "on") {
		area_type_list += _n + "Blast (" + spell_area_size + " sq)";
	}
	
	if (area_type_burst == "on") {
		area_type_list += _n + "Burst (" + spell_area_size + " sq)";
	}
	
	if (area_type_line == "on") {
		area_type_list += _n + "Line (" + (spell_area_size * 2) + " sq)";
	}
	
	if (area_type_nova == "on") {
		area_type_list += _n + "Nova (" + spell_area_size + " sq)";
	}
	
	area_type_list += _n + "Touch";
	
	if (area_type_wall == "on") {
		area_type_list += _n + "Wall (" + spell_area_size + " sq)";
	}
	
	return area_type_list;
}

function get_area(area_type, area_size) {
	let area = area_type;
	
	if (area_type == "line") {
		area_size *= 2;
	}
	
	if (["blast", "burst", "line", "nova", "wall"].includes(area_type)) {
		area += " (" + area_size + " sq)";
	}
	
	return area;
}

// CP Calc Functions
function cp_calc_skill_points(points) {
	let cp = 0;
	
	if (points > 19) {
		cp = 48 + (points - 19) * 4;
	}
	else if (points > 9) {
		cp = 18 + (points  - 9) * 3;
	}
	else {
		cp = points * 2;
	}

	return cp;
}

function cp_calc_skill_applications(app_count) {
	return Math.max(0, (app_count - 1) * 3);
}

function cp_calc_skill_pool(pool_extra) {
	return (pool_extra == 1 ? 5 : (pool_extra == 2 ? 15 : (pool_extra == 3 ? 30 : (pool_extra == 4 ? 50 : 0))));
}

const attribute_array = [
	{ name: 'physique',     combat_score: true  },
	{ name: 'agility',      combat_score: true  },
	{ name: 'intelligence', combat_score: false },
	{ name: 'wit',          combat_score: false }
];

const attribute_cp_costs = [ -60, -103, -92, -82, -72, -63, -54, -46, -38, -31, -24, -18, -12, -7, -2, 2, 7, 12, 18, 24, 31, 38, 46, 54, 63, 
72, 82, 92, 103, 114, 126, 138, 151, 164, 178, 192, 207, 222, 238, 254, 271, 288, 306, 324, 343, 362, 382, 402, 423, 444, 466 ];

attribute_array.forEach( function(attribute) {
	on('change:' + attribute.name, function() {
		getAttrs([attribute.name], function(values) {
			let attribute_value = get_int_or_zero(values[attribute.name]);
			
			if (attribute_value > 50) {
				console.error('Attribute values over 50 are not supported!');
				setAttrs({ [attribute.name]: 50 });
				return;
			}
			
			let attribute_mod = get_modifier(attribute_value);
			let cp_name       = `cp_${attribute.name}`;
			let cp_value      = attribute_cp_costs[attribute_value];
			console.log(`${cp_name}: ${cp_value}`);
			let set_object    = {
				[attribute.name + '_modifier']: attribute_mod,
				[cp_name]:                      cp_value
			};
			
			if (attribute.name == 'physique') {
				set_object['carry'    ] = attribute_value;
				set_object['carry_max'] = attribute_value * 2;
			}
			if (attribute.name == 'agility') {
				set_object['agility_speed_modifier'] = Math.floor((attribute_mod / 2) + (attribute_mod < 0 ? 0.5 : 0));
			}

			setAttrs(set_object);
		});
	});
});

[true, false].forEach( function(is_combat_score) {
	let attr_array = attribute_array.filter(attr => attr.combat_score == is_combat_score).map(attr => `cp_${attr.name}`);
	on('change:' + attr_array.join(' change:'), function() {
		getAttrs(attr_array, function(values) {
			let cp_attributes = 0;
			for (const attr of attr_array) {
				cp_attributes += get_int_or_zero(values[attr]);
			}
			let attr_key = `cp_${(is_combat_score ? '' : 'non_')}combat_attributes`;
			console.log(`${attr_key}: ${cp_attributes}`);
			setAttrs({ [attr_key]: cp_attributes });
		});
	});
});

function is_armor(armor_text) {
	let text = parse_textarea(armor_text);
	return ['armor', 'jerkin', 'fullplate', 'platemail', 'halfplate', 'splintmail', 'bandedmail', 'chainmail', 'scalemail', 'studdedleather', 'chainshirt', 'leather', 'jerkin'].some(a => text.includes(a));
}

function parse_armor(armor_text) {
	let armor_object = null;
	let text = parse_textarea(armor_text);
	
	if (['fullplate', 'platemail', 'halfplate', 'splintmail', 'bandedmail', 'heavyarmor'].some(a => text.includes(a))) {
		armor_object = { tier: 4, type: 'heavy', dr: 16, carry: 3 };
	}
	else if (['chainmail', 'scalemail', 'mailarmor', 'mediumarmor'].some(a => text.includes(a))) {
		armor_object = { tier: 3, type: 'medium', dr: 8, carry: 2 };
	}
	else if (['studdedleather', 'chainshirt', 'lightarmor'].some(a => text.includes(a))) {
		armor_object = { tier: 2, type: 'light', dr: 4, carry: 1 };
	}
	else if (['leather', 'jerkin', 'paddedarmor', 'minorarmor'].some(a => text.includes(a))) {
		armor_object = { tier: 1, type: 'minor', dr: 2, carry: 0 };
	}
	
	if (text.includes('adamantite')) {
		armor_object['material_bonus'] = 4;
	}
	else if (text.includes('astracite')) {
		armor_object['material_bonus'] = 8;
	}
	else {
		armor_object['material_bonus'] = 0;
	}
	
	let magic_object = get_magic_item_object(text);
	if (magic_object) {
		armor_object['magic_bonus_by_tier'] = magic_object.dr_bonus_by_tier;
	}
	
	return armor_object;
}

function set_carry_count() {
	getAttrs(['equipment_carry', 'money_gold_coins', 'money_silver_coins', 'money_copper_coins', 'armor_name'], function(values) {
		let equipment_text = parse_textarea(values.equipment_carry);
		const array = equipment_text.split(',');
		console.log('equipment: ' + array);

		let count         = 0;
		let mult          = 1;
		let has_sack      = false;
		let has_backpack  = false;
		let has_haversack = false;

		console.log('set_carry_count');
		for(let i in array) {
			let item = array[i];
			const match = array[i].match(/(.+)x(\d+)/);
			mult = 1 * (match ? (match[2]) : 1);
			if (match) {
				item = match[1];
				mult = 1 * match[2];
			}
			console.log(`line ${i}: ${item}, mult = ${mult}`);
			if (is_armor(item)) {
				console.log('found armor');
				let armor_object = parse_armor(item);
				count += mult * armor_object.carry;
			}
			else if (item != '') {
				count += mult;
			}
			
			if (item == 'sack') {
				has_sack = true;
			}
			if (item == 'backpack') {
				has_backpack = true;
			}
			if (item == 'handyhaversack') {
				has_haversack = true;
			}
		}
		
		let coin_count = get_int_or_zero(values.money_gold_coins) + get_int_or_zero(values.money_silver_coins) + get_int_or_zero(values.money_copper_coins);
		let coin_carry = Math.floor( coin_count / 500 );
		
		count += coin_carry;
		
		if (has_haversack) {
			count = Math.max( count - 12, 1 );
		}
		else if (has_backpack) {
			count = Math.max( count - 5, 1 );
		}
		else if (has_sack) {
			count = Math.max( count - 2, 1 );
		}

		if (is_armor(values.armor_name)) {
			let armor_object = parse_armor(values.armor_name);
			count += armor_object.carry;
		}
		
		setAttrs({ 'carry_current': count });
	});
}

function get_duration_text(base_duration, duration_bonus, collapse_high_duration_bonus = false) {
	let duration_text = '';
	if (isNaN(base_duration)) {
		if (collapse_high_duration_bonus && duration_bonus > 1) {
			base_duration = base_duration[0].duration;
		}
		else {
			base_duration.forEach( function(dur) {
				let name = '';
				let space = '';
				if (dur.name) {
					name = `(${dur.name})`;
					space = (dur.name.length > 10 ? _n : ' ');
				}
				let duration = (dur.custom ? dur.duration : get_spell_duration(dur.duration, duration_bonus));
				duration_text += `{{Duration${space}${name}=${duration}}} `;
			});
		}
	}
	if (!isNaN(base_duration)) {
		duration_text = `{{Duration=${get_spell_duration(base_duration, duration_bonus)}}} `;
	}

	return duration_text;
}

function cast_spell(skill_name, spell_name, ep_cost, base_duration = null, collapse_high_duration_bonus = false, effect = null, effect_attr = null, desc = null) {
	let natural_magic_name = 'bb_natural_magic_' + skill_name;
	let get_array = ['spell_duration', 'spell_duration_bonus', 'bb_inner_magic', 'use_beam', natural_magic_name, 'keep_ep_in_use', 'essence_points_in_use', 'essence_points'];
	
	getAttrs(get_array, function(values) {
		let duration          = get_int_or_zero(values.spell_duration);
		let duration_bonus    = get_int_or_zero(values.spell_duration_bonus);
		let has_natural_boon  = get_bool(values[natural_magic_name]);
		let ep                = get_int_or_zero(values.essence_points);
		let ep_in_use         = get_int_or_zero(values.essence_points_in_use);
		ep_cost               = (has_natural_boon ? 0 : get_modified_ep_cost(ep_cost, values.bb_inner_magic, values.use_beam));
		let keep_ep_in_use    = (values.keep_ep_in_use == 'on' || spell_name.match(/inscribe_.+?_rune/));
		let new_ep_in_use     = (keep_ep_in_use ? ep_in_use + ep_cost : ep_in_use);
		let skill_name_cap    = (has_natural_boon ? 'Natural ' : '') + capitalize_first_letter(skill_name);
		let spell_name_spaces = spell_name.replaceAll('_', ' ');
		
		let duration_text = get_duration_text(base_duration, duration_bonus, collapse_high_duration_bonus);

		let effect_text = '';
		if (effect_attr) {
			effect_text = effect_attr;
		}
		else if (effect) {
			effect_text = '{{Effect=' + effect + '}}';
		}
		
		let desc_text = '';
		if (desc) {
			desc_text = ' {{desc=' + desc + '}}';
		}

		let roll_text = "@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: " + skill_name_cap + "}} {{" + skill_name_cap + " (" + 
		spell_name_spaces + ") @{" + skill_name + "_advantage_text}=[[@{" + skill_name + "_" + spell_name + "_roll} + @{" + skill_name + "_total} + @{mob_skill_bonus}]]}} " + 
		effect_text + duration_text + "{{EP Cost=[[" + ep_cost + "]]}}" + desc_text + "'";

		startRoll(roll_text, (results) => {

			finishRoll(results.rollId);

			setAttrs({
				"essence_points": ep - ep_cost,
				"essence_points_in_use": new_ep_in_use,
				"keep_ep_in_use": "0"
			});
		});
	});
}

const cast_spell_exception_array = [
	'conjuration_armor', 'conjuration_fabricate', 'conjuration_summon_ally', 'displacement_telekinesis', 'displacement_teleport', 'biomancy_heal_damage', 
	'dynamancy_attack', 'dynamancy_duration_attack', 'necromancy_shape_corpse'];
cast_spell_exception_array.forEach( function(spell) {
	let skill_spell_array  = spell.split(/_(.*)/s);
	let effect_name        = `${spell}_effect`;
	let effect_text_name   = `${spell}_effect_text`;
	let base_duration_name = `${spell}_base_duration`;
	let duration_text_name = `${spell}_duration_text`;
	let ep_cost_name       = `${spell}_ep_cost`;
	let desc_name          = `${spell}_desc`;
	on(`change:${spell}_toggle`, function() {
		getAttrs([effect_name, effect_text_name, base_duration_name, ep_cost_name, desc_name], function(values) {
			let ep_cost       = get_int_or_zero(values[ep_cost_name]);
			let base_duration = get_int_or_zero(values[base_duration_name]);
			cast_spell(
				skill_spell_array[0], 
				skill_spell_array[1], 
				ep_cost, 
				base_duration,
				values[duration_text_name],
				values[effect_name],
				values[effect_text_name],
				values[desc_name]);
		});
	});
});

function cast_turn_undead_fear(ep_cost, is_turn_undead = true) {
	let crit_condition = '';
	let skill_name     = 'biomancy';
	let spell_name     = 'turn_undead';
	if (!is_turn_undead) {
		crit_condition = ' (bolt or touch only)';
		skill_name     = 'neuromancy';
		spell_name     = 'fear';
	}

	let effect = `{{Effect=Targets are **scared**}} {{Critical Success${crit_condition}=Target is **terrified**}} ` +
	`{{Critical Failure${crit_condition}=Caster is **scared**}} `;
	if (ep_cost == 30) {
		effect = '{{Effect=Targets are **terrified**}} ';
	}
	
	cast_spell(skill_name, spell_name, ep_cost, dur_short_rest_w_checks_1, null, null, effect);
}

function cast_prowess_imbue(ep_cost, is_prowess = true) {
	let skill_name = 'divination';
	let spell_name = 'prowess';
	let skill_desc = 'non-magic';
	let ep_cost_mult = 1;
	if (!is_prowess) {
		skill_name = 'metamancy';
		spell_name = 'imbue';
		skill_desc = 'magic';
		ep_cost_mult = 2;
	}
	let explode = 10 - (ep_cost / (10 * ep_cost_mult));
	let effect = `One ${skill_desc} skill explodes on **${explode}+**`;
	
	if (ep_cost / ep_cost_mult == 10) {
		effect += _or + `Training in one ${skill_desc} skill application`;
	}
	
	cast_spell(skill_name, spell_name, ep_cost, dur_concentration, false, effect);
}

function cast_adopt_aspect(ep_cost) {
	let boon_list = `${_bull}Fast Movement (+1 sq)${_bull}Ferocity${_bull}Infravision${_bull}Natural Attack (up to two)${_bull}Natural Damage Resistance (physical) 2${_bull}Quick Reflexes${_bull}Scent${_bull}Stability${_bull}Stonecunning${_bull}Ultravision`;

	if (ep_cost == 10){
		boon_list = `${_bull}Climb (3 sq)${_bull}Fast Movement (+3 sq)${_bull}Natural Attack + Free Grapple${_bull}Natural Attack (up to four)${_bull}Natural Damage Resistance (physical) 4${_bull}Swim (3 sq)`;
	}
	else if (ep_cost == 20) {
		boon_list = `${_bull}Amphibious + Swim (4 sq)${_bull}Aquatic + Swim (4 sq)${_bull}Burrow (3 sq)${_bull}Climb (6 sq)${_bull}Fast Movement (+6 sq)${_bull}Fly (4 sq)${_bull}Natural Attack + Free Grapple + Crush${_bull}Natural Attack + Free Grapple + Rake; this must be combined with Natural Attack (claw) from the 5 or 10 EP list or by spending pool points in order for Rake to cause extra damage${_bull}Natural Damage Resistance (physical) 8${_bull}Swim (6 sq)`;
	}
	else if (ep_cost == 30) {
		boon_list = `${_bull}Amphibious + Swim (10 sq)${_bull}Aquatic + Swim (10 sq)${_bull}Fly (10 sq)${_bull}Natural Damage Resistance (physical) 16`;
	}

	cast_spell('alteration', 'adopt_aspect', ep_cost, dur_concentration, false, null, null, '**Boon List**' + boon_list);
}

function cast_alter_armor_or_weapon(ep_cost, armor = true) {
	let effect = 'Add/remove magic';
	let base_duration = [
		{ name: 'add magic',    duration: dur_concentration         },
		{ name: 'remove magic', duration: dur_short_rest_w_checks_1 }
	];
	if (ep_cost == 20) {
		effect = `Add/remove eldritch${_or} ` + (armor ? 'Greater energy armor' : 'Energy weapon');
	}
	else if (ep_cost == 30) {
		effect = `Add/remove epic` + (armor ? '' : _or + 'Greater energy weapon');
	}
	else if (ep_cost == 40) {
		effect = 'Add/remove legendary';
	}
	
	cast_spell('alteration', 'alter_' + (armor ? 'armor' : 'weapon'), ep_cost, base_duration, true, effect);
}

function cast_alter_armor(ep_cost) {
	cast_alter_armor_or_weapon(ep_cost);
}

function cast_alter_weapon(ep_cost) {
	cast_alter_armor_or_weapon(ep_cost, false);
}

function cast_change_size(ep_cost) {
	let boon_10ep = "Large Size" + _or + "Small Size";
	let boon_20ep = "Huge Size" + _or + "Tiny Size";
	let boon = boon_10ep;
	if (ep_cost == 20) {
		boon = boon_20ep;
	}
	else if (ep_cost == 30) {
		boon = boon_10ep + _or + boon_20ep;
	}

	cast_spell('alteration', 'change_size', ep_cost, dur_concentration, false, boon);
}

function cast_illuminate(ep_cost) {
	let effect = `Items shine like torches (4 sq/20 ft)${_or}Area covered in darkness`;
	if (ep_cost >= 20) {
		effect = `Items shine like doubled torches (8 sq/40 ft)${_or}Area covered in deep darkness`;
	}
	let base_duration = (ep_cost == 30 ? dur_short_rest_p_linger : dur_concentration_w_pool);
	
	cast_spell('alteration', 'illuminate', ep_cost, base_duration, false, effect);
}

function cast_indurate(ep_cost) {
	let effect = 'Fatigued, move -1 sq';
	if (ep_cost == 30) {
		effect = 'Indurated';
	}
	else if (ep_cost == 45) {
		effect = "Indurated permanently";
	}
	let base_duration = (ep_cost == 45 ? dur_instantaneous : dur_short_rest_w_checks_1);

	cast_spell('alteration', 'indurate', ep_cost, base_duration, false, effect);
}

function cast_detoxify(ep_cost) {
	let effect  = `Advantage${_or}Replace checks`;
	let or_less = (ep_cost > 10 ? ' or less' : '');
	if (ep_cost >= 10) {
		effect = `Cure tier [[${(ep_cost / 10)}]]${or_less}${_or}Advantage${_or}Replace checks`;
	}
	
	cast_spell('biomancy', 'detoxify', ep_cost, dur_instantaneous, false, effect);
}

function cast_heal_damage(ep_cost) {
	getAttrs(["biomancy_heal_damage_toggle", "biomancy_tier", "ps_focused_healing", "use_focused_healing", "biomancy_healing_dice_modifier"], function(values) {
		let toggle = get_bool(values.biomancy_heal_damage_toggle);
		let tier = get_int_or_zero(values.biomancy_tier);
		let multiplier = 0;
		let size = ((ep_cost == 10 || ep_cost == 30) ? 10 : 6 );
		if (ep_cost < 20) {
			multiplier = 1;
		}
		else if (ep_cost < 40) {
			multiplier = 2;
		}
		else {
			multiplier = 4;
		}
		let has_focus = get_bool(values.ps_focused_healing);
		let use_focus = (values.use_focused_healing == 'on');
		let damage_tier = (has_focus && use_focus ? tier + 1 : tier);
		let damage = ((damage_tier + 1 ) * multiplier + get_int_or_zero(values.biomancy_healing_dice_modifier)) + "d" +  size;

		setAttrs({
			"biomancy_heal_damage_toggle":        !toggle,
			"biomancy_heal_damage_base_duration": dur_instantaneous,
			"biomancy_heal_damage_effect_text":   "{{Healing=[[" + damage + " + @{biomancy_attribute_modifier} + @{biomancy_healing_static_modifier}]]}}", 
			"biomancy_heal_damage_ep_cost":       ep_cost
		});
	});
}

function cast_regenerate(ep_cost) {
	if (ep_cost == 30) {
		cast_spell(
			'biomancy', 'regenerate', ep_cost, dur_instantaneous, false, null, 
			'{{Healing=[[@{biomancy_tier}d6 + @{biomancy_attribute_modifier}]]}}', 
			'If the limbs are touching the part they were severed from, they reattach in one round. Otherwise they regenerate slowly over 10 minutes.'
		);
		return;
	}

	let effect = '[[@{biomancy_tier} * 5]] days';
	let tn = 30;
	let regain_short = 'HP and EP as short rest';
	let regain_long = regain_short.replace('short', 'long');
	let regain_text = '1 HP and 1 EP';
	let nauseated = ', is nauseated until they take a short rest';
	let sickened = ', and is sickened until they take a long rest';
	let condition_text = nauseated + sickened;
	let crit_success = regain_short + _n;
	let crit_failure = 'great ';
	let regenerate = '';
	if (ep_cost >= 90) {
		effect = '[[@{biomancy_tier} * 5]] years';
		tn = 40;
		crit_success = regain_long + _n;
		crit_failure = '';
		regain_text = regain_short;
		condition_text = sickened;
		regenerate = _n + '10 EP *regenerate*';
	}
	if (ep_cost == 120) {
		effect = '[[@{biomancy_tier} * 50]] years';
		tn = 50;
		crit_success = '';
		regain_text = 'full HP and EP';
		condition_text = '';
	}
	let desc = 'Upon being resurrected, the creature is placed on ' + regain_text + condition_text + '.';
	
	let effect_text = `{{Target Number=[[${tn}]]}} {{Success=Resurrect a creature that has been dead up to ${effect}}} ` +
	`{{Critical Success=${crit_success}${(ep_cost / 3)} EP *detoxify/revivify*${regenerate}}} ` +
	`{{Critical Failure=Your future resurrect attempts incur ${crit_failure}disadvantage}}`;
	
	cast_spell('biomancy', 'regenerate', ep_cost, dur_instantaneous, false, null, effect_text, desc);
}

function cast_revivify(ep_cost) {
	let desc = `**10 EP List**${_bull}Alleviate the fatigued condition${_bull}Alleviate the sickened condition${_bull}Alleviate the slowed condition  (each AP of slowness counts as a separate condition)`;
	if (ep_cost == 20) {
		desc = `**20 EP List**${_bull}Reduce the nauseated condition to sickened${_bull}Reduce the paralyzed condition to slowed (2 AP)${_bull}Alleviate up to **@{biomancy_tier}** from the 10 EP list`;
	}
	else if (ep_cost == 30) {
		desc = `**30 EP List**${_bull}Any **2** items from the 20 EP list${_bull}Alleviate the nauseated condition${_bull}Alleviate the paralyzed condition${_bull}Reverse the effects of the Alteration (indurate) spell, reverting the statue back to a living creature`;
	}
	
	cast_spell('biomancy', 'revivify', ep_cost, dur_instantaneous, false, 'One item from the ' + ep_cost + ' EP List', null, desc);
}

function cast_sustain(ep_cost) {
	let effect = "Hard rations for [[@{biomancy_tier} * 3 : 3 people per tier you have in Biomancy]] people" + _or + "Restore spoiled food in the area";
	if (ep_cost == 10) {
		effect = "Cooked food for [[@{biomancy_tier} * 3 : 3 people per tier you have in Biomancy]] people" + _or +
		"Ingredients for [[@{biomancy_tier} * 6 : 6 people per tier you have in Biomancy]] people";
	}
	else if (ep_cost == 20) {
		effect = "Sustain [[@{biomancy_tier} * 6 : 6 people per tier you have in Biomancy]] people";
	}

	cast_spell('biomancy', 'sustain', ep_cost, dur_instantaneous, false, effect);
}

function cast_turn_undead(ep_cost) {
	cast_turn_undead_fear(ep_cost);
}

function cast_armor(ep_cost) {
	getAttrs(["conjuration_armor_toggle", "conjuration_tier"], function(values) {
		let toggle = get_bool(values.conjuration_armor_toggle);
		let tier   = get_int_or_zero(values.conjuration_tier);
		let armor_dr_array = [
			{ ep_cost:  5, base_dr:  4, dr_per_tier: 3 },
			{ ep_cost: 10, base_dr:  6, dr_per_tier: 4 },
			{ ep_cost: 20, base_dr:  8, dr_per_tier: 5 },
			{ ep_cost: 30, base_dr: 10, dr_per_tier: 6 },
			{ ep_cost: 40, base_dr: 12, dr_per_tier: 7 }
		];
		let dr_object   = armor_dr_array.find(a => a.ep_cost == ep_cost);
		let dr_bonus    = dr_object.base_dr + (dr_object.dr_per_tier * tier);
		let effect_text = `{{DR bonus=[[${dr_bonus}]]}} {{Damage Types=Up to [[${tier}]]}} `;
		setAttrs({ 
			'conjuration_armor_toggle':        !toggle,
			'conjuration_armor_effect_text':   effect_text, 
			'conjuration_armor_base_duration': dur_concentration_w_pool, 
			'conjuration_armor_ep_cost':       ep_cost 
		});
	});
}

function cast_barrier(ep_cost) {
	let base_duration = dur_concentration;
	let effect = "Standard barrier";
	if (ep_cost == 30) {
		base_duration = dur_concentration_w_pool;
		effect = "Fortified barrier, blocks spells and magic weapons";
	}
	else if (ep_cost >= 45) {
		base_duration = dur_short_rest_p_linger;
		effect = "Fortified barrier, blocks spells and magic weapons, include/exclude creatures";
	}
	if (ep_cost == 60) {
		base_duration = dur_permanent;
	}
	
	cast_spell('conjuration', 'barrier', ep_cost, base_duration, false, effect);
}

function cast_difficult_terrain(ep_cost) {
	let effect = "Difficult terrain";
	if (ep_cost == 10) {
		effect = "Difficult terrain and slippery";
	}
	else if (ep_cost == 20) {
		effect = "Difficult terrain and grasping appendages";
	}
	else if (ep_cost == 30) {
		effect = "Difficult terrain and grasping appendages, designate allies who ignore it";
	}
	else if (ep_cost == 40) {
		effect = "Difficult terrain and grasping appendages, designate allies who ignore and are protected by it";
	}

	cast_spell('conjuration', 'difficult_terrain', ep_cost, dur_concentration, false, effect);
}

function cast_fabricate_create(ep_cost) {
	getAttrs(["conjuration_fabricate_toggle", "conjuration_tier"], function(values) {
		let toggle = get_bool(values.conjuration_fabricate_toggle);
		let tier = get_int_or_zero(values.conjuration_tier);
		let item_count_multiplier = (1 / tier);
		let weight_cost_limit_multiplier = 10;
		if (ep_cost == 10) {
			item_count_multiplier = 1;
			weight_cost_limit_multiplier = 20;
		}
		else if (ep_cost == 20) {
			item_count_multiplier = 2;
			weight_cost_limit_multiplier = 50;
		}
		else if (ep_cost == 30) {
			item_count_multiplier = 3;
			weight_cost_limit_multiplier = 100;
		}
		else if (ep_cost == 40) {
			item_count_multiplier = 4;
			weight_cost_limit_multiplier = 250;
		}
		
		let effect = "Up to " + (tier * item_count_multiplier) + " item(s) of up to " + (tier * weight_cost_limit_multiplier) + " lbs/gc";

		setAttrs({ 
			'conjuration_fabricate_toggle':        !toggle,
			'conjuration_fabricate_effect':        effect, 
			'conjuration_fabricate_effect_text':   '', 
			'conjuration_fabricate_base_duration': dur_concentration, 
			'conjuration_fabricate_ep_cost':       ep_cost 
		});
	});
}

function cast_fabricate_repair(ep_cost) {
	getAttrs(["conjuration_fabricate_toggle", "conjuration_tier", "conjuration_healing_dice_modifier"], function(values) {
		let toggle = get_bool(values.conjuration_fabricate_toggle);
		let tier = get_int_or_zero(values.conjuration_tier);

		let multiplier = 0;
		let size = ((ep_cost == 10 || ep_cost == 30) ? 10 : 6 );
		if (ep_cost < 20) {
			multiplier = 1;
		}
		else if (ep_cost < 40) {
			multiplier = 2;
		}
		else {
			multiplier = 4;
		}
		let damage = ((tier + 1 ) * multiplier + get_int_or_zero(values.conjuration_healing_dice_modifier)) + "d" +  size;

		let restore_text = '';
		if (ep_cost == 30) {
			restore_text = _or + "Restore [[1]] destroyed item";
		}
		else if (ep_cost == 40) {
			restore_text = _or + "Restore [[" + tier + "]] destroyed items" + _or + "Restore [[1]] destroyed magic item";
		}
		
		let effect = "Repair/heal [[" + damage + " + @{conjuration_attribute_modifier} + @{conjuration_healing_static_modifier}]]" + restore_text;

		setAttrs({
			'conjuration_fabricate_toggle':        !toggle,
			'conjuration_fabricate_effect':        effect, 
			'conjuration_fabricate_effect_text':   '', 
			'conjuration_fabricate_base_duration': dur_instantaneous, 
			'conjuration_fabricate_ep_cost':       ep_cost 
		});
	});
}

function cast_fabricate_attack(ep_cost) {
	getAttrs(["conjuration_fabricate_toggle", "conjuration_tier", "conjuration_damage_dice_modifier"], function(values) {
		let toggle = get_bool(values.conjuration_fabricate_toggle);
		let tier = get_int_or_zero(values.conjuration_tier);
		let dice_mod = get_int_or_zero(values.conjuration_damage_dice_modifier);
		let damage = (tier + 1) * (ep_cost < 10 ? 1 : (ep_cost / 10) + 1);
		damage += dice_mod;

		setAttrs({
			"conjuration_fabricate_toggle":        !toggle,
			"conjuration_fabricate_base_duration": dur_instantaneous,
			'conjuration_fabricate_effect':        '', 
			"conjuration_fabricate_effect_text":   "{{Damage=[[" + damage + "d6+@{conjuration_attribute_modifier}+@{conjuration_damage_static_modifier}]]}}", 
			"conjuration_fabricate_ep_cost":       ep_cost
		});
	});
}

function cast_shelter(ep_cost) {
	let base_duration = dur_short_rest_p_linger;
	let effect = "Cottage";
	if (ep_cost == 20) {
		effect = "House";
	}
	else if (ep_cost == 30) {
		effect = "Extradimensional house" + _or + "Extradimensional chest";
		base_duration = [
			{ name: 'shelter', duration: dur_short_rest_p_linger },
			{ name: 'chest',   duration: dur_one_week            }
		];
	}
	else if (ep_cost == 40) {
		effect = "Extradimensional mansion";
	}
	
	cast_spell('conjuration', 'shelter', ep_cost, base_duration, null, effect);
}

function cast_shield(ep_cost, skill) {
	let advantage_type = (ep_cost == 30 ? 'Great a' : 'A');
	let effect = `${advantage_type}dvantage on ${skill} checks`;

	cast_spell('conjuration', 'shield', ep_cost, dur_concentration_w_pool, false, effect);
}

function cast_summon_ally(ep_cost, porter = false) {
	getAttrs(["conjuration_summon_ally_toggle", "conjuration_tier", "conjuration_attribute", "conjuration_attribute_modifier", "conjuration_advantage", "conjuration_explode", "summon_ally_damage_dice_modifier", "summon_ally_damage_static_modifier"], function(values) {
		let toggle                 = get_bool(values.conjuration_summon_ally_toggle);
		let tier                   = get_int_or_zero(values.conjuration_tier);
		let attribute              = get_int_or_zero(values.conjuration_attribute);
		let attribute_modifier     = get_int_or_zero(values.conjuration_attribute_modifier);
		let explode                = get_int_or_zero(values.conjuration_explode);
		let damage_dice_modifier   = get_int_or_zero(values.summon_ally_damage_dice_modifier);
		let damage_static_modifier = get_int_or_zero(values.summon_ally_damage_static_modifier);
		let ally_type              = (porter ? "Porter" : "Combatant");
		let ally_hp                = attribute * (tier + 2);
		if (!porter && ep_cost == 20) {
			ally_hp += attribute * 3;
		}
		else if (!porter && ep_cost == 30) {
			ally_hp += attribute * 6;
		}
		let ally_speed = 4;
		let ally_speed_extra = "";
		if (porter) {
			ally_speed += tier;
			if (ep_cost == 20) {
				ally_speed_extra = "," + _n + "fly or swim [[" + ally_speed + "]] sq";
			}
			if (ep_cost == 30) {
				ally_speed += 2;
				ally_speed_extra = "," + _n + "fly and swim [[" + ally_speed + "]] sq," + _n + "burrow [[" + tier + "]] sq";
			}
		}
		let mod_sign = (attribute_modifier >= 0 ? "+" : "");
		let untrained_skill_roll = "2d6" + mod_sign + attribute_modifier;
		let phy_with_mod = attribute + " (" + mod_sign + attribute_modifier + ")";
		let ally_damage = tier + (ep_cost == 20 ? 1 : (ep_cost == 30 ? 2 : 0));
		let ally_carry = attribute * (ep_cost == 20 ? tier : (ep_cost == 30 ? tier + 2 : 2));

		let extra_skills = (ep_cost == 30 ? 6 : 4);
		let ally_skills = "Any [[" + (extra_skills + tier) + "]] skill applications";
		if (ep_cost < 20) {
			if (porter) {
				ally_skills = "Athletics (climb, jump, swim)";
			}
			else {
				ally_skills = "Attack (one melee combat style)" + _n + "Defend (dodge)" + _n + "Mental Resilience (willpower)" + _n + "Physical Resilience (fortitude)";
			}
		}
		
		let ally_damage_text = "";
		let dr_physical = 0;
		if (!porter) {
			ally_damage_text = "{{Damage=" + ally_damage + "d6" + mod_sign + attribute_modifier + "}} ";
			let dr_mult = (ep_cost == 20 ? 5 : (ep_cost == 30 ? 8 : 2));
			dr_physical = (tier * dr_mult);
			ally_damage_text += "{{DR (physical)=[[" + dr_physical + "]]}} ";
		}
		let ally_carry_text = "";
		if (porter) {
			ally_carry_text = "{{Carry=[[" + ally_carry + "]] items}} {{Max Carry=[[" + (ally_carry * 2) + "]] items}}";
		}
		
		let effect_text = "{{Ally type=" + ally_type + "}} {{Physique (modifier)=" + phy_with_mod + "}} {{HP=[[" + ally_hp + "]]}} {{Speed=[[" + 
		ally_speed + "]] squares" + ally_speed_extra + "}} {{Trained skill list=" + ally_skills + "}} {{Trained skill check=Conjuration check}} " +
		"{{Untrained skill check=" + untrained_skill_roll + "}} " + ally_damage_text + ally_carry_text;

		let desc = "You can spend 1 AP to give your ally a command.";

		setAttrs({
			"conjuration_summon_ally_toggle": !toggle,
			"conjuration_summon_ally_base_duration": (porter ? dur_short_rest_p_linger : dur_concentration),
			"conjuration_summon_ally_effect_text": effect_text,
			"conjuration_summon_ally_desc": desc,
			"conjuration_summon_ally_ep_cost": ep_cost,
			"show_summoned_ally": "true",
			"show_porter_ally": (porter ? "true" : "false"),
			"summon_ally_type": ally_type,
			"summon_ally_physique": attribute,
			"summon_ally_physique_modifier": attribute_modifier,
			"summon_ally_hit_points": ally_hp,
			"summon_ally_untrained_dice": get_roll('0', values.conjuration_advantage, explode),
			"summon_ally_damage_dice": ally_damage + damage_dice_modifier,
			"summon_ally_damage_modifier": attribute_modifier + damage_static_modifier,
			"summon_ally_dr_physical": dr_physical,
			"summon_ally_carry": ally_carry,
			"summon_ally_carry_max": (ally_carry * 2)
		});
	});
}

function cast_bind(ep_cost) {
	let base_duration = dur_short_rest_w_checks_1;
	if (ep_cost == 20) {
		base_duration = dur_short_rest_p_linger;
	}
	if (ep_cost == 30) {
		base_duration = dur_one_week;
	}
	
	cast_spell('displacement', 'bind', ep_cost, base_duration, false, "Target(s) can't *teleport*");
}

function cast_chronofield(ep_cost) {
	let base_duration = dur_short_rest_w_checks_1;
	let collapse_high_duration_bonus = false;
	if (ep_cost > 10) {
		base_duration = [
			{ name: 'add AP', duration: dur_concentration         },
			{ name: 'slow',   duration: dur_short_rest_w_checks_1 }
		];
		collapse_high_duration_bonus = true;
	}
	let effect = '&ndash;1 AP';
	if (ep_cost == 20) {
		effect = '+1 AP' + _or + '&ndash;2 AP';
	}
	if (ep_cost == 30) {
		base_duration[1].name = 'paralyze';
		effect = '+2 AP' + _or + 'paralyzed';
	}
	if (ep_cost == 40) {
		base_duration[1] = { name: 'paralyze', duration: dur_short_rest_p_linger };
		collapse_high_duration_bonus = false;
		effect = '+3 AP' + _or + 'paralyzed';
	}

	cast_spell('displacement', 'chronofield', ep_cost, base_duration, collapse_high_duration_bonus, effect);
}

function cast_levitate(ep_cost) {
	let base_duration = (ep_cost == 30 ? dur_short_rest_p_linger : dur_concentration);
	let effect = "Levitate";
	if (ep_cost >= 20) {
		effect = "Fly (speed + @{displacement_tier}) squares";
	}

	cast_spell('displacement', 'levitate', ep_cost, base_duration, false, effect);
}

function cast_stasis(ep_cost) {
	let base_duration = dur_short_rest_p_linger;
	let effect = 'Near stasis';
	if (ep_cost >= 20) {
		base_duration = dur_one_week;
	}
	if (ep_cost >= 30) {
		effect = effect.replace('Near', 'Complete');
	}
	if (ep_cost == 40) {
		base_duration = dur_permanent;
	}

	cast_spell('displacement', 'stasis', ep_cost, base_duration, false, effect);
}

function cast_telekinesis(ep_cost) {
	getAttrs(["displacement_telekinesis_toggle", "displacement_tier"], function(values) {
		let toggle = get_bool(values.displacement_telekinesis_toggle);
		let tier = get_int_or_zero(values.displacement_tier);
		let effect = "Up to " + tier + " items of up to " + (tier * 20) + " pounds" + _or + "Remote Attack check";
		if (ep_cost == 20) {
			effect = "Up to " + (tier * 2) +" items of up to " + (tier * 50 ) + " pounds";
		}
		else if (ep_cost == 30) {
			effect = "Up to " + (tier * 3) +" items of up to " + (tier * 100 ) + " pounds";
		}
		else if (ep_cost == 40) {
			effect = "Up to " + (tier * 4) +" items of up to " + (tier * 250 ) + " pounds";
		}

		setAttrs({
			"displacement_telekinesis_toggle":        !toggle,
			"displacement_telekinesis_base_duration": dur_concentration,
			"displacement_telekinesis_effect":        effect,
			"displacement_telekinesis_ep_cost":       ep_cost
		});
	});
}

function cast_teleport(ep_cost) {
	getAttrs(["displacement_teleport_toggle", "spell_range", "displacement_tier"], function(values) {
		let toggle = get_bool(values.displacement_teleport_toggle);
		let tier = get_int_or_zero(values.displacement_tier);
		let range = get_int_or_zero(values.spell_range);
		let effect = "Teleport within " + range + " squares";
		if (ep_cost == 20) {
			effect = "Teleport within " + (tier * 100) + " miles if successful";
		}
		else if (ep_cost == 30) {
			effect = "Teleport within " + (tier * 500) + " miles automatically" + _or + "Teleport to another plane " +
			"or planet, [[1d10 * 50]] miles from your target";
		}
		else if (ep_cost == 40) {
			effect = "Teleport anywhere automatically";
		}

		setAttrs({
			"displacement_teleport_toggle":        !toggle,
			"displacement_teleport_base_duration": dur_instantaneous,
			"displacement_teleport_effect":        effect,
			"displacement_teleport_ep_cost":       ep_cost
		});
	});
}

function cast_teleport_attack(ep_cost) {
	getAttrs(["displacement_teleport_toggle", "displacement_tier", "displacement_damage_dice_modifier"], function(values) {
		let toggle = get_bool(values.displacement_teleport_toggle);
		let tier = get_int_or_zero(values.displacement_tier);
		let dice_mod = get_int_or_zero(values.displacement_damage_dice_modifier);
		let damage = (tier + 1) * (ep_cost < 10 ? 1 : (ep_cost / 10) + 1);
		damage += dice_mod;

		setAttrs({
			"displacement_teleport_toggle":        !toggle,
			"displacement_teleport_base_duration": dur_instantaneous,
			"displacement_teleport_effect_text":   "{{Damage=[[" + damage + "d6+@{displacement_attribute_modifier}+@{displacement_damage_static_modifier}]]}}", 
			"displacement_teleport_ep_cost":       ep_cost
		});
	});
}

function cast_analyze(ep_cost) {
	let effect = "Analyze up to tier [[@{divination_tier} + 1]]";
	if (ep_cost == 20) {
		effect = "Analyze any (touch)" + _or + effect + " (bolt)";
	}
	else if (ep_cost == 30) {
		effect = "Analyze any (bolt)";
	}

	cast_spell('divination', 'analyze', ep_cost, dur_instantaneous, false, effect);
}

function cast_comprehend(ep_cost) {
	let effect = (ep_cost == 20 ? 'all' : '[[@{divination_tier}]]');

	cast_spell('divination', 'comprehend', ep_cost, dur_short_rest_p_linger, false, `Understand ${effect} languages`);
}

function cast_detect(ep_cost) {
	let effect = "Detect concrete thing";
	if (ep_cost == 10) {
		effect = "Detect abstract thing";
	}
	else if (ep_cost == 20) {
		effect = "Sense or detect any";
	}

	let effect_text = `{{Effect=${effect}}} {{Range=[[@{spell_range}]] squares}}`;

	cast_spell('divination', 'detect', ep_cost, dur_concentration, false, null, effect_text);
}

function cast_prowess(ep_cost) {
	cast_prowess_imbue(ep_cost);
}

function cast_scry(ep_cost) {
	let effect = "Scry within [[@{divination_tier}]] miles";
	if (ep_cost == 20) {
		effect = "Scry on same plane or planet";
	}
	if (ep_cost == 30) {
		effect = "Scry anywhere";
	}

	cast_spell('divination', 'scry', ep_cost, dur_concentration_w_pool, false, effect);
}

function cast_status(ep_cost) {
	let effect = "Know status on same plane or planet";
	if (ep_cost == 20) {
		effect = "Know status anywhere";
	}

	cast_spell('divination', 'status', ep_cost, dur_short_rest_p_linger, false, effect);
}

function cast_attack(ep_cost) {
	getAttrs(["dynamancy_attack_toggle", "dynamancy_tier", "ps_focused_blasting", "use_focused_blasting", "use_mage_rage", "pr_tier", "dynamancy_damage_dice_modifier"], function(values) {
		let toggle = get_bool(values.dynamancy_attack_toggle);
		let tier = get_int_or_zero(values.dynamancy_tier);
		let has_focus = get_bool(values.ps_focused_blasting);
		let use_focus = (values.use_focused_blasting == 'on');
		let use_rage  = (values.use_mage_rage == 'on');
		let dice_mod  = get_int_or_zero(values.dynamancy_damage_dice_modifier);
		let damage_tier = (has_focus && use_focus && ep_cost > 0 ? tier + 1 : tier);
		let damage = (damage_tier + 1) * (ep_cost < 10 ? 1 : (ep_cost / 10) + 1) + (use_rage ? get_int_or_zero(values.pr_tier) : 0);
		damage += dice_mod;

		setAttrs({
			"dynamancy_attack_toggle":        !toggle,
			"dynamancy_attack_base_duration": dur_instantaneous,
			"dynamancy_attack_effect_text":   "{{Damage=[[" + damage + "d6+@{dynamancy_attribute_modifier}+@{dynamancy_damage_static_modifier}]]}}", 
			"dynamancy_attack_ep_cost":       ep_cost
		});
	});
}

function cast_duration_attack(ep_cost) {
	getAttrs(["dynamancy_duration_attack_toggle", "dynamancy_tier", "duration_attack_damage_dice_modifier"], function(values) {
		let toggle   = get_bool(values.dynamancy_duration_attack_toggle);
		let tier     = get_int_or_zero(values.dynamancy_tier);
		let dice_mod = get_int_or_zero(values.duration_attack_damage_dice_modifier);
		let dice     = tier * (ep_cost >= 30 ? 2 : 1) + dice_mod;
		let die_size = (ep_cost % 20 == 0 ? 10 : 6);

		setAttrs({
			"dynamancy_duration_attack_toggle":           !toggle,
			"dynamancy_duration_attack_base_duration":    dur_short_rest_w_checks_1,
			"dynamancy_duration_attack_effect_text":      `{{Damage=[[${dice}d${die_size}+@{dynamancy_attribute_modifier}]]}}`,
			"dynamancy_duration_attack_ep_cost":          ep_cost,
			"dynamancy_duration_attack_last_damage_roll": `${dice}d${die_size}`
		});
	});
}

function cast_dynamancy_force_effect(ep_cost, offensive = true) {
	let effect_text = "";
	let base_duration = "";
	if (offensive) {
		ep30_effect_text = (ep_cost >= 30) ? " and are knocked prone" : "";
		effect_text = "Creatures must make an Attack (reposition) check or move [[@{dynamancy_tier} + @{dynamancy_attribute_modifier}]] squares" + 
		ep30_effect_text + ".";
		base_duration = dur_instantaneous;
	}
	else {
		effect_text = "Creatures must make an Attack (reposition) check to move past the boundaries of the area.";
		if (ep_cost >= 30) {
			effect_text += _rn + "Creatures that fail this check are moved [[@{dynamancy_tier} + @{dynamancy_attribute_modifier}]] squares away from the area.";
		}
		base_duration = dur_concentration;
	}
	
	cast_spell('dynamancy', 'force_effect', ep_cost, base_duration, false, null, null, effect_text);
}

function cast_disguise(ep_cost) {
	let base_duration = dur_concentration;
	let effect = 'Disguise one small part or 1 cubic foot';
	if (ep_cost >= 10) {
		effect = "Disguise single target's sight and sound";
	}
	if (ep_cost >= 20) {
		effect = `Disguise all senses of single target, change size one step${_or}Disguise all targets sight and sound`;
	}
	if (ep_cost >= 30) {
		base_duration = dur_concentration_w_pool;
		effect = 'Disguise all senses of all targets, change size two steps';
	}
	if (ep_cost >= 40) {
		base_duration = dur_short_rest_p_linger;
	}

	cast_spell('illusion', 'disguise', ep_cost, base_duration, false, effect);
}

function cast_hologram(ep_cost) {
	let base_duration = dur_concentration;
	let effect = 'Visual hologram, 3 cubic feet';
	if (ep_cost >= 10) {
		effect = 'Sight and sound person-sized animated hologram';
	}
	if (ep_cost >= 20) {
		effect = `Five senses Large animated hologram${_or}Several sight and sound person-sized animated holograms`;
	}
	if (ep_cost >= 30) {
		base_duration = dur_concentration_w_pool;
		effect = `Five senses Huge animated hologram that can attack${_or}Several five senses Large animated holograms`;
	}
	if (ep_cost >= 40) {
		base_duration = dur_short_rest_p_linger;
		effect = 'Several five senses Huge animated holograms that can attack';
	}

	cast_spell('illusion', 'hologram', ep_cost, base_duration, false, effect);
}

function cast_mirror_image(ep_cost) {
	let effect = "[[@{illusion_tier} * 2 + 2]] illusory doubles";
	let desc = '';
	if (ep_cost >= 20) {
		desc = "Destroyed doubles reappear on a d6 roll of 1-@{illusion_tier}";
	}
	if (ep_cost == 30) {
		desc += _rn + "Doubles attacks are semi-real and add @{illusion_tier}d6 + [double count] damage";
	}

	cast_spell('illusion', 'mirror_image', ep_cost, dur_concentration, false, effect, null, desc);
}

function cast_obscure(ep_cost) {
	let effect = "Obscure one sense, ends with attack";
	if (ep_cost == 20) {
		effect = "Obscure one sense for duration";
	}
	else if (ep_cost == 30) {
		effect = "Obscure one sense except from each other";
	}

	cast_spell('illusion', 'obscure', ep_cost, dur_concentration, false, effect);
}

function cast_control_undead(ep_cost) {
	let type = (ep_cost == 20 ? "mindless" : "any");

	cast_spell('necromancy', 'control_undead', ep_cost, dur_permanent, false, `Control ${type} undead`);
}

function cast_create_undead(ep_cost) {
	let effect = 'human sized skeleton or zombie';
	if (ep_cost == 40) {
		effect = `Large Size${_or}human sized + boon`;
	}
	else if (ep_cost == 60) {
		effect = `Huge Size${_or}Large Size + boon${_or}human sized + 2 boons`;
	}
	else if (ep_cost == 80) {
		effect = `Huge Size + boon${_or}Large Size + 2 boons${_or}human sized + 3 boons`;
	}

	cast_spell('necromancy', 'create_undead', ep_cost, dur_instantaneous, false, effect);
}

function cast_decrepify(ep_cost) {
	let effect = "Target is fatigued";
	if (ep_cost == 20) {
		effect = "Target is fatigued and sickened";
	}
	else if (ep_cost == 30) {
		effect = "Target is nauseated";
	}

	cast_spell('necromancy', 'decrepify', ep_cost, dur_short_rest_w_checks_1, false, effect);
}

function cast_shape_corpse(ep_cost) {
	getAttrs(["necromancy_shape_corpse_toggle", "necromancy_tier", "necromancy_healing_dice_modifier"], function(values) {
		let toggle = get_bool(values.necromancy_shape_corpse_toggle);
		let tier = get_int_or_zero(values.necromancy_tier);
		let multiplier = 0;
		let size = ((ep_cost == 10 || ep_cost == 30) ? 10 : 6 );
		if (ep_cost < 20) {
			multiplier = 1;
		}
		else if (ep_cost < 40) {
			multiplier = 2;
		}
		else {
			multiplier = 4;
		}
		let damage = ((tier + 1 ) * multiplier + get_int_or_zero(values.necromancy_healing_dice_modifier)) + 'd' +  size;
		let effect = '';
		if (ep_cost == 5) {
			effect = 'Shape';
		}
		else if (ep_cost == 10) {
			effect = 'Assemble';
		}
		else if (ep_cost == 20) {
			effect = 'Assemble Large';
		}
		else if (ep_cost == 30) {
			effect = 'Assemble Huge';
		}
		effect = (effect == '' ? '' : effect + ' corpses' + _or) + `Heal [[${damage} + @{necromancy_attribute_modifier} + @{necromancy_healing_static_modifier}]]`;

		setAttrs({
			"necromancy_shape_corpse_toggle":        !toggle,
			"necromancy_shape_corpse_base_duration": dur_instantaneous,
			"necromancy_shape_corpse_effect":        effect, 
			"necromancy_shape_corpse_ep_cost":       ep_cost
		});
	});
}

function cast_charm(ep_cost) {
	let effect = `{{Effect=Target sees you as a friend}} {{Critical Success${_n}(bolt or touch only)=Great advantage on Persuade checks}} ` +
	`{{Critical Failure${_n}(bolt or touch only)=Target knows you cast *charm* on them}} `;
	let base_duration = dur_short_rest_w_checks_2;
	if (ep_cost > 10) {
		base_duration = dur_short_rest_p_linger;
	}
	if (ep_cost == 30) {
		effect = "{{Effect=Targets see you as a friend}} ";
	}
	else if (ep_cost == 40) {
		effect = "{{Effect=Target is dominated}} ";
	}

	cast_spell('neuromancy', 'charm', ep_cost, base_duration, false, null, effect);
}

function cast_fear(ep_cost) {
	cast_turn_undead_fear(ep_cost, false);
}

function cast_influence(ep_cost) {
	let effect = 'One-word command';
	let base_duration = [{ duration: '[[1]] round', custom: true }];
	if (ep_cost == 20) {
		effect = 'One-sentence suggestion'
		base_duration = dur_short_rest_w_checks_2;
	}
	if (ep_cost == 30) {
		effect = `One-word command${_or}One-sentence suggestion`;
		base_duration = [
			{ name: 'command', duration: dur_short_rest_w_checks_1 },
			{ name: 'suggest', duration: dur_short_rest_w_checks_2 }
		];
	}

	cast_spell('neuromancy', 'influence', ep_cost, base_duration, false, null, effect);
}

function cast_sleep(ep_cost) {
	let effect = `{{Effect=Targets are **sleepy**}} {{Critical Success${_n}(bolt or touch only)=Target is **asleep**}} ` +
	`{{Critical Failure${_n}(bolt or touch only)=Caster is **sleepy**}} `;
	if (ep_cost == 30) {
		effect = '{{Effect=Targets are **asleep**}} ';
	}

	cast_spell('neuromancy', 'sleep', ep_cost, dur_short_rest_w_checks_1, false, null, effect);
}

function cast_telepathy(ep_cost) {
	let effect = 'One-sentence message to one target';
	let base_duration = dur_instantaneous;
	if (ep_cost == 10) {
		effect = `Read surface thoughts of one target${_or}Two-way connection${_or}One-sentence message to many targets`;
		base_duration = [
			{ name: 'read surface thoughts', duration: dur_short_rest_w_checks_2 },
			{ name:	'two-way connection',    duration: dur_concentration_w_pool  },
			{ name:	'send message',          duration: dur_instantaneous         }
		];
	}
	if (ep_cost == 20) {
		effect = 'True telepathy with one willing target'
		base_duration = dur_concentration_w_pool;
	}
	if (ep_cost == 30) {
		effect = `Read surface thoughts of many targets${_or}True telepathy with many willing targets${_or}True telepathy with one unwilling target`;
		base_duration = [
			{ name: 'read surface thoughts',                 duration: dur_short_rest_w_checks_2 },
			{ name:	'two-way connection or true telepathy',  duration: dur_concentration_w_pool  },
			{ name:	'unwilling telepathy',                   duration: dur_short_rest_w_checks_1 }
		];
	}

	cast_spell('neuromancy', 'telepathy', ep_cost, base_duration, false, effect);
}

function cast_dispel_magic(ep_cost) {
	let effect = 'Suppress magic item';
	let base_duration = [
		{ name: 'dispel',   duration: dur_instantaneous         },
		{ name: 'suppress', duration: dur_short_rest_w_checks_1 }
	];
	if (ep_cost == 20) {
		effect = 'Suppress eldritch item';
	}
	else if (ep_cost == 30) {
		effect = 'Suppress epic item';
	}
	else if (ep_cost == 40) {
		effect = `Suppress legendary item${_or}Disjoin item`;
		base_duration.push({ name: 'disjoin', duration: dur_instantaneous });
	}
		
	cast_spell('metamancy', 'dispel_magic', ep_cost, base_duration, false, `Dispel tier [[${(ep_cost / 10)}]] effect${_or}${effect}`);
}

function cast_inscribe_rune(rune_type, ep_cost) {
	let base_duration = null;
	let alt_effect = '';
	if (rune_type == 'charge') {
		base_duration = dur_short_rest_p_linger;
		alt_effect = '{{Max charges=[[@{metamancy_tier} * 5]]}} ';
	}
	else if (rune_type == 'duration') {
		base_duration = [{ duration: 'Bound spell duration + 2', custom: true }];
	}
	let max_tier = (ep_cost / 10);
	let effect_text = `{{Max tier of bound spell=[[${max_tier}]]}} ${alt_effect}`;

	cast_spell('metamancy', `inscribe_${rune_type}_rune`, ep_cost, base_duration, false, null, effect_text);
}

function cast_inscribe_charge_rune(ep_cost) {
	cast_inscribe_rune('charge', ep_cost);
}

function cast_inscribe_duration_rune(ep_cost) {
	cast_inscribe_rune('duration', ep_cost);
}

function cast_imbue(ep_cost) {
	cast_prowess_imbue(ep_cost, false);
}

const special_combat_actions_array = [
	'use_charge', 'use_fight_recklessly', 'use_rage', 'use_wild_rage', 'use_precise_strike', 'use_sneak_attack',
	'use_fight_defensively', 'use_defensive_stance', 'use_guard', 'use_protect'
];

on('sheet:opened', function() {
	getAttrs(['sheet_is_initialized', 'passive_skills', 'boons_and_banes', 'mob_skill_bonus'], function(values) {
		let initialized     = get_bool(values.sheet_is_initialized  );
		let mob_skill_bonus = get_int_or_zero(values.mob_skill_bonus);
		if (mob_skill_bonus == 0) {
			//console.log(`sheet:opened - mob_skill_bonus: ${mob_skill_bonus}`);
			setAttrs({ "mob_skill_bonus": mob_skill_bonus });
		}
		if (!initialized) {
			console.log('Initializing new character sheet');
			let set_object = { 'sheet_is_initialized': false, 'sheet_initialization_check_count': 0 };
			if (values.passive_skills.trim().length == 0) {
				console.log('No passive skills; setting all to false');
				passive_skill_array.forEach(function(ps) {
					set_object[ps.name] = false;
				});
			}
			if (values.boons_and_banes.trim().length == 0) {
				console.log('No boons or banes; setting all to false');
				boons_and_banes_array.forEach(function(bb) {
					if (bb.max_count > 1) {
						for (let i = 1; i <= bb.max_count; i++) {
							set_object[`${bb.name}_${i}`] = false;
						}
					}
					else {
						set_object[bb.name] = false;
					}
				});
			}
			console.log('Set all special combat actions to off');
			for (let action of special_combat_actions_array) {
				set_object[action] = '0';
			}
			setAttrs(set_object);
		}
	});
});

on('change:sheet_initialization_check_count', function() {
	let get_array = special_combat_actions_array;
	get_array.push('sheet_initialization_check_count');
	getAttrs(get_array, function(values) {
		console.log(`sheet_initialization_check_count changed to ${values.sheet_initialization_check_count}`);
		let set_object = { 'sheet_initialization_check_count': get_int_or_zero(values.sheet_initialization_check_count) + 1 };
		let all_special_combat_actions_off = true;
		for (let action of special_combat_actions_array) {
			all_special_combat_actions_off ||= (values[action] == '0');
		}
		if (all_special_combat_actions_off) {
			set_object = { 'sheet_is_initialized': true };
		}
		setAttrs(set_object);
	});
});

on('change:sheet_is_initialized', function() {
	getAttrs(['sheet_is_initialized'], function(values) {
		if (get_bool(values.sheet_is_initialized)) {
			console.log('Sheet has been initialized');
			let set_object = {
				'attack_advantage':     'Novantage',
				'defend_advantage':     'Novantage',
				'mr_advantage':         'Novantage'
			};
			setAttrs(set_object);
		}
	});
});

const rest_type_array = ['short', 'long'];
rest_type_array.forEach( function (rest_type) {
	on(`clicked:${rest_type}rest`, function() {
		getAttrs(["hit_points", "hit_points_max", "essence_points", "essence_points_max", "essence_points_in_use"], function(values) {
			let hp        = get_int_or_zero(values.hit_points);
			let hp_max    = get_int_or_zero(values.hit_points_max);
			let ep        = get_int_or_zero(values.essence_points);
			let ep_max    = get_int_or_zero(values.essence_points_max);
			let ep_in_use = get_int_or_zero(values.essence_points_in_use);
			
			let capitalized_type = capitalize_first_letter(rest_type);

			startRoll("@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: " + capitalized_type + " Rest}} {{HP=[[@{" + rest_type + "_rest_hp_roll}]]}} {{EP=[[@{" + rest_type + "_rest_ep_roll}]]}}'", (results) => {
				setAttrs({
					"hit_points": Math.min(hp + results.results.HP.result, hp_max),
					"essence_points": Math.min(ep + results.results.EP.result, (ep_max - ep_in_use))
				});
				finishRoll(results.rollId);
			});
		});
	});
});

on("clicked:recovery", function() {
	getAttrs(["recovery_successes", "recovery_failures", "ps_die_hard", "pr_tier"], function(values) {
		let successes = get_int_or_zero(values.recovery_successes);
		let failures  = get_int_or_zero(values.recovery_failures);
		let pr_tier   = get_int_or_zero(values.pr_tier);
		let diehard   = get_bool(values.ps_die_hard);
		let tn        = 12;
		let roll      = (diehard ? '3d10!!k2' : '2d10!!');

		startRoll("@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Recovery}} {{Recovery=[[" + roll + "]]}}'", (results) => {
			if (results.results.Recovery.result >= (tn + 10)) {
				successes += 2;
			}
			else if (results.results.Recovery.result >= tn) {
				successes++;
			}
			else if (results.results.Recovery.result > (tn - 10)) {
				failures++;
			}
			else {
				failures += 2;
			}

			finishRoll(results.rollId);

			console.log("recovery_successes: " + successes + ", recovery_failures:" + failures);
			
			setAttrs({
				"recovery_successes": successes,
				"recovery_failures": failures,
			});
		});
	});
});

on("clicked:resetrecovery", function() {

	setAttrs({
		"recovery_successes": 0,
		"recovery_failures": 0
	});

	console.log("recovery tally cleared");
});

const healing_potion_type_array = [
	{ type: 'magic',     roll: '@{short_rest_hp_roll}'                                                             },
	{ type: 'eldritch',  roll: 'floor( @{long_rest_hp_roll} / 2)', detoxify_ep: 10, detoxify_tn: 16, or_and: 'or'  },
	{ type: 'epic',      roll: '@{long_rest_hp_roll}',             detoxify_ep: 20, detoxify_tn: 22, or_and: 'or'  },
	{ type: 'legendary', roll: '@{long_rest_hp_roll}',             detoxify_ep: 30, detoxify_tn: 28, or_and: 'and' }
];
healing_potion_type_array.forEach( function (potion) {

	on(`clicked:${potion.type}healingpotion`, function() {

		let potion_count_name = potion.type + '_healing_potion_count';
		
		getAttrs(['hit_points', 'hit_points_max', potion_count_name], function(values) {
			let count  = get_int_or_zero(values[potion_count_name]);
			let hp     = get_int_or_zero(values.hit_points);
			let hp_max = get_int_or_zero(values.hit_points_max);
			
			let capitalized_type = capitalize_first_letter(potion.type);
			
			let effect = '';
			
			if (potion.detoxify_ep) {
				effect = ` {{desc=Also casts ${potion.detoxify_ep} EP *detoxify* (TN ${potion.detoxify_tn}) ${potion.or_and} *revivify*}}`;
			}

			if (count > 0) {
				startRoll("@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: " + capitalized_type + " Healing Potion}} {{HP=[[" + potion.roll + "]]}}" + effect + "'", (results) => {
					setAttrs({
						'hit_points': Math.min(hp + results.results.HP.result, hp_max),
						[potion.type + '_healing_potion_count']: (count - 1)
					});
					finishRoll(results.rollId);
				});
			}
			else {
				startRoll(`/w @{character_name} ***You have no ${potion.type} healing potions***`, (results) => {
					finishRoll(results.rollId);
				});
			}
		});
	});
});

on("clicked:minorauraofprotectioninfo", function() {
	let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Minor Aura of Protection}} {{Area Size=One adjacent creature}} " +
	"{{desc=You radiate a minor aura of protection. You and one adjacent creature of your choice gain advantage on all Defend, Mental Resilience, and Physical " +
	"Resilience checks. As soon as either you or the protected creature fails a Defend, Mental Resilience, or Physical Resilience check, the effect ends " +
	"until your next short rest.}}'";
	startRoll(roll_text, (results) => {
		finishRoll(results.rollId);
	});
});

on("clicked:majorauraofprotectioninfo", function() {
	getAttrs(["size_modifier_aura"], function(values) {
		let aura_area_size = 7 + get_int_or_zero(values.size_modifier_aura);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Major Aura of Protection}} {{Area Size=[[" + aura_area_size + 
		"]] **sq**}} {{desc=You radiate an aura of protection. You and any ally within the nova gain advantage on all Defend, Mental Resilience, and Physical " +
		"Resilience checks}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:blooddraininfo", function() {
	getAttrs(["attack_tier", "pr_tier"], function(values) {
		let attack_tier = get_int_or_zero(values.attack_tier);
		let pr_tier     = get_int_or_zero(values.pr_tier);
		
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Blood Drain}} " +
		"{{Damage=" + value_effect('tier in Attack plus your tier in Physical Resilience', attack_tier + pr_tier) + "**d6**}} " +
		"{{desc=The monster has the ability to drain blood from any creature it has in a hold once per round by spending 1 AP. Any creature damaged " +
		"by blood drain is **fatigued** until they heal at least one Hit Point. }}'";
		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:engulfinfo", function() {
	getAttrs(["pr_total"], function(values) {
		let pr_total = get_int_or_zero(values.pr_total);
		
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Engulf}} " +
		"{{Reflex=TN " + skill_total_effect_pr(pr_total, 12) + "}} " +
		"{{desc=The monster can spend 1 AP to move up to its speed into the spaces of one or more creatures (depending on its size) and engulf them completely. " +
		"Creatures can choose to either make a free Attack check on the creature before being engulfed, or make a Reflex check to avoid being engulfed. If " +
		"successful, creatures are moved out of the path of the monster (behind it or to the side, their choice)." + _rn + "Engulfed creatures are " +
		"considered to be in a grapple and a hold by the monster and begin to suffocate (the monster is not considered grappled). If the monster causes any " +
		"non-physical damage with its natural attacks from the Strong Natural Attack boon, engulfed creatures automatically suffer that damage each round. " +
		"In addition, any other relevant boon such as the Paralysis may apply (GMs discretion). Engulfed creatures can attempt to escape the hold and the " +
		"grapple to escape the monster." + _rn + "If the monster is bloodied, engulfed creatures are no longer considered in a hold, but are in danger " +
		"of being hurt by attacks against the monster. Damage from single target attacks against the monster are split evenly between the monster and one " +
		"randomly chosen engulfed creature. Area attacks damage the monster and all engulfed creatures. Each time the monster is damaged, there is a 10% chance " +
		"(a 10 on 1d10) that one engulfed creatures mouth or nose is unblocked and they can breathe again." +
		"}}'";
		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on('clicked:legendaryactioninfo', function() {
	getAttrs(['legendary_action'], function(values) {
		let custom_action = (values.legendary_action ? _bull + values.legendary_action : '');
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Legendary Monster}} " +
		"{{desc=The monster is a legendary creature, such as a dragon. Legendary monsters can have a maximum of 60 in each attribute. Legendary monsters gain advantage " +
		"on all Physical and Mental resilience checks." + _rn + "In addition, they can take legendary actions outside of their normal turn, which dont cost AP to " +
		"use. They can take up to three legendary actions per round, which happen after any other creatures turn. Only one legendary action may be taken at a time." +
		header_text('Legendary Actions', false) + _bull + 'Perception check to detect a creature' + _bull + 'Attack check' + custom_action + "}}'";
		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

const lycanthropy_type_array = [
	{ name: 'werebear',  curse_attack: 'bite', bb_list: [ 'Large Size', 'Natural Attack (bite)', 'Natural Attack (claw x2)', 'Free Grapple (claw x2)', 'NDR (physical) 30'], ps_list: [] },
	{ name: 'wereboar',  curse_attack: 'gore', bb_list: [ 'Ferocity', 'Natural Attack (gore)', 'NDR (physical) 24'], ps_list: [] },
	{ name: 'wererat',   curse_attack: 'bite', bb_list: [ 'Disease Attack (bite', 'tier 2', 'filth fever)', 'Natural Attack (bite)', 'NDR (physical) 24'], ps_list: [] },
	{ name: 'weretiger', curse_attack: 'bite', bb_list: [ 'Large Size', 'Natural Attack (bite)', 'Natural Attack (claw x2)', 'Free Grapple (bite)', 'Free Grapple (claw x2)', 'NDR (physical) 26', 'Rake'], ps_list: ['Pounce'] },
	{ name: 'werewolf',  curse_attack: 'bite', bb_list: [ 'Natural Attack (bite)', 'Free Knockdown (bite)', 'NDR (physical) 26'], ps_list: [] }
];

on('clicked:lycanthropyinfo', function() {
	getAttrs(['bb_lycanthropy_raw'], function(values) {
		let type = values.bb_lycanthropy_raw.split('lycanthropy')[1];
		let type_object = lycanthropy_type_array.find(t => t.name == type);
		let ps_text = '';
		if (type_object.ps_list.length > 0) {
			ps_text = _rn + 'The monster also gains the following passive skill(s): ' + _bull + type_object.ps_list.join(_bull);
		}
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Lycanthropy}} " +
		"{{desc=The monster carries the curse of lycanthropy, which is a magical disease that allows it to transform into a powerful animal hybrid form, but may not be " +
		"able to control its actions." + _rn + `All monsters with this boon gain the following boons and banes:${_bull} Ultravision${_bull} Scent${_bull} Material ` + 
		"Vulnerability (silver)" + _rn + `They also gain the following passive skills:${_bull} Rage${_bull} Wild Rage` + _rn + "In addition, monsters with lycanthropy " +
		"(called lycanthropes) can influence animals of their type with Persuade (diplomacy) as if it were Nature (handle animal). They also gain advantage on Persuade " +
		"(diplomacy) and Nature (handle animal) checks when dealing with animals of their type." + _rn + "Lycanthropes cannot choose to enter a normal rage - when they " +
		"rage it always must be a wild rage. When they wild rage, they transform into an animal hybrid form and gain a number of monstrous boons. This transformation takes " +
		"1 AP. This form maintains all of their equipment, even if their size changes." + _rn + `This monster is a ${type}, and gains the following additional boons:` + 
		_bull + type_object.bb_list.join(_bull) + ps_text + _rn + `In addition, the ${type}s ${type_object.curse_attack} attack can pass on the curse of lycanthropy if the ` +
		"target takes damage and fails a TN 18 Fortitude (constitution) check. The curse will only manifest on the night of the next full moon. Once a given " +
		"creature successfully resists the curse, the lycanthrope cannot attempt to pass the curse onto that same creature again until it takes a long rest." + _rn +
		"Every full moon, lycanthropes must attempt a 1-round Mental Resilience (willpower) test versus TN 36 or change to hybrid form and go on a rampage, attempting to " +
		"kill or destroy any creature or object in their path. During this rampage, the monster is not in control of its own actions and cannot even attempt Mental " +
		"Resilience checks to avoid attacking allies. A rampaging lycanthrope must continually wild rage." + " }}'";
		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:regenerateinfo", function() {
	getAttrs(["regenerate_healing", "regenerate_vulnerability"], function(values) {
		
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Regenerate}} {{Healing=**" + values.regenerate_healing + 
		"**}} {{Vulnerability=" + values.regenerate_vulnerability + "}} {{desc=Monsters with this boon heal rapidly, healing an amount of Hit Point " +
		"damage each round. They also recover their full maximum HP after any short or long rest. Monsters with this boon always have one or more " +
		"damage or material types theyre vulnerable to, which suppresses this ability for one round.}}'";

		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:rendinfo", function() {
	getAttrs(["attack_tier", "attack_attribute_modifier", "attack_attribute_name"], function(values) {
		let attack_tier = get_int_or_zero(values.attack_tier);
		let attack_mod  = get_int_or_zero(values.attack_attribute_modifier);
		
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Rend}} {{desc=When you use 1 AP to make two successful Attack " +
		"(dual wield melee) checks and both of them cause damage to the target, you cause " + tier_effect_attack(attack_tier, 1, 'd6') + 
		attribute_mod_effect(values.attack_attribute_name, attack_mod) + " additional damage to the target. This damage is considered part of the " +
		"base damage caused by your second attack (for the purpose of applying Damage Resistance).}}'";

		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});


on("clicked:shatterweaponsinfo", function() {
	let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Shatter Weapons}}" +
	"{{desc=Any time the monster is struck with a weapon, the weapon suffers damage as if successfully hit with the monsters primary attack. Creatures with the Brawl "+
	"passive skill that strike the monster suffer that damage themselves.}}'";
	
	startRoll(roll_text, (results) => {
		finishRoll(results.rollId);
	});
});

on("clicked:swallowwholeinfo", function() {
	getAttrs(["swallow_whole_damage", "swallow_whole_hp", "swallow_whole_tn"], function(values) {
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Swallow Whole}} {{Chemical damage=" + values.swallow_whole_damage + 
		"}} {{Cut out TN=" + values.swallow_whole_tn + "}} {{Cut out HP=" + values.swallow_whole_hp + "}}" +
		"{{desc=This boon only applies to monsters that have the Free Grapple boon with a bite attack. If the monster has a creature of a smaller size in a grapple with " +
		"its bite attack, it can spend 1 AP to make an Attack (grapple) check to swallow the creature whole. The creature immediately takes damage as if hit with the " +
		"monsters bite attack, and is still considered grappled (although the monster is not)." + _rn + "A swallowed creature takes " + values.swallow_whole_damage + 
		" chemical damage each round. They can attempt to escape the grapple, in which case they exit the monsters mouth, and the monster gets a free bite attack on them " +
		"as if they were fleeing combat." + _rn + "Alternatively, they can attempt to cut their way out of the monster with an appropriate weapon. They make an " +
		"Attack (any melee combat style) check against TN " + values.swallow_whole_tn + ". The monsters NDR  (physical) and DR (physical) do not apply to the damage " +
		"caused by this attack. If the swallowed creature causes " + values.swallow_whole_hp + " points of damage, they have cut their way out of the monster, and the " +
		"monster cannot use this boon again until the damage is healed.}}'";
		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:swarminfo", function() {
	getAttrs(["pr_tier", "pr_total"], function(values) {
		let pr_tier  = get_int_or_zero(values.pr_tier);
		let pr_total = get_int_or_zero(values.pr_total);
		
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Swarm}} {{Physical Resilience (constitution)=**TN** " + 
		skill_total_effect_pr(pr_total, 12) + "}} {{Effect=Sickened}} " +
		"{{desc=This is an entire swarm of hundreds or thousands of creatures that is considered a single monster." + _rn + "Swarms are immune to normal attacks - " +
		"weapon attacks, single target spells, and anything else the GM determines. However, they suffer disadvantage on checks against any area effect, and take 3 " +
		"damage against such effects, if applicable. When a swarm is reduced to zero HP, it disperses and is effectively dead, although there may be component " +
		"creatures left alive." + _rn + "A successful offensive Dynamancy (force effect) that covers the entire area of the swarm completely disperses it and " +
		"effectively kills it. However, the swarm will reform over the course of one round if it rolls less than or equal to " + tier_effect_pr(pr_tier, 1, '') + 
		" on 1d6. A swarm can only reform itself " + tier_effect_pr(pr_tier, 1, '') + " time(s)." + _rn + "Swarms can occupy spaces with other creatures with no penalty. " +
		"Each round, the swarm makes a single attack against all creatures with whom it shares a space, which is an Attack (two-handed melee) check that is " +
		"automatically successful (usually a bite or sting natural attack), and gains a +2d6 damage bonus." + _rn + "The first time each creature takes damage from " +
		"a swarm, they must make a Physical Resilience (constitution) check. If they fail, they are sickened until they no longer share a space with the swarm." +
		_rn + "**Sickened:** Disadvantage on all actions; if exposed to anything stomach-upsetting, 10% chance each round to become nauseated until your next " + 
		"short rest.}}'";
		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:tombrotinfo", function() {
	getAttrs(["mr_total"], function(values) {
		let mr_total = get_int_or_zero(values.mr_total);
		
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Tomb Rot}} " +
		"{{Physical Resilience (constitution)=TN " + skill_total_effect_mr(mr_total, 12) + "}} " +
		"{{desc=The monster causes the magical disease tomb rot with one of its natural attacks. It lasts until magically cured. A creature suffering from tomb rot " +
		"suffers the fatigued condition, does not heal HP or EP from a short rest, and on a long rest, only heals HP & EP as if it had taken a short rest. In addition, " +
		"the creature cannot benefit from magical healing." + _rn + "Each day the creature can make a Physical Resilience (constitution) check against the TN to " +
		"avoid only the fatigued condition.}}'";
		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:totalmagicimmunityinfo", function() {
	let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Total Magic Immunity}} " +
	"{{desc=The monster is completely immune to spells from every magic skill. It has no control over this ability, and can never be affected by magic. Monsters with " +
	"this boon almost always have some specific exceptions to it, which will be listed in the monsters description.}}'";
	
	startRoll(roll_text, (results) => {
		finishRoll(results.rollId);
	});
});

on("clicked:mobinfo", function() {
	getAttrs(["mob_member_count", "mob_skill_bonus", "mob_damage_bonus", "mob_hit_points_max"], function(values) {
		let count          = get_int_or_zero(values.mob_member_count);
		let skill_bonus    = get_int_or_zero(values.mob_skill_bonus);
		let damage_bonus   = get_int_or_zero(values.mob_damage_bonus);
		let hit_points_max = get_int_or_zero(values.mob_hit_points_max);

		let skill_text  = value_effect(` (mob member count - 1) * 2`, skill_bonus);
		let damage_text = value_effect(` mob member count / 2, rounded down`, damage_bonus);
		let hp_text     = value_effect(` mob member hit points added together`, hit_points_max);
		let desc = `This is a group of [[${count}]] creatures with the same exact statistics, including this passive skill. ` +
		`Mobs are treated as if they were a single creature in some respects. A mob has three Action Points to spend each round as a unit ` +
		`(individual creatures in the mob do not take separate actions). The mob gains a **+**${skill_text} bonus to all skill checks and a ` + 
		`**+**${damage_text}**d6** damage bonus, and has a Hit Point total of ${hp_text}.${_rn}Mobs suffer disadvantage versus area attacks, ` +
		`and if applicable, take double damage from such attacks. If a mob is bloodied, it suffers disadvantage on all skill checks.`;
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Mob}} " +
		"{{desc=" + desc + "}}'";
		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:endsummonally", function() {
	setAttrs({
		"show_summoned_ally": "false",
		"summon_ally_type": "",
		"summon_ally_physique": 0,
		"summon_ally_physique_modifier": 0,
		"summon_ally_hit_points": 0,
		"summon_ally_dr_physical": 0,
		"summon_ally_damage_dice": 0,
		"summon_ally_damage_modifier": 0,
		"summon_ally_carry": 0,
		"summon_ally_carry_max": 0
	});
});

on("change:conjuration_attribute_modifier change:conjuration_tier change:summon_ally_damage_dice_modifier change:summon_ally_damage_static_modifier", function() {
	getAttrs(["conjuration_attribute_modifier", "conjuration_tier", "summon_ally_damage_dice_modifier", "summon_ally_damage_static_modifier", "conjuration_summon_ally_ep_cost"], function(values) {
		let attribute_mod = get_int_or_zero(values.conjuration_attribute_modifier);
		let tier          = get_int_or_zero(values.conjuration_tier);
		let dice_mod      = get_int_or_zero(values.summon_ally_damage_dice_modifier);
		let static_mod    = get_int_or_zero(values.summon_ally_damage_static_modifier);
		let ep_cost       = get_int_or_zero(values.conjuration_summon_ally_ep_cost);

		let ally_damage = tier + (ep_cost == 20 ? 1 : (ep_cost == 30 ? 2 : 0));

		setAttrs({
			"summon_ally_damage_dice": ally_damage + dice_mod,
			"summon_ally_damage_modifier": attribute_mod + static_mod
		});
	});
});

on("change:gm_rolls", function() {
	getAttrs(["gm_rolls"], function(values) {
		let gm_rolls = values.gm_rolls;
		let gm_rolls_text = (gm_rolls == 'on' ? '/w gm ' : '');
		console.log("gm_rolls: " + gm_rolls + ", gm_rolls_text: " + gm_rolls_text);
		setAttrs({
			"gm_rolls_text": gm_rolls_text,
		});
	});
});

on("change:perception_total change:agility_modifier change:bb_quick_reflexes change:bb_slow_reflexes", function() {
	getAttrs(["perception_total", "agility_modifier", "bb_quick_reflexes", "bb_slow_reflexes"], function(values) {
		let total         = get_int_or_zero(values.perception_total);
		let mod           = get_int_or_zero(values.agility_modifier);
		let quick         = get_bool(values.bb_quick_reflexes);
		let slow          = get_bool(values.bb_slow_reflexes);
		let boon_bane_mod = (quick ? 2 : (slow ? -2 : 0));
		let reflex        = total + mod + boon_bane_mod;
		setAttrs({
			"reflex_total": reflex
		});
	});	
});

on('change:attack_tier change:ps_combat_expertise', function() {
	getAttrs(['attack_tier', 'ps_combat_expertise'], function(values) {
		let tier = get_int_or_zero(values.attack_tier);
		let has_combat_expertise = get_bool(values.ps_combat_expertise);

		setAttrs({ 'combat_expertise_modifier': (has_combat_expertise ? Math.floor(tier / 2) : 0) });
	});	
});

on('change:ps_deadly_precision change:perception_tier', function() {
	getAttrs(['ps_deadly_precision', 'perception_tier'], function(values) {
		let has_deadly_precision = get_bool(values.ps_deadly_precision);
		let perception_tier      = get_int_or_zero(values.perception_tier);

		setAttrs({ 'deadly_precision_modifier': (has_deadly_precision ? perception_tier : 0) });
	});
});

on('change:ps_sneak_attack change:sneak_tier', function() {
	getAttrs(['ps_sneak_attack', 'sneak_tier'], function(values) {
		let has_sneak_attack = get_bool(values.ps_sneak_attack);
		let sneak_tier       = get_int_or_zero(values.sneak_tier);

		setAttrs({ 'sneak_attack_modifier': (has_sneak_attack ? sneak_tier : 0) });
	});
});

on('change:ps_rage change:pr_tier', function() {
	getAttrs(['ps_rage', 'pr_tier'], function(values) {
		let has_rage = get_bool(values.ps_rage);
		let pr_tier  = get_int_or_zero(values.pr_tier);

		setAttrs({ 'rage_modifier': (has_rage ? pr_tier : 0) });
	});
});

const ps_damage_array = [
	{name: 'ps_deadly_aim'   , damage_name: 'deadly_aim_damage'   , display_name: 'two_handed_missile_modifier_display'},
	{name: 'ps_powerful_blow', damage_name: 'powerful_blow_damage', display_name: 'two_handed_melee_modifier_display'  }
];
ps_damage_array.forEach( function(ps) {
	on(`change:${ps.name} change:attack_attribute_modifier change:attack_damage_static_modifier`, function() {
		getAttrs([ps.name, 'attack_attribute_modifier', 'attack_damage_static_modifier'], function(values) {
			let has_ps    = get_bool(values[ps.name]);
			let damage    = get_int_or_zero(values.attack_attribute_modifier);
			let modifier  = get_int_or_zero(values.attack_damage_static_modifier);
			let ps_damage = (has_ps ? damage : 0);
			let display   = (damage + ps_damage + modifier);
			if (display >= 0) {
				display = '+' + display;
			}
			
			setAttrs({
				[ps.damage_name]:  ps_damage,
				[ps.display_name]: display
			});
		});
	});
});

on('change:ps_mob', function() {
	getAttrs(['ps_mob'], function(values) {
		if (values.ps_mob == '0') {
		
			console.log('Turn off Mob');
		
			setAttrs({ 'mob_member_count': 0 });
		}
	});
});

on('change:mob_member_count change:hit_points_max', function() {
	getAttrs(['mob_member_count', 'hit_points_max'], function(values) {
		let mob_count = get_int_or_zero(values.mob_member_count);
		let hp_max    = get_int_or_zero(values.hit_points_max);
		
		if (mob_count > 0) {
			mob_count = Math.max(4, Math.min(6, mob_count));
		}
		
		let mob_hp_max = hp_max * mob_count;

		console.log(`mob count: ${mob_count}; max hp: ${hp_max}; mob max hp: ${mob_hp_max}`);
		
		setAttrs({
			'mob_member_count':   mob_count,
			'mob_hit_points_max': mob_hp_max,
			'mob_hit_points':     mob_hp_max
		});
	});
});

on('change:mob_member_count', function() {
	getAttrs(['mob_member_count'], function(values) {
		let mob_count    = get_int_or_zero(values.mob_member_count);
		let skill_bonus  = (mob_count > 0 ? (mob_count - 1) * 2 : 0);
		let damage_bonus = Math.floor(mob_count / 2);

		console.log(`change:mob_member_count - mob_skill_bonus: ${skill_bonus}`);
		
		setAttrs({ 'mob_skill_bonus': skill_bonus, 'mob_damage_bonus': damage_bonus });
	});
});

function get_short_rest_roll(tier_primary, tier_secondary, attribute_mod, passive_skill) {
	let dice = tier_primary * (passive_skill ? 2 : 1) + tier_secondary;
	let roll = '{1d1, ' + dice + 'd6 + ' + attribute_mod + '}k1';
	
	return roll;
}

const vital_stats_array = [
	{
		name:                'hit_points',
		abbreviation:        'hp',
		primary: {           
			attribute:       'physique',
			skill:           'pr'
		},
		secondary: {         
			attribute:       'agility',
			skill:           'defend'
		},
		ps_stat:             'ps_stoic_defense',
		ps_short_rest:       'ps_vitality',
		modifier:            'size_modifier_hp',
		bane_ignore_primary: 'bb_no_metabolism'
	},
	{
		name:                'essence_points',
		abbreviation:        'ep',
		primary: {           
			attribute:       'wit',
			skill:           'mr'
		},
		secondary: {         
			attribute:       'intelligence',
			skill:           'arcana'
		},
		ps_stat:             'ps_intuitive_magic_versatility_arcana',
		ps_short_rest:       'ps_quintessence',
		modifier:            null,
		bane_ignore_primary: null
	}
];
vital_stats_array.forEach( function(stat) {
	// Event: any attribute or skill that would change the max value of a vital stat (i.e. hp or ep)
	// Update the maximum for that stat and the long rest roll; also update the current stat value for the difference
	let stat_max_name              = stat.name            + '_max';
	let primary_skill_total_name   = stat.primary.skill   + '_total';
	let primary_skill_tier_name    = stat.primary.skill   + '_tier';
	let secondary_skill_total_name = stat.secondary.skill + '_total';
	let secondary_skill_tier_name  = stat.secondary.skill + '_tier';
	let extra_stat_name            = stat.name            + '_extra';
	let getAttrs_array_stat        = [stat.name, stat_max_name, stat.primary.attribute, primary_skill_total_name, stat.secondary.attribute, secondary_skill_total_name, stat.ps_stat, extra_stat_name, stat.modifier, stat.bane_ignore_primary];
	let change_stat                = 'change:' + getAttrs_array_stat.join(' change:');
	getAttrs_array_stat.push(primary_skill_tier_name, secondary_skill_tier_name);
	
	on(change_stat, function() {
		getAttrs(getAttrs_array_stat, function(values) {
			let stat_current          = get_int_or_zero(values[stat.name]);
			let stat_max              = get_int_or_zero(values[stat_max_name]);
			let primary_attribute     = get_int_or_zero(values[stat.primary.attribute]);
			let secondary_attribute   = get_int_or_zero(values[stat.secondary.attribute]);
			let primary_skill_tier    = Math.max(get_int_or_zero(values[primary_skill_tier_name])||0, 0.5);
			let primary_skill_total   = get_int_or_zero(values[primary_skill_total_name]);
			let secondary_skill_tier  = Math.max(get_int_or_zero(values[secondary_skill_tier_name])||0, 0.5);
			let secondary_skill_total = get_int_or_zero(values[secondary_skill_total_name]);
			let has_passive_skill     = get_bool(values[stat.ps_stat]);
			let extra_stat            = get_int_or_zero(values[extra_stat_name]);
			let modifier              = get_int_or_zero(values[stat.modifier]);
			let bane_ignore_primary   = get_bool(values[stat.bane_ignore_primary]);
			
			if (bane_ignore_primary) {
				primary_attribute = 0;
			}
			
			secondary_attribute = (has_passive_skill ? primary_attribute : secondary_attribute);

			let stat_value = 
				(Math.floor(primary_attribute   * primary_skill_tier  ) + primary_skill_total  ) +
				(Math.floor(secondary_attribute * secondary_skill_tier) + secondary_skill_total) +
				extra_stat + modifier;
			
			setAttrs({
				[stat_max_name]:                         stat_value,
				[stat.name]:                             stat_current + (stat_value - stat_max),
				[`long_rest_${stat.abbreviation}_roll`]: stat_value
			});
		});
	});
	
	// Event: any attribute modifier or skill tier that would change a short rest roll
	// Update the short rest roll
	let primary_attribute_mod = stat.primary.attribute   + '_modifier';
	let getAttrs_array_rest   = [primary_attribute_mod, primary_skill_tier_name, secondary_skill_tier_name, stat.ps_short_rest];
	let change_rest           = 'change:' + getAttrs_array_rest.join(' change:');

	on(change_rest, function(values) {
		getAttrs(getAttrs_array_rest, function(values) {
			let attribute_mod        = get_int_or_zero(values[primary_attribute_mod]);
			let primary_skill_tier   = get_int_or_zero(values[primary_skill_tier_name]);
			let secondary_skill_tier = get_int_or_zero(values[secondary_skill_tier_name]);
			let has_passive_skill    = get_bool(values[stat.ps_short_rest]);
			let dice                 = primary_skill_tier * (has_passive_skill ? 2 : 1) + secondary_skill_tier;
			let roll                 = '{1d1, ' + dice + 'd6 + ' + attribute_mod + '}k1';
			
			//console.log(`short_rest_${stat.abbreviation}_roll = '${roll}'`);
			setAttrs({ [`short_rest_${stat.abbreviation}_roll`]: roll });
		});
	});
});

on('change:hit_points_extra change:essence_points_extra', function() {
	getAttrs(['hit_points_extra', 'essence_points_extra'], function(values) {
		let hp_extra = get_int_or_zero(values.hit_points_extra    );
		let ep_extra = get_int_or_zero(values.essence_points_extra);
		
		let cp_vital_stats = (hp_extra + ep_extra) / 2;
		console.log(`cp_vital_stats: ${cp_vital_stats}`);
		setAttrs({ 'cp_vital_stats': cp_vital_stats });
	});
});

let speed_get_array = [ 'agility_speed_modifier', 'size_modifier_speed', 'bb_fast_movement_speed', 'bb_slow_movement_speed', 'speed_temporary_modifier' ];
on('change:' + speed_get_array.join(' change:'), function() {
	getAttrs(speed_get_array, function(values) {
		let agi_mod  = get_int_or_zero(values.agility_speed_modifier);
		let size_mod = get_int_or_zero(values.size_modifier_speed);
		let bonus    = get_int_or_zero(values.bb_fast_movement_speed);
		let penalty  = get_int_or_zero(values.bb_slow_movement_speed);
		let temp     = get_int_or_zero(values.speed_temporary_modifier);
		
		let total = 4 + agi_mod + size_mod + bonus - penalty + temp;
		setAttrs({ 'speed_total': total });
	});
});

on("clicked:recoveryinfo", function() {
	let roll_text = "/w @{character_name} '&{template:custom} {{title=Death & Dying}} " +
	"{{desc=When knocked below 1 HP, you are placed at 0 HP and dying. While dying, you attempt a 1-round skill test against TN 12. The skill check is a " +
	"flat 2d10, exploding. " + _rn + "If you succeed the skill test, you are stable and unconscious, no longer dying, and will wake up after a short rest " +
	"(though you will not recover any HP or EP). If you fail the skill test, you die. If you critically succeed the skill test, you are " +
	"conscious, no longer dying, and placed at 1 HP." + 
	_rn + "An ally can also attempt a TN 16 First Aid (immediate) check to stabilize you, spend 2 AP to pour a healing " +
	"draft or potion down your throat, or heal you with magic. If you receive any healing at all, you are conscious and no longer dying. }}'";
	startRoll(roll_text, (results) => {
		finishRoll(results.rollId);
	});
});

on("clicked:perceptionnoticeinfo", function() {
	getAttrs(["perception_total"], function(values) {
		let total = get_int_or_zero(values.perception_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Perception (notice) info}} " +
		"{{Notice=TN per GM or Sneak (stealth) check}} " +
		"{{desc=You notice a hidden threat or something otherwise amiss. The GM might make this roll for you, but you might make it if youre looking " +
		"out for anything odd (e.g. listening at a door). The check is made reactively and is instantaneous (it costs no AP)." + _rn + "The " +
		"Target Number is determined by the situation, or if a person is hiding the TN is their Sneak (stealth) check." + _rn + "If the lighting " +
		"is dim or the area especially noisy, you suffer disadvantage on your Perception (notice) check. In addition, you suffer disadvantage if you are " +
		"more than 5 squares (20 feet) away from the threat or oddity you might notice. }}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:perceptionscaninfo", function() {
	getAttrs(["perception_total"], function(values) {
		let total = get_int_or_zero(values.perception_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Perception (scan) info}} " +
		"{{Scan=TN per GM or Sneak (stealth) check}} " +
		"{{desc=You actively scan an area, searching for something specific (triggers for traps or alarms, an item you think has been hidden, etc.). " +
		"You must be adjacent to (or in) the square that contains the item for which youre looking to find it. It takes 1 AP per square to scan in " +
		"such a way." + _rn + "The Target Number is determined by the situation, or if a person is hiding the TN is their Sneak (stealth) check." +
		"" + _rn + "If the lighting is dim or the area especially noisy, you suffer disadvantage on your Perception (scan) check. " +
		spend_pool_perception('search faster at a rate of 1 point per additional square searched in a round') + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:reflexinfo", function() {
	let roll_text = "/w @{character_name} '&{template:custom} {{title=Reflex info}} {{Reflex=TN per GM}} " +
	"{{desc=Reflex is your ability to be aware of and react to things that may otherwise catch you off guard. It determines who goes first in " +
	"combat and allows characters to avoid harmful traps and other hazards." + _rn + "Reflex is not actually an application of the " +
	"Perception skill. Instead, it is calculated as your Perception (notice) total plus your Agility modifier. }}'";
	startRoll(roll_text, (results) => {
		finishRoll(results.rollId);
	});
});

function turn_off_combat_actions_except(exception_array) {
	let set_object = {};
	for (let action of special_combat_actions_array.filter(a => !exception_array.includes(a))) {
		set_object[action] = '0';
	}
	return set_object;
}

on('change:use_charge', function() {
	getAttrs(['use_charge', 'attack_advantage', 'attack_advantage_index_modifier', 'defend_advantage', 'defend_advantage_index_modifier'], function(values) {
		let charge_on = (values.use_charge == 'on');
		console.log(`turn charge ${(charge_on ? 'on' : 'off')}`);
		let attack_object = apply_advantage(values.attack_advantage, get_int_or_zero(values.attack_advantage_index_modifier), !charge_on);
		let defend_object = apply_advantage(values.defend_advantage, get_int_or_zero(values.defend_advantage_index_modifier),  charge_on);
		let set_object = {
			'attack_advantage':                attack_object.advantage,
			'attack_advantage_index_modifier': attack_object.index_modifier,
			'defend_advantage':                defend_object.advantage,
			'defend_advantage_index_modifier': defend_object.index_modifier,
		};
		if (charge_on) {
			set_object = {...set_object, ...turn_off_combat_actions_except(['use_charge'])};
		}
		setAttrs(set_object);
	});
});

on('change:use_fight_recklessly', function() {
	getAttrs(['use_fight_recklessly', 'use_rage', 'attack_advantage', 'attack_advantage_index_modifier', 'defend_advantage', 'defend_advantage_index_modifier'], function(values) {
		let fight_recklessly_on = (values.use_fight_recklessly == 'on');
		console.log(`turn fight recklessly ${(fight_recklessly_on ? 'on' : 'off')}`);
		let attack_object = apply_advantage(values.attack_advantage, get_int_or_zero(values.attack_advantage_index_modifier), !fight_recklessly_on);
		let defend_object = apply_advantage(values.defend_advantage, get_int_or_zero(values.defend_advantage_index_modifier),  fight_recklessly_on);
		let set_object = {
			'use_rage':                        (fight_recklessly_on ? values.use_rage : '0' ),
			'attack_advantage':                attack_object.advantage,
			'attack_advantage_index_modifier': attack_object.index_modifier,
			'defend_advantage':                defend_object.advantage,
			'defend_advantage_index_modifier': defend_object.index_modifier
		};
		if (fight_recklessly_on) {
			set_object = {...set_object, ...turn_off_combat_actions_except(['use_fight_recklessly', 'use_rage', 'use_wild_rage'])};
		}
		setAttrs(set_object);
	});
});

on('change:use_rage', function() {
	getAttrs(['use_rage', 'use_wild_rage', 'mr_advantage', 'mr_advantage_index_modifier'], function(values) {
		let rage_on = (values.use_rage == 'on');
		console.log(`turn rage ${(rage_on ? 'on' : 'off')}`);
		let mr_object = apply_advantage(values.mr_advantage, get_int_or_zero(values.mr_advantage_index_modifier), !rage_on);
		let set_object = {
			'use_fight_recklessly':        values.use_rage,
			'use_wild_rage':               (rage_on ? values.use_wild_rage : '0'),
			'mr_advantage':                mr_object.advantage,
			'mr_advantage_index_modifier': mr_object.index_modifier
		};
		setAttrs(set_object);
	});
});

on('change:use_wild_rage', function() {
	getAttrs(['use_rage', 'use_wild_rage'], function(values) {
		let wild_rage_on = (values.use_wild_rage == 'on');
		console.log(`turn wild rage ${(wild_rage_on ? 'on' : 'off')}`);
		let set_object = { 'use_rage': (wild_rage_on ? 'on' : values.use_rage) };
		setAttrs(set_object);
	});
});

on('change:use_precise_strike', function() {
	getAttrs(['use_precise_strike', 'use_sneak_attack', 'attack_advantage', 'attack_advantage_index_modifier'], function(values) {
		let precise_strike_on = (values.use_precise_strike == 'on');
		console.log(`turn precise strike ${(precise_strike_on ? 'on' : 'off')}`);
		let attack_object = apply_advantage(values.attack_advantage, get_int_or_zero(values.attack_advantage_index_modifier), precise_strike_on);
		let set_object = {
			'use_sneak_attack':                (precise_strike_on ? values.use_sneak_attack : '0'),
			'attack_advantage':                attack_object.advantage,
			'attack_advantage_index_modifier': attack_object.index_modifier
		};
		if (precise_strike_on) {
			set_object = {...set_object, ...turn_off_combat_actions_except(['use_precise_strike', 'use_sneak_attack'])};
		}
		setAttrs(set_object);
	});
});

on('change:use_sneak_attack', function() {
	getAttrs(['use_sneak_attack', 'use_precise_strike'], function(values) {
		let sneak_attack_on = (values.use_sneak_attack == 'on');
		console.log(`turn sneak attack ${(sneak_attack_on ? 'on' : 'off')}`);
		let set_object = { 'use_precise_strike': (sneak_attack_on ? 'on' : values.use_precise_strike) };
		setAttrs(set_object);
	});
});

on('change:use_fight_defensively', function() {
	getAttrs(['use_fight_defensively', 'use_guard', 'guard_just_turned_on', 'ps_defensive_stance', 'use_defensive_stance', 'attack_advantage', 'attack_advantage_index_modifier', 'defend_advantage', 'defend_advantage_index_modifier'], function(values) {
		let fight_defensively_on = (values.use_fight_defensively == 'on');
		let guard_on             = (values.use_guard == 'on');
		console.log(`turn fight defensively ${(fight_defensively_on ? 'on' : 'off')}`);
		let attack_object = apply_advantage(values.attack_advantage, get_int_or_zero(values.attack_advantage_index_modifier),  fight_defensively_on);
		let defend_object = apply_advantage(values.defend_advantage, get_int_or_zero(values.defend_advantage_index_modifier), !fight_defensively_on);
		let set_object = {
			'fight_defensively_just_turned_on': fight_defensively_on,
			'attack_advantage':                 attack_object.advantage,
			'attack_advantage_index_modifier':  attack_object.index_modifier,
			'defend_advantage':                 defend_object.advantage,
			'defend_advantage_index_modifier':  defend_object.index_modifier
		};
		if (get_bool(values.guard_just_turned_on)) {
			set_object = {...set_object, ...{ 'guard_just_turned_on': false }};
		}
		else {
			set_object = {...set_object, ...{
				'use_defensive_stance':  (fight_defensively_on ? values.use_defensive_stance : '0'),
				'show_defensive_stance': fight_defensively_on && get_bool(values.ps_defensive_stance)
			}};
		}
		if (fight_defensively_on) {
			let exception_array = ['use_fight_defensively'];
			if (guard_on) {
				exception_array.push('use_defensive_stance');
			}
			set_object = {...set_object, ...turn_off_combat_actions_except(exception_array)};
		}
		console.log(set_object);
		setAttrs(set_object);
	});
});

on('change:use_guard', function() {
	getAttrs(['use_fight_defensively', 'use_guard', 'fight_defensively_just_turned_on', 'ps_defensive_stance', 'use_defensive_stance', 'defend_advantage', 'defend_advantage_index_modifier'], function(values) {
		let fight_defensively_on = (values.use_fight_defensively == 'on');
		let guard_on             = (values.use_guard == 'on');
		console.log(`turn guard ${(guard_on ? 'on' : 'off')}`);
		let defend_object = apply_advantage(values.defend_advantage, get_int_or_zero(values.defend_advantage_index_modifier), !guard_on);
		defend_object     = apply_advantage(defend_object.advantage, defend_object.index_modifier, !guard_on);
		let set_object = {
			'guard_just_turned_on':            guard_on,
			'defend_advantage':                defend_object.advantage,
			'defend_advantage_index_modifier': defend_object.index_modifier
		};
		if (get_bool(values.fight_defensively_just_turned_on)) {
			set_object = {...set_object, ...{ 'fight_defensively_just_turned_on': false }};
		}
		else {
			set_object = {...set_object, ...{
				'use_defensive_stance':  (guard_on ? values.use_defensive_stance : '0'),
				'show_defensive_stance': guard_on && get_bool(values.ps_defensive_stance)
			}};
		}
		if (guard_on) {
			let exception_array = ['use_guard'];
			if (fight_defensively_on) {
				exception_array.push('use_defensive_stance');
			}
			set_object = {...set_object, ...turn_off_combat_actions_except(exception_array)};
		}
		console.log(set_object);
		setAttrs(set_object);
	});
});

on('change:use_defensive_stance', function() {
	getAttrs(['use_defensive_stance', 'defend_tier'], function(values) {
		let defensive_stance_on = (values.use_defensive_stance == 'on');
		console.log(`turn defensive stance ${(defensive_stance_on ? 'on' : 'off')}`);
		let physical_dr_bonus   = get_int_or_zero(values.defend_tier) * (defensive_stance_on ? 4 : 0);
		let set_object = { 'defensive_stance_dr_bonus': physical_dr_bonus };
		setAttrs(set_object);
	});
});

on('change:use_protect', function() {
	getAttrs(['use_protect', 'defend_advantage', 'defend_advantage_index_modifier'], function(values) {
		let protect_on = (values.use_protect == 'on');
		console.log(`turn protect ${(protect_on ? 'on' : 'off')}`);
		let defend_object = apply_advantage(values.defend_advantage, get_int_or_zero(values.defend_advantage_index_modifier), protect_on);
		let set_object = {
			'defend_advantage':                defend_object.advantage,
			'defend_advantage_index_modifier': defend_object.index_modifier
		};
		if (protect_on) {
			set_object = {...set_object, ...turn_off_combat_actions_except(['use_protect'])};
		}
		setAttrs(set_object);
	});
});

const natural_magic_spells_by_ep_10 = [
	{ ep_cost:  0, tier: 1, ps: null       },
	{ ep_cost:  5, tier: 1, ps: null       },
	{ ep_cost: 10, tier: 1, ps: null       },
	{ ep_cost: 15, tier: 2, ps: 'improved' },
	{ ep_cost: 20, tier: 2, ps: 'improved' },
	{ ep_cost: 30, tier: 3, ps: 'greater'  },
	{ ep_cost: 40, tier: 4, ps: 'epic'     },
];

const natural_magic_spells_by_ep_15 = [
	{ ep_cost: 15, tier: 1, ps: null       },
	{ ep_cost: 30, tier: 2, ps: 'improved' },
	{ ep_cost: 45, tier: 3, ps: 'greater'  },
	{ ep_cost: 60, tier: 4, ps: 'epic'     }
];

const active_skill_array = [
	{
		name: 'attack',
		combat_score: true,
		applications: [
			{ name: 'dw_melee',            count: 6, friendly_name: 'dual wield melee',    damage_bonus: function(tier) { return 0; }                                    , extra_damage: null },
			{ name: 'dw_missile',          count: 4, friendly_name: 'dual wield missile',  damage_bonus: function(tier) { return 0; }                                    , extra_damage: null },
			{ name: 'free_hand_melee',     count: 2, friendly_name: 'free hand melee',     damage_bonus: function(tier) { return 0; }                                    , extra_damage: null },
			{ name: 'free_hand_missile',   count: 2, friendly_name: 'free hand missile',   damage_bonus: function(tier) { return 0; }                                    , extra_damage: null },
			{ name: 'melee_with_shield',   count: 2, friendly_name: 'melee with shield',   damage_bonus: function(tier) { return 0; }                                    , extra_damage: null },
			{ name: 'missile_with_shield', count: 2, friendly_name: 'missile with shield', damage_bonus: function(tier) { return 0; }                                    , extra_damage: null },
			{ name: 'two_handed_melee',    count: 2, friendly_name: 'two-handed melee',    damage_bonus: function(tier) { return (tier >= 3 ? 2 : (tier >= 1 ? 1 : 0)); }, extra_damage: 'powerful_blow_damage' },
			{ name: 'two_handed_missile',  count: 2, friendly_name: 'two-handed missile',  damage_bonus: function(tier) { return (tier >= 3 ? 1 : 0); }                  , extra_damage: 'deadly_aim_damage'    },
			{ name: 'grapple',             count: 0 },
			{ name: 'reposition',          count: 0 },
			{ name: 'tactical_combat',     count: 0 }
 		],
		attribute: 'physique',
		alternate_attribute: 'agility',
		passive_skill: 'ps_dexterous_strike',
		size_modifier_multiplier: 1,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'perception',
		combat_score: false,
		applications: [ { name: 'notice' }, { name: 'scan' } ],
		attribute: 'wit',
		alternate_attribute: null,
		passive_skill: null,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'defend',
		combat_score: true,
		applications: [ { name: 'block' }, { name: 'dodge' } ],
		attribute: 'agility',
		alternate_attribute: 'physique',
		passive_skill: 'ps_stoic_defense',
		size_modifier_multiplier: 1,
		apply_no_metabolism_bane: false,
		affects_hp: true,
		affects_ep: false
	},
	{
		name: 'pr',
		combat_score: true,
		applications: [ { name: 'constitution' }, { name: 'fortitude' } ],
		attribute: 'physique',
		alternate_attribute: null,
		passive_skill: null,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: true,
		affects_hp: true,
		affects_ep: false
	},
	{
		name: 'mr',
		combat_score: true,
		applications: [ { name: 'concentration' }, { name: 'willpower' } ],
		attribute: 'wit',
		alternate_attribute: null,
		passive_skill: null,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: true
	},
	{
		name: 'athletics',
		combat_score: false,
		applications: [ { name: 'climb' }, { name: 'elusive_movement' }, { name: 'feat' }, { name: 'gymnastics' }, { name: 'jump' }, { name: 'swim' } ],
		attribute: 'physique',
		alternate_attribute: 'agility',
		passive_skill: 'ps_dexterous_athletics',
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'medicine',
		combat_score: false,
		applications: [ { name: 'diagnose' }, { name: 'first_aid' }, { name: 'long_term_care' } ],
		attribute: 'intelligence',
		alternate_attribute: null,
		passive_skill: null,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'nature',
		combat_score: false,
		applications: [ { name: 'handle_animal' }, { name: 'sustain' }, { name: 'track' } ],
		attribute: 'wit',
		alternate_attribute: null,
		passive_skill: null,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'persuade',
		combat_score: false,
		applications: [ { name: 'bluff' }, { name: 'diplomacy' }, { name: 'intimidate' }, { name: 'intuition' } ],
		attribute: 'wit',
		alternate_attribute: null,
		passive_skill: null,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'security',
		combat_score: false,
		applications: [ { name: 'disable_device' }, { name: 'pick_locks' } ],
		attribute: 'agility',
		alternate_attribute: null,
		passive_skill: null,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'sneak',
		combat_score: false,
		applications: [ { name: 'escapology' }, { name: 'sleight_of_hand' }, { name: 'stealth' } ],
		attribute: 'agility',
		alternate_attribute: null,
		passive_skill: null,
		size_modifier_multiplier: 4,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	// Magic Skills
	{
		name: 'arcana',
		combat_score: false,
		applications: [ { name: 'arcana' } ],
		attribute: 'intelligence',
		alternate_attribute: 'wit',
		passive_skill: 'ps_intuitive_magic_versatility_arcana',
		natural: false,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: true
	},
	{
		name: 'alteration',
		combat_score: true,
		applications: [
			{
				name: 'adopt_aspect', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] }
				] 
			}, 
			{
				name: 'alter_armor', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'alter_weapon', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'change_size', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'illuminate', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'indurate', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [15] },
					{ tier: 2, ep_costs: [30] },
					{ tier: 3, ep_costs: [45] }
				] 
			}
		],
		attribute: 'intelligence',
		alternate_attribute: 'wit',
		passive_skill: 'ps_intuitive_magic_versatility_alteration',
		natural: true,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'biomancy',
		combat_score: true,
		applications: [
			{
				name: 'detoxify', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] },
					{ tier: 4, ep_costs:    [40] }
				] 
			}, 
			{
				name: 'heal_damage', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] },
					{ tier: 4, ep_costs:    [40] }
				] 
			}, 
			{
				name: 'regenerate', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs:  [30] },
					{ tier: 2, ep_costs:  [60] },
					{ tier: 3, ep_costs:  [90] },
					{ tier: 4, ep_costs: [120] }
				] 
			}, 
			{
				name: 'revivify', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'sustain', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] }
				] 
			}, 
			{
				name: 'turn_undead', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 3, ep_costs: [30] }
				] 
			}
		],
		attribute: 'wit',
		alternate_attribute: 'intelligence',
		passive_skill: 'ps_academic_magic_versatility_biomancy',
		natural: false,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'conjuration',
		combat_score: true,
		applications: [
			{
				name: 'armor', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] },
					{ tier: 4, ep_costs:    [40] }
				] 
			}, 
			{
				name: 'barrier', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [15] },
					{ tier: 2, ep_costs: [30] },
					{ tier: 3, ep_costs: [45] },
					{ tier: 4, ep_costs: [60] }
				] 
			}, 
			{
				name: 'difficult_terrain', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] },
					{ tier: 4, ep_costs:    [40] }
				] 
			}, 
			{
				name: 'fabricate', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] },
					{ tier: 4, ep_costs:    [40] }
				] 
			}, 
			{
				name: 'shelter', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'shield', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [15] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'summon_ally', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}
		],
		attribute: 'intelligence',
		alternate_attribute: 'wit',
		passive_skill: 'ps_intuitive_magic_versatility_conjuration',
		natural: true,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'displacement',
		combat_score: false,
		applications: [
			{
				name: 'bind', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			},
			{
				name: 'chronofield', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'levitate', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'stasis', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'telekinesis', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'teleport', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}
		],
		attribute: 'intelligence',
		alternate_attribute: 'wit',
		passive_skill: 'ps_intuitive_magic_versatility_displacement',
		natural: true,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'divination',
		combat_score: false,
		applications: [
			{
				name: 'analyze', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'comprehend', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] }
				] 
			}, 
			{
				name: 'detect', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] }
				] 
			}, 
			{
				name: 'prowess', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'scry', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'status', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] }
				] 
			}
		],
		attribute: 'wit',
		alternate_attribute: 'intelligence',
		passive_skill: 'ps_academic_magic_versatility_divination',
		natural: true,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'dynamancy',
		combat_score: true,
		applications: [
			{
				name: 'attack', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [0, 5, 10] },
					{ tier: 2, ep_costs:       [20] },
					{ tier: 3, ep_costs:       [30] },
					{ tier: 4, ep_costs:       [40] }
				] 
			}, 
			{
				name: 'duration_attack', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'force_effect', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [15] },
					{ tier: 2, ep_costs: [30] }
				] 
			}
		],
		attribute: 'intelligence',
		alternate_attribute: 'wit',
		passive_skill: 'ps_intuitive_magic_versatility_dynamancy',
		natural: true,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'illusion',
		combat_score: false,
		applications: [
			{
				name: 'disguise', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] },
					{ tier: 4, ep_costs:    [40] }
				] 
			}, 
			{
				name: 'hologram', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] },
					{ tier: 4, ep_costs:    [40] }
				] 
			}, 
			{
				name: 'mirror_image', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'obscure', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}
		],
		attribute: 'wit',
		alternate_attribute: 'intelligence',
		passive_skill: 'ps_academic_magic_versatility_illusion',
		natural: true,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'necromancy',
		combat_score: true,
		applications: [
			{
				name: 'control_undead', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [20] },
					{ tier: 2, ep_costs: [40] }
				] 
			}, 
			{
				name: 'create_undead', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [20] },
					{ tier: 2, ep_costs: [40] },
					{ tier: 3, ep_costs: [60] },
					{ tier: 4, ep_costs: [80] }
				] 
			}, 
			{
				name: 'decrepify', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'shape_corpse', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] },
					{ tier: 4, ep_costs:    [40] }
				] 
			}
		],
		attribute: 'intelligence',
		alternate_attribute: 'wit',
		passive_skill: 'ps_intuitive_magic_versatility_necromancy',
		natural: false,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'neuromancy',
		combat_score: false,
		applications: [
			{
				name: 'charm', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'fear', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'influence', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'sleep', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 3, ep_costs: [30] }
				] 
			}, 
			{
				name: 'telepathy', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [5, 10] },
					{ tier: 2, ep_costs:    [20] },
					{ tier: 3, ep_costs:    [30] }
				] 
			}
		],
		attribute: 'wit',
		alternate_attribute: 'intelligence',
		passive_skill: 'ps_academic_magic_versatility_neuromancy',
		natural: true,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	},
	{
		name: 'metamancy',
		combat_score: false,
		applications: [
			{
				name: 'dispel_magic', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'imbue', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [20] },
					{ tier: 2, ep_costs: [40] },
					{ tier: 3, ep_costs: [60] },
					{ tier: 4, ep_costs: [80] }
				] 
			}, 
			{
				name: 'inscribe_charge_rune', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}, 
			{
				name: 'inscribe_duration_rune', 
				tier_ep_costs: [ 
					{ tier: 1, ep_costs: [10] },
					{ tier: 2, ep_costs: [20] },
					{ tier: 3, ep_costs: [30] },
					{ tier: 4, ep_costs: [40] }
				] 
			}
		],
		attribute: 'intelligence',
		alternate_attribute: 'wit',
		passive_skill: 'ps_intuitive_magic_versatility_metamancy',
		natural: false,
		size_modifier_multiplier: 0,
		apply_no_metabolism_bane: false,
		affects_hp: false,
		affects_ep: false
	}
];
active_skill_array.forEach( function(skill) {

	// Event: change skill points, extra pool points, attribute; also passive skill and modifier (if applicable)
	// Sets the skill total, attribute modifier, tier, and pool total
	let skill_points_name = `${skill.name}_points`;
	let skill_extra_pool_name = `${skill.name}_pool_extra`;
	let attribute_mod_name = `${skill.attribute}_modifier`;
	let getAttrs_array = [skill_points_name, skill_extra_pool_name, attribute_mod_name];
	let is_versatile = (skill.alternate_attribute && skill.passive_skill);
	let is_magic = (is_versatile && skill.passive_skill.includes('magic'));
	let apply_size_modifier = (skill.size_modifier_multiplier > 0);
	let apply_no_metabolism_bane = (skill.apply_no_metabolism_bane && skill.attribute == 'physique');
	let alternate_attribute_mod_name = '';
	let cp_points = `cp_${skill.name}_points`;
	let cp_apps   = `cp_${skill.name}_applications`;
	let cp_pool   = `cp_${skill.name}_pool`
	if (is_versatile) {
		alternate_attribute_mod_name = `${skill.alternate_attribute}_modifier`;
		getAttrs_array.push(alternate_attribute_mod_name, skill.passive_skill);
	}
	if (apply_size_modifier) {
		getAttrs_array.push('size_modifier_skill');
	}
	if (apply_no_metabolism_bane) {
		getAttrs_array.push('bb_no_metabolism');
	}
	let change = 'change:' + getAttrs_array.join(' change:');
	
	on(change, function() {
		getAttrs(getAttrs_array, function(values) {
			let skill_points   = get_int_or_zero(values[skill_points_name]);
			let attribute_name = skill.attribute;
			let attribute_mod  = get_int_or_zero(values[attribute_mod_name]);
			if (is_versatile) {
				let has_passive_skill = get_bool(values[skill.passive_skill]);
				if (has_passive_skill) { 
					attribute_name = skill.alternate_attribute;
					attribute_mod  = get_int_or_zero(values[alternate_attribute_mod_name]);
				}
			}
			if (apply_no_metabolism_bane) {
				let has_no_metabolism_bane = get_bool(values.bb_no_metabolism);
				if (has_no_metabolism_bane) {
					attribute_mod = 0;
				}
			}
			let pool_extra = get_int_or_zero(values[skill_extra_pool_name]);
			let total      = skill_points + attribute_mod;
			if (apply_size_modifier) {
				let size_modifier_skill = get_int_or_zero(values.size_modifier_skill);
				total += (size_modifier_skill * skill.size_modifier_multiplier);
			}
			let tier = get_tier(skill_points);
			let pool = tier + pool_extra;
			
			setAttrs({
				[`${skill.name}_attribute_name`]:     capitalize_first_letter(attribute_name),
				[`${skill.name}_attribute_modifier`]: attribute_mod,
				[`${skill.name}_total`]:              total,
				[`${skill.name}_tier`]:               tier,
				[`${skill.name}_pool_total`]:         pool,
				[cp_points]:                          cp_calc_skill_points(skill_points),
				[cp_pool]:                            cp_calc_skill_pool(pool_extra)
			});
		});
	});
		
	let advantage_name = `${skill.name}_advantage`;
	let explode_name   = `${skill.name}_explode`;
	
	// Event: change advantage level of skill
	// Sets advantage text to show up in the roll template
	on(`change:${advantage_name}`, function() {
		getAttrs([advantage_name], function(values) {
			setAttrs({
				[`${advantage_name}_text`]: values[advantage_name].replace('tA', 't A').replace('tD', 't D').replace('Novantage', '')
			});
		});
	});
	
	// Events (magic skills only): toggle spell button clicked
	// Shows or hides untrained spells (skill applications)
	if (is_magic && skill.name != 'arcana') {
		let getAttrs_array_training = [];
		let getAttrs_array_show     = [];
		skill.applications.forEach( function(spell) {
			getAttrs_array_training.push(`${skill.name}_${spell.name}_training`);
			getAttrs_array_show.push(`show_${skill.name}_${spell.name}`);
		});

		on(`clicked:toggle${skill.name}spells`, function() {
			getAttrs(getAttrs_array_training.concat(getAttrs_array_show), function(values) {

				let any_hidden = false;
				getAttrs_array_show.forEach( function(show) {
					any_hidden = any_hidden ||= !values[show];
				});

				for (let i = 0; i < getAttrs_array_show.length; i++) {
					setAttrs({
						[getAttrs_array_show[i]]: (any_hidden ? true : values[getAttrs_array_training[i]] == 'on'),
					});
				}
			});
		});
	}
	
	skill.applications.forEach( function(application) {
		// Events: advantage level, explode value, or training of skill applications
		// Sets the roll for each skill application
		let training = `${skill.name}_${application.name}_training`;
		let roll     = `${skill.name}_${application.name}_roll`;
		
		on(`change:${advantage_name} change:${explode_name} change:${training}`, function() {
			getAttrs([advantage_name, explode_name, training], function(values) {
				setAttrs({ [roll]:  get_roll(values[training], values[advantage_name], values[explode_name]) });
				if (application.name == 'summon_ally') {
					setAttrs({ 'summon_ally_untrained_dice': get_roll('0', values[advantage_name], values[explode_name]) });
				}
			});
		});

		if (is_magic && skill.name != 'arcana') {
			let tier_name                = `${skill.name}_tier`;
			let natural_boon_name        = `bb_natural_magic_${skill.name}`;
			let natural_ps_improved_name = `ps_improved_natural_magic_${skill.name}`;
			let natural_ps_greater_name  = `ps_greater_natural_magic_${skill.name}`;
			let natural_ps_epic_name     = `ps_epic_natural_magic_${skill.name}`;
			let getAttrs_array_spell     = [tier_name, training, natural_boon_name, natural_ps_improved_name, natural_ps_greater_name, natural_ps_epic_name];
			let change_spell             = 'change:' + getAttrs_array_spell.join(' change:');

			// Events (magic skills only): skill tier changes
			// Sets the recharge roll if they have the natural magic boon for this skill
			on(`change:${tier_name} change:${natural_boon_name} change:bb_inner_magic change:use_beam change:${advantage_name}`, function() {
				getAttrs([natural_boon_name, tier_name, advantage_name, 'bb_inner_magic', 'use_beam'], function(values) {
					let tier              = get_int_or_zero(values[tier_name]);
					let recharge_roll     = '';
					let modify_recharge   = (get_bool(values.bb_inner_magic) || values.use_beam == 'on');

					if (get_bool(values[natural_boon_name])) {
						let base_roll = '1d6';
						if ( modify_recharge && values[advantage_name] != 'GreatDisadvantage') {
							base_roll = '2d6kl1';
						}
						if (!modify_recharge && values[advantage_name] == 'GreatDisadvantage') {
							base_roll = '2d6k1';
						}
						recharge_roll = `${base_roll}cs<${tier}cf>${(tier + 1)}`;
					}
					
					console.log(`inner_magic: ${get_bool(values.bb_inner_magic)}, advantage_name: ${values[advantage_name]}`);
					console.log(`${natural_boon_name}: set recharge roll to ${recharge_roll}`);

					setAttrs({ [`natural_magic_${skill.name}_recharge_roll`]: recharge_roll });
				});	
			});

			// Events (magic skills only): skill tier or training of skill applications
			// Sets the show/hide for each EP version of a spell
			on(change_spell, function() {
				getAttrs(getAttrs_array_spell, function(values) {
					let tier             = get_int_or_zero(values[tier_name]);
					let has_training     = (values[training] == 'on');
					let has_natural_boon = get_bool(values[natural_boon_name]);
//					console.log(`has ${natural_boon_name}: ${has_natural_boon}`);

					if (has_natural_boon) {
						let all_ep_costs = [];
						application.tier_ep_costs.forEach( function(tier_ep_cost) {
							all_ep_costs = all_ep_costs.concat(tier_ep_cost.ep_costs);
						});
//						console.log(`all_ep_costs: ${all_ep_costs}`);
						let spells_by_ep = (all_ep_costs[0] == 15 ? natural_magic_spells_by_ep_15 : natural_magic_spells_by_ep_10);
						spells_by_ep.forEach( function(spell) {
							if (all_ep_costs.includes(spell.ep_cost)) {
								let show_spell = 
								(
									has_training && 
									tier >= spell.tier && 
									(spell.ps === null || (get_bool(values[`ps_${spell.ps}_natural_magic_${skill.name}`])))
								);
//								let ps_nat_name = `ps_${spell.ps}_natural_magic_${skill.name}`;
//								let log_msg = `has_training: ${has_training}; tier: ${tier}; `;
//								if (spell.ps === null) { log_msg += 'tier 1, no ps needed'; }
//								else { log_msg += `${ps_nat_name}: ${values[ps_nat_name]}`; }
//								console.log(log_msg);
//								console.log(`show_${skill.name}_${application.name}_${spell.ep_cost}_ep: ${show_spell}`)
								setAttrs({ [`show_${skill.name}_${application.name}_${spell.ep_cost}_ep`]: show_spell });
							}
						});
					}
					else {
						application.tier_ep_costs.forEach( function(tier_ep_cost) {
							tier_ep_cost.ep_costs.forEach( function(ep_cost) {
//								console.log(`show_${skill.name}_${application.name}_${ep_cost}_ep: ${(has_training && tier >= tier_ep_cost.tier)}`);
								setAttrs({
									[`show_${skill.name}_${application.name}_${ep_cost}_ep`]: (has_training && tier >= tier_ep_cost.tier)
								});
							});
						});
					}
				});
			});
		}
	});
	
	// Update skill application count & CP cost
	let training_array = skill.applications.map(app => `${skill.name}_${app.name}_training`);
	on('change:' + training_array.join(' change:'), function() {
		getAttrs(training_array, function(values) {
			let app_count = training_array.filter(app => values[app] == 'on').length;
			console.log(`${skill.name}_application_count = ${app_count}`);
			setAttrs({
				[`${skill.name}_application_count`]: app_count,
				[cp_apps]:                           cp_calc_skill_applications(app_count)
			});
		});
	});

	// Update total skill CP cost
	on(`change:${cp_points} change:${cp_apps} change:${cp_pool}`, function() {
		getAttrs([cp_points, cp_apps, cp_pool], function(values) {
			let points_val = get_int_or_zero(values[cp_points]);
			let apps_val   = get_int_or_zero(values[cp_apps]  );
			let pool_val   = get_int_or_zero(values[cp_pool]  );
			let cp_total = (points_val + apps_val + pool_val);
			console.log(`${skill.name} points CP: ${points_val}, apps CP: ${apps_val}, pool CP: ${pool_val}; total = ${cp_total}`);
			setAttrs({ [`cp_${skill.name}`]: cp_total });
		});
	});
});

// Update Skill Combat Score CP
let combat_score_skill_array = active_skill_array
	.filter(skill => { return skill.combat_score === true })
	.map(skill => `cp_${skill.name}`);

on('change:' + combat_score_skill_array.join(' change:'), function() {
	getAttrs(combat_score_skill_array, function(values) {
		let cp_total = 0;
		for (let cp_skill of combat_score_skill_array) {
			cp_total += get_int_or_zero(values[cp_skill]);
		}
		console.log(`cp_combat_skills: ${cp_total}`);
		setAttrs({ 'cp_combat_skills': cp_total });
	});
});

// Update Skill Non-Combat Score CP
let non_combat_score_skill_array = active_skill_array
	.filter(skill => { return skill.combat_score === false })
	.map(skill => `cp_${skill.name}`);

on('change:' + non_combat_score_skill_array.join(' change:'), function() {
	getAttrs(non_combat_score_skill_array, function(values) {
		let cp_total = 0;
		for (let cp_skill of non_combat_score_skill_array) {
			cp_total += get_int_or_zero(values[cp_skill]);
		}
		console.log(`cp_non_combat_skills: ${cp_total}`);
		setAttrs({ 'cp_non_combat_skills': cp_total });
	});
});

// Add events for combat styles
const combat_style_array = active_skill_array
	.find(skill => { return skill.name === 'attack'}).applications
	.filter(application => { return application.count > 0 });

combat_style_array.forEach( function(style) {
	
	// Event: change anything that affects damage dice
	// Sets the weapon damage for the given combat style(s)
	let getAttrs_array = [];
	for (let i = 1; i <= style.count; i++) {
		getAttrs_array.push(`${style.name}_weapon${i}_name`);
	}
	
	getAttrs_array.push(
		'attack_tier', 'combat_expertise_modifier', 'size_modifier_damage', 
		'attack_damage_dice_modifier', 'attack_damage_static_modifier',
		'use_precise_strike', 'deadly_precision_modifier', 'use_sneak_attack',
		'sneak_attack_modifier', 'use_rage', 'rage_modifier', 'use_wild_rage',
		'use_charge', 'ps_devastating_charge', 'ps_flying_kick', 'athletics_tier',
		'use_fight_defensively', 'use_guard',
		'use_fight_recklessly', 'use_protect',  'use_defensive_stance'
	);

	on('change:' + getAttrs_array.join(' change:'), function() {
		//console.log(`${style.name} weapon changed`);
		getAttrs(getAttrs_array, function(values) {
			let tier                      = get_int_or_zero(values.attack_tier);
			let size_modifier             = get_int_or_zero(values.size_modifier_damage);
			let combat_expertise_modifier = get_int_or_zero(values.combat_expertise_modifier);
			let damage_dice_modifier      = get_int_or_zero(values.attack_damage_dice_modifier);
			let damage_static_modifier    = get_int_or_zero(values.attack_damage_static_modifier);
			let mob_damage_bonus          = get_int_or_zero(values.mob_damage_bonus);
			let set_object                = {};
			
			let use_any_special_action = (
				values.use_charge           == 'on' || values.use_precise_strike    == 'on' || values.use_sneak_attack     == 'on' || 
				values.use_fight_recklessly == 'on' || values.use_rage              == 'on' || values.use_wild_rage        == 'on' || 
				values.use_guard            == 'on' || values.use_fight_defensively == 'on' || values.use_defensive_stance == 'on' || 
				values.use_protect          == 'on'
			);
			combat_expertise_modifier = (use_any_special_action ? 0 : combat_expertise_modifier);
			
			let charge_modifier = 0;

			let precise_strike_modifier = 0;
			let precise_strike_on       = (values.use_precise_strike == 'on');
			if (precise_strike_on) {
				precise_strike_modifier = 1 + 
					get_int_or_zero(values.deadly_precision_modifier) + 
					(values.use_sneak_attack == 'on' ? get_int_or_zero(values.sneak_attack_modifier) : 0);
			}
			
			let rage_modifier = 0;
			let rage_on       = (values.use_rage == 'on');
			if (rage_on) {
				rage_modifier = get_int_or_zero(values.rage_modifier) * (values.use_wild_rage == 'on' ? 2 : 1);
			}
			
			let modifier = 
				size_modifier + style.damage_bonus(tier) + mob_damage_bonus + charge_modifier + precise_strike_modifier + 
				rage_modifier + combat_expertise_modifier + damage_dice_modifier;
			
			// set physical & magic damage amounts & roll text for each weapon
			for (let i = 1; i <= style.count; i++) {
				let weapon_name     = values[`${style.name}_weapon${i}_name`].trim();
				// add charge damage if applicable
				if (values.use_charge == 'on') {
					charge_modifier = get_charge_damage(weapon_name, get_bool(values.ps_devastating_charge), get_bool(values.ps_flying_kick), get_int_or_zero(values.athletics_tier));
				}

				let physical_damage = get_weapon_damage(weapon_name, tier, modifier + charge_modifier);
				let magic_object    = get_magic_item_object(weapon_name);
				let magic_damage    = (magic_object ? magic_object.damage_bonus_by_tier[tier] : 0);
				let roll_text       = get_weapon_roll_text(
					weapon_name, style.name, style.friendly_name, i, style.extra_damage, damage_static_modifier, (magic_damage > 0)
				);

				/*console.log(`${'_'.repeat(80)}\nWEAPON: ${weapon_name}\nsize_modifier: ${size_modifier}, style.damage_bonus: ${style.damage_bonus(tier)}, mob_damage_bonus: ${mob_damage_bonus}, ` +
				`charge_modifier: ${charge_modifier}, precise_strike_modifier: ${precise_strike_modifier}, rage_modifier: ${rage_modifier}, ` +
				`combat_expertise_modifier: ${combat_expertise_modifier}, damage_dice_modifier: ${damage_dice_modifier}; TOTAL: ${modifier} (original: ${original_mod_value}, after charge: ${modifier_after_charge})` +
				`\nphysical_damage: ${physical_damage}, magic_damage: ${magic_damage}`);*/

				set_object[`${style.name}_weapon${i}_physical_damage`] = physical_damage;
				set_object[`${style.name}_weapon${i}_magic_damage`]    = magic_damage;
				set_object[`${style.name}_weapon${i}_damage`]          = (physical_damage + magic_damage > 0 ? physical_damage + magic_damage : '');
				set_object[`${style.name}_weapon${i}_roll_text`]       = roll_text;
				//console.log(`roll_text = ${roll_text}`);
			}
			
			//console.log(`set_object = ${JSON.stringify(set_object)}`);
			setAttrs(set_object);
		});
	});
});

// Set events for using pool points to add damage or healing
const use_pool_points_for_damage_or_healing_array = [ 
	{ name: 'attack',       type: 'damage'  },
	{ name: 'biomancy',     type: 'healing' },
	{ name: 'conjuration',  type: 'damage'  },
	{ name: 'conjuration',  type: 'healing' },
	{ name: 'displacement', type: 'damage'  },
	{ name: 'dynamancy' ,   type: 'damage'  },
	{ name: 'necromancy',   type: 'healing' }
];
use_pool_points_for_damage_or_healing_array.forEach( function(skill) {

	on(`change:use_${skill.name}_pool_points change:${skill.name}_pool_points_to_use`, function() {
		getAttrs([`use_${skill.name}_pool_points`, `${skill.name}_pool_points_to_use`, `${skill.name}_pool_total`], function(values) {
			let dice_mod   = '';
			let static_mod = '';
			
			if (values[`use_${skill.name}_pool_points`] == 'on') {
				let pool_total = get_int_or_zero(values[`${skill.name}_pool_total`]);
				let use_pool   = get_int_or_zero(values[`${skill.name}_pool_points_to_use`]);
				
				if (use_pool % 2 == 1) {
					static_mod = 1;
					use_pool--;
				}
				
				if (use_pool > 0) {
					dice_mod = use_pool / 2;
				}
			}
			
			let set_object = { [`${skill.name}_${skill.type}_dice_modifier`]: dice_mod, [`${skill.name}_${skill.type}_static_modifier`]: static_mod };

			if (skill.name == 'dynamancy') {
				let duration_attack_dice_mod = (values[`use_${skill.name}_pool_points`] == 'on' ? Math.floor(get_int_or_zero(values[`${skill.name}_pool_points_to_use`]) / 3) : '');
				set_object['duration_attack_damage_dice_modifier'] = duration_attack_dice_mod;
			}
			
			setAttrs(set_object);
		});
	});
});

on('change:attack_attribute_modifier change:attack_damage_static_modifier', function() {
	getAttrs(['attack_attribute_modifier', 'attack_damage_static_modifier'], function(values) {
		let attack_attribute_modifier         = get_int_or_zero(values.attack_attribute_modifier);
		let attack_damage_static_modifier     = get_int_or_zero(values.attack_damage_static_modifier);
		let attack_attribute_modifier_display = attack_attribute_modifier + attack_damage_static_modifier;
		if (attack_attribute_modifier >= 0) {
			attack_attribute_modifier_display = '+' + attack_attribute_modifier_display;
		}
		setAttrs({ 'attack_attribute_modifier_display': attack_attribute_modifier_display });
	});
});

on("clicked:togglecombatstyles", function() {
	let show_array     = [];
	let training_array = [];
	combat_style_array.forEach( function(style) {
		show_array.push(`show_${style.name}`);
		training_array.push(`attack_${style.name}_training`);
	});

	getAttrs(show_array.concat(training_array), function(values) {
		let any_hidden = false;
		show_array.forEach( function(show) {
			any_hidden ||= !values[show];
		});
		
		let set_object = {};
		for (let i = 0; i < show_array.length; i++) {
			set_object[show_array[i]] = (any_hidden ? true : (values[training_array[i]] == 'on'));
		}
		//console.log(`set_object = ${JSON.stringify(set_object)}`);
		
		setAttrs(set_object);
	});
});

const proficiency_array = [
	{ name: 'craft',      attribute: 'physique'     },
	{ name: 'knowledge',  attribute: 'intelligence' },
	{ name: 'perform',    attribute: 'wit'          },
	{ name: 'profession', attribute: 'wit'          }
];

function get_proficiency_skill_array(count) {
	let array = [];
	
	proficiency_array.forEach( function(prof) {
		for (let i = 1; i <= count; i++) {
			array.push({ type: prof.name, name: `${prof.name}${i}`, attribute: prof.attribute, applications: [ { name: 'type' } ] });
		}
	});

	return array;
}

const proficiency_count = 5;
const proficiency_skill_array = get_proficiency_skill_array(proficiency_count);

proficiency_skill_array.forEach( function(skill) {

	// Event: change skill points or attribute; also passive skill and modifier (if applicable)
	// Sets the skill total and attribute modifier
	let skill_points_name     = `${skill.name}_points`;
	let attribute_mod_name    = `${skill.attribute}_modifier`;
	let cp_points             = `cp_${skill.name}_points`;
	
	let getAttrs_array = [skill_points_name, attribute_mod_name];
	let change = 'change:' + getAttrs_array.join(' change:');
	
	on(change, function() {
		getAttrs(getAttrs_array, function(values) {
			let skill_points   = get_int_or_zero(values[skill_points_name]);
			let training       = (skill_points >= 1 ? 'on' : '0');
			let attribute_name = skill.attribute;
			let attribute_mod  = get_int_or_zero(values[attribute_mod_name]);
			let total          = skill_points + attribute_mod;
			
			//console.log(`${cp_points}: ${(skill_points / 2)}`);
			setAttrs({
				[`${skill.name}_attribute_name`]:     capitalize_first_letter(attribute_name),
				[`${skill.name}_attribute_modifier`]: attribute_mod,
				[`${skill.name}_total`]:              total,
				[`${skill.name}_type_training`]:      training,
				[cp_points]:                          (skill_points / 2)
			});
		});
	});
	
	let advantage_name = `${skill.name}_advantage`;
	let explode_name   = `${skill.name}_explode`;
	
	// Event: change advantage level of skill
	// Sets advantage text to show up in the roll template
	on(`change:${advantage_name}`, function() {
		getAttrs([advantage_name], function(values) {
			setAttrs({
				[`${advantage_name}_text`]: values[advantage_name].replace('tA', 't A').replace('tD', 't D').replace('Novantage', '')
			});
		});
	});
	
	skill.applications.forEach( function(application) {
		// Events: advantage level, explode value, or training of skill applications
		// Sets the roll for each skill application
		let training = `${skill.name}_${application.name}_training`;
		let roll     = `${skill.name}_${application.name}_roll`;
		
		on(`change:${advantage_name} change:${explode_name} change:${training}`, function() {
			getAttrs([advantage_name, explode_name, training], function(values) {
				setAttrs({ [roll]: get_roll(values[training], values[advantage_name], values[explode_name]) });
			});
		});
	});
});

const proficiency_names = proficiency_array.map(skill => skill.name);

// Update tier, pool, and CP total per profession type
proficiency_names.forEach( function(skill) {
	let points_array = proficiency_skill_array.filter(p => p.type == skill).map(s => `${s.name}_points`);
	let skill_extra_pool_name = `${skill}_pool_extra`;
	points_array.push(skill_extra_pool_name);
	
	on('change:' + points_array.join(' change:'), function() {
		getAttrs(points_array, function(values) {
			let max_points = 0;
			points_array.forEach( function(points_item) {
				if (points_item.includes('pool')) {
					return;
				}
				let item_value = get_int_or_zero(values[points_item]);
				max_points = Math.max(max_points, item_value);
			});
			let tier = get_tier(max_points);
			let pool = tier + get_int_or_zero(values[skill_extra_pool_name]);
			console.log(`${skill}_tier: ${tier}; ${skill}_pool_total: ${pool}`);
			setAttrs({ [`${skill}_tier`]: tier, [`${skill}_pool_total`]: pool });
		});
	});
	
	let cp_array = proficiency_skill_array.filter(p => p.type == skill).map(s => `cp_${s.name}_points`);
	cp_array.push(skill_extra_pool_name);
	on('change:' + cp_array.join(' change:'), function() {
		getAttrs(cp_array, function(values) {
			let cp_total   = 0;
			cp_array.forEach( function(cp_item) {
				let item_value = get_float_or_zero(values[cp_item]);
				if (cp_item.includes('pool')) {
					item_value = cp_calc_skill_pool(item_value);
				}
				cp_total += item_value;
			});
			console.log(`cp_${skill}: ${cp_total}`);
			setAttrs({ [`cp_${skill}`]: cp_total });
		});
	});
});

// Update Proficiency Non-Combat Score CP
let proficiency_skill_cp_names = proficiency_names.map(skill => `cp_${skill}`);

on('change:' + proficiency_skill_cp_names.join(' change:'), function() {
	getAttrs(proficiency_skill_cp_names, function(values) {
		let cp_total = 0.0;
		let cp = 0.0;
		for (let cp_skill of proficiency_skill_cp_names) {
			cp = get_float_or_zero(values[cp_skill]);
			console.log(`${cp_skill}: ${cp}`);
			cp_total += cp;
		}
		console.log(`cp_proficiencies: ${cp_total}`);
		setAttrs({ 'cp_proficiencies': cp_total });
	});
});

function toggle_skills(active_skill_names) {
	let get_array = [];
	active_skill_names.forEach( function(skill) {
		get_array.push(`${skill}_points`);
		get_array.push(`show_${skill}`);
	});

	getAttrs(get_array, function(values) {

		let any_hidden = false;
		active_skill_names.forEach( function(skill) {
			any_hidden ||= !values[`show_${skill}`];
		});

		active_skill_names.forEach( function(skill) {
			setAttrs({
				[`show_${skill}`]: (any_hidden ? true : (get_int_or_zero(values[`${skill}_points`]) > 0))
			});
		});
	});
}

// if the show value for any proficiency changes, update the show tier value accordingly
proficiency_array.forEach( function(prof) {
	let get_array = [];
	for (let i = 1; i <= proficiency_count; i++) {
		get_array.push(`show_${prof.name}${i}`);
	}
	let change = 'change:' + get_array.join(' change:');
	
	on(change, function() {
		getAttrs(get_array, function(values) {
			
			let show_proficiency = false;
			get_array.forEach( function(show) {
				show_proficiency ||= (get_bool(values[show]));
			});
			
			setAttrs({ [`show_${prof.name}_tier`]: show_proficiency });
		});
	});
});

on("clicked:toggleactiveskills", function() {

	let active_skill_names = []
	active_skill_array.forEach( function(skill) {
		if ((!skill.passive_skill || !skill.passive_skill.includes('magic')) && 
			!['perception', 'attack', 'defend', 'pr', 'mr'].includes(skill.name)) {
			active_skill_names.push(skill.name);
		}
	});
	
	toggle_skills(active_skill_names);
});

on("clicked:togglepassiveskills", function() {
	getAttrs(["show_passive_skills"], function(values) {
		let show_passive_skills = get_bool(values.show_passive_skills);
		setAttrs({
			"show_passive_skills": !show_passive_skills
		});
	});
});

on("clicked:toggleboonsbanes", function() {
	getAttrs(["show_boons_and_banes"], function(values) {
		let show_boons_and_banes = get_bool(values.show_boons_and_banes);
		setAttrs({
			"show_boons_and_banes": !show_boons_and_banes
		});
	});
});

on("clicked:togglecarry", function() {
	getAttrs(["show_carry"], function(values) {
		let show_carry = get_bool(values.show_carry);
		setAttrs({
			"show_carry": !show_carry
		});
	});
});

on("clicked:toggleproficiencies", function() {

	let skill_names = []
	proficiency_skill_array.forEach( function(skill) {
		skill_names.push(skill.name);
	});
	
	toggle_skills(skill_names);
});

on("clicked:togglelanguages", function() {
	getAttrs(["show_languages"], function(values) {
		let show_languages = get_bool(values.show_languages);
		setAttrs({
			"show_languages": !show_languages
		});
	});
});

on("clicked:togglemodesofconveyance", function() {
	getAttrs(["show_modes_of_conveyance"], function(values) {
		let show_modes_of_conveyance = get_bool(values.show_modes_of_conveyance);
		setAttrs({
			"show_modes_of_conveyance": !show_modes_of_conveyance
		});
	});
});

const damage_type_array = [
	{
		name: 'arcane',
		description: 'Pure magical energy',
		secondary_effect: 'Targets are knocked prone'
	},
	{
		name: 'chemical',
		description: 'Strong acids and bases',
		secondary_effect: 'Targets suffer additional damage on the following round, based on the spell being cast'
	},
	{
		name: 'cold',
		description: 'Dangerously low temperatures',
		secondary_effect: 'Targets are slowed (1 AP) for one round'
	},
	{
		name: 'disease',
		description: 'Diseases or radiation',
		secondary_effect: 'Targets are fatigued for one round'
	},
	{
		name: 'electricity',
		description: 'Electric currents or lightning',
		secondary_effect: 'Targets are slowed (1 AP) for one round'
	},
	{
		name: 'heat',
		description: 'Dangerously high temperatures',
		secondary_effect: 'Targets suffer additional damage on the following round, based on the spell being cast'
	},
	{
		name: 'mental',
		description: 'Anything that affects your mind',
		secondary_effect: 'Targets are sleepy for one round'
	},
	{
		name: 'physical',
		description: 'Any physical force',
		secondary_effect: 'Targets are knocked prone'
	},
	{
		name: 'poison',
		description: 'Any substance that harms you internally when ingested, inhaled or injected',
		secondary_effect: 'Targets are fatigued for one round'
	},
	{
		name: 'sonic',
		description: 'Very loud sounds, or harmful inaudible frequencies',
		secondary_effect: 'Targets are deafened for one round'
	},
	{
		name: 'spectral',
		description: 'Unholy, death, or void energy',
		secondary_effect: 'Targets are scared for one round'
	},
	{
		name: 'vibrant',
		description: 'Holy, life, or cosmic energy',
		secondary_effect: 'Targets are scared for one round'
	}
];

const damage_type_list = damage_type_array.map(type => type.name);

damage_type_array.forEach( function(damage_type) {
	let dr_natural_name = `dr_${damage_type.name}_natural`;
	let dr_item_name    = `dr_${damage_type.name}_item`;
	let dr_spell_name   = `dr_${damage_type.name}_spell`;
	let get_array = [ dr_natural_name, dr_item_name, dr_spell_name ];
	on('change:' + get_array.join(' change:'), function() {
		getAttrs(get_array, function(values) {
			let dr_bonus = Math.max(get_int_or_zero(values[dr_item_name]), get_int_or_zero(values[dr_spell_name]));
			let dr_total = dr_bonus + get_int_or_zero(values[dr_natural_name]);
			setAttrs({ [`dr_${damage_type.name}_total`]: (dr_total == 0 ? '' : dr_total) });
		});
	});

	let has_damage_type_name      = `damage_type_${damage_type.name}`;
	let has_secondary_effect_name = `damage_type_${damage_type.name}_secondary`;
	
	on(`change:${has_damage_type_name}`, function() {
		if (has_damage_type_name === 'damage_type_physical') { return; }
		getAttrs([has_damage_type_name, 'cp_damage_types'], function(values) {
			let cp_damage     = get_int_or_zero(values.cp_damage_types);
			let cp_change     = (values[has_damage_type_name] == 'on' ? 3 : -3);
			let new_cp_damage = Math.max(0, cp_damage + cp_change);
			console.log(`cp_damage_types: ${new_cp_damage}`);
			setAttrs({ 'cp_damage_types': new_cp_damage });
		});
	});
	
	on(`change:${has_secondary_effect_name}`, function() {
		getAttrs([has_secondary_effect_name, 'cp_damage_types'], function(values) {
			let cp_damage     = get_int_or_zero(values.cp_damage_types);
			let cp_change     = (values[has_secondary_effect_name] == 'on' ? 3 : -3);
			let new_cp_damage = Math.max(0, cp_damage + cp_change);
			console.log(`cp_damage_types: ${new_cp_damage}`);
			setAttrs({ 'cp_damage_types': new_cp_damage });
		});
	});
	
	on(`clicked:damagetype${damage_type.name}info`, function() {
		getAttrs([has_secondary_effect_name], function(values) {
			let secondary = '';
			if (values[has_secondary_effect_name] == 'on') {
				secondary = ` {{Secondary effect=${damage_type.secondary_effect}}}`;
			}
			let roll_text = "/w @{character_name} '&{template:custom} {{title=" + capitalize_first_letter(damage_type.name) + " damage type info}} " +
			"{{Description=" + damage_type.description + "}}" + secondary + "'";
			startRoll(roll_text, (results) => {
				finishRoll(results.rollId);
			});
		});
	});
});

on('change:armor_name change:defend_tier change:defensive_stance_dr_bonus', function() {
	getAttrs(['armor_name', 'defend_tier', 'defensive_stance_dr_bonus'], function(values) {
		let defensive_stance_dr_bonus = get_int_or_zero(values.defensive_stance_dr_bonus);
		if (!is_armor(values.armor_name)) {
			if (values.armor_name != '') {
				console.error(`"${values.armor_name}" is not recognized as armor`);
			}
			setAttrs({ 'dr_physical_item': defensive_stance_dr_bonus });
			return;
		}
		let armor_object = parse_armor(values.armor_name);
		let dr_value     = armor_object.dr;
		if (armor_object.magic_bonus_by_tier) {
			dr_value += armor_object.magic_bonus_by_tier[get_int_or_zero(values.defend_tier)];
		}
		dr_value += armor_object.material_bonus + defensive_stance_dr_bonus;
		setAttrs({ 'dr_physical_item': dr_value });
	});
});

const area_type_array = ['area_type_blast', 'area_type_burst', 'area_type_line', 'area_type_nova', 'area_type_wall'];

on('change:' + area_type_array.join(' change:'), function() {
	getAttrs(area_type_array, function(values) {
		let cp_area_types = 0;
		
		for (let type of area_type_array) {
			cp_area_types += (values[type] == 'on' ? 3 : 0);
		}

		console.log(`area type CP: ${cp_area_types}`);
		setAttrs({ 'cp_area_types': cp_area_types });
	});
});

const passive_skill_array = [
	{ name: 'ps_absolute_protector',          search_text: 'absoluteprotector',         cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_action_hero',                 search_text: 'actionhero',                cs_cp_cost:  3, ncs_cp_cost:  3 },
	{ name: 'ps_animate_object',              search_text: 'animateobject',             cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_arcane_trapfinding',          search_text: 'arcanetrapfinding',         cs_cp_cost:  0, ncs_cp_cost:  6 },
	{ name: 'ps_archers_stance',              search_text: 'archersstance',             cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_armor_expertise',             search_text: 'armorexpertise',            cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_armored_spellcasting',        search_text: 'armoredspellcasting',       cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_beam',                        search_text: 'beam',                      cs_cp_cost:  0, ncs_cp_cost:  6 },
	{ name: 'ps_blind_fighting',              search_text: 'blindfighting',             cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_brawl',                       search_text: 'brawl',                     cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_improved_breath_weapon',      search_text: 'improvedbreathweapon',      cs_cp_cost: 10, ncs_cp_cost:  0 },
	{ name: 'ps_greater_breath_weapon',       search_text: 'greaterbreathweapon',       cs_cp_cost: 20, ncs_cp_cost:  0 },
	{ name: 'ps_epic_breath_weapon',          search_text: 'epicbreathweapon',          cs_cp_cost: 30, ncs_cp_cost:  0 },
	{ name: 'ps_legendary_breath_weapon',     search_text: 'legendarybreathweapon',     cs_cp_cost: 40, ncs_cp_cost:  0 },
	{ name: 'ps_combat_awareness',            search_text: 'combatawareness',           cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_combat_expertise',            search_text: 'combatexpertise',           cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_combat_reflexes',             search_text: 'combatreflexes',            cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_conjuration_attack',          search_text: 'conjurationattack',         cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_deadly_aim',                  search_text: 'deadlyaim',                 cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_deadly_precision',            search_text: 'deadlyprecision',           cs_cp_cost:  4, ncs_cp_cost:  0 },
	{ name: 'ps_deathblow',                   search_text: 'deathblow',                 cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_defensive_stance',            search_text: 'defensivestance',           cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_devastating_charge',          search_text: 'devastatingcharge',         cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_dexterous_athletics',         search_text: 'dexterousathletics',        cs_cp_cost:  0, ncs_cp_cost:  3 },
	{ name: 'ps_dexterous_strike',            search_text: 'dexterousstrike',           cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_die_hard',                    search_text: 'diehard',                   cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_displacement_attack',         search_text: 'displacementattack',        cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_dynamancy_opportunist',       search_text: 'dynamancyopportunist',      cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_improved_explosive_death',    search_text: 'improvedexplosivedeath',    cs_cp_cost: 10, ncs_cp_cost:  0 },
	{ name: 'ps_greater_explosive_death',     search_text: 'greaterexplosivedeath',     cs_cp_cost: 20, ncs_cp_cost:  0 },
	{ name: 'ps_epic_explosive_death',        search_text: 'epicexplosivedeath',        cs_cp_cost: 30, ncs_cp_cost:  0 },
	{ name: 'ps_legendary_explosive_death',   search_text: 'legendaryexplosivedeath',   cs_cp_cost: 40, ncs_cp_cost:  0 },
	{ name: 'ps_far_shot',                    search_text: 'farshot',                   cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_flying_kick',                 search_text: 'flyingkick',                cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_focused_blasting',            search_text: 'focusedblasting',           cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_greater_focused_blasting',    search_text: 'greaterfocusedblasting',    cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_focused_healing',             search_text: 'focusedhealing',            cs_cp_cost:  4, ncs_cp_cost:  0 },
	{ name: 'ps_greater_focused_healing',     search_text: 'greaterfocusedhealing',     cs_cp_cost:  4, ncs_cp_cost:  0 },
	{ name: 'ps_force_weapon',                search_text: 'force_weapon',              cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_gang_up',                     search_text: 'gangup',                    cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_iron_skin',                   search_text: 'ironskin',                  cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_mage_rage',                   search_text: 'magerage',                  cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_mind_stab',                   search_text: 'mindstab',                  cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_mob',                         search_text: 'mob',                       cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_multiattack',                 search_text: 'multiattack',               cs_cp_cost: 12, ncs_cp_cost:  0 },
	{ name: 'ps_necromantic_summons',         search_text: 'necromanticsummons',        cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_pinion',                      search_text: 'pinion',                    cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_pounce',                      search_text: 'pounce',                    cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_powerful_blow',               search_text: 'powerfulblow',              cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_precise_shot',                search_text: 'preciseshot',               cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_quick_draw',                  search_text: 'quickdraw',                 cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_quintessence',                search_text: 'quintessence',              cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_rage',                        search_text: 'rage',                      cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_ranged_legerdemain',          search_text: 'rangedlegerdemain',         cs_cp_cost:  0, ncs_cp_cost:  6 },
	{ name: 'ps_rapid_reload',                search_text: 'rapidreload',               cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_rend',                        search_text: 'rend',                      cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_shield_bash',                 search_text: 'shieldbash',                cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_sideslip_attack',             search_text: 'sideslipattack',            cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_sideslip_defense',            search_text: 'sideslipdefense',           cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_snap_shot',                   search_text: 'snapshot',                  cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_sneak_attack',                search_text: 'sneakattack',               cs_cp_cost:  4, ncs_cp_cost:  0 },
	{ name: 'ps_spell_combat',                search_text: 'spellcombat',               cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_spell_shaper',                search_text: 'spellshaper',               cs_cp_cost:  3, ncs_cp_cost:  3 },
	{ name: 'ps_spell_synthesis_alteration',  search_text: 'spellsynthesisalteration',  cs_cp_cost: 12, ncs_cp_cost:  0 },
	{ name: 'ps_spell_synthesis_biomancy',    search_text: 'spellsynthesisbiomancy',    cs_cp_cost: 12, ncs_cp_cost:  0 },
	{ name: 'ps_spell_synthesis_conjuration', search_text: 'spellsynthesisconjuration', cs_cp_cost: 12, ncs_cp_cost:  0 },
	{ name: 'ps_spell_synthesis_dynamancy',   search_text: 'spellsynthesisdynamancy',   cs_cp_cost: 12, ncs_cp_cost:  0 },
	{ name: 'ps_spell_synthesis_summoning',   search_text: 'spellsynthesissummoning',   cs_cp_cost: 12, ncs_cp_cost:  0 },
	{ name: 'ps_spellsong',                   search_text: 'spellsong',                 cs_cp_cost:  3, ncs_cp_cost:  3 },
	{ name: 'ps_spellstrike',                 search_text: 'spellstrike',               cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_stick_and_move',              search_text: 'stickandmove',              cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_stoic_defense',               search_text: 'stoicdefense',              cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_supernatural_aspect',         search_text: 'supernaturalaspect',        cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_sweeping_attack',             search_text: 'sweepingattack',            cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_tunnel_fighting',             search_text: 'tunnelfighting',            cs_cp_cost:  3, ncs_cp_cost:  0 },
	{ name: 'ps_vitality',                    search_text: 'vitality',                  cs_cp_cost:  6, ncs_cp_cost:  0 },
	{ name: 'ps_wild_rage',                   search_text: 'wildrage',                  cs_cp_cost:  6, ncs_cp_cost:  0 },
];

damage_type_list.forEach( function(type) {
	for (let other of damage_type_list) {
		if (type == other) {
			continue;
		}
		passive_skill_array.push( {
			name:        `ps_energy_amalgamation_${type}_${other}`,
			search_text: `energyamalgamation${type}${other}`,
			cs_cp_cost:  6,
			ncs_cp_cost: 0
		} );
	}
});

const magic_skill_base_array = active_skill_array
	.filter(skill => 
		skill.alternate_attribute && 
		skill.passive_skill && 
		skill.passive_skill.includes('magic'));

magic_skill_base_array.forEach( function(skill) {
	passive_skill_array.push( {
		name:        skill.passive_skill,
		search_text: skill.passive_skill.substring(3).replaceAll('_', ''),
		cs_cp_cost:  (skill.combat_score ? 4 : 0),
		ncs_cp_cost: (skill.combat_score ? 0 : 4)
	} );
	
	if (skill.natural) {
		passive_skill_array.push(
			{ 
				name:        `ps_improved_natural_magic_${skill.name}`, 
				search_text: `improvednaturalmagic${skill.name}`, 
				cs_cp_cost:  (skill.combat_score ? 20 :  0), 
				ncs_cp_cost: (skill.combat_score ?  0 : 20) 
			},
			{ 
				name:        `ps_greater_natural_magic_${skill.name}`,  
				search_text: `greaternaturalmagic${skill.name}`,  
				cs_cp_cost:  (skill.combat_score ? 30 :  0), 
				ncs_cp_cost: (skill.combat_score ?  0 : 30) 
			},
			{ 
				name:        `ps_epic_natural_magic_${skill.name}`,     
				search_text: `epicnaturalmagic${skill.name}`,     
				cs_cp_cost:  (skill.combat_score ? 40 :  0), 
				ncs_cp_cost: (skill.combat_score ?  0 : 40) 
			}
		);
	}
});

function get_passives_skills_object(ps_text) {
	let ps_object = { 'cp_combat_passives': 0, 'cp_non_combat_passives': 0 };

	if (!ps_text || ps_text == '') {
		return ps_object;
	}
	
	let ps_array = parse_textarea(ps_text).split(',');
	for (let ps of ps_array) {
		let object = passive_skill_array.find(s => s.search_text == ps);
		if (!object) {
			console.error(`passive skill ${ps} not found`);
		}
		else {
			ps_object.cp_combat_passives     += object.cs_cp_cost;
			ps_object.cp_non_combat_passives += object.ncs_cp_cost;
			ps_object[object.name]            = true;
		}
	}
	
	return ps_object;
}

function set_passive_skills(eventInfo) {
	let old_ps_object = get_passives_skills_object(eventInfo.previousValue);
	let new_ps_object = get_passives_skills_object(eventInfo.newValue);

	let keys_to_blank_out = Object.keys(old_ps_object).filter(ps => !Object.keys(new_ps_object).includes(ps));

	for (let key of keys_to_blank_out) {
		new_ps_object[key] = '';
	}

	console.log(new_ps_object);
	setAttrs(new_ps_object);
}

const movement_boon_array = [
	{ search_text: 'burrow',       base_cost:  6 },
	{ search_text: 'climb',        base_cost:  0 },
	{ search_text: 'fastmovement', base_cost:  0 },
	{ search_text: 'fly',          base_cost: 12 },
	{ search_text: 'slowmovement', base_cost:  0, bane: true },
	{ search_text: 'swim',         base_cost:  0 }
];

function parse_movement_boon(bb_raw) {
	let boon     = movement_boon_array.find(b => bb_raw.startsWith(b.search_text));
	let movement = get_int_or_zero(bb_raw.split(boon.search_text)[1].split('sq')[0]);
	let cp_cost  = boon.base_cost + (movement * 4) * (boon.bane ? -1 : 1);
	let cp_costs = { cs_cp_cost: 0, ncs_cp_cost: cp_cost };
	return cp_costs;
}

function parse_breath_weapon_boon(bb_raw) {
	let bb_array   = bb_raw.split(',');
	let multiplier = (bb_array[0].includes('minor') ? 1 : 10);
	let base_cost  = (bb_array[1] == 'physical' ? 3 : 9);
	let cs_cp_cost = base_cost * multiplier;
	let cp_costs   = { cs_cp_cost: cs_cp_cost, ncs_cp_cost: 0 };
	return cp_costs;
}

const free_action_boons = [ 
	{ prefix: 'grapple',   cp_cost: 8 },
	{ prefix: 'knockdown', cp_cost: 8 }
];

function parse_free_action_boon(bb_raw) {
	let boon       = free_action_boons.find(b => bb_raw.startsWith('free' + b.prefix));
	let bb_array   = bb_raw.split(boon.prefix);
	let multiplier = 1;
	let cp_cost    = boon.cp_cost;
	if (bb_array[1].includes('x')) {
		let attack_parts = bb_array[1].split('x');
		if (attack_parts.length > 1 && !isNaN(parseInt(attack_parts[1]))) {
			multiplier = get_int_or_zero(attack_parts[1]);
		}
	}
	let cp_costs = { cs_cp_cost: cp_cost * multiplier, ncs_cp_cost: 0 };
	return cp_costs;
}

const natural_attack_boon_array = [
	{ prefix: '',          cp_cost:  3 },
	{ prefix: 'magic',     cp_cost:  6 },
	{ prefix: 'eldritch',  cp_cost: 12 },
	{ prefix: 'epic',      cp_cost: 18 },
	{ prefix: 'legendary', cp_cost: 24 },
	{ prefix: 'energy',    cp_cost: 54 },
];

function parse_natural_attack_boon(bb_raw) {
	let bb_array   = bb_raw.split(',');
	let boon_parts = bb_array[0].split('naturalattack');
	let boon       = natural_attack_boon_array.find(b => b.prefix == boon_parts[0]);
	let multiplier = 1;
	let cp_cost    = boon.cp_cost;
	if (boon_parts[1].includes('x')) {
		let attack_parts = boon_parts[1].split('x');
		if (attack_parts.length > 1 && !isNaN(parseInt(attack_parts[1]))) {
			multiplier = get_int_or_zero(attack_parts[1]);
		}
	}
	if (!['', 'energy'].includes(boon_parts[0])) {
		if (bb_array[1] != 'physical') {
			cp_cost *= 3;
		}
	}
	let cp_costs = { cs_cp_cost: cp_cost * multiplier, ncs_cp_cost: 0 };
	return cp_costs;
}

const boons_and_banes_array = [
	{ name: 'bb_amorphous',                           search_text: 'amorphous',                 cs_cp_cost:  30, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_amphibious',                          search_text: 'amphibious',                cs_cp_cost:   0, ncs_cp_cost:   8, increment: 0, max_count:  1 },
	{ name: 'bb_aquatic',                             search_text: 'aquatic',                   cs_cp_cost:   0, ncs_cp_cost:   8, increment: 0, max_count:  1 },
	{ name: 'bb_aura_of_fear',                        search_text: 'auraoffear',                cs_cp_cost:  30, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_minor_aura_of_protection',            search_text: 'minorauraofprotection',     cs_cp_cost:  20, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_major_aura_of_protection',            search_text: 'majorauraofprotection',     cs_cp_cost:  40, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_aura_of_slowness',                    search_text: 'auraofslowness',            cs_cp_cost:  30, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_aura_of_stench',                      search_text: 'auraofstench',              cs_cp_cost:  15, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_blindsense',                          search_text: 'blindsense',                cs_cp_cost:   0, ncs_cp_cost:  30, increment: 0, max_count:  1 },
	{ name: 'bb_blindsight',                          search_text: 'blindsight',                cs_cp_cost:   0, ncs_cp_cost:  40, increment: 0, max_count:  1 },
	{ name: 'bb_blood_drain',                         search_text: 'blooddrain',                cs_cp_cost:  20, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_blur',                                search_text: 'blur',                      cs_cp_cost:  12, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_minor_breath_weapon_blast',           search_text: 'minorbreathweaponblast',    cs_cp_cost:   0, ncs_cp_cost:   0, increment: 1, max_count:  3, 
		cp_function: function(bb_raw) {
			return parse_breath_weapon_boon(bb_raw);
		}
	},
	{ name: 'bb_minor_breath_weapon_line',            search_text: 'minorbreathweaponline',     cs_cp_cost:   0, ncs_cp_cost:   0, increment: 1, max_count:  3, 
		cp_function: function(bb_raw) {
			return parse_breath_weapon_boon(bb_raw);
		}
	},
	{ name: 'bb_major_breath_weapon_blast',           search_text: 'majorbreathweaponblast',    cs_cp_cost:   0, ncs_cp_cost:   0, increment: 1, max_count:  3, 
		cp_function: function(bb_raw) {
			return parse_breath_weapon_boon(bb_raw);
		}
	},
	{ name: 'bb_major_breath_weapon_line',            search_text: 'majorbreathweaponline',     cs_cp_cost:   0, ncs_cp_cost:   0, increment: 1, max_count:  3, 
		cp_function: function(bb_raw) {
			return parse_breath_weapon_boon(bb_raw);
		}
	},
	{ name: 'bb_burrow',                              search_text: 'burrow',                    cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1, 
		cp_function: function(bb_raw) {
			return parse_movement_boon(bb_raw);
		}
	},
	{ name: 'bb_change_shape',                        search_text: 'changeshape',               cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count: 10, 
		cp_function: function(bb_raw) {
			let change_shape_type = bb_raw.split('changeshape')[1];
			let ncs_cp_cost = (change_shape_type.length >= 3 && change_shape_type.substring(0, 3) == 'any' ? 30 : 10);
			let cp_costs = { cs_cp_cost: 0, ncs_cp_cost: ncs_cp_cost };
			return cp_costs;
		}
	},
	{ name: 'bb_climb',                               search_text: 'climb',                     cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1,  
		cp_function: function(bb_raw) {
			return parse_movement_boon(bb_raw);
		}
	},
	{ name: 'bb_construct',                           search_text: 'construct',                 cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_corrosive_blood',                     search_text: 'corrosiveblood',            cs_cp_cost:  30, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_create_spawn',                        search_text: 'createspawn',               cs_cp_cost:  12, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_crush',                               search_text: 'crush',                     cs_cp_cost:   8, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_desert_thirst',                       search_text: 'desertthirst',              cs_cp_cost:  30, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_disease_attack',                      search_text: 'diseaseattack',             cs_cp_cost:  15, ncs_cp_cost:   0, increment: 2, max_count:  3,
		cp_function: function(bb_raw) {
			let tier       = get_int_or_zero(bb_raw.split(',')[1].substring(4, 5));
			let cs_cp_cost = tier * 30;
			let cp_costs   = { cs_cp_cost: cs_cp_cost, ncs_cp_cost: 0 };
			return cp_costs;
		}
	},
	{ name: 'bb_disease_immunity',                    search_text: 'diseaseimmunity',           cs_cp_cost:  45, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_energy_drain',                        search_text: 'energydrain',               cs_cp_cost:  30, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_engulf',                              search_text: 'engulf',                    cs_cp_cost:  60, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_facehugger',                          search_text: 'facehugger',                cs_cp_cost:  20, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_fast_movement',                       search_text: 'fastmovement',              cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1, 
		cp_function: function(bb_raw) {
			return parse_movement_boon(bb_raw);
		}
	},
	{ name: 'bb_fear_immunity',                       search_text: 'fearimmunity',              cs_cp_cost:  10, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_ferocity',                            search_text: 'ferocity',                  cs_cp_cost:   6, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_fly',                                 search_text: 'fly',                       cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1, 
		cp_function: function(bb_raw) {
			return parse_movement_boon(bb_raw);
		}
	},
//	{ name: 'bb_free_grapple',                        search_text: 'freegrapple',               cs_cp_cost:   8, ncs_cp_cost:   0, increment: 0, max_count:  1 },
//	{ name: 'bb_free_knockdown',                      search_text: 'freeknockdown',             cs_cp_cost:   8, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_gaze_attack',                         search_text: 'gazeattack',                cs_cp_cost:   0, ncs_cp_cost:   0, increment: 1, max_count:  3,
		cp_function: function(bb_raw) {
			let gaze_parts  = bb_raw.split('gazeattack')[1].split(',');
			let ep_cost     = get_int_or_zero(gaze_parts[1].split('ep')[0]);
			let magic_skill = active_skill_array.find(s => s.applications.find(a => a.name == gaze_parts[0]));
			let cp_costs    = {
				cs_cp_cost:  (magic_skill.combat_score ? ep_cost : 0),
				ncs_cp_cost: (magic_skill.combat_score ? 0 : ep_cost)
			};
			return cp_costs;
		}
	},
	{ name: 'bb_huge_size',                           search_text: 'hugesize',                  cs_cp_cost:   6, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_infravision',                         search_text: 'infravision',               cs_cp_cost:   0, ncs_cp_cost:   6, increment: 0, max_count:  1 },
	{ name: 'bb_inner_magic',                         search_text: 'innermagic',                cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_lair_action',                         search_text: 'lairaction',                cs_cp_cost:  30, ncs_cp_cost:   0, increment: 2, max_count:  3 },
	{ name: 'bb_large_size',                          search_text: 'largesize',                 cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_legendary_monster',                   search_text: 'legendarymonster',          cs_cp_cost: 120, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_lycanthropy',                         search_text: 'lycanthropy',               cs_cp_cost: -20, ncs_cp_cost:  10, increment: 0, max_count:  1 },
	{ name: 'bb_magic_resistance',                    search_text: 'magicresistance',           cs_cp_cost:  10, ncs_cp_cost:  10, increment: 0, max_count:  1 },
	{ name: 'bb_material_vulnerability',              search_text: 'materialvulnerability',     cs_cp_cost:  -6, ncs_cp_cost:   0, increment: 0, max_count: 10 },
	{ name: 'bb_mindless',                            search_text: 'mindless',                  cs_cp_cost:   0, ncs_cp_cost:  10, increment: 0, max_count:  1 },
	{ name: 'bb_total_magic_immunity',                search_text: 'totalmagicimmunity',        cs_cp_cost: 200, ncs_cp_cost: 200, increment: 0, max_count:  1 },
	{ name: 'bb_no_metabolism',                       search_text: 'nometabolism',              cs_cp_cost: -20, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_no_natural_healing',                  search_text: 'nonaturalhealing',          cs_cp_cost: -20, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_non_breathing',                       search_text: 'nonbreathing',              cs_cp_cost:   0, ncs_cp_cost:   6, increment: 0, max_count:  1 },
	{ name: 'bb_non_eating',                          search_text: 'noneating',                 cs_cp_cost:   0, ncs_cp_cost:   3, increment: 0, max_count:  1 },
	{ name: 'bb_non_sleeping',                        search_text: 'nonsleeping',               cs_cp_cost:   0, ncs_cp_cost:  10, increment: 0, max_count:  1 },
	{ name: 'bb_poison_attack',                       search_text: 'poisonattack',              cs_cp_cost:   0, ncs_cp_cost:   0, increment: 1, max_count:  3, 
		cp_function: function(bb_raw) {
			let bb_array   = bb_raw.split(',');
			let weapon     = bb_array[0].split('poisonattack')[1];
			let tier       = get_int_or_zero(bb_array[1].substring(4, 5));
			let cs_cp_cost = tier * (weapon == 'touch' ? 75 : 50);
			let cp_costs   = { cs_cp_cost: cs_cp_cost, ncs_cp_cost: 0 };
			return cp_costs;
		}
	},
	{ name: 'bb_poison_immunity',                     search_text: 'poisonimmunity',            cs_cp_cost:  45, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_polyglot',                            search_text: 'polyglot',                  cs_cp_cost:   0, ncs_cp_cost:   8, increment: 0, max_count:  1 },
	{ name: 'bb_preternatural_cunning',               search_text: 'preternaturalcunning',      cs_cp_cost:  10, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_quick_reflexes',                      search_text: 'quickreflexes',             cs_cp_cost:   6, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_rake',                                search_text: 'rake',                      cs_cp_cost:  10, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_regenerate',                          search_text: 'regenerate',                cs_cp_cost:   0, ncs_cp_cost:   0, increment: 1, max_count:  1,
		cp_function: function(bb_raw) {
			let dice       = get_int_or_zero(bb_raw.split('regenerate')[1].split('d6,')[0]);
			let cs_cp_cost = dice * 20;
			let cp_costs   = { cs_cp_cost: cs_cp_cost, ncs_cp_cost: 0 };
			return cp_costs;
		}
	},
	{ name: 'bb_regeneration_vulnerability',          search_text: 'regenerationvulnerability', cs_cp_cost: -12, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_scent',                               search_text: 'scent',                     cs_cp_cost:   0, ncs_cp_cost:   6, increment: 0, max_count:  1 },
	{ name: 'bb_shatter_weapons',                     search_text: 'shatterweapons',            cs_cp_cost:  20, ncs_cp_cost:   0, increment: 0, max_count:  1 }, 
	{ name: 'bb_slow_movement',                       search_text: 'slowmovement',              cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1, 
		cp_function: function(bb_raw) {
			return parse_movement_boon(bb_raw);
		}
	},
	{ name: 'bb_slow_reflexes',                       search_text: 'slowreflexes',              cs_cp_cost:  -6, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_small_size',                          search_text: 'smallsize',                 cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_spell_immunity',                      search_text: 'spellimmunity',             cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count: 10,
		cp_function: function(bb_raw) {
			let spell_name  = bb_raw.split('spellimmunity')[1];
			let magic_skill = active_skill_array.find(s => s.applications.find(a => a.name == spell_name));
			let cp_costs    = {
				cs_cp_cost:  (magic_skill.combat_score ? 6 : 0),
				ncs_cp_cost: (magic_skill.combat_score ? 0 : 6)
			};
			return cp_costs;
		}
	},
	{ name: 'bb_split',                               search_text: 'split',                     cs_cp_cost:  15, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_spell_vulnerability',                 search_text: 'spellvulnerability',        cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_stability',                           search_text: 'stability',                 cs_cp_cost:   4, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_steal_voice',                         search_text: 'stealvoice',                cs_cp_cost:   0, ncs_cp_cost:   6, increment: 0, max_count:  1 },
	{ name: 'bb_stonecunning',                        search_text: 'stonecunning',              cs_cp_cost:   0, ncs_cp_cost:   4, increment: 0, max_count:  1 },
	{ name: 'bb_sunlight_powerlessness',              search_text: 'sunlightpowerlessness',     cs_cp_cost: -10, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_supernatural_flight',                 search_text: 'supernaturalflight',        cs_cp_cost:   0, ncs_cp_cost:  10, increment: 0, max_count:  1 },
	{ name: 'bb_supernatural_toughness',              search_text: 'supernaturaltoughness',     cs_cp_cost:  10, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_swallow_whole',                       search_text: 'swallowwhole',              cs_cp_cost:  12, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_swarm',                               search_text: 'swarm',                     cs_cp_cost:  12, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_swim',                                search_text: 'swim',                      cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1, 
		cp_function: function(bb_raw) {
			return parse_movement_boon(bb_raw);
		}
	},
	{ name: 'bb_tiny_size',                           search_text: 'tinysize',                  cs_cp_cost:   6, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_tireless',                            search_text: 'tireless',                  cs_cp_cost:   6, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_tomb_rot',                            search_text: 'tombrot',                   cs_cp_cost:  20, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_transparent',                         search_text: 'transparent',               cs_cp_cost:   0, ncs_cp_cost:  20, increment: 0, max_count:  1 },
	{ name: 'bb_tremorsense',                         search_text: 'tremorsense',               cs_cp_cost:   0, ncs_cp_cost:  20, increment: 0, max_count:  1 },
	{ name: 'bb_ultravision',                         search_text: 'ultravision',               cs_cp_cost:   0, ncs_cp_cost:   4, increment: 0, max_count:  1 },
	{ name: 'bb_undead_ghostly',                      search_text: 'undeadghostly',             cs_cp_cost: 156, ncs_cp_cost:  19, increment: 0, max_count:  1 },
	{ name: 'bb_undead_skeletal',                     search_text: 'undeadskeletal',            cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_undead_zombified',                    search_text: 'undeadzombified',           cs_cp_cost:   0, ncs_cp_cost:   0, increment: 0, max_count:  1 },
	{ name: 'bb_web',                                 search_text: 'web',                       cs_cp_cost:  20, ncs_cp_cost:   0, increment: 0, max_count:  1 }
];

attribute_array.forEach( function(attribute) {
	let cs_cost  = (attribute.combat_score ? 4 : 0);
	let ncs_cost = (attribute.combat_score ? 0 : 4);
	boons_and_banes_array.push(
		{ name: `bb_high_attribute_${attribute.name}`,      search_text: `highattribute${attribute.name}`,     cs_cp_cost: cs_cost,      ncs_cp_cost: ncs_cost,      increment: 0, max_count: 1 },
		{ name: `bb_low_attribute_${attribute.name}`,       search_text: `lowattribute${attribute.name}`,      cs_cp_cost: cs_cost * -1, ncs_cp_cost: ncs_cost * -1, increment: 0, max_count: 1 },
		{ name: `bb_very_high_attribute_${attribute.name}`, search_text: `veryhighattribute${attribute.name}`, cs_cp_cost: cs_cost *  2, ncs_cp_cost: ncs_cost *  2, increment: 0, max_count: 1 },
		{ name: `bb_very_low_attribute_${attribute.name}`,  search_text: `verylowattribute${attribute.name}`,  cs_cp_cost: cs_cost * -2, ncs_cp_cost: ncs_cost * -2, increment: 0, max_count: 1 }
	);

	cs_cost  = (attribute.combat_score ? -30 :   0);
	ncs_cost = (attribute.combat_score ?   0 : -40);
	boons_and_banes_array.push(
		{
			name:        `bb_unskilled_${attribute.name}`,
			search_text: `unskilled${attribute.name}`,
			cs_cp_cost:  cs_cost,
			ncs_cp_cost: ncs_cost,
			increment:   0,
			max_count:   1 
		}
	);
});

free_action_boons.forEach( function(boon) {
	boons_and_banes_array.push(
		{ 
			name:        `bb_free_${boon.prefix}`,
			search_text: `free${boon.prefix}`,
			cs_cp_cost:   0,
			ncs_cp_cost:  0,
			increment:    0,
			max_count:   10,
			cp_function: function(bb_raw) {
				return parse_free_action_boon(bb_raw);
			}
		}
	);	
});

natural_attack_boon_array.forEach( function(boon) {
	let is_increment = (!['', 'energy'].includes(boon.prefix));
	let underscore = (is_increment ? '_' : '');
	boons_and_banes_array.push(
		{ 
			name:        `bb_${boon.prefix}${underscore}natural_attack`,
			search_text: `${boon.prefix}naturalattack`,
			cs_cp_cost:   0,
			ncs_cp_cost:  0,
			increment:    (is_increment ? 1 : 0),
			max_count:   10,
			cp_function: function(bb_raw) {
				return parse_natural_attack_boon(bb_raw);
			}
		}
	);	
});

magic_skill_base_array.forEach( function(skill) {
	boons_and_banes_array.push(
		{ 
			name:        `bb_magic_immunity_${skill.name}`,
			search_text: `magicimmunity${skill.name}`,
			cs_cp_cost:  (skill.combat_score ? 60 :  0), 
			ncs_cp_cost: (skill.combat_score ?  0 : 60),
			increment:   0,
			max_count:   1
		},
		{ 
			name:        `bb_true_magic_immunity_${skill.name}`,
			search_text: `truemagicimmunity${skill.name}`,  
			cs_cp_cost:  (skill.combat_score ? 45 :  0), 
			ncs_cp_cost: (skill.combat_score ?  0 : 45),
			increment:   0,
			max_count:   1
		},
		{ 
			name:        `bb_magic_vulnerability_${skill.name}`,
			search_text: `magicvulnerability${skill.name}`, 
			cs_cp_cost:  (skill.combat_score ? -10 :   0), 
			ncs_cp_cost: (skill.combat_score ?   0 : -10),
			increment:   0,
			max_count:   1
		}
	);

	if (skill.natural) {
		boons_and_banes_array.push(
			{ 
				name:        `bb_natural_magic_${skill.name}`, 
				search_text: `naturalmagic${skill.name}`, 
				cs_cp_cost:  (skill.combat_score ? 10 :  0), 
				ncs_cp_cost: (skill.combat_score ?  0 : 10),
				increment:   0,
				max_count:   1
			}
		)
	}
});

damage_type_list.forEach( function(type) {
	boons_and_banes_array.push(
		{
			name:        `bb_aura_of_damage_${type}`,
			search_text: `auraofdamage${type}`,
			cs_cp_cost:  (type == 'physical' ? 20 : 60),
			ncs_cp_cost: 0,
			increment:   0,
			max_count:   1
		},
		{
			name:        `bb_natural_damage_resistance_${type}`,
			search_text: `ndr${type}`,
			cs_cp_cost:  0,
			ncs_cp_cost: 0,
			increment:   0,
			max_count:   1,
			cp_function: function(bb_raw) {
				let ndr        = get_int_or_zero(bb_raw.split(type)[1]);
				let cs_cp_cost = ndr * (type == 'physical' ? 3 : 1);
				let cp_costs   = { cs_cp_cost: cs_cp_cost, ncs_cp_cost: 0 };
				return cp_costs;
			}
		},
		{
			name:        `bb_natural_damage_immunity_${type}`,
			search_text: `ndi${type}`,
			cs_cp_cost:  (type == 'physical' ? 90 : 30),
			ncs_cp_cost: 0,
			increment:   0,
			max_count:   1
		}
	);
	minor_major_array.forEach( function(mm) {
		boons_and_banes_array.push(
			{
				name:        `bb_${mm}_explosive_death_${type}`,
				search_text: `${mm}explosivedeath${type}`,
				cs_cp_cost:  (type == 'physical' ? 3 : 9) * (mm == 'minor' ? 1 : 10),
				ncs_cp_cost: 0,
				increment:   0,
				max_count:   1
			},
			{
				name:        `bb_${mm}_natural_damage_vulnerability_${type}`,
				search_text: `${mm}ndv${type}`,
				cs_cp_cost:  (type == 'physical' ? 30 : 10) * (mm == 'minor' ? 1 : 3) * -1,
				ncs_cp_cost: 0,
				increment:   0,
				max_count:   1
			}
		);
	});
});

function parse_boons_and_banes_text(boons_and_banes_text) {
	if (!boons_and_banes_text) {
		return null;
	}
	let parsed_array = [];
	let bb           = null;
	let bb_part      = null;
	let bb_array     = boons_and_banes_text.split(',');
	for (let i = 0; i < bb_array.length; i++ ) {
		bb = boons_and_banes_array.find(b => bb_array[i].startsWith(b.search_text));
		if (!bb) {
			console.error(`${bb_array[i]} not found`);
			continue;
		}
		bb_part = bb_array[i];
		for (let j = i + 1; j <= i + bb.increment; j++) {
			bb_part += `,${bb_array[j]}`;
		}
		parsed_array.push(bb_part);
		i += bb.increment;
	}
	parsed_array = parsed_array.sort((a, b) => a.localeCompare(b));
	return parsed_array;
}

function get_boons_and_banes_object(bb_array) {
	let set_object  = { cp_combat_boons_banes: 0, cp_non_combat_boons_banes: 0 };
	if (!bb_array) {
		return set_object;
	}
	let bb          = null;
	let calc_cp     = null;
	let count       = 0;
	let count_affix = '';
	for (let bb_raw of bb_array) {
		bb = boons_and_banes_array.find(b => bb_raw.startsWith(b.search_text));
		if (!bb) {
			console.error(`boon/bane ${bb_raw} not found`);
			continue;
		}
		count = set_object[`${bb.name}_count`];
		if (count) {
			if (count + 1 > bb.max_count) {
				console.error(`Not adding ${bb_raw}; max count exceeded`);
				continue;
			}
			else {
				count++;
			}
		}
		else {
			count = 1;
		}
		count_affix                                = (bb.max_count > 1 ? `_${count}` : '');
		set_object[`${bb.name}${count_affix}`]     = true;
		set_object[`${bb.name}_count`]             = count;
		set_object[`${bb.name}${count_affix}_raw`] = bb_raw;
		if (bb.cp_function) {
			calc_cp = bb.cp_function(bb_raw);
			set_object.cp_combat_boons_banes     += calc_cp.cs_cp_cost;
			set_object.cp_non_combat_boons_banes += calc_cp.ncs_cp_cost;
		}
		else {
			set_object.cp_combat_boons_banes     += bb.cs_cp_cost;
			set_object.cp_non_combat_boons_banes += bb.ncs_cp_cost;
		}
	}

	return set_object;
}

function set_boons_and_banes(eventInfo) {
	console.log('set_boons_and_banes');
	console.log(eventInfo);

	let old_bb_text = (eventInfo.previousValue ? parse_textarea(eventInfo.previousValue) : '');
	let new_bb_text = (eventInfo.newValue      ? parse_textarea(eventInfo.newValue)      : '');
	console.log(`old_bb_text: ${old_bb_text}`);
	console.log(`new_bb_text: ${new_bb_text}`);

	let old_bb_array = parse_boons_and_banes_text(old_bb_text);
	let new_bb_array = parse_boons_and_banes_text(new_bb_text);
	console.log(old_bb_array);
	console.log(new_bb_array);

	let old_bb_object = get_boons_and_banes_object(old_bb_array);
	let new_bb_object = get_boons_and_banes_object(new_bb_array);
	//console.log(old_bb_object);
	//console.log(new_bb_object);

	let keys_to_blank_out = Object.keys(old_bb_object).filter(b => !Object.keys(new_bb_object).includes(b));

	for (let key of keys_to_blank_out) {
		new_bb_object[key] = '';
	}

	console.log(new_bb_object);
	setAttrs(new_bb_object);
}

damage_type_list.forEach( function(type) {

	// Aura of Damage
	let aura_of_damage_name      = `bb_aura_of_damage_${type}`;
	let get_aura_of_damage_array = [ aura_of_damage_name, 'size_modifier_aura', 'mr_tier' ];
	on('change:' + get_aura_of_damage_array.join(' change:'), function() {
		getAttrs(get_aura_of_damage_array, function(values) {
			console.log(values);
			let has_aura_of_damage = get_bool(values[aura_of_damage_name]);
			let tier               = get_int_or_zero(values.mr_tier);
			let size_mod           = get_int_or_zero(values.size_modifier_aura);
			
			let description = '';
			let damage_type = '';
			let damage      = '0';

			if (has_aura_of_damage) {
				description = `nova (${7 + size_mod} sq), ${type}`;
				damage_type = capitalize_first_letter(type);
				damage      = (tier + 1) + "d6";
			}
			
			setAttrs({ 
				[`${aura_of_damage_name}_description`]: description,
				[`${aura_of_damage_name}_type`]:        damage_type,
				[`${aura_of_damage_name}_damage`]:      damage
			});
		});	
	});

	// Natural Damage Resistance
	let ndr_name     = `bb_natural_damage_resistance_${type}`;
	let ndr_raw_name = `${ndr_name}_raw`;
	on(`change:${ndr_raw_name}`, function() {
		getAttrs([ndr_name, ndr_raw_name], function(values) {
			let ndr_value = '';
			if (get_bool(values[ndr_name])) {
				ndr_value = get_int_or_zero(values[ndr_raw_name].split(type)[1]);
			}
			setAttrs({ [`dr_${type}_natural`]: ndr_value });
		});
	});

	minor_major_array.forEach( function(mm) {
		// Explosive Death
		let explosive_death_name = `bb_${mm}_explosive_death_${type}`;
		let get_explosive_death_array = [ explosive_death_name, 'size_modifier_aura', 'mr_tier', 'ps_improved_explosive_death', 'ps_greater_explosive_death', 'ps_epic_explosive_death', 'ps_legendary_explosive_death' ];
		on('change:' + get_explosive_death_array.join(' change:'), function() {
			getAttrs(get_explosive_death_array, function(values) {
				let has_explosive_death           = get_bool(values[explosive_death_name]);
				let size_mod                      = get_int_or_zero(values.size_modifier_aura);
				let mr_tier                       = get_int_or_zero(values.mr_tier);
				let has_improved_explosive_death  = get_bool(values.ps_improved_explosive_death);
				let has_greater_explosive_death   = get_bool(values.ps_greater_explosive_death);
				let has_epic_explosive_death      = get_bool(values.ps_epic_explosive_death);
				let has_legendary_explosive_death = get_bool(values.ps_legendary_explosive_death);
				
				let damage_multiplier    = 0;
				let ps_tier_bonus        = 0;
				let damage_total         = 0;
				let area_size            = 0;
				let description          = '';

				if (has_explosive_death) {
					damage_multiplier = (mm == 'minor' ? 2 : 4);

					if (has_improved_explosive_death) {
						ps_tier_bonus = Math.max(ps_tier_bonus, 1);
					}
					if (has_greater_explosive_death) {
						ps_tier_bonus = Math.max(ps_tier_bonus, 2);
					}
					if (has_epic_explosive_death) {
						ps_tier_bonus = Math.max(ps_tier_bonus, 3);
					}
					if (has_legendary_explosive_death) {
						ps_tier_bonus = Math.max(ps_tier_bonus, 4);
					}
					
					damage_total = (mr_tier + 1 + ps_tier_bonus) * damage_multiplier;
					description  = `nova (${7 + size_mod} sq), ${type}`;
				}

				setAttrs({
					[`${explosive_death_name}_damage_total`]: damage_total,
					[`${explosive_death_name}_description`]:  description
				});
			});
		});
	});
});

const aura_type_array = ['fear', 'slowness', 'stench']
aura_type_array.forEach( function (type) {
	let aura_boon_name = 'bb_aura_of_' + type;
	on(`change:${aura_boon_name} change:size_modifier_aura`, function() {

		getAttrs([aura_boon_name, 'size_modifier_aura'], function(values) {
			let has_aura = get_bool(values[aura_boon_name]);
			let size_mod = get_int_or_zero(values.size_modifier_aura);

			setAttrs({ [`aura_of_${type}_description`]: (has_aura ? `nova (${7 + size_mod} sq)` : '') });
		});	
	});
});

minor_major_array.forEach( function(type) {
	['blast', 'line'].forEach( function(area) {
		let boon_base_name = `bb_${type}_breath_weapon_${area}`;
		let boon           = boons_and_banes_array.find(b => b.name == boon_base_name);
		if (!boon) {
			console.error(`${boon_base_name} not found`);
			return;
		}
		for (let i = 1; i <= boon.max_count; i++) {
			// Set breath weapon values for rolls
			let boon_name             = `${boon_base_name}_${i}`;
			let boon_raw_name         = `${boon_name}_raw`;
			let boon_damage_type_name = `${boon_name}_damage_type`;
			let boon_damage_desc_name = `${boon_name}_damage_description`;
			let boon_area_type_name   = `${boon_name}_area_type`;
			
			let get_array = [ boon_name, boon_raw_name, 'pr_total', 'pr_tier', 'ps_improved_breath_weapon', 'ps_greater_breath_weapon', 'ps_epic_breath_weapon', 'ps_legendary_breath_weapon' ];
			on('change:' + get_array.join(' change:'), function() {
				getAttrs(get_array, function(values) {
					let has_breath_weapon           = get_bool(values[boon_name]);
					let breath_weapon_raw_text      = values[boon_raw_name];
					let pr_total                    = get_int_or_zero(values.pr_total);
					let pr_tier                     = get_int_or_zero(values.pr_tier);
					let has_improved_breath_weapon  = get_bool(values.ps_improved_breath_weapon);
					let has_greater_breath_weapon   = get_bool(values.ps_greater_breath_weapon);
					let has_epic_breath_weapon      = get_bool(values.ps_epic_breath_weapon);
					let has_legendary_breath_weapon = get_bool(values.ps_legendary_breath_weapon);

					let area_type          = '';
					let damage_type        = '';
					let damage_multiplier  = 0;
					let damage_description = '';
					let ps_tier_bonus      = 0;
					let damage_total       = 0;
					let area_size          = 0;
					let description        = '';
					let recharge_roll      = '';

					if (has_breath_weapon) {
						let regex   = /m(in|aj)orbreathweapon(blast|line),(\w+)/;
						let matches = breath_weapon_raw_text.match(regex);
						//console.log(matches);
						if (matches) {
							damage_type = matches[3];
						}

						area_type = area;
						
						damage_multiplier = (type == 'minor' ? 2 : 4);
						
						let ps_text = '';

						if (has_improved_breath_weapon) {
							ps_tier_bonus = Math.max(ps_tier_bonus, 1);
							ps_text       = 'Improved Breath Weapon';
						}
						if (has_greater_breath_weapon) {
							ps_tier_bonus = Math.max(ps_tier_bonus, 2);
							ps_text       = 'Greater Breath Weapon';
						}
						if (has_epic_breath_weapon) {
							ps_tier_bonus = Math.max(ps_tier_bonus, 3);
							ps_text       = 'Epic Breath Weapon';
						}
						if (has_legendary_breath_weapon) {
							ps_tier_bonus = Math.max(ps_tier_bonus, 4);
							ps_text       = 'Legendary Breath Weapon';
						}
						
						damage_total = (pr_tier + 1 + ps_tier_bonus) * damage_multiplier;
						
						if (ps_text != '') {
							ps_text = `, plus ${ps_tier_bonus * damage_multiplier}d6 from the ${ps_text} passive skill`;
						}
						
						damage_description = `[[${damage_total} : This is ${damage_multiplier}d6, plus ${damage_multiplier}d6 per tier you have in Physical ` +
						`Resilience${ps_text}]]**d6**`;

						area_size = Math.max(Math.floor(pr_total / 4), 1);
						if (area_type.toLowerCase() == 'line') {
							area_size *= 2;
						}
						
						description   = `${area_type} (${area_size} sq), ${damage_type}`;
						recharge_roll = `1d6cs<${pr_tier}cf>${(pr_tier + 1)}`;
						damage_type   = capitalize_first_letter(damage_type);
					}

					setAttrs({
						[`${boon_name}_damage_multiplier`]:  damage_multiplier,
						[`${boon_name}_ps_tier_bonus`]:      ps_tier_bonus,
						[`${boon_name}_damage_total`]:       damage_total,
						[boon_damage_type_name]:             damage_type,
						[boon_damage_desc_name]:             damage_description,
						[boon_area_type_name]:               area_type,
						[`${boon_name}_description`]:        description,
						[`${boon_name}_recharge_roll`]:      recharge_roll
					});
				});
			});
			
			// Set breath weapon info
			let info_name = boon_name.replaceAll('_', '') + 'info';
			on(`clicked:${info_name}`, function() {
				getAttrs([boon_damage_type_name, boon_damage_desc_name, boon_area_type_name, 'pr_tier', 'pr_total'], function(values) {
					let pr_tier   = get_int_or_zero(values.pr_tier);
					let pr_total  = get_int_or_zero(values.pr_total);
					
					let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: " + capitalize_first_letter(type) + " Breath Weapon}} " +
					"{{Casting Time=2 AP}} {{Area Type=" + capitalize_first_letter(values[boon_area_type_name]) + 
					"}} {{Physical Resilience (fortitude)=**TN** " + skill_total_effect_pr(pr_total, 12) + "}} {{Damage=" + 
					values[boon_damage_desc_name] + " " + values[boon_damage_type_name] + " damage}} {{Recharge=" +
					tier_effect_pr(pr_tier, 1, '') + " or lower on 1d6}}'";
					
					startRoll(roll_text, (results) => {
						finishRoll(results.rollId);
					});
				});
			});
		}
	});
});

on("change:bb_corrosive_blood", function() {
	getAttrs(["bb_corrosive_blood", "pr_tier"], function(values) {
		let has_corrosive_blood = get_bool(values.bb_corrosive_blood);
		let tier = get_int_or_zero(values.pr_tier);

		let damage = '';

		if (has_corrosive_blood) {
			damage = ((tier + 1) * 2) + "d6";
		}
		
		setAttrs({ "corrosive_blood_damage": damage });
	});	
});

on("change:bb_desert_thirst", function() {
	getAttrs(["bb_desert_thirst", "mr_tier"], function(values) {
		let has_desert_thirst = get_bool(values.bb_desert_thirst);
		let tier = get_int_or_zero(values.mr_tier);

		let area_size = '';

		if (has_desert_thirst) {
			area_size = Math.max(2, tier);
		}
		
		setAttrs({ "desert_thirst_area_size": area_size });
	});	
});

let disease_attack_boon = boons_and_banes_array.find(b => b.name == 'bb_disease_attack');
if (disease_attack_boon) {
	for (let i = 1; i <= disease_attack_boon.max_count; i++) {
		// Set Disease Attack values for rolls
		let boon_name      = `bb_disease_attack_${i}`;
		let boon_raw_name  = `${boon_name}_raw`;
		let attack_name    = `${boon_name}_natural_attack`;
		let tn_name        = `${boon_name}_tn`;
		let duration_name  = `${boon_name}_duration`;
		let successes_name = `${boon_name}_successes`;
		let name_name      = `${boon_name}_name`;
		let get_array      = [boon_name, boon_raw_name];
		on('change:' + get_array.join(' change:'), function() {
			getAttrs(get_array, function(values) {
				let has_disease_attack = get_bool(values[boon_name]);
				let boon_raw_text      = values[boon_raw_name];
				let name               = '';
				let natural_attack     = '';
				let tier               = 0;
				let tn                 = 0;
				let successes          = 0;
				let duration           = '';
			
				if (has_disease_attack) {
					let regex   = /diseaseattack(\w+),tier(\d+),(\w+)/;
					let matches = parse_textarea(boon_raw_text).match(regex);
					//console.log(matches);
					name           = matches[3];
					tier           = get_int_or_zero(matches[2]);
					successes      = (tier < 3 ? tier : tier - 1);
					natural_attack = matches[1];
					tn             = 10 + (tier * 6);
					duration       = `[[${tier}]] week` + (tier == 1 ? '' : 's');
				}
				
				setAttrs({
					[attack_name]:         natural_attack,
					[`${boon_name}_tier`]: tier,
					[tn_name]:             tn,
					[duration_name]:       duration,
					[successes_name]:      successes,
					[name_name]:           name
				});
			});	
		});

		// Set Disease Attack info
		let info_name = boon_name.replaceAll('_', '') + 'info';
		on(`clicked:${info_name}`, function() {
			getAttrs([successes_name], function(values) {
				let successes   = get_int_or_zero(values[successes_name]);
				let suffix      = (successes == 1 ? '' : 'es');
				let detail_name = `${boon_name}_detail`;

				let roll_text = `/w @{character_name} '&{template:custom} {{title=@{character_name}: Disease Attack (@{${name_name}})}} ` +
				`{{Natural Attack=@{${attack_name}}}} {{Physical Resilience=TN [[@{${tn_name}}]]}} {{Duration=@{${duration_name}}}} ` +
				`{{Resist=[[@{${successes_name}}]] success${suffix}}} {{desc=@{${detail_name}}}}'`;
				startRoll(roll_text, (results) => {
					finishRoll(results.rollId);
				});
			});
		});
	}
}

movement_boon_array.forEach( function(bb) {
	let boon = boons_and_banes_array.find(b => b.search_text == bb.search_text);
	if (!boon) {
		return;
	}
	let boon_raw_name = `${boon.name}_raw`;
	on(`change:${boon_raw_name} change:agility_speed_modifier change:speed_temporary_modifier`, function() {
		getAttrs([boon.name, boon_raw_name, 'agility_speed_modifier', 'speed_temporary_modifier'], function(values) {
			let speed = 0;
			if (get_bool(values[boon.name])) {
				speed  = get_int_or_zero(values[boon_raw_name].split(boon.search_text)[1].split('sq')[0]);
				if (!boon.name.includes('movement')) {
					speed += get_int_or_zero(values.agility_speed_modifier) + get_int_or_zero(values.speed_temporary_modifier);
				}
			}
			setAttrs({ [`${boon.name}_speed`]: speed });
		});
	});
});

let gaze_attack_boon = boons_and_banes_array.find(b => b.name == 'bb_gaze_attack');
if (gaze_attack_boon) {
	for (let i = 1; i <= gaze_attack_boon.max_count; i++) {
		let boon_name      = `bb_gaze_attack_${i}`;
		let boon_raw_name  = `${boon_name}_raw`;
		let boon_area_size = `${boon_name}_area_size`;
		let boon_spell     = `${boon_name}_spell`;
		let boon_ep        = `${boon_name}_ep`;
		let get_array      =  [ boon_name, boon_raw_name, 'size_modifier_aura' ];
		on('change:' + get_array.join(' change:'), function() {
			getAttrs(get_array, function(values) {
				let has_gaze_attack = get_bool(values[boon_name]);
				let size_mod        = get_int_or_zero(values.size_modifier_aura);

				let area_size = '';
				let spell     = '';
				let ep        = '0';

				if (has_gaze_attack) {
					let regex   = /gazeattack(\w+),(\d+)ep/;
					let matches = values[boon_raw_name].match(regex);
					//console.log(matches);

					area_size = 7 + size_mod;
					spell     = matches[1];
					ep        = matches[2];
				}
				
				setAttrs({ 
					[boon_area_size]: area_size,
					[boon_spell]:     spell,
					[boon_ep]:        ep
				});
			});	
		});
		
		let info_name = boon_name.replaceAll('_', '') + 'info';
		on(`clicked:${info_name}`, function() {
			getAttrs(['mr_total', boon_area_size, boon_spell, boon_ep], function(values) {
				let mr_total = get_int_or_zero(values.mr_total);
				let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Gaze Attack}} {{Area=Nova (" + values[boon_area_size] + 
				" sq)}}" + "{{Spell effect=" + capitalize_first_letter(values[boon_spell]) + " (" + values[boon_ep] + " EP)}} {{Reflex=TN " + 
				skill_total_effect_mr(mr_total, 12) + "}} {{Duration=" + Math.floor(mr_total / 2) + " units}}" +
				"{{desc=The monster has a gaze attack, which affects targets that simply look into its eyes. The gaze causes a spell effect. Any creature that " +
				"comes within a " + values[boon_area_size] + "-square nova of the monster must make a resilience check to resist the spell effect each round. In " +
				"addition, the monster can spend 1 AP to focus its gaze on a single creature within the nova, forcing them to make another resilience check to resist " +
				"the spell effect." + _rn + "Creatures can attempt to avert their eyes while within the gaze attacks range, which gives them a 50% chance (6+ " +
				"on 1d10) each round to ignore the gaze and not need to make a resilience check. Any attacks or spells made by a creature averting their eyes that " +
				"target the monster automatically fail if the check is an odd number." + _rn + "Alternatively, creatures can blindfold themselves, in which " +
				"case they incur the blinded condition. In this case, they do not need to make resilience checks against the gaze attack." +
				"}}'";
				
				startRoll(roll_text, (results) => {
					finishRoll(results.rollId);
				});
			});
		});
	}
}

on('clicked:facehuggerinfo', function() {
	getAttrs(['size_modifier_skill'], function(values) {
		let target_size_index = Math.min((get_int_or_zero(values.size_modifier_skill) * -1) + 2, 2);
		let target_size_array = ['Medium', 'Large', 'Huge'];
		let target_size = target_size_array[target_size_index];
		let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Facehugger}} {{desc=The monster is a facehugger - a creature that completely " +
		`engulfs a humanoid creatures head. This facehugger can only target the heads of humanoid creatures up to ${target_size} size. Facehuggers either fly towards ` +
		"(Fly boon), jump towards (Pounce passive skill), or drop on (Climb boon) their targets." + _rn + "The facehug attack is an Attack (grapple) check made at " +
		"advantage. Creatures wearing helmets (assume medium and heavy armor includes a helmet) will not be targeted by facehuggers unless they are the only targets, and " +
		"they gain great advantage on their Defend checks against a facehug attack." + _rn + "If a facehug attack is successful, the target creature is considered blind, " +
		"grappled, and begins to suffocate. The facehugger is also considered to be grappling, and automatically causes damage as a two-handed melee attack each round. " +
		"Attacks against a grappling facehugger deal half damage to the facehugger and half to the grappled creature." + _rn + "Creatures can attempt to pull the " +
		"facehugger off a grappled creature, which takes a successful Attack (grapple) or Athletics (feat) check versus the facehuggers Attack (grapple) check, made at " +
		"great advantage. If successful, the grappled creature takes damage as if critically hit with the facehuggers Attack (two-handed melee) check.}}'";
		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("change:bb_huge_size change:bb_large_size change:bb_small_size change:bb_tiny_size", function() {
	getAttrs(["bb_huge_size", "bb_large_size", "bb_small_size", "bb_tiny_size"], function(values) {
		let huge_size  = get_bool(values.bb_huge_size);
		let large_size = get_bool(values.bb_large_size);
		let small_size = get_bool(values.bb_small_size);
		let tiny_size  = get_bool(values.bb_tiny_size);
		
		let size_modifier_skill  = (large_size ? -1 : (small_size ? 1 : (huge_size ? -2 : (tiny_size ? 2 : 0))));
		let size_modifier_damage = size_modifier_skill * -1;
		let size_modifier_hp     = (large_size ? 10 : (small_size ? -10 : (huge_size ? 30 : (tiny_size ? -20 : 0))));
		let size_modifier_aura   = (huge_size ? 2 : (large_size ? 1 : 0 ));
		let size_modifier_speed  = (huge_size ? 1 : 0 );

		setAttrs({
			"size_modifier_skill":  size_modifier_skill,
			"size_modifier_damage": size_modifier_damage,
			"size_modifier_hp" :    size_modifier_hp,
			"size_modifier_aura":   size_modifier_aura,
			"size_modifier_speed":  size_modifier_speed
		});
	});
});

function get_lair_action_effect_stats(lair_action_effect_raw) {
	let lair_action_effect = lair_action_effect_raw;
	let is_damage = false;
	if (damage_type_list.includes(lair_action_effect_raw)) {
		lair_action_effect = lair_action_effect_raw + ' damage';
		is_damage = true;
	}
	else if (lair_action_effect_raw.includes('slowed')) {
		lair_action_effect = `slowed (-${lair_action_effect_raw.substring(6, 7)} AP)`;
	}
	
	var lair_action_effect_stats = {
		'effect':    lair_action_effect,
		'is_damage': is_damage
	};
	
	return lair_action_effect_stats;
}

let lair_action_boon = boons_and_banes_array.find(b => b.name == 'bb_lair_action');
if (lair_action_boon) {
	for (let i = 1; i <= lair_action_boon.max_count; i++) {
		let boon_name      = `${lair_action_boon.name}_${i}`;
		let boon_raw_name  = `${boon_name}_raw`;
		let get_array      = [boon_name, boon_raw_name, 'pr_total', 'pr_tier'];
		on('change:' + boon_raw_name, function() {
			getAttrs(get_array, function(values) {
				let pr_total = get_int_or_zero(values.pr_total);
				let pr_tier  = get_int_or_zero(values.pr_tier);
			
				let description = '';
				let range       = 0;
				let area        = '';
				let condition   = '';
				let damage_type = '';
				let damage      = '';
				let duration    = '';
				let resist      = 0;
				let text        = '';
				let roll_text   = '';
				
				if (get_bool(values[boon_name])) {
					let regex = /lairaction([a-z]+),([a-z]+),([\w]+)/;
					let matches = values[boon_raw_name].match(regex);
					console.log(matches);

					description = matches[1];
					range       = pr_total;
					area        = get_area(matches[2], Math.floor(pr_total / 4));
					duration    = Math.min(pr_tier, 3);
					resist      = 12 + pr_total;
					text        = `${matches[1]}, ${area}, `;

					let effect = matches[3];
					if (effect.includes('and')) {
						const effects = effect.split('and');
						var effect1_stats = get_lair_action_effect_stats(effects[0]);
						var effect2_stats = get_lair_action_effect_stats(effects[1]);
						if (effect1_stats.is_damage) {
							damage_type = effect1_stats.effect;
							condition = effect2_stats.effect;
						}
						else {
							damage_type = effect2_stats.effect;
							condition = effect1_stats.effect;
						}
					}
					else {
						var effect_stats = get_lair_action_effect_stats(effect);
						if (effect_stats.is_damage) {
							damage_type = effect_stats.effect;
						}
						else {
							condition = effect_stats.effect;
						}
					}
					
					if (damage_type) {
						damage = `${((pr_tier + 1) * 2)}d6`;
						text  += `${damage} ${damage_type}`;
						if (condition) {
							text += ' and ';
						}
					}
					if (condition) {
						text += condition;
					}
					
					let roll_damage    = (damage_type ? `{{${capitalize_first_letter(damage_type)}=[[${damage}]]}} ` : '');
					let roll_condition = (condition   ? `{{Condition=${capitalize_first_letter(condition)}}} {{Duration=Short rest ([[${duration}]] successes)}} ` : '');

					roll_text = "@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Lair Action (" + description + ")}} " +
					"{{Range=[[" + range + "]] squares}} {{Area=" + capitalize_first_letter(area) + "}} {{Physical Resilience (fortitude)=**TN** [[" + 
					resist + "]]}} " + roll_damage + roll_condition + "{{desc=A lair action is a special action that happens once per round at 30 in " +
					"Reflex order. This does not cost the monster any AP. }}'";
				}

				setAttrs({ 
					[`${boon_name}_range`]:       range,
					[`${boon_name}_description`]: description,
					[`${boon_name}_duration`]:    duration,
					[`${boon_name}_area`]:        area,
					[`${boon_name}_resist`]:      resist,
					[`${boon_name}_text`]:        text,
					[`${boon_name}_damage_type`]: damage_type,
					[`${boon_name}_damage`]:      damage,
					[`${boon_name}_condition`]:   condition,
					[`${boon_name}_roll_text`]:   roll_text
				});
			});
		});
	}
}

let poison_attack_boon = boons_and_banes_array.find(b => b.name == 'bb_poison_attack');
if (poison_attack_boon) {
	for (let i = 1; i <= poison_attack_boon.max_count; i++) {
		let boon_name           = `bb_poison_attack_${i}`;
		let boon_raw_name       = `${boon_name}_raw`;
		let boon_natural_weapon = `${boon_name}_natural_weapon`;
		let boon_tier           = `${boon_name}_tier`;
		let boon_type           = `${boon_name}_type`;
		let boon_TN             = `${boon_name}_TN`;
		let boon_duration       = `${boon_name}_duration`;
		let boon_damage         = `${boon_name}_damage`;
		let boon_condition      = `${boon_name}_condition`;
		let boon_roll_text      = `${boon_name}_roll_text`;
		on(`change:${boon_raw_name}`, function() {
			getAttrs([ boon_name, boon_raw_name ], function (values) {
				let has_poison_attack = get_bool(values[boon_name]);

				let natural_weapon = '';
				let tier           = 0;
				let type           = '';
				let TN             = 0;
				let duration       = 0;
				let damage         = '';
				let condition      = null;
				let roll_text      = '';

				if (has_poison_attack) {
					let regex   = /poisonattack(\w+),tier(\d+)(\w+)/;
					let matches = values[boon_raw_name].match(regex);
					//console.log(matches);
					
					natural_weapon = matches[1];
					tier           = get_int_or_zero(matches[2]);
					type           = matches[3];
					TN             = 10 + (tier * 6);
					let plural     = (tier == 1 ? '' : 'es');
					duration       = `Short rest${_n}(${tier} success${plural})`;
					if (tier == 4) {
						duration = (type == 'sleep' || type == 'kill' ? 'Instantaneous' : 'Short rest');
					}
				
					if (type == 'damage') {
						damage = (tier + 1) + 'd6';
					}
					else if (type == 'sleep') {
						condition = (tier < 4) ? 'sleepy' : 'asleep';
					}
					else if (type == 'slow') {
						if (tier < 4) {
							let AP = Math.ceil(tier / 2);
							condition = 'slowed (-' + AP + ' AP)';
						}
						else {
							condition = 'paralyzed';
						}
					}
					else if (type == 'sick') {
						condition = (tier < 3) ? 'sickened' : (tier < 4) ? 'fatigued & sickened' : 'nauseated';
					}
					else if (type == 'kill') {
						condition = (tier < 3) ? 'fatigued' : (tier < 4) ? 'fatigued & sickened' : 'dead';
					}
					
					let effect = (type == 'damage') ? '[[' + damage + ']] poison damage' : condition;
					roll_text = "@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Poison Attack}} {{Physical Resilience (constitution)=TN " + TN + 
					"}} {{Effect=" + effect + "}} {{Duration=" + duration + "}}'";
				}
				
				setAttrs({
					[boon_natural_weapon]: natural_weapon,
					[boon_tier]:           tier,
					[boon_type]:           type,
					[boon_TN]:             TN,
					[boon_duration]:       duration,
					[boon_damage]:         damage,
					[boon_condition]:      condition,
					[boon_roll_text]:      roll_text
				});
			});
		});

		let info_name = boon_name.replaceAll('_', '') + 'info';
		on(`clicked:${info_name}`, function() {
			getAttrs([boon_natural_weapon, boon_tier, boon_type, boon_TN, boon_duration, boon_damage, boon_condition], function(values) {
				let damage_poison  = (values[boon_type] == "damage");
				let effect         = damage_poison ? values[boon_damage] + " poison damage" : values[boon_condition];
				let poison_tier    = get_int_or_zero(values[boon_tier]);
				let attack_text    = `your ${values[boon_natural_weapon]} attack`;
				let touch_text     = '';
				let success_text   = (poison_tier == 4 ? '' : ' If they roll the specified number of successes, they have processed the poison and no longer suffer its effects.');
				
				if (values[boon_natural_weapon] == 'touch') {
					attack_text = 'any of your natural attacks';
					touch_text  = _rn + 'Your poison can be delivered by any physical contact with you, so any creature touching you at all would have to make a ' +
					'Physical Resilience (constitution) check or be poisoned. This also applies to the following made by or against you: unarmed attacks, ' +
					'Attack (grapple and reposition) checks, and anything else the GM decides.';
				}
				
				let roll_text = "/w @{character_name} '&{template:custom} {{title=@{character_name}: Poison Attack}} " +
				"{{Natural weapon=" + capitalize_first_letter(values[boon_natural_weapon]) + "}} {{Type= " + capitalize_first_letter(values[boon_type]) + 
				"}} {{Tier=" + poison_tier + "}} {{Physical Resilience (constitution)=TN " + values[boon_TN] + "}}  {{Effect=" + effect + "}} {{Duration=" + 
				values[boon_duration] + "}}" + 
				"{{desc=When a creature is damaged by " + attack_text + ", they must make a Physical Resilience " +
				"(constitution) check against the poison's TN or suffer the effects. Until the poison's duration runs out, the creature must make another check " +
				"each round. " + success_text + _rn +
				"If you poison the same target multiple times with this attack, the target suffers disadvantage on resilience checks against your poison until " +
				"its next short rest." + touch_text + "}}'";
				startRoll(roll_text, (results) => {
					finishRoll(results.rollId);
				});
			});
		});
	}
}

on("change:bb_regenerate", function() {
	getAttrs(['bb_regenerate', 'bb_regenerate_raw'], function(values) {
		let has_regenerate = get_bool(values.bb_regenerate);
		//console.log(`bb_regenerate: ${values.bb_regenerate}; has_regenerate: ${has_regenerate}`);
		let healing = '0';
		let vulnerability = '';

		if (has_regenerate) {
			let regex = /regenerate(\d+?d6),(\w+)/;
			let matches = values.bb_regenerate_raw.match(regex);
			//console.log(matches);
			healing = matches[1];
			vulnerability = matches[2];
			vulnerability = vulnerability.replace('and', ' and ').replace('or', ' or ').replace('coldiron', 'cold iron');
		}

		setAttrs({
			'regenerate_healing':       healing,
			'regenerate_vulnerability': vulnerability
		});
	});	
});

on('clicked:rollregeneratehealing', function() {
	getAttrs(['hit_points', 'hit_points_max', 'regenerate_healing'], function(values) {
		let hp      = get_int_or_zero(values.hit_points);
		let hp_max  = get_int_or_zero(values.hit_points_max);
		
		startRoll("@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Regenerate Healing}} {{HP=[[" + values.regenerate_healing + "]]}}'", (results) => {
			setAttrs({ 'hit_points': Math.min(hp + results.results.HP.result, hp_max) });
			finishRoll(results.rollId);
		});
	});
});

on("change:bb_swallow_whole", function() {
	getAttrs(["bb_swallow_whole", "hit_points", "pr_total", "pr_tier"], function(values) {
		let has_swallow_whole = get_bool(values.bb_swallow_whole);
		let hit_points = get_int_or_zero(values.hit_points);
		let pr_total   = get_int_or_zero(values.pr_total);
		let pr_tier    = get_int_or_zero(values.pr_tier);
		
		let damage = '';
		let tn = 0;
		let hp = 0;
		let roll_text = '';

		if (has_swallow_whole) {
			damage = ((pr_tier + 1) * 2) + "d6";
			tn = 12 + pr_total;
			hp = Math.floor(hit_points / 10);
			roll_text = "@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Swallow Whole}} {{Chemical damage=[[" + damage + "]]}}'";
		}

		setAttrs({
			"swallow_whole_damage":    damage,
			"swallow_whole_tn":        tn,
			"swallow_whole_hp":        hp,
			"swallow_whole_roll_text": roll_text
		});
	});	
});

on("change:bb_swarm", function() {
	getAttrs(["bb_swarm", "bb_swarm_raw", "pr_tier"], function(values) {
		let has_swarm = get_bool(values.bb_swarm);
		let pr_tier   = get_int_or_zero(values.pr_tier);
		
		let swarm_hp_multiplier = 1;
		let reform_roll         = '';
		let roll_text           = '';

		if (has_swarm) {
			swarm_hp_multiplier = (values.bb_swarm_raw.includes('nonflying') ? 3 : 7);
			reform_roll = `1d6cs<${pr_tier}cf>${(pr_tier + 1)}`;
			roll_text = "@{gm_rolls_text}'&{template:custom} {{title=@{character_name}: Swarm Reform}} {{Reform=[[" + reform_roll + "]]}}'";
		}

		setAttrs({ 
			"swarm_reform_roll_text": roll_text,
			"swarm_hp_multiplier":    swarm_hp_multiplier
		});
	});	
});

on('clicked:resetswarmhp', function() {
	getAttrs(['swarm_hp_multiplier', 'hit_points_max', 'hit_points_extra'], function(values) {
		setAttrs({ 'hit_points_extra': 
			get_int_or_zero(values.swarm_hp_multiplier) * (get_int_or_zero(values.hit_points_max) - get_int_or_zero(values.hit_points_extra)) });
	});
});

// Overall character CP calc
const cp_calc_attr_array = ['cp_combat_attributes', 'cp_non_combat_attributes', 'cp_combat_skills', 'cp_non_combat_skills', 'cp_vital_stats', 'cp_damage_types', 'cp_area_types', 'cp_spell_statistics', 'cp_combat_passives', 'cp_non_combat_passives', 'cp_combat_boons_banes', 'cp_non_combat_boons_banes', 'cp_proficiencies'];
on('change:' + cp_calc_attr_array.join(' change:'), function() {
	getAttrs(cp_calc_attr_array, function(values) {
		let cp_cs_atts     = get_int_or_zero(values.cp_combat_attributes      );
		let cp_ncs_atts    = get_int_or_zero(values.cp_non_combat_attributes  );
		let cp_cs_skills   = get_int_or_zero(values.cp_combat_skills          );
		let cp_ncs_skills  = get_int_or_zero(values.cp_non_combat_skills      );
		let cp_vital_stats = get_int_or_zero(values.cp_vital_stats            );
		let cp_cs_pass     = get_int_or_zero(values.cp_combat_passives        );
		let cp_ncs_pass    = get_int_or_zero(values.cp_non_combat_passives    );
		let cp_cs_bb       = get_int_or_zero(values.cp_combat_boons_banes     );
		let cp_ncs_bb      = get_int_or_zero(values.cp_non_combat_boons_banes );
		let cp_damage      = get_int_or_zero(values.cp_damage_types           );
		let cp_area_types  = get_int_or_zero(values.cp_area_types             );
		let cp_spell_stats = get_int_or_zero(values.cp_spell_statistics       );
		let cp_profs       = get_int_or_zero(values.cp_proficiencies          );

		let combat_score     = (cp_cs_atts + cp_cs_skills + cp_vital_stats + cp_cs_pass + cp_cs_bb + cp_damage) / 10;
		let non_combat_score = (cp_ncs_atts + cp_ncs_skills + cp_ncs_pass + cp_ncs_bb + cp_area_types + cp_profs + cp_spell_stats) / 10;
		
		let cp_total = cp_cs_atts + cp_ncs_atts + cp_cs_skills + cp_ncs_skills + cp_vital_stats + cp_cs_pass + cp_ncs_pass + cp_cs_bb + cp_ncs_bb +
					   cp_damage + cp_area_types + cp_spell_stats + cp_profs;
		
		console.log(`CP: ${cp_total}; CS: ${combat_score}; NCS: ${non_combat_score}`);
		
		setAttrs({
			'cp_total':         cp_total,
			'combat_score':     Math.round(combat_score),
			'non_combat_score': Math.round(non_combat_score)
		});
	});
});

on("clicked:toggledamagetypes", function() {
	let getAttrs_array_training = [];
	let getAttrs_array_show     = [];
	damage_type_array.forEach( function(damage_type) {
		getAttrs_array_training.push(`damage_type_${damage_type.name}`);
		getAttrs_array_show.push(`show_damage_type_${damage_type.name}`);
	});

	getAttrs(getAttrs_array_training.concat(getAttrs_array_show), function(values) {

		let any_hidden = false;
		getAttrs_array_show.forEach( function(show) {
			any_hidden = any_hidden ||= !values[show];
		});

		for (let i = 0; i < getAttrs_array_show.length; i++) {
			setAttrs({
				[getAttrs_array_show[i]]: (any_hidden ? true : values[getAttrs_array_training[i]] == 'on'),
			});
		}
	});
});

on("clicked:togglemagicskills", function() {

	let active_skill_names = []
	active_skill_array.forEach( function(skill) {
		if (skill.passive_skill && skill.passive_skill.includes('magic'))  {
			active_skill_names.push(skill.name);
		}
	});
	
	toggle_skills(active_skill_names);
});

function get_attack_combat_style_info(combat_style, combat_style_info) {
	let missile_info = "";
	if (combat_style.toLowerCase().includes("missile")) {
		missile_info = _rn + "**Missile Attack Special Rules**" + _bull + "Missile weapons have a range, which represents the " +
		"range of a normal attack. They have a maximum range of double the normal range. You can attack a target between the normal and maximum " +
		"range with disadvantage on the Attack check, but cannot attack beyond the weapons maximum range." + _bull + "Attacking an enemy " +
		"with cover incurs disadvantage. Cover is an occupied space, partial wall or doorway, etc., and is subject to GM discretion." + _bull + 
		"You can spend 3 AP to aim before attacking with a missile weapon, and if your very next AP is used to attack, you gain advantage on the " +
		"Attack check. Aiming requires concentration, and if you are disrupted you must make a Mental Resilience (concentration) check or lose advantage.";
		if (combat_style.toLowerCase().includes("two")) {
			missile_info += _bull + "Two-handed triggered missile weapons (e.g. crossbow, rifle) ignore [[4]] points of DR (physical).";
		}
		else {
			missile_info += _bull + "One-handed triggered missile weapons (e.g. pistol) ignore [[2]] points of DR (physical).";
		}
	}
	let info = "/w @{character_name} '&{template:custom} {{title=Attack (" + combat_style + ") info}} " +
	"{{desc=You can spend one Action Point to make an attack using the " + combat_style + " combat style. You make an Attack (" + combat_style + ") " +
	"check against your opponents Defend check. If successful, you cause damage as per your weapon and combat style. " + combat_style_info +
	get_crit_text('you cause extra damage, based on how much higher your Attack check is than your opponents Defend check.' + _bull + '10 points higher: ' +
	'double your rolled damage' + _bull + '20 points higher: your maximum damage + your rolled damage' + _bull + '30+ points higher: double your maximum damage', 
	'[fumble] (you cannot use the same weapon again until you do).') + missile_info +
	spend_pool_attack('do the following:' + _bull + 'Increase the damage of your attack by +1 damage per 1 pool point spent' + _bull + 
	'Increase the damage of your attack by +1d6 damage per 2 pool points spent' + _bull + 'Draw or stow one weapon without using an Action Point ' +
	'per 2 pool points spent' + _bull + 'Reduce the time to reload a triggered weapon by 1 AP per 2 pool points spent' + _bull + 'Make a free attack on ' +
	'an enemy leaving your threatened area; this costs 1 pool point for the first attack, and increases by +1 pool point per successive free attack') + "}}";
	return info;
}

function get_1h_missile_range_descripiton(tier, mod, trained, attribute_name) {
	console.log("missle range description: tier: " + tier + "; mod: " + mod + "; trained: " + trained);
	let desc = tier_effect_combat_range(trained, tier, 10, 2, 'triggered') + tier_effect_combat_range(trained, tier, 1, 1, 'thrown', attribute_name, mod)
	return desc;
}

function get_attack_dw_info(type, tier, mod = 0, trained = false, attribute_name = "Physique") {
	let type_lower = type.toLowerCase();
	let info = header_text('Dual Wield ' + type) + "You wield a one-handed " + type_lower + " weapon in each hand. Each time you " +
	"attack, you can choose which weapon to attack with. If you spend all 3 AP attacking, you can choose " + tier_effect_combat(tier, 1, 2) + 
	" of your Action Points to make an attack with each weapon; when you do so, all of your attacks are considered " +
	"secondary attacks and suffer disadvantage.";
	if (type_lower == "missile") {
		info += get_1h_missile_range_descripiton(tier, mod, trained, attribute_name);
		info = info.replaceAll("[combat style]", "dual wield " + type_lower);
	}
	return get_attack_combat_style_info("dual wield " + type_lower, info); 
}

function get_attack_free_hand_info(type, tier, mod = 0, trained = false, attribute_name = "Physique") {
	let type_lower = type.toLowerCase();
	let skill_plural = (tier >= 2 ? "s" : "");
	let info = header_text('Free Hand ' + type) + "You wield a one-handed " + type_lower + " weapon in one hand and keep the other hand " +
	"free. You gain " + tier_effect_attack(tier, 1, '') + " free floating skill pool point" + skill_plural + 
	" each round, each of which can be treated as if it were a pool point in either Attack or Defend.";
	if (type_lower == "missile") {
		info += get_1h_missile_range_descripiton(tier, mod, trained, attribute_name);
		info = info.replaceAll("[combat style]", "free hand " + type_lower);
	}
	return get_attack_combat_style_info("free hand " + type_lower, info); 
}

function get_attack_with_shield_info(type, tier, mod = 0, trained = false, attribute_name = "Physique") {
	let type_lower = type.toLowerCase();
	let info = header_text(type + ' with Shield') + "You wield a one-handed " + type_lower + " weapon in one hand, and a shield in the other. " +
	`You gain ${tier_effect_attack(tier, 1, ' bonus Defend pool points')}, which you can only use to reduce damage.`;
	if (type_lower == "missile") {
		info += get_1h_missile_range_descripiton(tier, mod, trained, attribute_name);
		info = info.replaceAll("[combat style]", type_lower + " with shield");
	}
	return get_attack_combat_style_info(type_lower + " with shield", info); 
}

function get_attack_two_handed_info(type, tier, trained = false) {
	let type_lower = type.toLowerCase();
	let melee_info = "";
	if (type_lower == "melee") {
		melee_info = "You gain " + tier_effect_combat(tier, 1, 2, 'd6', '+') + " damage on each attack. " +
		"If youre wielding a polearm, you can attack opponents 2 squares away, but suffer great disadvantage attacking adjacent opponents.";
	}
	let info = header_text('Two-Handed ' + type) + "You wield a  " + type_lower + " weapon in two hands. " + melee_info;
	if (type_lower == "missile") {
		if (tier >= 3) {
			info += "You gain +1d6 damage on each attack.";
		}
		info += tier_effect_combat_range(trained, tier, 20, 4).replace('[combat style]', 'two-handed missile');
	}
	return get_attack_combat_style_info("two-handed " + type_lower, info); 
}

on("clicked:attackdwmeleeinfo", function() {
	getAttrs(["attack_total", "attack_tier"], function(values) {
		let total     = get_int_or_zero(values.attack_total);
		let tier      = get_int_or_zero(values.attack_tier);
		let roll_text = get_attack_dw_info("Melee", tier);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attackdwmissileinfo", function() {
	getAttrs(["attack_total", "attack_tier", "attack_attribute_modifier", "attack_attribute_name", "attack_dw_missile_training"], function(values) {
		let total     = get_int_or_zero(values.attack_total);
		let tier      = get_int_or_zero(values.attack_tier);
		let mod       = get_int_or_zero(values.attack_attribute_modifier);
		let trained   = (values.attack_dw_missile_training == 'on');
		let roll_text = get_attack_dw_info("Missile", tier, mod, trained, values.attack_attribute_name);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attackfreehandmeleeinfo", function() {
	getAttrs(["attack_total", "attack_tier"], function(values) {
		let total     = get_int_or_zero(values.attack_total);
		let tier      = get_int_or_zero(values.attack_tier);
		let roll_text = get_attack_free_hand_info("Melee", tier);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attackfreehandmissileinfo", function() {
	getAttrs(["attack_total", "attack_tier", "attack_attribute_modifier", "attack_attribute_name", "attack_free_hand_missile_training"], function(values) {
		let total     = get_int_or_zero(values.attack_total);
		let tier      = get_int_or_zero(values.attack_tier);
		let mod       = get_int_or_zero(values.attack_attribute_modifier);
		let trained   = (values.attack_free_hand_missile_training == 'on');
		let roll_text = get_attack_free_hand_info("Missile", tier, mod, trained, values.attack_attribute_name);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attackmeleewithshieldinfo", function() {
	getAttrs(["attack_total", "attack_tier"], function(values) {
		let total     = get_int_or_zero(values.attack_total);
		let tier      = get_int_or_zero(values.attack_tier);
		let roll_text = get_attack_with_shield_info("Melee", tier);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attackmissilewithshieldinfo", function() {
	getAttrs(["attack_total", "attack_tier", "attack_attribute_modifier", "attack_attribute_name", "attack_missile_with_shield_training"], function(values) {
		let total     = get_int_or_zero(values.attack_total);
		let tier      = get_int_or_zero(values.attack_tier);
		let mod       = get_int_or_zero(values.attack_attribute_modifier);
		let trained   = (values.attack_missile_with_shield_training == 'on');
		let roll_text = get_attack_with_shield_info("Missile", tier, mod, trained, values.attack_attribute_name);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attacktwohandedmeleeinfo", function() {
	getAttrs(["attack_total", "attack_tier"], function(values) {
		let total     = get_int_or_zero(values.attack_total);
		let tier      = get_int_or_zero(values.attack_tier);
		let roll_text = get_attack_two_handed_info("Melee", tier);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attacktwohandedmissileinfo", function() {
	getAttrs(["attack_total", "attack_tier", "attack_two_handed_missile_training"], function(values) {
		let total     = get_int_or_zero(values.attack_total);
		let tier      = get_int_or_zero(values.attack_tier);
		let trained   = (values.attack_two_handed_missile_training == 'on');
		let roll_text = get_attack_two_handed_info("Missile", tier, trained);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attackgrappleinfo", function() {
	getAttrs(["attack_total"], function(values) {
		let total     = get_int_or_zero(values.attack_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Attack (grapple) info}} " +
		"{{Escape=An Attack (grapple) check or a Sneak (escapology) check to end the grapple or escape a hold}} " +
		"{{Hold=An Attack (grapple) check to get your foe in a hold  while in a hold you suffer disadvantage on physical " +
		"actions associated with the grapple; hold must be escaped before grapple can be ended}} " +
		"{{Attack=An Attack (free hand melee), Attack (reposition), or Dynamancy (attack) basic attack check against your foe}} " +
		"{{desc=You can spend one Action Point to engage an opponent in a grapple. You make an Attack (grapple) check versus their " +
		"Attack (grapple) or Defend check, and if you succeed you are grappling." + _rn + "While grappling, you and your foe suffer disadvantage " +
		"on all Physique and Agility skill checks other than Physical Resilience and those associated with the grapple itself. Neither " +
		"of you gain the advantage of a shield if you are carrying one." + _rn + "Once you are engaged in a grapple, you and your opponent can " +
		"spend one Action Point to make any one of the actions listed above. " +
		_rn + "If you use Attack more than once in a round, any time after the first incurs disadvantage. }}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attackrepositioninfo", function() {
	getAttrs(["attack_total", "attack_attribute_modifier", "attack_attribute_name", "speed_total"], function(values) {
		let total          = get_int_or_zero(values.attack_total);
		let attribute_name = values.attack_attribute_name;
		let mod            = get_int_or_zero(values.attack_attribute_modifier);
		let speed          = get_int_or_zero(values.speed_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Attack (reposition) info}} " +
		"{{Spin=Move an adjacent opponent to any other square adjacent to you, provided they have a clear path of adjacent squares in between. " +
		"If you fail, your opponent does not move at all.}} " +
		"{{Move=Move your opponent directly away from you or directly towards you, up to " + 
		value_effect(attribute_name + ' modifier (minimum 1, maximum your normal movement speed)', Math.max(1, Math.min(mod, speed)))  + 
		" **squares**. You move with your opponent when repositioning, If you fail, your opponent does " +
		"not move at all.}} " +
		"{{Bull Rush=Move through an opponents square as part of your normal movement, which costs you 2 squares of movement. Failure means your movement stops before their square.}} " +
		"{{desc=You can spend one Action Point to push, pull or shove past an adjacent opponent who is no more than one size category larger " +
		"than you. You make an Attack (reposition) check versus their Attack (reposition) check, and do one of the actions listed above. " +
		spend_pool_attack("move more squares as part of a reposition at a cost of 1 point per additional square of movement (though you still cannot " +
		"move more than your normal movement speed).") +
		_rn + "If you use Attack more than once in a round, any time after the first incurs disadvantage. }}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:attacktacticalcombatinfo", function() {
	getAttrs(["attack_total", "attack_attribute_modifier", "attack_attribute_name"], function(values) {
		let total          = get_int_or_zero(values.attack_total);
		let attribute_name = values.attack_attribute_name;
		let mod            = get_int_or_zero(values.attack_attribute_modifier);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Attack (tactical combat) info}} " +
		"{{Disarm=You disarm your opponent of one item they are holding, and the item falls to the ground. Your Attack (tactical combat) check " +
		"is opposed by their Attack (tactical combat) check." + get_crit_text('you choose *one* of the following:' + _bull + 'The item is knocked away ' + 
		value_effect(attribute_name + ' modifier', mod, true, 1) + ' squares in a random direction.' + _bull + 'If you have a hand free, you are now ' +
		'holding the item.', '[fumble].') + "}} " +
		"{{Feint=You use your body language to trick an opponent into thinking youre going to do something other than your real intention, " +
		"granting you advantage on your next Attack check versus that opponent (this is an exception to the rule that every Attack check after " +
		"the first suffers disadvantage). Your Attack (tactical combat) check is opposed by their Attack " +
		"(tactical combat) check." + get_crit_text('you gain advantage on your next two Attack checks versus that opponent.', '[fumble].') + "}} " +
		"{{Knockdown=You trip or bowl over your opponent, knocking them prone. Your Attack (tactical combat) check is opposed by their Attack " +
		"(tactical combat) or Defend check." + get_crit_text('your opponent also drops one item they are holding.', '[fumble].') + "}} " +
		"{{desc=You can spend one Action Point to perform a tactical combat action. You make an Attack (tactical combat) check against your foe, " +
		"opposed by one or more skills, depending on which action you take. The actions available are listed above.  " +
		_rn + "If you use Attack more than once in a round, any time after the first incurs disadvantage. }}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

function get_defend_text() {
	return get_crit_text('turns the Attack check into a critical failure, if applicable.', 
	'turns the Attack check into a critical success, if applicable.') +
	spend_pool('Defend', 'turn a failed Defend check into a glancing blow, granting you DR against the attack. You gain DR 2 for every 1 point ' +
	'spent. This DR counts against any damage type, stacks with other DR you have, and applies to the total sum of damage dealt by the attack.');
}

on("clicked:defendblockinfo", function() {
	getAttrs(["defend_total"], function(values) {
		let total = get_int_or_zero(values.defend_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Defend (block) info}} {{Block=TN Attack check}} " +
		"{{desc=You block an attack with a shield, parry it with a weapon, or intercept it with an item or even your bare hands. This does not cost " +
		"any Action Points. If you are not holding a melee weapon or other object you could reasonably use to block (GMs discretion), you suffer " +
		"disadvantage on Defend (block) checks. If you have the Brawl passive skill and the Natural Attack boon, you are treated as if always " +
		"carrying a melee weapon.  " + _rn + "Training in this skill application gives you proficiency with shields; if you carry a shield, you gain " +
		"advantage on Defend (block) checks. " + get_defend_text() + " }}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:defenddodgeinfo", function() {
	getAttrs(["defend_total"], function(values) {
		let total = get_int_or_zero(values.defend_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Defend (dodge) info}} " +
		"{{Dodge=TN Attack check}} " +
		"{{desc=You avoid an attack entirely. This does not cost any Action Points. You suffer disadvantage on Defend (dodge) checks when wearing " +
		"medium or heavy armor (this stacks with encumbrance, if applicable). " + get_defend_text() + " }}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

function get_pr_text() {
	return spend_pool('Physical Resilience', 'reduce the damage caused by a failed Physical Resilience check, granting you DR against the ' +
	'attack. You gain DR 2 for every 1 point spent. This DR counts against any damage type, stacks with other DR you have, and applies to ' +
	'the total sum of damage dealt by the poison, disease, spell or effect.');
}

on("clicked:prconstitutioninfo", function() {
	getAttrs(["pr_total"], function(values) {
		let total = get_int_or_zero(values.pr_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Physical Resilience (constitution) info}} " +
		"{{Constitution=TN per GM}} " +
		"{{desc=You make a Physical Resilience (constitution) check to defend against poison, disease or the effects of extreme temperatures. " +
		"It does not cost any Action Points. The Target Number is set by the effect to be resisted. " + 
		get_crit_text('you gain advantage on the next check you make against the same situation, poison or disease.',
		'you suffer disadvantage on the next check you make against the same situation, poison or disease.') +
		get_pr_text() + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:prfortitudeinfo", function() {
	getAttrs(["pr_total"], function(values) {
		let total = get_int_or_zero(values.pr_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Physical Resilience (fortitude) info}} " +
		"{{Fortitude=TN per spell or effect}} " +
		"{{desc=You make a Physical Resilience (fortitude) check to defend against supernatural attacks that affect your body. This includes " +
		"poisons and diseases if they are supernatural or from a supernatural source. It does not cost any Action Points. The Target Number is " +
		"set by the spell or effect to be resisted. " + get_crit_text('turns the magic skill check into a critical failure, if applicable.',
		'turns the magic skill check into a critical success, if applicable.') +
		_rn + _star + " If you are affected by a spell or effect that lasts more than one round because you failed a Physical " +
		"Resilience (fortitude) check, you can spend 3 points from your Physical Resilience pool to grant yourself another check at " +
		"disadvantage to resist the effect. This Physical Resilience (fortitude) check occurs at the end of your turn and does not cost any " +
		"Action Points." + get_pr_text() + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:mrconcentrationinfo", function() {
	getAttrs(["mr_total"], function(values) {
		let total = get_int_or_zero(values.mr_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Mental Resilience (concentration) info}} " +
		"{{Concentrate=TN damage taken or per GM}} " +
		"{{desc=You make a Mental Resilience (concentration) check in response to being interrupted when youre trying to concentrate. " +
		"It does not cost any Action Points. The most common situations are when you take damage while you are trying to cast a spell " +
		"or aim a missile weapon. " +
		_rn + "The Target Number in this case is equal to the amount of damage you take. Other disruptive things might also " +
		"threaten your concentration, like riding on a galloping horse or in a boat in storm-tossed waters. In such situations the GM " +
		"will provide the TN. Failing a Mental Resilience (concentration) check causes your spell to fail (wasting your EP) or the loss " +
		"of your aiming bonus. " + get_crit_text('you gain advantage on the next check you make against the same situation or opponent.', 
		'you suffer disadvantage on the next check you make against the same situation or opponent.') +
		spend_pool('Mental Resilience', 'reduce the Essence Point loss if you fail a Mental Resilience (concentration) check for a spell ' +
		'on which youve spent EP, at a rate of 1 point per 2 EP retained (up to a maximum of the number of EP you spent on the spell).') + 
		"}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:mrwillpowerinfo", function() {
	getAttrs(["mr_total"], function(values) {
		let total = get_int_or_zero(values.mr_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Mental Resilience (willpower) info}} " +
		"{{Willpower=TN per spell or effect}} " +
		"{{desc=You make a Mental Resilience (willpower) check to defend against supernatural attacks that affect your mind, or to resist " +
		"some powerful mental compulsion. It does not cost any Action Points. The Target Number is set by the spell or effect to be resisted." +
		get_crit_text('turns the magic skill check into a critical failure, if applicable.',
		'turns the magic skill check into a critical success, if applicable.') +
		_rn + _star + " If you are affected by a spell or effect that lasts more than one round because you failed a Mental Resilience " +
		"(willpower) check, you can spend 3 points from your Mental Resilience pool to grant yourself another check at disadvantage to resist " +
		"the effect. This Mental Resilience (willpower) check occurs at the end of your turn and does not cost any Action Points.}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

function get_athletics_text(elusive_movement_training) {
	let elusive_move_text  = '';
	let elusive_move_extra = '';
	if (elusive_movement_training == 'on') {
		elusive_move_text = _bull + 'Move through a friendly occupied square without costing extra movement for 1 pool point' + _bull +
		'Let an ally move through your square without costing extra movement as a reaction for 2 pool points';
		elusive_move_extra = '; this movement does not provoke a free attack from any enemies';
	}
	let athletics_text = 'do any of the following:' + _bull + 'Make one 45 turn while running for 1 pool point' + elusive_move_text +_bull + 
	'Kip up from being prone without spending any Action Points for 2 pool points' + _bull + 'Move one square without spending ' +
	'any Action Points for 2 pool points (or 3 pool points as a reaction)' + elusive_move_extra;
	return spend_pool_athletics(athletics_text);
}

on("clicked:athleticselusivemovementinfo", function() {
	getAttrs(["athletics_total", "athletics_elusive_movement_training"], function(values) {
		let total = get_int_or_zero(values.athletics_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Athletics (elusive movement) info}} " +
		"{{Elusive movement=TN 12 + enemy's Attack total }} " +
		"{{desc=You can spend one Action Point to attempt elusive movement. You make an Athletics (elusive movement) check, and move up to " +
		"half your speed. While moving elusively, you attempt to flee combat and/or move through squares occupied by enemies. " +
		_rn + "Compare your Athletics (elusive movement) check to the Target Number of 12 + each enemys Attack total. If you " +
		"succeed against a given target, you can ignore free attacks and freely move through the enemys space. " +
		_rn + "The first enemy for which you fail to meet the TN ends your movement, and may get a free attack on you (if you were " +
		"fleeing combat). " + spend_pool_athletics('move more squares as part of elusive movement at a cost of 1 point per additional ' +
		'square of movement, up to a maximum of your speed.') + get_athletics_text(values.athletics_elusive_movement_training) + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:athleticsgymnasticsinfo", function() {
	getAttrs(["athletics_tier", "athletics_elusive_movement_training"], function(values) {
		let tier = get_int_or_zero(values.athletics_tier);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Athletics (gymnastics) info}} " +
		"{{Gymnastics=TN per GM}} {{Fall lightly=TN 15 + 3 per 10 feet}} " +
		"{{desc=You can balance on narrow ledges or slippery surfaces, perform backflips, or swing from a rope, pole or other affixed item. " +
		"Target Numbers vary widely depending on the situation, but the minimum TN for any gymnastic activity is 16. " +
		_rn + "Most gymnastics are used to get from one place to another. You can only move half your speed with a single AP and " +
		"Athletics check. Moving in this way may allow you to avoid difficult terrain or other hazards, depending on the situation. " +
		header_text('Fall Lightly') + "You can soften the landing of any fall with an Athletics (gymnastics) check. The Target Number is 15, " +
		"+3 per 10 feet of the fall (so TN for a 10-19 ft. fall is 18, a 20-29 foot fall is 21, etc.). " +
		_rn + "If you succeed, you reduce falling damage as if the fall were " + tier_effect(tier, 10, ' feet', 'Athletics') + 
		" shorter (minimum 0 damage). " + get_crit_text('you reduce the falling damage as if the fall were 10 feet shorter.', 
		'you increase the falling damage as if the fall were 10 feet longer.') +
		spend_pool_athletics('move more squares as part of gymnastic movement at a cost of 1 point per additional square of movement, ' +
		'up to a maximum of your speed.') + spend_pool_athletics('further reduce falling damage at a cost of 1 point per 10-foot reduction in damage.') +
		get_athletics_text(values.athletics_elusive_movement_training) + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:athleticsclimbinfo", function() {
	getAttrs(["athletics_total", "athletics_elusive_movement_training"], function(values) {
		let total = get_int_or_zero(values.athletics_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Athletics (climb) info}} {{Climb=TN per GM}} " +
		"{{desc=You can spend one Action Point to attempt to climb a rope or steep surface. You make an Athletics (climb) check, and move up " +
		"to half your speed. The Target Number is determined by how difficult the climb is. " +
		_rn + "If you fail your Athletics (climb) check, you dont move forward; if you critically fail, you fall. If you fall " +
		"while climbing you can attempt to catch yourself by making an Athletics (climb) check with a Target Number equal to the TN of the " +
		"climb +10; if you succeed, you lose your next Action Point. " +
		_rn + "Any actions you take while climbing (other than climbing) take +1 AP and suffer disadvantage. If you take " +
		"damage while climbing, you must make an Athletics (climb) check or fall (TN = damage taken)." +
		spend_pool_athletics('move more squares as part of a climb at a cost of 1 point per additional square of movement, up to a maximum of ' +
		'your normal speed. You can also spend 4 pool points to remove disadvantage on other actions while climbing for 1 round.') + 
		get_athletics_text(values.athletics_elusive_movement_training) + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:athleticsfeatinfo", function() {
	getAttrs(["athletics_total", "athletics_elusive_movement_training"], function(values) {
		let total = get_int_or_zero(values.athletics_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Athletics (feat) info}} {{Feat=TN per GM}} " +
		"{{desc=You perform some feat of athletics, using leverage or just plain brawn. This is usually lifting or moving something heavy, holding a door " +
		"closed or bashing one down, or something similar. The TN of the check is based on the task, or its an opposed Athletics (feat) check." +
		get_athletics_text(values.athletics_elusive_movement_training) + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:athleticsjumpinfo", function() {
	getAttrs(["athletics_total", "athletics_elusive_movement_training"], function(values) {
		let total = get_int_or_zero(values.athletics_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Athletics (jump) info}} " +
		"{{Long Jump=TN squares &times; 8}} {{High Jump=TN feet &times; 6}} " +
		"{{desc=You can jump, and your Athletics (jump) check determines how far. Jumping costs at least one Action Point and counts as running. " +
		"If your jump is farther than your running movement, you must spend AP to increase your movement and use AP in successive rounds to " +
		"complete the jump, until the total jump distance has been completed. " +
		_rn + "For a running long jump, the most common type of jump, the Target Number is equal to the distance of the jump in " +
		"squares &times; 8. For a running high jump, the Target Number is equal to the distance of the jump in feet &times; 6. Both of these " +
		"TNs are doubled without a running start of at least 4 squares (20 feet). " +
		spend_pool_athletics('reduce the required running start at a cost of 1 point per square (minimum one square).') + 
		get_athletics_text(values.athletics_elusive_movement_training) + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:athleticsswiminfo", function() {
	getAttrs(["athletics_total", "athletics_elusive_movement_training"], function(values) {
		let total = get_int_or_zero(values.athletics_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Athletics (swim) info}} {{Swim=TN per GM}} " +
		"{{desc=As long as you have training in this skill application, you know how to swim and do not need to make checks to move through the water. " +
		"You can spend one Action Point to swim up to half your speed." +
		_rn + "If youre swimming against a current or something similar, a Target Number will be set for your Athletics (swim) check. If you fail " +
		"your Athletics (swim) check, you dont move forward; if you critically fail, you move in the direction of the current. " +
		_rn + "Items designed to lessen your Carry, such as backpacks, have no lightening effect while youre swimming." +
		_rn + "Any actions you take while swimming (other than swimming) take +1 AP and suffer disadvantage." +
		spend_pool_athletics('move more squares as part of a swim at a cost of 1 point per additional square of movement. You can also spend 4 pool ' +
		'points to remove disadvantage on other actions while swimming for 1 round.') + get_athletics_text(values.athletics_elusive_movement_training) + 
		"}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

function get_medicine_text() {
	return _rn + 'You suffer great disadvantage on Medicine checks unless you have a first aid kit. Medicine (first aid and long-term care) ' +
	'checks expend one use of the first aid kit, while Medicine (diagnose) checks do not expend any uses.';
}

on("clicked:medicinediagnoseinfo", function() {
	getAttrs(["medicine_total", "medicine_tier"], function(values) {
		let total = get_int_or_zero(values.medicine_total);
		let tier  = get_int_or_zero(values.medicine_tier);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Medicine (diagnose) info}} " +
		"{{desc=You can attempt to diagnose a medical condition afflicting a creature. For diseases and poisons, the TN is the TN of the specific disease or " +
		"poison. For other conditions, the GM will set the TN. This skill application can also be used forensically, to determine cause of death in a corpse." + 
		get_medicine_text() + " }}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:medicinefirstaidinfo", function() {
	getAttrs(["medicine_total", "medicine_tier"], function(values) {
		let total = get_int_or_zero(values.medicine_total);
		let tier  = get_int_or_zero(values.medicine_tier);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Medicine (first aid) info}} " +
		"{{Boost Short Rest=TN 20}} {{Stabilize=TN 16}} {{Treat Poison=Poison TN}} " +
		"{{desc=You can apply immediate medical attention, which can be used for one of the following actions. " +
		"All three of these require you to be able to physically touch your ally. " +
		header_text('Boost Short Rest') + "You can boost short rest HP healing for " + tier_effect_medicine(tier, 1, ' allies') + 
		" during each short rest. Make a TN 20 Medicine (first aid) check for each ally; if you are successful, you add +1d6 to their HP recovery. " +
		get_crit_text('you add ' + tier_effect_medicine(tier, 1, 'd6', '+') + ' to their HP recovery.', 
		'you cause 1d6 damage to your ally and they dont recover any HP.') +
		header_text('Stabilize') + "You can spend two Action Points to stabilize a dying ally. Make a TN 16 Medicine (first aid) check; " +
		"if you are successful, your ally is stable as if they had made three successful recovery checks." + get_crit_text(
		'your ally is stable and conscious at 1d6 HP.', 'you cause your ally to incur a recovery check failure') +
		header_text('Treat Poison') + "You can spend two Action Points to treat an ally who has been poisoned. " +
		"Make a Medicine (first aid) check, which counts as their PR (constitution) check. You can do this once per instance where they would " +
		"need to make such a check. " + get_medicine_text() + " }}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:medicinelongtermcareinfo", function() {
	getAttrs(["medicine_total", "medicine_tier"], function(values) {
		let total = get_int_or_zero(values.medicine_total);
		let tier  = get_int_or_zero(values.medicine_tier);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Medicine (long-term care) info}} " +
		"{{Boost Long Rest=TN 20}} {{Treat Disease=Disease TN}} " +
		"{{desc=You give medical care once per day to a number of patients in a hospital or similar environment, which can be used for one " +
		"of the actions listed below. You can make one check per day per patient, and can simultaneously care for up to " + 
		tier_effect_medicine(tier, 3, ' patients') + ". " +
		header_text('Boost Long Rest') + "You can boost long rest HP healing your allies during each long rest. Make a TN 20 " +
		"Medicine (long-term care) check for each ally; if you are successful, you add " + tier_effect_medicine(tier, 1, 'd6', '+') + 
		" to their HP recovery. " + get_crit_text('you add ' + tier_effect_medicine(tier, 2, 'd6', '+') + ' to their HP recovery.', 
		'you cause 3d6 damage to your ally and they dont recover any HP.') +
		header_text('Treat Disease') + "You can treat an ally who has a disease. Make a Medicine (long-term care) check, which counts " +
		"as their PR (constitution) check. " + get_medicine_text() + " }}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

function get_persuade_text() {
	return _rn + _star + ' If you fail a Persuade (bluff, diplomacy, or intimidate) check, you can spend 3 points from your Persuade pool to grant ' +
	'yourself another check to attempt the same Persuade check, which must be made immediately. This check suffers disadvantage and can only be ' +
	'done once per conversation.'
}

on("clicked:persuadebluffinfo", function() {
	getAttrs(["persuade_total"], function(values) {
		let total = get_int_or_zero(values.persuade_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Persuade (bluff) info}} " +
		"{{Distract=Perception (notice) check}} {{Impersonate=Persuade (intuition) check}} {{Lie=Persuade (intuition) check}} " +
		"{{desc=Bluff has three uses: distract, impersonate, and lie." +
		header_text('Distract') + "You can make Persuade (bluff) check to cause a distraction for 1 AP. Each creature you are trying " +
		"to distract makes a Perception (notice) check against your skill check, and if they fail, they are distracted for one round, which you can " +
		"use to move or make a Sneak (stealth) check without them noticing. If they succeed, they are aware you were trying to trick them." +
		header_text('Impersonate') + "You can make Persuade (bluff) check to impersonate someone else. The first time a given person interacts with you, " +
		"you must attempt a 1-minute Persuade (bluff) test versus their Persuade (intuition). If you fail, they know you arent who you say you are. If " +
		"you critically fail, they instantly recognize you if they would know you normally. If you succeed, they believe you are who you are impersonating. " +
		header_text('Lie') + "You attempt to tell a convincing lie by making a Persuade (bluff) check, which is opposed by your targets " +
		"Persuade (intuition) check. This is at least a 1-AP skill test (or more, GMs discretion). If you succeed, your target believes your lie. If you " +
		"fail, your target does not believe your lie, and gains advantage on Persuade (intuition) checks against you for the rest of the conversation. " +
		get_persuade_text() + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:persuadediplomacyinfo", function() {
	getAttrs(["persuade_total"], function(values) {
		let total = get_int_or_zero(values.persuade_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Persuade (diplomacy) info}} " +
		"{{Gather information=TN per GM}} {{Improve attitude=TN per GM}} " +
		"{{desc=Diplomacy has two uses: gather information and improve attitude." +
		header_text('Gather Information') + "You can attempt a Persuade (diplomacy) test to gather information, which is at least a 1-hour skill test " +
		"(or more, GMs discretion). The GM will decide if this involves other things, like buying food or drinks for people, etc. The Target Number " +
		"and effects are set by the GM. " +
		header_text('Improve Attitude') + "You can attempt to improve the attitudes of one or more people by making a Persuade (diplomacy) " +
		"test. The Target Number depends on many factors, and is set by the GM. This is at least a 1-AP skill test (or more, GMs discretion). If successful, " +
		"your target(s) attitudes are improved. Your target also gets an Persuade (intuition) check to see how heavily you are candy-coating things, with a " +
		"Target Number of your Persuade (diplomacy) check. " + get_persuade_text() + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:persuadeintimidateinfo", function() {
	getAttrs(["persuade_total", "persuade_tier"], function(values) {
		let total       = get_int_or_zero(values.persuade_total);
		let tier        = get_int_or_zero(values.persuade_tier);
		let effect_tier = tier_effect(tier, 1, ' rounds', 'Persuade', '', 0, 3);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Persuade (intimidate) info}} " +
		"{{Coerce=Mental Resilience (willpower) check}} {{Demoralize=Mental Resilience (willpower) check}} {{Taunt=Mental Resilience (willpower) check}} " +
		"{{desc=Intimidate has three uses: coerce, demoralize, and taunt." +
		header_text('Coerce') + "You can attempt to coerce a target into doing what you want. You attempt a Persuade (intimidate) test, " +
		"which is opposed by your targets Mental Resilience (willpower) check. This is at least a 1-AP skill test  (or more, GMs discretion). If successful, " +
		"your target behaves in a helpful way for as long as you remain a threat. Your target also gets a Persuade (intuition) check to see whether or not you " +
		"will make good on your threats, with a Target Number of your Persuade (intimidate) check. " +
		header_text('Demoralize') + "You can make Persuade (intimidate) check opposed by your targets Mental Resilience (willpower) check " +
		"to demoralize them for 1 AP. If you succeed, they are scared for " + effect_tier + ". " +
		header_text('Taunt') + "You can make Persuade (intimidate) check opposed by your targets Mental Resilience (willpower) check " +
		"to taunt them into attacking you for 1 AP. If you succeed, they are they are compelled to attack you for " + effect_tier + ". " +
		get_persuade_text() + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:persuadeintuitioninfo", function() {
	getAttrs(["persuade_total"], function(values) {
		let total = get_int_or_zero(values.persuade_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Persuade (intuition) info}} " +
		"{{desc=Intuition is your ability to tell when someone is lying to you, not telling you the whole story, has an ulterior motive, or is candy-coating something. It is used to oppose other Persuade checks.}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:securitydisabledeviceinfo", function() {
	getAttrs(["security_total"], function(values) {
		let total = get_int_or_zero(values.security_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Security (disable device) info}} " +
		"{{Disable device=TN per GM}} {{Bypass device=Critical success}} " +
		"{{desc=You can attempt a 2-AP Security (disable device) test to disable an alarm system or trap. " +
		"The Target Number depends on the alarm system or trap to be disabled. " +
		_rn + "If you fail the Security (disable device) test, you set off the alarm or trap. " +
		_rn + "If you critically succeed the test, you can bypass the alarm or trap and allow others with you to bypass it, but leave it set." +
		spend_pool_security('reduce the number of Action Points it takes to disable an alarm or trap, at a cost of 1 point per 1 AP ' +
		'(minimum one Action Point).') + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:securitypicklocksinfo", function() {
	getAttrs(["security_total"], function(values) {
		let total = get_int_or_zero(values.security_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Security (pick locks) info}} " +
		"{{Pick lock=TN per GM}} " +
		"{{desc=You can attempt a 1-AP Security (pick locks) test to pick a lock. The Target number depends on the lock " +
		"to be picked." + _rn + "You suffer great disadvantage on a Security (pick locks) check unless you have lock picking tools. " +
		spend_pool_security('reduce the number of Action Points it takes to pick a lock, at a cost of 1 point per 1 AP (minimum one ' +
		'Action Point).') + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:sneakescapologyinfo", function() {
	getAttrs(["sneak_total"], function(values) {
		let total = get_int_or_zero(values.sneak_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Sneak (escapology) info}} " +
		"{{Escape grapple=Attack (grapple) check}} {{Escape bonds=TN per GM}} " +
		"{{desc=You can spend one Action Point to attempt to escape a grapple, hold or bonds, like ropes or manacles. " +
		"The Target Number is either your opponents Attack (grapple) check or based on the item binding you.}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:sneaksleightofhandinfo", function() {
	getAttrs(["sneak_total"], function(values) {
		let total = get_int_or_zero(values.sneak_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Sneak (sleight of hand) info}} " +
		"{{Conceal item=Perception check}} " +
		"{{desc=You can spend one Action Point to hide a small item from sight. You make a Sneak (sleight of hand) check, which sets the " +
		"Target Number for your opponents Perception (notice) check." +
		_rn + "Only small weapons and similarly sized objects can be hidden on your person. " +
		"Trying to hide a larger weapon or similarly sized object incurs great disadvantage." +
		_rn + "You can also use this skill application to try to pick someones pocket, but you suffer disadvantage.}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:sneakstealthinfo", function() {
	getAttrs(["sneak_total"], function(values) {
		let total = get_int_or_zero(values.sneak_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Sneak (stealth) info}} " +
		"{{Avoid detection=Perception check}}" +
		"{{desc=You can spend one Action Point to attempt to avoid being seen or heard. You make a Sneak (stealth) check, and can move " +
		"up to half your speed. Your Sneak (stealth) check sets the Target Number for any opposing partys Perception check to notice you. " +
		spend_pool('Sneak', 'move more squares while moving unseen at a cost of 1 point per additional square of movement for that AP, ' +
		'up to a maximum of your speed.') + "}}'";		
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

function get_nature_text() {
	return _rn + 'You can also attempt a TN 12 Nature check to find north.' + spend_pool_nature('move more squares while moving through difficult ' +
	'terrain at a cost of 1 point per additional square of movement, up to a maximum of your speed.');
}

on("clicked:naturehandleanimalinfo", function() {
	getAttrs(["nature_total"], function(values) {
		let total = get_int_or_zero(values.nature_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Nature (handle animal) info}} " +
		"{{desc=You can use this skill application to improve the attitude of an animal (or similar creature) as per Persuade (diplomacy). " + _rn + 
		"You can also use this to get an animal to perform an action it might not normally do, like stay, heel, guard, or attack. In this case, your " +
		"Nature (handle animal) check is opposed to the animals Mental Resilience (willpower) check. If you succeed at a 2-day skill " +
		"test, you can teach an animal one of those tricks permanently." + _rn + "If the animal already knows the attack action, you can get it to " +
		"use a special combat action (like flank, fight recklessly, or guard)." + get_nature_text() + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:naturesustaininfo", function() {
	getAttrs(["nature_total", "nature_tier"], function(values) {
		let total       = get_int_or_zero(values.nature_total);
		let tier        = get_int_or_zero(values.nature_tier);
		let effect_tier = tier_effect(tier, 2, ' people', 'Nature');
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Nature (sustain) info}} " +
		"{{Food, water, shelter=TN 12}} {{Predict weather=TN 20}} {{Recognize hazard=TN per GM}} {{Find north=TN 12}}" +
		"{{desc=Each day you spend in the wild, you can make a Nature (sustain) check to find clean water, food and shelter for yourself and others. " +
		"The Target Number is 12 to sustain " + effect_tier + ", and every 3 points by which you exceed that allows you to sustain an additional " +
		effect_tier + ". " +
		_rn + "You can also use this application to predict the weather for the next day by making a TN 20 Nature (sustain) check. " +
		_rn + "Finally, you can make a Nature (sustain) check to recognize and avoid a natural hazard such as quicksand. " +
		"The Target Number for such a check is based on the hazard." + get_nature_text() + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:naturetrackinfo", function() {
	getAttrs(["nature_total"], function(values) {
		let total = get_int_or_zero(values.nature_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Nature (track) info}} " +
		"{{Track=TN per GM}} {{Find north=TN 12}}" +
		"{{desc=You can attempt to track one or more creatures by making a Nature (track) check. The Target Number is based on many different factors, " +
		"and is set by the GM. You move at half speed while tracking, but you can track at full speed by taking disadvantage or at a run by taking a great " +
		"disadvantage. " +
		_rn + "If you lose the trail you can attempt another Nature (track) check to find it again after an hour of searching." +
		get_nature_text() + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:cinemapointsinfo", function() {
	getAttrs(["ps_action_hero"], function(values) {
		let has_action_hero = get_bool(values.ps_action_hero);
		let cinema_point_max = (has_action_hero ? 6 : 3);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Cinema Points}} " +
		"{{desc=Cinema Points are awarded by the GM; you can hold up to [[" + cinema_point_max + "]] at a time. You can spend one Cinema Point to do any " +
		"one of the following (whether or not it's your turn):" + _n + _bull + "Grant one skill +4 pool points for one round" + _bull + "Gain +1 AP for one round" + 
		_bull + "Double all your movement speeds for one round" + _bull + "Move to the current spot in Reflex order if you havent gone yet this round" + _bull + 
		"Instantly heal a number of HP equal to your maximum short rest HP roll" + _bull + "Instantly recover a number of EP equal to your maximum short rest " +
		"EP roll" + _bull + "Convert a success to a critical success" + _bull + "Convert a critical failure to a regular failure" + _bull + "Automatically " +
		"stabilize if dying" + _rn + "For 2 Cinema Points, you can cheat death (the GM decides how)." + _rn + "You may spend more than one Cinema Point at a " +
		"time if you wish.}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:craftinfo", function() {
	let roll_text = "/w @{character_name} '&{template:custom} {{title=Craft}} {{desc=This proficiency type covers the ability to make things. Some Craft " +
	"proficiencies are: alchemy, armor, blacksmith, carpentry, jewelry, leather, locks, masonry, poison, pottery, traps, weapons." + _rn + 
	"**Crafting Items**" + _n + "To craft an item, you must have the appropriate Craft proficiency (determined by the GM). Crafting requires raw materials " +
	"of a value equal to half the price of the finished item, a workspace, and appropriate tools. Each day, you can spend 8 hours crafting, then make a " +
	"Craft check of the appropriate type versus a Target Number." + _rn + "If successful, you craft an amount of the item equal to (your Craft check) " +
	"&times; 5cc. If you critically succeed, you use a multiplier of 6cc instead of 5cc. If you fail, you make no progress on the item. If you critically " +
	"fail, you destroy one third of the raw materials you started with, and you will need more to be able to complete the item. Once you get to the total " +
	"value of the item, you have completed it."  + _rn + "Target numbers for crafting items are set by the GM, but in general, simple items are TN 16, " +
	"complex items are TN 20, and exotic items are TN 24. Weapons and armor are considered complex, while guns are considered exotic.}}'";
	startRoll(roll_text, (results) => {
		finishRoll(results.rollId);
	});
});

on("clicked:knowledgeinfo", function() {
	let roll_text = "/w @{character_name} '&{template:custom} {{title=Knowledge}} {{Area knowledge=Humanoids (humans, elves, dwarves, etc.)}} " +
	"{{Dungeoneering=Aberrations, oozes}} {{Magic=Constructs, dragons, other magical creatures}} {{Nature=Animals, elementals, fey, plants}} " +
	"{{Planes=Creatures from the outer planes}} {{Religion=Angels, demons, undead}} {{desc=This proficiency type covers things that you know about. Some " +
	"Knowledge proficiencies include: area knowledge (specific to one town, city or local area), astronomy, biology, dungeoneering, engineering, economics, " +
	"geography, heraldry, history (world history or a specific area/time period), law (one region), literature, magic, mathematics, nature, philosophy, " +
	"physics, planes, politics, religion." + _rn + "You make Knowledge checks to see whether or not you know something about a topic. Target Numbers are " +
	"based on how obscure the given piece of information is. If you fail a Knowledge check, that means you dont know that thing. You cannot make another " +
	"check for the same piece of information until you put another point into that Knowledge proficiency or gain access to another source of related " +
	"information (like a book)." + _rn + "Knowledge checks can also be used to see what you know about certain types of creatures when you encounter them. " +
	"The base TN for such a check is 10, plus 6 per tier of the creature. So tier 1 creatures are TN 16, tier 2 are TN 22, etc. Success means you know basic " +
	"things about that creature type; critical success means you know everything about them. The GM will determine what is basic for each creature. " +
	"Knowledge types and the creature types they cover are above." + _rn + "**Linguistics**" + _n + "Linguistics is a specific Knowledge proficiency, and " +
	"is the study of languages, etymology, etc. For each point that you put into Knowledge (linguistics), you learn one new language. You must have " +
	"reasonable access to the language in the form of people, books, etc. in order to learn it. You do not need a point in Knowledge (linguistics) to speak " +
	"your first language.}}'";
	startRoll(roll_text, (results) => {
		finishRoll(results.rollId);
	});
});

on("clicked:performinfo", function() {
	let roll_text = "/w @{character_name} '&{template:custom} {{title=Perform}} {{desc=This proficiency type covers any type of performance. Some Perform " +
	"proficiencies include: acting, comedy, dance, keyboard instruments, oratory, percussion instruments, string instruments, wind instruments, singing. " +
	"Target Numbers are based on the complexity of the attempted performance, and are set by the GM.}}'";
	startRoll(roll_text, (results) => {
		finishRoll(results.rollId);
	});
});

on("clicked:professioninfo", function() {
	let roll_text = "/w @{character_name} '&{template:custom} {{title=Profession}} {{desc=This proficiency type covers professions that dont involve " +
	"crafting items. Some Profession proficiencies are accountant, architect, baker, barrister, brewer, butcher, clerk, cook, courtesan, engineer, farmer, " +
	"fisherman, gambler, gardener, herbalist, innkeeper, librarian, merchant, midwife, miller, miner, porter, sailor, scribe, shepherd, stable master, " +
	"soldier, tanner, trapper, woodcutter." + _rn + "**Conveyance**" + _n + "Conveyance is a specific Profession proficiency, and covers the ability to " +
	"effectively ride animals and operate vehicles. For each point that you put into Profession (conveyance), you learn to ride one new type of creature or " +
	"drive one new type of vehicle. You must have reasonable access to the creature or vehicle in order to learn about it. Profession (conveyance) checks " +
	"are usually only required in extreme cases, like avoiding an accident, riding/driving while in combat, etc.}}'";
	startRoll(roll_text, (results) => {
		finishRoll(results.rollId);
	});
});

on("change:passive_skills", function(eventInfo) { 
	set_passive_skills(eventInfo);
});

on("change:boons_and_banes", function(eventInfo) { 
	set_boons_and_banes(eventInfo);
});

on("change:equipment_carry change:money_gold_coins change:money_silver_coins change:money_copper_coins change:armor_name", function() {
	set_carry_count();
});

on('change:arcana_points', function() {
	getAttrs(['arcana_points'], function(values) {
		let skill_points = get_int_or_zero(values.arcana_points);
		let defaults = '0';
		if (skill_points >= 1) {
			defaults = 'on';
		}
		setAttrs({
			'arcana_arcana_training': defaults,
			'area_type_bolt':         defaults,
			'area_type_touch':        defaults,
			'area_type_self':         defaults,
			'damage_type_physical':   defaults
		});
	});
});

on('change:arcana_tier', function() {
	getAttrs(['arcana_tier'], function(values) {
		let tier           = get_int_or_zero(values.arcana_tier);
		let duration_bonus = tier - 1;
		let duration_text  = 'Base';
		if (duration_bonus > 0) {
			duration_text += ' + ' + duration_bonus;
		}

		setAttrs({ 
			'spell_duration_bonus':        duration_bonus,
			'spell_duration_text':         duration_text,
			'arcana_duration_linger_roll': `1d6cs<${tier}cf>${(tier + 1)}` 
		});
	});	
});

on("clicked:arcanainfo", function() {
	getAttrs(["arcana_total"], function(values) {
	
		let total = get_int_or_zero(values.arcana_total);
		let roll_text = "/w @{character_name} '&{template:custom} {{title=Arcana info}} " +
		"{{EFFECT OR TRAP:" + _n + "Detect" + _n + "Identify magic skill" + _n + "Identify spell" + _n + "Identify specific version=" + _n + "TN" + _n + 
		"TN + 2" + _n + "TN + 5" + _n + "TN + 10}} " +
		//"{{Effect or trap:" + _n + "Detect=TN}} {{Effect or trap:" + _n + "Identify magic skill=TN + 2}} {{Effect or trap:" + _n + 
		//"Identify spell=TN + 5}} {{Effect or trap:" + _n + "Identify specific version=TN + 10}} " +
		//"{{Spell being cast:" + _n + "Identify magic skill=TN 12}} " +
		//"{{Spell being cast:" + _n + "Identify spell=TN 16}} {{Spell being cast:" + _n + "Identify specific version=TN 20}} " +
		"{{SPELL BEING CAST:" + _n + "Identify magic skill" + _n + "Identify spell" + _n + "Identify specific version=" + _n + "TN 12" + _n + "TN 16" + _n + "TN 20}} " +
		"{{Base Range=" + value_effect('Arcana total', total) + "}} {{Base Duration=" + value_effect('Arcana total / 2', Math.floor(total / 2)) + 
		"}} {{Base Area Size=" + value_effect('Arcana total / 4', Math.floor(total / 4)) + "}}" +
		"{{desc=Arcana is the core magic skill - it represents your overall ability with magic, and determines your spell statistics (see below). " + 
		"You cannot put more points in any magic skill than you have in the Arcana skill. Arcana doesnt have separate skill applications or spells, " + 
		"but it can be used to do several things. " +
		_rn + "You can spend 2 AP to use Arcana to search for magical effects (including magic traps) as if it were Perception (scan). " + 
		"The TN is based on the magic skill check used to create the effect, or the TN of the magic trap. Success means that you notice that the " + 
		"effect or trap exists, and if your check is higher you can glean more information (see above). 'Specific version' means you know the " +
		"tier, EP cost, damage type, and specific version of the spell, if applicable. For example, if its a *force effect* spell, you know whether " +
		"its the defensive or offensive version of that spell." + 
		_rn + "You can also use Arcana to recognize a spell thats actively being cast, which costs no AP. Make an Arcana check; your check determines " +
		"how much you know about the spell (see TNs above). Your knowledge of the spell being cast can make this check harder or easier, or even be " +
		"automatically successful, as shown below. 'Know skill' means you have at least one point in the magic skill." + _bull + "Know skill, spell & tier: " +
		"automatic success" + _bull + "Know skill & spell, not tier: advantage" + _bull + "Know skill, not spell: normal check" + _bull + "Dont know skill: " +
		"disadvantage" +
		_rn + "Arcana also determines the base values of your spell statistics (see above). The maximum value for each spell statistic is " +
		"equal to the base value &times; 2." + spend_pool_arcana('increase the spell statistics of a spell. It costs 1 pool point per extra square of ' +
		'range, 2 pool points per extra unit of duration, and 4 pool points per extra square of area size.') + "}}'";
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

const spell_statistics = [
	{name: 'range',     divisor: 1},
	{name: 'area_size', divisor: 4}
];
spell_statistics.forEach( function(statistic) {
	let extra_name = `spell_${statistic.name}_extra`;
	let key_array = ['arcana_points', 'arcana_total', extra_name];
	on('change:' + key_array.join(' change:'), function() {
		getAttrs(key_array, function(values) {
			let arcana_points = get_int_or_zero(values.arcana_points);
			let arcana_total  = get_int_or_zero(values.arcana_total );
			let extra         = get_int_or_zero(values[extra_name]  );
			setAttrs({
				[`spell_${statistic.name}`]:    (arcana_points >= 1 ? Math.max(1, Math.floor(arcana_total / statistic.divisor)) + extra : ''),
				[`cp_spell_${statistic.name}`]: (extra * statistic.divisor)
			});
		});
	});
});

on('change:cp_spell_range change:cp_spell_area_size', function() {
	getAttrs(['cp_spell_range', 'cp_spell_area_size'], function(values) {
		let cp_spell_range     = get_int_or_zero(values.cp_spell_range    );
		let cp_spell_area_size = get_int_or_zero(values.cp_spell_area_size);
		console.log(`cp_spell_statistics: ${(cp_spell_range + cp_spell_area_size)}`);
		setAttrs({ 'cp_spell_statistics': (cp_spell_range + cp_spell_area_size) });
	});
});

const dur_concentration         = 0;
const dur_short_rest_w_checks_1 = 1;
const dur_concentration_w_pool  = 2;
const dur_short_rest_w_checks_2 = 3;
const dur_short_rest            = 4;
const dur_short_rest_p_linger   = 5;
const dur_long_rest             = 6;
const dur_one_week              = 7;
const dur_permanent             = 8;
const dur_instantaneous         = 9;

const spell_durations = [
	'Concentration',
	'Short rest with checks, 1 success',
	'Concentration with pool points',
	'Short rest with checks, 2 successes',
	'Short rest',
	'Short rest plus linger',
	'Long rest',
	'One week',
	'Permanent',
	'Instantaneous'
];

function get_spell_duration(base_duration, duration_bonus) {
	if (base_duration == dur_instantaneous) {
		return spell_durations[dur_instantaneous];
	}

	let duration_index = base_duration;
	
	for (let i = 0; i < duration_bonus; i++) {
		duration_index++;
		if (duration_index <= 3) {
			duration_index++;
		}
	}

	return spell_durations[Math.min(duration_index, dur_permanent)];
}

function get_prowess_imbue_info(tier, show_tier1, show_tier2, show_tier3, show_tier4, duration_bonus, range, is_prowess = true) {
	let skill_name = 'Divination';
	let spell_name = 'prowess';
	let skill_desc = 'non-';
	let ep_cost_mult = 1;
	let spend_pool_desc = 'lower the threshold for exploding dice for a skill at a cost of 4 points per one point of lowered threshold (minimum 6+).'
	let spend_pool_text = spend_pool_divination(spend_pool_desc);
	if (!is_prowess) {
		skill_name = 'Metamancy';
		spell_name = 'imbue';
		skill_desc = '';
		ep_cost_mult = 2;
		spend_pool_text = spend_pool_metamancy(spend_pool_desc);
	}
	let tier1_effect = 				 `{{${10 * ep_cost_mult} EP=Skill explodes on 9+` + _or + `Training in one ${skill_desc}magic skill application}} `;
	let tier2_effect = (show_tier2 ? `{{${20 * ep_cost_mult} EP=Skill explodes on 8+}} ` : '');
	let tier3_effect = (show_tier3 ? `{{${30 * ep_cost_mult} EP=Skill explodes on 7+}} ` : '');
	let tier4_effect = (show_tier4 ? `{{${40 * ep_cost_mult} EP=Skill explodes on 6+}} ` : '');
	let tier2_text = (show_tier2 ? _rn + "You can lower the explode value of the target " + skill_desc + "magic skill further based on the amount of EP spent. " : '');
	let power_text = (show_tier2 ? _pow + "Choose " + value_effect(` tier in ${skill_name} - 1`, tier - 1) + " **" + skill_desc + "magic skill(s)**" +
	", and lower their threshold for exploding dice from 10 to 9+. You can change which skill(s) this bonus applies to after each long rest." : '');
	let desc = "This spell grants the target temporary knowledge of a particular " + skill_desc + "magic skill, in the form of a lower threshold " +
	"for skill checks with that skill to explode." + power_text +
	_rn + "You can spend " + (10 * ep_cost_mult) + " EP to lower the threshold for one skill to explode to 9+, or to grant training in one " + skill_desc + 
	"magic skill application in which the target is not trained. If you grant a target training in a skill application for a " +
	"skill in which they have no skill points, they gain 1 skill point in that skill for the duration of this spell. " + tier2_text +
	_rn + "You can grant an enhancement to more than one skill in one casting of this spell, but the enhancement bought for " +
	"each effect and affected skill must be bought separately. " + spend_pool_text;
	let roll_text = get_spell_info(`${skill_name} (${spell_name})`, '2 AP', range + ' squares', dur_concentration, duration_bonus, 
	_bolt_touch, 'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
	return roll_text;
}

on("clicked:alterationadoptaspectinfo", function() {
	getAttrs(["alteration_tier", "show_alteration_adopt_aspect_10_ep", "show_alteration_adopt_aspect_20_ep", "show_alteration_adopt_aspect_30_ep", "ps_supernatural_aspect", "spell_duration_bonus", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.alteration_tier);
		let show_alteration_adopt_aspect_10_ep = get_bool(values.show_alteration_adopt_aspect_10_ep);
		let show_alteration_adopt_aspect_20_ep = get_bool(values.show_alteration_adopt_aspect_20_ep);
		let show_alteration_adopt_aspect_30_ep = get_bool(values.show_alteration_adopt_aspect_30_ep);
		let has_supernatural_aspect = get_bool(values.ps_supernatural_aspect);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let tier1_effect = '{{5 EP=5 EP boon list}} {{10 EP=10 EP boon list}} ';
		let tier2_effect = (show_alteration_adopt_aspect_20_ep ? '{{20 EP=20 EP boon list}} ' : '');
		let tier3_effect = (show_alteration_adopt_aspect_30_ep ? '{{30 EP=30 EP boon list}} ' : '');
		let tier1_list = 									   `${header_text('5 EP boon list:' , false)}${_bull}Fast Movement (+1 sq)${_bull}Ferocity${_bull}Infravision${_bull}Natural Attack (up to two)${_bull}Natural Damage Resistance (physical) 2${_bull}Quick Reflexes${_bull}Scent${_bull}Stability${_bull}Stonecunning${_bull}Ultravision` +
															   `${header_text('10 EP boon list:', false)}${_bull}Climb (3 sq)${_bull}Fast Movement (+3 sq)${_bull}Natural Attack + Free Grapple${_bull}Natural Attack (up to four)${_bull}Natural Damage Resistance (physical) 4${_bull}Swim (3 sq)`;
		let tier2_list = (show_alteration_adopt_aspect_20_ep ? `${header_text('20 EP boon list:', false)}${_bull}Amphibious + Swim (4 sq)${_bull}Aquatic + Swim (4 sq)${_bull}Burrow (3 sq)${_bull}Climb (6 sq)${_bull}Fast Movement (+6 sq)${_bull}Fly (4 sq)${_bull}Natural Attack + Free Grapple + Crush${_bull}Natural Attack + Free Grapple + Rake; this must be combined with Natural Attack (claw) from the 5 or 10 EP list or by spending pool points in order for Rake to cause extra damage${_bull}Natural Damage Resistance (physical) 8${_bull}Swim (6 sq)` : '');
		let tier3_list = (show_alteration_adopt_aspect_30_ep ? `${header_text('30 EP boon list:', false)}${_bull}Amphibious + Swim (10 sq)${_bull}Aquatic + Swim (10 sq)${_bull}Fly (10 sq)${_bull}Natural Damage Resistance (physical) 16` : '');
		let poly_text_1 = (has_supernatural_aspect ? '' : " The creatures features change visibly to be part bestial, based on which boon(s) are granted (GMs discretion).");
		let poly_text_2 = (has_supernatural_aspect ? '' : _rn + "If you spend at least 20 EP on *adopt aspect*, it becomes a polymorph effect and changes the target into a different type of creature. Its gear is subsumed into its form for the spells duration.");
		let desc = "*Adopt aspect* grants the target creature one or more monstrous boons for the duration." + poly_text_1 + _pow + 
		"You can choose up to " + tier_effect_alteration(tier, 5, ' EP') + " worth of boons to apply to yourself. Each time you take a " +
		"long rest, you may choose different boons." + tier1_list + tier2_list + tier3_list +
		_rn + "You may grant the target creature any number of boons with a single casting of this spell, but you must pay EP for each " +
		"one separately. You cannot choose a single item off of a single list more than once with a single casting of this spell." + poly_text_2 +
		spend_pool_alteration('increase some qualities of the granted boons in the following ways:' + _bull + '1 point per additional square of movement ' +
		'(Burrow, Climb, Fast Movement, Fly, or Swim)' + _bull + '1 point per additional Natural Attack' + _bull + '1 point per additional 1 NDR.');
		let roll_text = get_spell_info('Alteration (adopt aspect)', '2 AP', range + ' squares', dur_concentration, duration_bonus,
		_bolt_touch, 'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:alterationadoptaspect5ep", function() {
	cast_adopt_aspect(5);
});

on("clicked:alterationadoptaspect10ep", function() {
	cast_adopt_aspect(10);
});

on("clicked:alterationadoptaspect20ep", function() {
	cast_adopt_aspect(20);
});

on("clicked:alterationadoptaspect30ep", function() {
	cast_adopt_aspect(30);
});

on("clicked:alterationalterarmorinfo", function() {
	getAttrs(["alteration_tier", "show_alteration_alter_armor_10_ep", "show_alteration_alter_armor_20_ep", "show_alteration_alter_armor_30_ep", "show_alteration_alter_armor_40_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst"], function(values) {
		let tier = get_int_or_zero(values.alteration_tier);
		let show_alteration_alter_armor_10_ep = get_bool(values.show_alteration_alter_armor_10_ep);
		let show_alteration_alter_armor_20_ep = get_bool(values.show_alteration_alter_armor_20_ep);
		let show_alteration_alter_armor_30_ep = get_bool(values.show_alteration_alter_armor_30_ep);
		let show_alteration_alter_armor_40_ep = get_bool(values.show_alteration_alter_armor_40_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = [
			{ name: 'add magic',    duration: dur_concentration         },
			{ name: 'remove magic', duration: dur_short_rest_w_checks_1 }
		];
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, '0', '0', '0');
		let tier1_effect = 										'{{10 EP=Add/remove magic}} ';
		let tier2_effect = (show_alteration_alter_armor_20_ep ? `{{20 EP=Add/remove eldritch${_or}Greater energy armor}} ` : '');
		let tier3_effect = (show_alteration_alter_armor_30_ep ? '{{30 EP=Add/remove epic}} ' : '');
		let tier4_effect = (show_alteration_alter_armor_40_ep ? '{{40 EP=Add/remove legendary}} ' : '');
		let power_text   = (show_alteration_alter_armor_20_ep ? _pow + 'Any armor you wear becomes magic for as long as youre wearing it.' : '');
		let tier2_text   = (show_alteration_alter_armor_20_ep ? _rn + 'Alternatively, for 20 EP, you can make energy armor into greater energy armor (for ' +
		'all damage types the armor protects against). You can add this version of the spell to a typical version of this spell in a single casting, ' +
		'but you must pay the totalled EP cost for both versions.' : '');
		let desc = "*Alter armor* can add or remove magic, eldritch, epic, or legendary bonuses from armor, based on your tier in Alteration " +
		"and how much EP you spend. " + power_text + _rn +
		"Armor that you make magic with this spell is also energy armor of " + tier_effect_alteration(tier, 1, ' damage types') + " you know. If you target " +
		"magic armor of a given tier (magic, eldritch, etc.) with a spell of that same tier, you can add one extra damage type to the energy armor." + tier2_text +
		_rn + "If you target an area with this spell, it can only affect one suit of armor per affected square. The DR bonuses granted by this spell " +
		"do not stack with those from magic, eldritch, epic, or legendary armor, nor do they stack with DR bonuses from the Conjuration (armor) spell." + 
		spend_pool_alteration('increase the DR further, at a cost of 1 point per additional 1 DR. You can also add protection against damage types you know at ' +
		'a cost of 1 point per additional type. ' + _rn + _star + ' If you know the secondary effect for a damage type this spell protects against, you can ' +
		'spend 3 pool points to make the spell negate the secondary effect of that damage type against ' + tier_effect_alteration(tier, 1, ' successful attacks') + 
		' each round.');
		let roll_text = get_spell_info('Alteration (alter armor)', '2 AP', range + ' squares', base_duration, duration_bonus, area_type_list,
		'Item', 'Physical Resilience', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc, true);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:alterationalterarmor10ep", function() {
	cast_alter_armor(10);
});

on("clicked:alterationalterarmor20ep", function() {
	cast_alter_armor(20);
});

on("clicked:alterationalterarmor30ep", function() {
	cast_alter_armor(30);
});

on("clicked:alterationalterarmor40ep", function() {
	cast_alter_armor(40);
});

on("clicked:alterationalterweaponinfo", function() {
	getAttrs(["alteration_tier", "show_alteration_alter_weapon_10_ep", "show_alteration_alter_weapon_20_ep", "show_alteration_alter_weapon_30_ep", "show_alteration_alter_weapon_40_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst"], function(values) {
		let tier = get_int_or_zero(values.alteration_tier);
		let show_alteration_alter_weapon_10_ep = get_bool(values.show_alteration_alter_weapon_10_ep);
		let show_alteration_alter_weapon_20_ep = get_bool(values.show_alteration_alter_weapon_20_ep);
		let show_alteration_alter_weapon_30_ep = get_bool(values.show_alteration_alter_weapon_30_ep);
		let show_alteration_alter_weapon_40_ep = get_bool(values.show_alteration_alter_weapon_40_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = [
			{ name: 'add magic',    duration: dur_concentration         },
			{ name: 'remove magic', duration: dur_short_rest_w_checks_1 }
		];
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, '0', '0', '0');
		let tier1_effect = 										 '{{10 EP=Add/remove magic}} ';
		let tier2_effect = (show_alteration_alter_weapon_20_ep ? `{{20 EP=Add/remove eldritch${_or}Energy weapon}} ` : '');
		let tier3_effect = (show_alteration_alter_weapon_30_ep ? `{{30 EP=Add/remove epic${_or}Greater energy weapon}} ` : '');
		let tier4_effect = (show_alteration_alter_weapon_40_ep ? '{{40 EP=Add/remove legendary}} ' : '');
		let power_text   = (show_alteration_alter_weapon_20_ep ? _pow + 'Any weapon you wield becomes a magic weapon for as long as youre wielding it.' : '');
		let tier2_text   = (show_alteration_alter_weapon_20_ep ? _rn + 'Alternatively, for 20 EP, you can change a magic weapon into an energy weapon. You ' +
		'can add this version of the spell to a typical version of this spell in a single casting, but you must pay the totalled EP cost for both versions.' : '');
		let tier3_text   = (show_alteration_alter_weapon_30_ep ? _rn + 'Alternatively, for 30 EP, you can change a magic weapon into a greater energy weapon. ' +
		'You can add this version of the spell to a typical version of this spell in a single casting, but you must pay the totalled EP cost for both versions.' 
		: '');
		let desc = "*Alter weapon* can add or remove magic, eldritch, epic, or legendary bonuses from weapons, based on your tier in Alteration and how " +
		"much EP you spend. The additional magic damage these weapons cause can be of any type you know." + power_text + tier2_text + tier3_text + _rn + 
		"If you target an area with this spell, it can only affect one weapon per affected square. The damage bonuses granted by this spell can be of any " +
		"damage type you know, and do not stack with those from magic, eldritch, epic, or legendary weapons." + spend_pool_alteration('increase the damage ' +
		'further, at a cost of 4 points per additional die. ' + _rn + _star + ' If you know the secondary effect for a damage type this spell adds to the ' +
		'weapon, you can spend 3 pool points to make targets suffer the secondary effect of that damage type on up to ' + 
		tier_effect_alteration(tier, 1, ' successful attacks') + ' each round. If the secondary effect is additional damage, targets suffer the same damage ' +
		'added to the weapon by this spell.');
		let roll_text = get_spell_info('Alteration (alter weapon)', '2 AP', range + ' squares', base_duration, duration_bonus, area_type_list,
		'Item', 'Physical Resilience', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc, true);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:alterationalterweapon10ep", function() {
	cast_alter_weapon(10);
});

on("clicked:alterationalterweapon20ep", function() {
	cast_alter_weapon(20);
});

on("clicked:alterationalterweapon30ep", function() {
	cast_alter_weapon(30);
});

on("clicked:alterationalterweapon40ep", function() {
	cast_alter_weapon(40);
});

on("clicked:alterationchangesizeinfo", function() {
	getAttrs(["alteration_tier", "show_alteration_change_size_10_ep", "show_alteration_change_size_20_ep", "show_alteration_change_size_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.alteration_tier);
		let show_alteration_change_size_10_ep = get_bool(values.show_alteration_change_size_10_ep);
		let show_alteration_change_size_20_ep = get_bool(values.show_alteration_change_size_20_ep);
		let show_alteration_change_size_30_ep = get_bool(values.show_alteration_change_size_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let area_types = _bolt_touch;
		if (show_alteration_change_size_30_ep) {
			area_types = [
				{ name: '10 or 20 EP', types: _bolt_touch    },
				{ name: '30 EP',       types: area_type_list }
			];
		}
		let boon_10ep = `Large Size${_or}Small Size`;
		let boon_20ep = `Huge Size${_or}Tiny Size`;
		let tier1_effect = 										`{{10 EP=${boon_10ep}}} `;
		let tier2_effect = (show_alteration_change_size_20_ep ? `{{20 EP=${boon_20ep}}} ` : '');
		let tier3_effect = (show_alteration_change_size_30_ep ? `{{30 EP=${boon_10ep}${_or}${boon_20ep}}} ` : '');
		let tier2_text = (show_alteration_change_size_20_ep ? _pow + 'Once per short or long rest, can spend 2 AP to grant yourself either the Large Size or ' +
		'Small Size boon for ' + tier_effect(tier, 1, ' rounds', 'Alteration', '', 0, 3) + '.' : '');
		let desc = "*Change size* increases or decreases the size of the target creature, granting it a size-related monstrous boon for the duration. " +
		"Equipment carried by the target resizes appropriately. If you try to increase the size of a creature so that it would be too big to fit " +
		"in the space its in, the spell fails." + tier2_text;
		let roll_text = get_spell_info('Alteration (change size)', '2 AP', range + ' squares', dur_concentration, duration_bonus, area_types,
		'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:alterationchangesize10ep", function() {
	cast_change_size(10);
});

on("clicked:alterationchangesize20ep", function() {
	cast_change_size(20);
});

on("clicked:alterationchangesize30ep", function() {
	cast_change_size(30);
});

on("clicked:alterationilluminateinfo", function() {
	getAttrs(["alteration_tier", "show_alteration_illuminate_10_ep", "show_alteration_illuminate_20_ep", "show_alteration_illuminate_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.alteration_tier);
		let show_alteration_illuminate_10_ep = get_bool(values.show_alteration_illuminate_10_ep);
		let show_alteration_illuminate_20_ep = get_bool(values.show_alteration_illuminate_20_ep);
		let show_alteration_illuminate_30_ep = get_bool(values.show_alteration_illuminate_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = dur_concentration_w_pool;
		if (show_alteration_illuminate_30_ep) {
			base_duration = [
				{ name: '10 or 20 EP', duration: dur_concentration_w_pool },
				{ name: '30 EP',       duration: dur_short_rest_p_linger  }
			];
		}
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, '0', values.area_type_nova, '0');
		let tier3_ep = (show_alteration_illuminate_30_ep ? '20 or 30' : '20');
		let tier1_effect = `{{10 EP=Items shine like torches${_or}Area covered in darkness}} `;
		let tier2_effect = (show_alteration_illuminate_20_ep ? `{{${tier3_ep} EP=Items shine like doubled torches${_or}Area covered in deep darkness}} ` : '');
		let tier1_text = _rn + 'For 10 EP, you can make the target items shed light as a torch for the duration. Alternatively, you can target ' +
		'an area and blanket it in darkness. Creatures with the Infravision boon can still see through it.';
		let tier2_text = (show_alteration_illuminate_20_ep ? _rn + 'For 20 EP, you can make the target items shine brighter, out to a 16-square ' +
		'nova or 40-foot radius. Alternatively, you can target an area and blanket it in deep darkness. Even creatures with the Infravision ' +
		'boon cannot see through it.' : '');
		let tier3_text = (show_alteration_illuminate_30_ep ? _rn + 'For 30 EP, you can cast the 20 EP version of this spell, but the base duration ' +
		'becomes short rest plus linger.' : '');
		let desc = "This spell changes the illumination level in the area or around the target. " + _pow + "You can spend 1 AP to turn your arcane focus into " +
		"a light source that illuminates like a torch (a 8-square nova or 20-foot radius). The duration of this effect is permanent, and you can spend 1 AP " +
		"to dismiss it." + tier1_text + tier2_text + tier3_text + spend_pool_alteration('increase the light radius at a cost of 2 points per extra square of ' +
		'the nova, or 4 points per extra five feet of radius.');
		let roll_text = get_spell_info('Alteration (illuminate)', '2 AP', range + ' squares', base_duration, duration_bonus, area_type_list,
		'Area or item', 'Physical Resilience', tier1_effect + tier2_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:alterationilluminate10ep", function() {
	cast_illuminate(10);
});

on("clicked:alterationilluminate20ep", function() {
	cast_illuminate(20);
});

on("clicked:alterationilluminate30ep", function() {
	cast_illuminate(30);
});

on("clicked:alterationindurateinfo", function() {
	getAttrs(["alteration_tier", "show_alteration_indurate_15_ep", "show_alteration_indurate_30_ep", "show_alteration_indurate_45_ep", "spell_duration_bonus", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.alteration_tier);
		let show_alteration_indurate_15_ep = get_bool(values.show_alteration_indurate_15_ep);
		let show_alteration_indurate_30_ep = get_bool(values.show_alteration_indurate_30_ep);
		let show_alteration_indurate_45_ep = get_bool(values.show_alteration_indurate_45_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = dur_short_rest_w_checks_1;
		let range = get_int_or_zero(values.spell_range);
		let tier1_effect = 									 '{{15 EP=Fatigued, move 1 sq}} ';
		let tier2_effect = (show_alteration_indurate_30_ep ? '{{30 EP=Indurated}} ' : '');
		let tier1_text = 								   _rn + "For 15 EP, you partially indurate the target, causing them the fatigued condition for the duration. The target also loses an additional square of movement."
		let tier2_text = (show_alteration_indurate_30_ep ? _rn + "For 30 EP, you totally indurate the target for the duration." : "");
		let tier3_text = (show_alteration_indurate_45_ep ? _rn + "For 45 EP, you totally indurate the target, and the base duration of the spell becomes short rest plus linger." : "");
		if (show_alteration_indurate_45_ep) {
			base_duration = [
				{ name: '15 or 30 EP', duration: dur_short_rest_w_checks_1 },
				{ name: '45 EP',       duration: dur_short_rest_p_linger   }
			];
			tier2_effect = tier2_effect.replace('30 EP', '30 or 45 EP');
		}
		let desc = "This spell changes a living creature into a statue made of some common substance, such as stone, wood or glass. Indurate automatically " +
		"fails if cast on anything other than a living creature." + _pow + "You gain advantage on Physical Resilience (fortitude) checks to resist another " +
		"casters *indurate* spell." + tier1_text + tier2_text + tier3_text +
		_rn + "Anything done to the newly created statue is also done to the creature when they revert to their normal form. However, if the " +
		"statue is in relatively the same state, the creature is unharmed." + _rn + "For example, if you petrify a human, and then crack off one " +
		"of their arms, when they revert to human form the effect will be the same as having chopped off their arm. If, however, someone holds the arm " +
		"against the statue at the point where it broke when they revert back, the person will be whole and unharmed.";
		let roll_text = get_spell_info('Alteration (indurate)', '2 AP', range + ' squares', base_duration, duration_bonus, _bolt_touch,
		'Creature', 'Physical Resilience', tier1_effect + tier2_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:alterationindurate15ep", function() {
	cast_indurate(15);
});

on("clicked:alterationindurate30ep", function() {
	cast_indurate(30);
});

on("clicked:alterationindurate45ep", function() {
	cast_indurate(45);
});

on("clicked:biomancydetoxifyinfo", function() {
	getAttrs(["biomancy_tier", "show_biomancy_detoxify_10_ep", "show_biomancy_detoxify_20_ep", "show_biomancy_detoxify_30_ep", "show_biomancy_detoxify_40_ep", "spell_range", "spell_area_size", "area_type_nova"], function(values) {
		let tier = get_int_or_zero(values.biomancy_tier);
		let show_biomancy_detoxify_10_ep = get_bool(values.show_biomancy_detoxify_10_ep);
		let show_biomancy_detoxify_20_ep = get_bool(values.show_biomancy_detoxify_20_ep);
		let show_biomancy_detoxify_30_ep = get_bool(values.show_biomancy_detoxify_30_ep);
		let show_biomancy_detoxify_40_ep = get_bool(values.show_biomancy_detoxify_40_ep);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let nova_area = (values.area_type_nova == 'on' ? `${_n}Nova (${area_size} sq)` : '');
		let tier1_effect =								   `{{5 EP=Advantage${_or}Replace checks}} ` +
														   `{{10 EP=Cure tier [[1]]${_or}Advantage${_or}Replace checks}} `;
		let tier2_effect = (show_biomancy_detoxify_20_ep ? `{{20 EP=Cure tier [[2]] or less${_or}Advantage${_or}Replace checks}} ` : '');
		let tier3_effect = (show_biomancy_detoxify_30_ep ? `{{30 EP=Cure tier [[3]] or less${_or}Advantage${_or}Replace checks}} ` : '');
		let tier4_effect = (show_biomancy_detoxify_40_ep ? `{{40 EP=Cure tier [[4]] or less${_or}Advantage${_or}Replace checks}} ` : '');
		let tier2_text = (show_biomancy_detoxify_20_ep ? ' or higher' : '');
		let tier1_text = _rn + "For 5 EP, you can affect all of the target creatures future Physical Resilience (constitution) checks against one " +
		"single poison or disease. You can choose to either grant the afflicted creature advantage on their checks, or replace their checks with " +
		"your Biomancy (detoxify) checks." +
		_rn + "For 10 EP" + tier2_text + ", you can affect up to " + tier_effect_biomancy(tier, 1, '') + " diseases or poisons. If the disease or " +
		"poison is equal to or under the tier listed based on the EP you spend, it is automatically cured. If not, you can choose to either grant " +
		"the afflicted creature advantage on their checks, or replace their checks with your Biomancy (detoxify) checks. You can choose different " +
		"options for each affected disease or poison.";
		let desc = "This spell can help the target creatures fight off one or more diseases or poisons, or even completely cure them. If the " +
		"disease or poison is magic, you must make a successful Biomancy check against the target poison or diseases TN to successfully affect " +
		"it. If affecting multiple magical diseases or poisons, make a separate Biomancy check against each one. " + _pow + "You gain advantage on " + 
		"First Aid checks to treat poison and disease." + tier1_text;
		let roll_text = get_spell_info('Biomancy (detoxify)', '2 AP', range + ' squares', dur_instantaneous, 0, `Bolt${nova_area}${_n}Touch`,
		'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:biomancydetoxify5ep", function() {
	cast_detoxify(5);
});

on("clicked:biomancydetoxify10ep", function() {
	cast_detoxify(10);
});

on("clicked:biomancydetoxify20ep", function() {
	cast_detoxify(20);
});

on("clicked:biomancydetoxify30ep", function() {
	cast_detoxify(30);
});

on("clicked:biomancydetoxify40ep", function() {
	cast_detoxify(40);
});

on("clicked:biomancyhealdamageinfo", function() {
	getAttrs(["biomancy_tier", "biomancy_attribute_name", "biomancy_attribute_modifier", "show_biomancy_heal_damage_10_ep", "show_biomancy_heal_damage_20_ep", "show_biomancy_heal_damage_30_ep", "show_biomancy_heal_damage_40_ep", "spell_duration", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.biomancy_tier);
		let attribute_name = values.biomancy_attribute_name;
		let attribute_mod = get_int_or_zero(values.biomancy_attribute_modifier);
		let show_biomancy_heal_damage_10_ep = get_bool(values.show_biomancy_heal_damage_10_ep);
		let show_biomancy_heal_damage_20_ep = get_bool(values.show_biomancy_heal_damage_20_ep);
		let show_biomancy_heal_damage_30_ep = get_bool(values.show_biomancy_heal_damage_30_ep);
		let show_biomancy_heal_damage_40_ep = get_bool(values.show_biomancy_heal_damage_40_ep);
		let duration = get_int_or_zero(values.spell_duration);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let damage_text = attribute_mod_effect(attribute_name, attribute_mod) + ' damage'; 
		let tier1_effect = 									  '{{5'  + tier_effect_biomancy(tier, 1, 'd6',  ' EP=Heal ', 1) + damage_text + '}} ' +
															  '{{10' + tier_effect_biomancy(tier, 1, 'd10', ' EP=Heal ', 1) + damage_text + '}} ';
		let tier2_effect = (show_biomancy_heal_damage_20_ep ? '{{20' + tier_effect_biomancy(tier, 2, 'd6',  ' EP=Heal ', 1) + damage_text + '}} ' : '');
		let tier3_effect = (show_biomancy_heal_damage_30_ep ? '{{30' + tier_effect_biomancy(tier, 2, 'd10', ' EP=Heal ', 1) + damage_text + '}} ' : '');
		let tier4_effect = (show_biomancy_heal_damage_40_ep ? '{{40' + tier_effect_biomancy(tier, 4, 'd6',  ' EP=Heal ', 1) + damage_text + '}} ' : '');
		let desc = "This spell can be used to heal Hit Points." + _pow + "You gain advantage on Medicine checks made to increase short or long rest healing." + 
		_rn + "The amount of damage you heal is based on your tier and how much EP you spend. " +
		spend_pool_biomancy('increase the healing further, at a cost of 2 points per additional die.');
		let roll_text = get_spell_info('Biomancy (heal damage)', '2 AP', range + ' squares', dur_instantaneous, 0, area_type_list,
		'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:biomancyhealdamage5ep", function() {
	cast_heal_damage(5);
});

on("clicked:biomancyhealdamage10ep", function() {
	cast_heal_damage(10);
});

on("clicked:biomancyhealdamage20ep", function() {
	cast_heal_damage(20);
});

on("clicked:biomancyhealdamage30ep", function() {
	cast_heal_damage(30);
});

on("clicked:biomancyhealdamage40ep", function() {
	cast_heal_damage(40);
});

on("clicked:biomancyregenerateinfo", function() {
	getAttrs(["biomancy_tier", "biomancy_attribute_name", "biomancy_attribute_modifier", "show_biomancy_regenerate_30_ep", "show_biomancy_regenerate_60_ep", "show_biomancy_regenerate_90_ep", "show_biomancy_regenerate_120_ep"], function(values) {
		let tier           = get_int_or_zero(values.biomancy_tier);
		let attribute_name = values.biomancy_attribute_name;
		let attribute_mod  = get_int_or_zero(values.biomancy_attribute_modifier);
		let show_biomancy_regenerate_30_ep  = get_bool(values.show_biomancy_regenerate_30_ep );
		let show_biomancy_regenerate_60_ep  = get_bool(values.show_biomancy_regenerate_60_ep );
		let show_biomancy_regenerate_90_ep  = get_bool(values.show_biomancy_regenerate_90_ep );
		let show_biomancy_regenerate_120_ep = get_bool(values.show_biomancy_regenerate_120_ep);
		let tier2_value = tier_effect_biomancy(tier,  5, ' days');
		let tier3_value = tier_effect_biomancy(tier,  5, ' years');
		let tier4_value = tier_effect_biomancy(tier, 50, ' years');
		let tier1_effect = 									  '{{30 EP=Regrow limbs}} ';
		let tier2_effect = (show_biomancy_regenerate_60_ep  ? '{{60 EP=Resurrect dead '  + tier2_value + '; TN **30**}} ' : '');
		let tier3_effect = (show_biomancy_regenerate_90_ep  ? '{{90 EP=Resurrect dead '  + tier3_value + '; TN **40**}} ' : '');
		let tier4_effect = (show_biomancy_regenerate_120_ep ? '{{120 EP=Resurrect dead ' + tier4_value + '; TN **50**}} ' : '');
		let tier1_text = _rn + "For 30 EP, you can cause the target creature to regrow lost limbs and heal broken bones and other internal injuries. " +
		"If the limbs are touching the part they were severed from, they reattach in one round. Otherwise they regenerate slowly over 10 minutes. The " +
		"target creature also heals " + tier_effect_biomancy(tier, 1, 'd6') + attribute_mod_effect(attribute_name, attribute_mod) + " damage.";
		let tier2_text = (show_biomancy_regenerate_60_ep ? _rn + "For 60 EP, you can resurrect a creature that has been dead for up to " + tier2_value + 
		". Upon being resurrected, the creature is placed on 1 HP and 1 EP, is nauseated until they take a short rest, " +
		"and sickened until they take a long rest. " + get_crit_text('the target gains HP and EP as if it had taken a short rest and has conditions, ' +
		'poisons and diseases removed as per a 20 EP *detoxify* and *revivify*. This does not affect the conditions incurred by this spell.', 
		'any future attempts by you to resurrect the target creature incur great disadvantage on the Biomancy check.') : '');
		let tier2_spend_pool = (show_biomancy_regenerate_60_ep ? spend_pool_biomancy('increase the age a corpse can be that you resurrect, at a cost of ' +
		'3 points per 1 unit of time (5 days, 5 years or 50 years, depending on the version of the spell cast).') : '');
		let tier3_text = (show_biomancy_regenerate_90_ep ? _rn + "For 90 EP, you can resurrect a creature that has been dead for up to " + tier3_value + 
		". You dont need the body for this version of the spell; anything that was once part of their body will do (even a single hair). " +
		"Upon being resurrected, the creature is placed on HP and EP as if it had taken a short rest, and is sickened until they take a long rest. " +
		get_crit_text('the target gains HP and EP as if it had taken a long rest and has conditions, poisons and diseases removed as per a ' +
		'30 EP *detoxify* and *revivify*, as well as a 10 EP *regenerate*. This does not affect the conditions incurred by this spell.', 
		'any future attempts by you to resurrect the target creature incur disadvantage on the Biomancy check.') : '');
		let tier4_text = (show_biomancy_regenerate_120_ep ? _rn + "For 120 EP, you can resurrect a creature that has been dead for up to " + tier4_value + 
		". You dont need the body or body part for this version of the spell; you simply need to speak the creatures full name aloud. " +
		"Upon being resurrected, the creature is placed on full HP and EP. " + get_crit_text('the target has conditions, poisons and diseases removed ' +
		'as per a 40 EP *detoxify* and *revivify*, as well as a 10 EP *regenerate*.', 'any future attempt to resurrect the creature incurs disadvantage ' +
		'on the Biomancy check.') : '');
		let desc = "This spell can cause the target creature to regrow lost limbs or bring them back to life. Regenerate automatically fails if cast " +
		"on anything other than a living (or recently deceased) creature." + _rn + "If bringing a creature back to life, your Biomancy check when you " +
		"cast this spell must meet or exceed a specific Target Number or the spell fails. Creatures come back in the condition they were in just " +
		"before they died, so if they have injuries, diseases, poisons, etc., they are still present when the creature is resurrected. You cannot " +
		"bring back a creature who has died of natural causes." +
		_pow + "You can spend 1 AP to touch a dying creature and instantly stabilize them as if they had succeeded on three recovery checks." +
		tier1_text + tier2_text + tier3_text + tier4_text + spend_pool_biomancy('increase the healing of this spell, at a cost of 2 points per ' +
		'additional 1d6.') + tier2_spend_pool;
		let roll_text = get_spell_info('Biomancy (resurrect)', '3 AP', null, dur_instantaneous, 0, 'Touch',
		'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:biomancyregenerate30ep", function() {
	cast_regenerate(30);
});

on("clicked:biomancyregenerate60ep", function() {
	cast_regenerate(60);
});

on("clicked:biomancyregenerate90ep", function() {
	cast_regenerate(90);
});

on("clicked:biomancyregenerate120ep", function() {
	cast_regenerate(120);
});

on("clicked:biomancyrevivifyinfo", function() {
	getAttrs(["biomancy_tier", "show_biomancy_revivify_10_ep", "show_biomancy_revivify_20_ep", "show_biomancy_revivify_30_ep", "spell_range", "spell_area_size", "area_type_nova"], function(values) {
		let tier = get_int_or_zero(values.biomancy_tier);
		let show_biomancy_revivify_10_ep = get_bool(values.show_biomancy_revivify_10_ep );
		let show_biomancy_revivify_20_ep = get_bool(values.show_biomancy_revivify_20_ep );
		let show_biomancy_revivify_30_ep = get_bool(values.show_biomancy_revivify_30_ep );
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let nova_area = (values.area_type_nova == 'on' ? `${_n}Nova (${area_size} sq)` : '');
		let tier1_effect = 								   '{{10 EP=10 EP list}} ';
		let tier2_effect = (show_biomancy_revivify_20_ep ? '{{20 EP=20 EP list}} ' : '');
		let tier3_effect = (show_biomancy_revivify_30_ep ? '{{30 EP=30 EP list}} ' : '');
		let tier1_text = 								 `${header_text('10 EP List', false)}${_bull}Alleviate the deafened condition${_bull}Alleviate the fatigued condition${_bull}Alleviate the sickened condition${_bull}Alleviate the slowed condition  (each AP of slowness counts as a separate condition)`;
		let tier2_text = (show_biomancy_revivify_20_ep ? `${header_text('20 EP List', false)}${_bull}Alleviate the blinded condition${_bull}Reduce the nauseated condition to sickened${_bull}Reduce the paralyzed condition to slowed (2 AP)${_bull}Alleviate up to ${tier_effect_biomancy(tier, 1, ' conditions')} from the 10 EP list` : '');
		let tier3_text = (show_biomancy_revivify_30_ep ? `${header_text('30 EP List', false)}${_bull}Any **2** items from the 20 EP list${_bull}Alleviate the nauseated condition${_bull}Alleviate the paralyzed condition${_bull}Reverse the effects of the Alteration (indurate) spell, reverting the statue back to a living creature` : '');
		let desc = "This spell can remove one or more physical conditions from the target, based on the amount of EP spent. *Revivify* " +
		"automatically fails if cast on anything other than a living creature. " + _pow + "When you attempt a second Physical Resilience check to " +
		"shake off a spell or effect that causes one of the conditions alleviated by this spell, it only costs 2 pool points. In addition, you can attempt " +
		"two such checks on two successive turns." + tier1_text + tier2_text + tier3_text + 
		_rn + "You can alleviate more than one condition with a single casting of any version of this spell, but you must pay for " +
		"each separately.";
		let roll_text = get_spell_info('Biomancy (revivify)', '2 AP', range + ' squares', dur_instantaneous, 0, `Bolt${nova_area}${_n}Touch`,
		'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:biomancyrevivify10ep", function() {
	cast_revivify(10);
});

on("clicked:biomancyrevivify20ep", function() {
	cast_revivify(20);
});

on("clicked:biomancyrevivify30ep", function() {
	cast_revivify(30);
});

on("clicked:biomancysustaininfo", function() {
	getAttrs(["biomancy_tier", "show_biomancy_sustain_10_ep", "show_biomancy_sustain_20_ep", "spell_range", "spell_area_size", "area_type_nova"], function(values) {
		let tier = get_int_or_zero(values.biomancy_tier);
		let show_biomancy_sustain_10_ep = get_bool(values.show_biomancy_sustain_10_ep );
		let show_biomancy_sustain_20_ep = get_bool(values.show_biomancy_sustain_20_ep );
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let nova_area = (values.area_type_nova == 'on' ? `${_n}Nova (${area_size} sq)` : '');
		let effect_3 = tier_effect_biomancy(tier, 3, ' people');
		let effect_6 = tier_effect_biomancy(tier, 6, ' people');
		let tier1_effect = `{{5 EP=Hard rations for ${effect_3}${_or}Restore spoiled food in the area}} {{10 EP=Cooked food for ${effect_3}${_or}Ingredients for ${effect_6}}} `
		let tier2_effect = (show_biomancy_sustain_20_ep ? `{{20 EP=Sustain${effect_6}}}` : '');
		let tier1_text = _rn + "For 5 EP, you can create enough hard rations to sustain up to " + effect_3 + " for one day. " +
		_rn + "Alternatively, you can restore any spoiled or rotten food and drinks in the spells area so they are clean, fresh and " +
		"safe to eat or drink." + _rn + "For 10 EP, you can create enough fully cooked, ready to eat food and enough fresh, clean water " +
		"to sustain up to " + effect_3 + " for one day." + _rn + "Alternatively, you can create enough ingredients and clean water to " +
		"sustain up to " + effect_6 + " for one day, provided the ingredients are stored and cooked properly.";
		let tier2_text = (show_biomancy_sustain_20_ep ? _rn + "For 20 EP, you can sustain up to " + effect_6 + " for one day. The targets do not " +
		"need to eat or drink, and are sustained as if they had." : "");
		let desc = "*Sustain* can sustain you and your allies, by creating food or just through pure magic." + _pow + "You do not need to eat or drink, and " +
		"are sustained as if you had." + tier1_text + tier2_text + 
		spend_pool_biomancy('sustain more people, at a rate of one point per one extra person for a given casting of this spell.');
		let roll_text = get_spell_info('Biomancy (sustain)', '10 minutes', range + ' squares', dur_instantaneous, 0, `Bolt${nova_area}${_n}Touch`,
		'Area', 'Auto (willing)', tier1_effect + tier2_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:biomancysustain5ep", function() {
	cast_sustain(5);
});

on("clicked:biomancysustain10ep", function() {
	cast_sustain(10);
});

on("clicked:biomancysustain20ep", function() {
	cast_sustain(20);
});

on("clicked:biomancyturnundeadinfo", function() {
	getAttrs(["biomancy_tier", "show_biomancy_turn_undead_10_ep", "show_biomancy_turn_undead_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.biomancy_tier);
		let show_biomancy_turn_undead_10_ep = get_bool(values.show_biomancy_turn_undead_10_ep );
		let show_biomancy_turn_undead_30_ep = get_bool(values.show_biomancy_turn_undead_30_ep );
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let tier1_effect = 									  '{{10 EP=Targets are **scared**}} ';
		let tier3_effect = (show_biomancy_turn_undead_30_ep ? '{{30 EP=Targets are **terrified**}} ' : '');
		let tier3_text = (show_biomancy_turn_undead_30_ep ? _rn + "For 30 EP, you can impose the **terrified** condition on the target(s)." : "");
		let desc = "This spell causes fear in undead creatures, and can even affect creatures with the Mindless or Fear Immunity monstrous boons. " +
		"*Turn undead* can only be cast on creatures with the Undead monstrous boon; casting on any other target causes the spell to fail. " +
		_pow + "You can use a Biomancy (turn undead) check as if it were a Persuade (intimidate) check to demoralize or taunt an undead creature, even if it " +
		"is mindless." +
		_rn + "Unlike most other spells, turn undead can cause a critical success or critical failure even when cast with a larger " +
		"area type. In such a case, you are considered to have critically failed if more than half of the targets critically succeed on their " +
		"Mental Resilience (willpower) checks. " +
		_rn + "If there are any undead in the spells area under the control of a necromancer, the necromancer " +
		"can make a check to resist on behalf of each undead creature under their control. " + get_crit_text(
		'the target is **terrified** instead of **scared**.', "you are **scared** for the spell's duration.") + tier3_text;
		let roll_text = get_spell_info('Biomancy (turn undead)', '2 AP', range + ' squares', dur_short_rest_w_checks_1, duration_bonus, area_type_list,
		'Creature', 'Mental Resilience', tier1_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:biomancyturnundead10ep", function() {
	cast_turn_undead(10);
});

on("clicked:biomancyturnundead30ep", function() {
	cast_turn_undead(30);
});

on("clicked:conjurationarmorinfo", function() {
	getAttrs(["conjuration_tier", "show_conjuration_armor_10_ep", "show_conjuration_armor_20_ep", "show_conjuration_armor_30_ep", "show_conjuration_armor_40_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.conjuration_tier);
		let show_conjuration_armor_10_ep = get_bool(values.show_conjuration_armor_10_ep );
		let show_conjuration_armor_20_ep = get_bool(values.show_conjuration_armor_20_ep );
		let show_conjuration_armor_30_ep = get_bool(values.show_conjuration_armor_30_ep );
		let show_conjuration_armor_40_ep = get_bool(values.show_conjuration_armor_40_ep );
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let tier1_effect = 								   '{{5 EP='  + tier_effect_conjuration(tier, 3, '', 'DR ',  4/3) + '}} ' +
														   '{{10 EP=' + tier_effect_conjuration(tier, 4, '', 'DR ',  6/4) + '}} ';
		let tier2_effect = (show_conjuration_armor_20_ep ? '{{20 EP=' + tier_effect_conjuration(tier, 5, '', 'DR ',  8/5) + '}} ' : '');
		let tier3_effect = (show_conjuration_armor_30_ep ? '{{30 EP=' + tier_effect_conjuration(tier, 6, '', 'DR ', 10/6) + '}} ' : '');
		let tier4_effect = (show_conjuration_armor_40_ep ? '{{40 EP=' + tier_effect_conjuration(tier, 7, '', 'DR ', 12/7) + '}} ' : '');
		let desc = "With this spell, you envelop a target in magical armor, protecting them from harm. " + _pow + 
		"You gain " + tier_effect_conjuration(tier, 3, '', 'DR ') + ", which applies to every damage type you know." +
		_rn + "You can give a target of this spell DR for up to " + tier_effect_conjuration(tier, 1, '') + " damages type you know, based on the " +
		"amount of EP you spend. You can grant DR against " +
		"more than one set of damage types with a single casting of *armor*, but you must pay the EP cost for each separately." + _rn + "The DR granted by " +
		"this spell does not stack with DR from any armor worn." +
		spend_pool_conjuration('increase the DR further, at a cost of 1 point per additional 2 DR. You can also add protection against damage types you know ' +
		'at a cost of 1 point per additional type.' + _rn + _star + ' If you know the secondary effect for a damage type this spell protects against, you can ' +
		'make the spell negate the secondary effect of that damage type for up to '  + tier_effect_conjuration(tier, 1, ' successful attacks') + '.');
		let roll_text = get_spell_info('Conjuration (armor)', '2 AP', range + ' squares', dur_concentration_w_pool, duration_bonus, area_type_list,
		'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect + tier4_effect + '{{Damage Types=Any ' + 
		tier_effect_conjuration(tier, 1, '') + ' you know}} ', desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:conjurationarmor5ep", function() {
	cast_armor(5);
});

on("clicked:conjurationarmor10ep", function() {
	cast_armor(10);
});

on("clicked:conjurationarmor20ep", function() {
	cast_armor(20);
});

on("clicked:conjurationarmor30ep", function() {
	cast_armor(30);
});

on("clicked:conjurationarmor40ep", function() {
	cast_armor(40);
});

on("clicked:conjurationbarrierinfo", function() {
	getAttrs(["conjuration_tier", "show_conjuration_barrier_15_ep", "show_conjuration_barrier_30_ep", "show_conjuration_barrier_45_ep", "show_conjuration_barrier_60_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.conjuration_tier);
		let show_conjuration_barrier_15_ep = get_bool(values.show_conjuration_barrier_15_ep );
		let show_conjuration_barrier_30_ep = get_bool(values.show_conjuration_barrier_30_ep );
		let show_conjuration_barrier_45_ep = get_bool(values.show_conjuration_barrier_45_ep );
		let show_conjuration_barrier_60_ep = get_bool(values.show_conjuration_barrier_60_ep );
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = dur_concentration;
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let tier1_effect = 								     '{{15 EP=Standard barrier}} ';
		let tier2_effect = (show_conjuration_barrier_30_ep ? '{{30 EP=Fortified barrier, blocks spells and magic weapons}} ' : '');
		let tier3_effect = (show_conjuration_barrier_45_ep ? '{{45 EP=Fortified barrier, blocks spells and magic weapons, include/exclude creatures}} ' : '');
		if (show_conjuration_barrier_30_ep) {
			base_duration = [
				{ name: '15 EP', duration: dur_concentration        },
				{ name: '30 EP', duration: dur_concentration_w_pool }
			];
		}
		if (show_conjuration_barrier_45_ep) {
			base_duration.push({ name: '45 EP', duration: dur_short_rest });
		}
		if (show_conjuration_barrier_60_ep) {
			base_duration.push({ name: '60 EP', duration: dur_short_rest_p_linger });
			tier3_effect = tier3_effect.replace('45 EP', '45 or 60 EP');
		}
		let tier1_text = _rn + "For 15 EP, you can create a standard barrier. The barrier can be directed inwards, outwards or both. If directed inwards, it " +
		"prevents creatures from entering the spells area, and if directed outwards, it prevents creatures from leaving the spells area. " + _rn +
		"*Barrier* exerts a mental compulsion - any creature who attempts to cross it must make a Mental Resilience (willpower) check, and if they fail, they " +
		"cannot ever cross that barrier. This spell also prevents creatures from throwing or firing non-magical weapons across the barrier, as long as the " +
		"creatures are within " + value_effect('your range spell statistic', range) + " squares of the barrier. It does not prevent magical weapons or spells " + 
		"from crossing the barrier. " + _rn + "By default, the barrier prevents all creatures from crossing it, but you can choose to name one specific " +
		"creature for the barrier to block by speaking their true name while casting the spell. In this case, it only affects that one creature, and they " +
		"suffer disadvantage on their Mental Resilience check to attempt to cross it. ";
		let tier2_text = (show_conjuration_barrier_30_ep ? _rn + "For 30 EP, you can create a fortified barrier with a base duration of concentration with pool points. This barrier works " +
		"like the 15 EP version, but it prevents magical weapons and spells from crossing it. In addition, you can specify a command word at the time of casting, " +
		"and any creature who speaks that word while attempting to cross can cross the barrier freely. Alternatively, you can designate creatures who can ignore " +
		"the barrier by touching them at the time of casting. " : "");
		let tier3_text = (show_conjuration_barrier_45_ep ? _rn + "For 45 EP, you can create a fortified barrier with a base duration of short rest. In addition, you can " +
		"specific creatures or types of creatures who the barrier does or doesnt affect. You must either choose to make it affect everyone other than who you " +
		"specify, or only the creatures you specify. Work with the Game Master to define these rules. " : "");
		let tier4_text = (show_conjuration_barrier_60_ep ? _rn + "For 60 EP, you can create a fortified barrier like the 45 EP version, and the base duration is " +
		"short rest plus linger. " : "");
		let desc = "This spell creates a stationary magic barrier that prevents creatures from crossing it." + _pow + "You gain advantage on Mental " +
		"Resilience (willpower) checks to cross other creatures *barrier* spells." + tier1_text + tier2_text + tier3_text + tier4_text;
		let roll_text = get_spell_info('Conjuration (barrier)', '2 AP', range + ' squares', base_duration, duration_bonus, area_type_list,
		'Area', 'Mental Resilience', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:conjurationbarrier15ep", function() {
	cast_barrier(15);
});

on("clicked:conjurationbarrier30ep", function() {
	cast_barrier(30);
});

on("clicked:conjurationbarrier45ep", function() {
	cast_barrier(45);
});

on("clicked:conjurationbarrier60ep", function() {
	cast_barrier(60);
});

on("clicked:conjurationdifficultterraininfo", function() {
	getAttrs(["conjuration_tier", "show_conjuration_difficult_terrain_10_ep", "show_conjuration_difficult_terrain_20_ep", "show_conjuration_difficult_terrain_30_ep", "show_conjuration_difficult_terrain_40_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.conjuration_tier);
		let show_conjuration_difficult_terrain_10_ep = get_bool(values.show_conjuration_difficult_terrain_10_ep );
		let show_conjuration_difficult_terrain_20_ep = get_bool(values.show_conjuration_difficult_terrain_20_ep );
		let show_conjuration_difficult_terrain_30_ep = get_bool(values.show_conjuration_difficult_terrain_30_ep );
		let show_conjuration_difficult_terrain_40_ep = get_bool(values.show_conjuration_difficult_terrain_40_ep );
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let tier1_effect = 											   '{{5 EP=Difficult terrain}} ' +
																	   '{{10 EP=Difficult terrain and slippery}} ';
		let tier2_effect = (show_conjuration_difficult_terrain_20_ep ? '{{20 EP=Difficult terrain and grasping appendages}} ': '');
		let tier3_effect = (show_conjuration_difficult_terrain_30_ep ? '{{30 EP=Difficult terrain and grasping appendages, designate allies who ignore it}} ': '');
		let tier4_effect = (show_conjuration_difficult_terrain_40_ep ? '{{40 EP=Difficult terrain and grasping appendages, designate allies who ignore and are protected by it}} ': '');
		let tier1_text = header_text('Slippery (10 EP)') + "Every creature in the spells area when the spell is cast, and any creature that spends " +
		"an Action Point to move within or through the area, must make an Athletics (gymnastics) check versus the spells TN or fall prone. Creatures " +
		"make one check per AP spent moving through the area.";
		let tier2_text = (show_conjuration_difficult_terrain_20_ep ? header_text('Grasping appendages (20 EP)') + "Every creature in the spells area " +
		"when the spell is cast, and any creature that spends an Action Point to move within or through the area, they must make an Attack (grapple) or " +
		"Defend check versus the spells TN or become grappled. Creatures make one check per AP spent moving through the area. If they are already " +
		"grappled by the spell, they must make an Attack (grapple) check versus the spells TN or it gets them in a hold. " : '');
		let tier3_text = (show_conjuration_difficult_terrain_30_ep ? header_text('Grasping appendages (30 EP)') + "For 30 EP, you can conjure grasping " +
		"appendages like the 20 EP version of the spell. In addition, you can specify a command word at the time of casting, and any creature who speaks that " +
		"word while entering the spells area is unaffected by the appendages and does not count the area as difficult terrain. Alternatively, you can " +
		"designate creatures who can ignore the terrain by touching them at the time of casting. " : '');
		let tier4_text = (show_conjuration_difficult_terrain_40_ep ? header_text('Grasping appendages (40 EP)') + "For 40 EP, you can conjure grasping " +
		"appendages like the 30 EP version of the spell. In addition, the appendages perform a protect action against any designated creatures while inside " +
		"the spells area, granting them advantage on Defend checks. " : '');
		let desc = "*Difficult terrain* conjures some impediment to normal movement in the area for the duration, creating difficult terrain in the area. " +
		"It can also have additional effects, based on how much EP you spend. Anything conjured by this spell disappears completely when the duration is over. " +
		_pow + "You can walk through areas of difficult terrain without suffering a movement penalty." +
		tier1_text + tier2_text + tier3_text + tier4_text;
		let roll_text = get_spell_info('Conjuration (difficult terrain)', '2 AP', range + ' squares', dur_concentration, duration_bonus, area_type_list,
		'Area', 'N/A (see description)', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:conjurationdifficultterrain5ep", function() {
	cast_difficult_terrain(5);
});

on("clicked:conjurationdifficultterrain10ep", function() {
	cast_difficult_terrain(10);
});

on("clicked:conjurationdifficultterrain20ep", function() {
	cast_difficult_terrain(20);
});

on("clicked:conjurationdifficultterrain30ep", function() {
	cast_difficult_terrain(30);
});

on("clicked:conjurationdifficultterrain40ep", function() {
	cast_difficult_terrain(40);
});

on("clicked:conjurationfabricateinfo", function() {
	getAttrs(["conjuration_tier", "conjuration_attribute_name", "conjuration_attribute_modifier", "show_conjuration_fabricate_10_ep", "show_conjuration_fabricate_20_ep", "show_conjuration_fabricate_30_ep", "show_conjuration_fabricate_40_ep", "ps_conjuration_attack", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.conjuration_tier);
		let attribute_name = values.conjuration_attribute_name;
		let attribute_mod = get_int_or_zero(values.conjuration_attribute_modifier);
		let show_conjuration_fabricate_10_ep = get_bool(values.show_conjuration_fabricate_10_ep);
		let show_conjuration_fabricate_20_ep = get_bool(values.show_conjuration_fabricate_20_ep);
		let show_conjuration_fabricate_30_ep = get_bool(values.show_conjuration_fabricate_30_ep);
		let show_conjuration_fabricate_40_ep = get_bool(values.show_conjuration_fabricate_40_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = [
			{ name: 'fabricate',   duration: dur_concentration },
			{ name: 'repair/heal', duration: dur_instantaneous }
		];
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let damage_text = attribute_mod_effect(attribute_name, attribute_mod) + ' damage'; 

		let basic_attack = '';
		let basic_effect = '';
		let tier1_attack = '';
		let tier2_attack = '';
		let tier3_attack = '';
		let tier4_attack = '';
		let attack_text  = '';
		let or_damage    = '';
		if (get_bool(values.ps_conjuration_attack)) {
			let physical_damage = damage_text.replace('damage', 'physical damage');
			basic_attack = _or + tier_effect_conjuration(tier, 1, 'd6', '', 1) + physical_damage;
			tier1_attack = _or + tier_effect_conjuration(tier, 2, 'd6', '', 1) + physical_damage;
			tier2_attack = _or + tier_effect_conjuration(tier, 3, 'd6', '', 1) + physical_damage;
			tier3_attack = _or + tier_effect_conjuration(tier, 4, 'd6', '', 1) + physical_damage;
			tier4_attack = _or + tier_effect_conjuration(tier, 5, 'd6', '', 1) + physical_damage;
			basic_effect = `{{0 EP=${basic_attack.replace(_or, '')}}}`;
			attack_text  = _rn + "Alternatively, you can use this spell to conjure something heavy and drop in on your target(s), causing physical damage. " +
			"This works like Dynamancy (attack), including the basic attack. The physical damage caused is based on how much EP you spend on it.";
			or_damage = ' or damage';
			base_duration.push({ name: 'attack', duration: dur_instantaneous });
		}

		let tier1_effect = basic_effect +						'{{5 EP=**1** item' + 												' of up to ' + tier_effect_conjuration(tier,  10, ' lbs/gc') + _or + 'Repair/heal ' + tier_effect_conjuration(tier, 1, 'd6',  '', 1) + damage_text + basic_attack + '}} ' +
																'{{10 EP=Up to ' + tier_effect_conjuration(tier, 1, ' items', '') + ' of up to ' + tier_effect_conjuration(tier,  20, ' lbs/gc') + _or + 'Repair/heal ' + tier_effect_conjuration(tier, 1, 'd10', '', 1) + damage_text + tier1_attack + '}} ';
		let tier2_effect = (show_conjuration_fabricate_20_ep  ? '{{20 EP=Up to ' + tier_effect_conjuration(tier, 2, ' items', '') + ' of up to ' + tier_effect_conjuration(tier,  50, ' lbs/gc') + _or + 'Repair/heal ' + tier_effect_conjuration(tier, 2, 'd6',  '', 1) + damage_text + tier2_attack + '}} ' : '');
		let tier3_effect = (show_conjuration_fabricate_30_ep  ? '{{30 EP=Up to ' + tier_effect_conjuration(tier, 3, ' items', '') + ' of up to ' + tier_effect_conjuration(tier, 100, ' lbs/gc') + _or + 'Repair/heal ' + tier_effect_conjuration(tier, 2, 'd10', '', 1) + damage_text + tier3_attack + _or + 'Restore **1 destroyed item**}} ' : '');
		let tier4_effect = (show_conjuration_fabricate_40_ep  ? '{{40 EP=Up to ' + tier_effect_conjuration(tier, 4, ' items', '') + ' of up to ' + tier_effect_conjuration(tier, 250, ' lbs/gc') + _or + 'Repair/heal ' + tier_effect_conjuration(tier, 4, 'd6',  '', 1) + damage_text + tier4_attack + _or + 'Restore ' + tier_effect_conjuration(tier, 1, ' destroyed items') + _or + 'Restore **1 destroyed magic item**}} ' : '');
	
		let desc = "This power can create items, repair items, and heal constructs. Creating items is limited by weight or cost, whichever is " +
		"more restrictive. " + _pow + "For 1 AP, you can create a single item of up to 2 pounds or 2 GC per tier you have in Conjuration (whichever is " +
		"more restrictive). This item lasts for " + tier_effect(tier, 1, ' rounds', 'Conjuration', '', 0, 3) + "." + _rn + "The number of items you can create and their " +
		"total maximum weight or cost, or the amount of damage you heal, is based on your tier and how much EP you spend. " + _rn + "Items created by this " +
		"spell must be created in an environment that can support them, and instantly disappear when the duration runs out. *Fabricate* cannot be used to " +
		"create magic items. " + attack_text + spend_pool_conjuration('increase the healing' + or_damage + ' further, at a cost of 2 points per additional die.');
		let roll_text = get_spell_info('Conjuration (fabricate)', '10 minutes', range + ' squares', base_duration, duration_bonus, area_type_list,
		'Creature or item', 'Auto (item, willing)', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:conjurationfabricateattack0ep", function() {
	cast_fabricate_attack(0);
});

on("clicked:conjurationfabricatecreate5ep", function() {
	cast_fabricate_create(5);
});

on("clicked:conjurationfabricaterepair5ep", function() {
	cast_fabricate_repair(5);
});

on("clicked:conjurationfabricateattack5ep", function() {
	cast_fabricate_attack(5);
});

on("clicked:conjurationfabricatecreate10ep", function() {
	cast_fabricate_create(10);
});

on("clicked:conjurationfabricaterepair10ep", function() {
	cast_fabricate_repair(10);
});

on("clicked:conjurationfabricateattack10ep", function() {
	cast_fabricate_attack(10);
});

on("clicked:conjurationfabricatecreate20ep", function() {
	cast_fabricate_create(20);
});

on("clicked:conjurationfabricaterepair20ep", function() {
	cast_fabricate_repair(20);
});

on("clicked:conjurationfabricateattack20ep", function() {
	cast_fabricate_attack(20);
});

on("clicked:conjurationfabricatecreate30ep", function() {
	cast_fabricate_create(30);
});

on("clicked:conjurationfabricaterepair30ep", function() {
	cast_fabricate_repair(30);
});

on("clicked:conjurationfabricateattack30ep", function() {
	cast_fabricate_attack(30);
});

on("clicked:conjurationfabricatecreate40ep", function() {
	cast_fabricate_create(40);
});

on("clicked:conjurationfabricaterepair40ep", function() {
	cast_fabricate_repair(40);
});

on("clicked:conjurationfabricateattack40ep", function() {
	cast_fabricate_attack(40);
});

on("clicked:conjurationshelterinfo", function() {
	getAttrs(["conjuration_tier", "show_conjuration_shelter_10_ep", "show_conjuration_shelter_20_ep", "show_conjuration_shelter_30_ep", "show_conjuration_shelter_40_ep", "spell_range", "spell_duration_bonus", "spell_area_size", "area_type_nova"], function(values) {
		let tier = get_int_or_zero(values.conjuration_tier);
		let show_conjuration_shelter_10_ep = get_bool(values.show_conjuration_shelter_10_ep);
		let show_conjuration_shelter_20_ep = get_bool(values.show_conjuration_shelter_20_ep);
		let show_conjuration_shelter_30_ep = get_bool(values.show_conjuration_shelter_30_ep);
		let show_conjuration_shelter_40_ep = get_bool(values.show_conjuration_shelter_40_ep);
		let range = get_int_or_zero(values.spell_range);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let area_size = get_int_or_zero(values.spell_area_size);
		let nova_area = (values.area_type_nova == 'on' ? `Nova (${area_size} sq)` : '');
		let tier1_effect = 									 "{{10 EP=Cottage}} ";
		let tier2_effect = (show_conjuration_shelter_20_ep ? "{{20 EP=House}} " : "");
		let tier3_effect = (show_conjuration_shelter_30_ep ? "{{30 EP=Extradimensional house" + _or + "Extradimensional chest}}" : "");
		let tier4_effect = (show_conjuration_shelter_40_ep ? "{{40 EP=Extradimensional mansion}} " : "");
		let tier1_text = _rn + "For 10 EP, a cottage springs up around you, up to the size of your nova, with an 8-foot ceiling. The cottage is made " +
		"out of wood, has a fireplace and chimney, a single door, and up to " + tier_effect_conjuration(tier, 2, ' windows') + ". " +
		"It can also have bunk beds, tables, chairs, and other basic furniture that would reasonably fit inside, which you choose when casting the " +
		"spell."
		let tier2_text = (show_conjuration_shelter_20_ep ? _rn + "For 20 EP, a house springs up around you, up to double the size of your nova, with an " +
		"8-foot ceiling. It can also be 2-story (each floor being the size of your nova), with a staircase. The house is made of stone, has up to " +
		"two doors, and up to " + tier_effect_conjuration(tier, 4, ' windows') + ". Its interior stays at 70 F, unless the " +
		"outside temperature is below 0 F or above 100 F, in which case the inner temperature is decreased or increased on a 1-for-1 degree " +
		"basis. The house can withstand up to hurricane force winds." : "");
		let tier3_text = (show_conjuration_shelter_30_ep ? _rn + "For 30 EP, a house springs up around you, which is identical to the 20 EP version of this " +
		"spell, only the house is in an extradimensional space, and unaffected by any weather conditions. Only creatures you designate can enter " +
		"the door(s), and they are invisible to other creatures. In addition, one 10 EP porter ally (as per *summon ally*) is present in the house " +
		"for the duration of the spell." + _rn + "Alternatively, you can cast this spell on any normal chest. The chest can fit up to " +
		tier_effect_conjuration(tier, 5, ' cubic feet') + " of items . In addition, you can speak a word and send the chest to an extradimensional " +
		"space, and speak another word at any time to summon it back to your side from that space. If the spell ends and the chest is still in the " +
		"extradimensional space, it appears next to you, along with all the items that were inside of it (assuming they wouldnt have fit in the " +
		"chest without this spell)." : "");
		let tier4_text = (show_conjuration_shelter_40_ep ? _rn + "For 40 EP, a mansion springs up around you, up to five times the size of your nova. It " +
		"can have any layout or number of floors you want, within the size constraint, and is lavishly furnished and decorated. The mansion is in " +
		"an extradimensional space, and unaffected by any weather conditions. Only creatures you designate can enter the door(s), and they are " +
		"invisible to other creatures. The mansion has up to eight 10 EP porter allies, and a fully stocked pantry and larder." : "");
		let desc = "Touching a spot on the ground, you cause a shelter to appear around you. " + _pow + "You can spend 1 AP to conjure a bedroll that will " +
		"keep you comfortable for a nights sleep as long as the ambient temperature is between 0 F and 100 F." + 
		tier1_text + tier2_text + tier3_text + tier4_text;
		let roll_text = get_spell_info('Conjuration (shelter)', '10 minutes', null, dur_short_rest_p_linger, duration_bonus, nova_area,
		'Area', 'N/A', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:conjurationshelter10ep", function() {
	cast_shelter(10);
});

on("clicked:conjurationshelter20ep", function() {
	cast_shelter(20);
});

on("clicked:conjurationshelter30ep", function() {
	cast_shelter(30);
});

on("clicked:conjurationshelter40ep", function() {
	cast_shelter(40);
});

on("clicked:conjurationshieldinfo", function() {
	getAttrs(["conjuration_tier", "show_conjuration_shield_15_ep", "show_conjuration_shield_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.conjuration_tier);
		let show_conjuration_shield_15_ep = get_bool(values.show_conjuration_shield_15_ep);
		let show_conjuration_shield_30_ep = get_bool(values.show_conjuration_shield_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let tier1_effect = 									"{{15 EP=Advantage}} ";
		let tier3_effect = (show_conjuration_shield_30_ep ? "{{30 EP=Great Advantage}} " : "" );
		let tier1_text = _rn + "For 15 EP, you can create a shield that grants advantage on either Defend (block), Mental Resilience (willpower), or Physical " +
		"Resilience (fortitude) checks. You can create a shield that grants advantage on more than one skill in a single casting, but you must pay the " +
		"totalled EP cost.";
		let tier3_text = (show_conjuration_shield_30_ep ? _rn + "For 30 EP, you can conjure a shield that grants great advantage on one of those checks. " : "" );
		let desc = "You create a magical shield that helps block some attacks." + _pow +
		"You can spend 1 AP to conjure a shield of magical force; it is of negligible weight, but otherwise must be carried like a normal shield. " + 
		"This shield disappears as soon as you are no longer touching it." +
		tier1_text + tier3_text + _rn + "Shields conjured by this spell hover near you and do not need to be carried.";
		let roll_text = get_spell_info('Conjuration (shield)', '2 AP', range + ' squares', dur_concentration_w_pool, duration_bonus, area_type_list,
		'Creature', 'Auto (willing)', tier1_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:conjurationshield15epdef", function() {
	cast_shield(15, "Defend (block)");
});

on("clicked:conjurationshield30epdef", function() {
	cast_shield(30, "Defend (block)");
});

on("clicked:conjurationshield15epmr", function() {
	cast_shield(15, "Mental Resilience (willpower)");
});

on("clicked:conjurationshield30epmr", function() {
	cast_shield(30, "Mental Resilience (willpower)");
});

on("clicked:conjurationshield15eppr", function() {
	cast_shield(15, "Physical Resilience (fortitude)");
});

on("clicked:conjurationshield30eppr", function() {
	cast_shield(30, "Physical Resilience (fortitude)");
});

on('change:conjuration_attribute_name', function() {
	getAttrs(['conjuration_attribute_name', 'intelligence', 'wit'], function(values) {
		let intelligence = get_int_or_zero(values.intelligence);
		let wit = get_int_or_zero(values.wit);
		let conjuration_attribute = (values.conjuration_attribute_name.toLowerCase() == 'intelligence' ? intelligence : wit);
		setAttrs({
			'conjuration_attribute': conjuration_attribute
		});
	});
});

on("clicked:conjurationsummonallyinfo", function() {
	getAttrs(["conjuration_tier", "conjuration_attribute_name", "conjuration_attribute", "conjuration_attribute_modifier", "show_conjuration_summon_ally_10_ep", "show_conjuration_summon_ally_20_ep", "show_conjuration_summon_ally_30_ep", "spell_duration_bonus", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.conjuration_tier);
		let attribute_name = values.conjuration_attribute_name;
		let attribute = get_int_or_zero(values.conjuration_attribute);
		let attribute_mod = get_int_or_zero(values.conjuration_attribute_modifier);
		let attribute_mod_text = attribute_mod_effect(attribute_name, attribute_mod);
		let show_conjuration_summon_ally_10_ep = get_bool(values.show_conjuration_summon_ally_10_ep);
		let show_conjuration_summon_ally_20_ep = get_bool(values.show_conjuration_summon_ally_20_ep);
		let show_conjuration_summon_ally_30_ep = get_bool(values.show_conjuration_summon_ally_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = [
			{ name: 'combatant', duration: dur_concentration },
			{ name: 'porter',    duration: dur_short_rest    }
		];
		let range = get_int_or_zero(values.spell_range);
		let effect_tier_plus_4 = tier_effect_conjuration(tier, 1, '', '', 4);
		let effect_tier_plus_6 = tier_effect_conjuration(tier, 1, '', '', 6);
		let tier1_text = header_text('Combatant') + "For 10 EP, you summon an ally to fight for you. Your ally is trained in the following skill applications: ";
		let tier1_text_combatant = tier1_text + "Attack (any one melee combat style), Defend (dodge), Mental Resilience (willpower), " +
		"Physical Resilience (fortitude), and has a speed of 4 squares. Their attacks cause " + tier_effect_conjuration(tier, 1, 'd6') + 
		attribute_mod_text + " physical damage, and they have NDR (physical) " + tier_effect_conjuration(tier, 2, '') + ". ";
		let tier1_text_porter = tier1_text.replace('Combatant', 'Porter').replace('fight for you', 'help you with physical tasks, who ' +
		'appears wearing the equivalent of a backpack') + "Athletics (climb, feat, jump and swim), and has a speed of " + effect_tier_plus_4 + 
		" squares, and a Carry multiplier of &times;2. They do not make attacks. ";
		let tier2_text_combatant = "";
		let tier2_text_porter = "";
		let tier3_text_combatant = "";
		let tier3_text_porter = "";
		if (show_conjuration_summon_ally_20_ep) {
			tier2_text = _rn + "For 20 EP, you can summon a combatant ally that is trained in " + effect_tier_plus_4 + 
			" skill applications. The skill applications can be any, for any active skill, with the exception of magic skills. " +
			"Your ally will appear with whatever gear is relevant to their trained skill applications, subject to GM discretion. ";
			tier2_text_combatant = tier2_text + "Their attacks cause " + tier_effect_conjuration(tier, 1, 'd6', '', 1) + attribute_mod_text + 
			" physical damage, and they have DR (physical) " + tier_effect_conjuration(tier, 5, '') + " (either naturally or from armor). " +
			"The ally has " + value_effect(attribute_name + " &times; (your tier in Conjuration + 5)", (tier + 5) * attribute) + " HP.";
			tier2_text_porter = tier2_text.replace('combatant', 'porter') + "They have either a fly speed or a swim speed (choose one) equal " +
			"to their normal movement speed. Your ally has a Carry multiplier of " + tier_effect_conjuration(tier, 1, '', '&times;') + ".";
		}
		if (show_conjuration_summon_ally_30_ep) {
			tier3_text = _rn + "For 30 EP, you can summon a combatant ally like the 20 EP version, with the following " +
			"exceptions. They are trained in " + effect_tier_plus_6 + " skill applications, ";
			tier3_text_combatant = tier3_text + "their attacks cause " + tier_effect_conjuration(tier, 1, 'd6', '', 2) + attribute_mod_text + 
			" physical damage, and they have DR (physical) " + tier_effect_conjuration(tier, 8, '') + " (either naturally or from armor). " +
			"The ally has " + value_effect(attribute_name + " &times; (your tier in Conjuration + 8)", (tier + 8) * attribute) + " HP.";
			tier3_text_porter = tier3_text.replace('combatant', 'porter') + "they have a movement, fly and swim speed of " + effect_tier_plus_6 + 
			" squares, a burrow speed of " + tier_effect_conjuration(tier, 1, '') + " squares, and a Carry multiplier of " + 
			tier_effect_conjuration(tier, 1, '', '&times;', 2) + ".";
		}
		let desc = "*Summon ally* conjures a creature to aid you for the duration. The creature appears in the target square, which must be in an " +
		"environment capable of safely supporting it. Your ally is shaped however you wish, subject to GM discretion. " + _pow + 
		"You gain the ability to summon a familiar." + _rn + "There are two versions of " +
		"this spell: combatant and porter. You must choose one of them each time you cast it. " +
		_rn + "Both versions conjure allies that are trained in certain skill applications. Any time an ally makes a skill check for " +
		"which it is trained, you make a Conjuration (summon ally) check and use that result. For all other skill checks, roll **2d6**" + 
		attribute_mod_text + ". The ally has a Physique of " + value_effect(attribute_name, attribute) + ", and has " +
		value_effect(attribute_name + " &times; (your tier in Conjuration + 2)", (tier + 2) * attribute) + " HP, unless otherwise specified. " +
		"You can spend 1 AP to give your ally a command, which they follow to the best of their ability, until they are done or you give a new " +
		"command. " + tier1_text_combatant + tier2_text_combatant + tier3_text_combatant + tier1_text_porter + tier2_text_porter + tier3_text_porter;
		let roll_text = get_spell_info('Conjuration (summon ally)', '2 AP', range + ' squares', base_duration, duration_bonus, _bolt_touch,
		'Area', 'N/A', null, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:conjurationsummonallycombatant10ep", function() {
	cast_summon_ally(10);
});

on("clicked:conjurationsummonallyporter10ep", function() {
	cast_summon_ally(10, true);
});

on("clicked:conjurationsummonallycombatant20ep", function() {
	cast_summon_ally(20);
});

on("clicked:conjurationsummonallyporter20ep", function() {
	cast_summon_ally(20, true);
});

on("clicked:conjurationsummonallycombatant30ep", function() {
	cast_summon_ally(30);
});

on("clicked:conjurationsummonallyporter30ep", function() {
	cast_summon_ally(30, true);
});

on("clicked:familiarinfo", function() {
	getAttrs(["conjuration_tier"], function(values) {
		let tier = get_int_or_zero(values.conjuration_tier);
		let tier2_text = (tier >= 2 ? _rn + "*Speech:* Your familiar gains the ability to speak, and knows every language you do. It can also speak with creatures of its general type (e.g. cats with other felines; GM's discretion)." : '');
		let tier3_text = (tier >= 3 ? _rn + '*Magic Resistance:* Your familiar gains the Magic Resistance boon, and gains advantage on resilience checks versus spells.' +
		_rn + '*Share senses:* You can spend 1 AP to shift one or more of your senses to your familiar, and 1 AP to shift them back. While shifted, you gain sensory input from your familiar and not your own senses.' : '');
		let tier2_effect = (tier >= 2 ? _rn + '**Tier 2**' + _n + '*Ritual cost:* 200gc' + _n + '*EP in use:* 20'    + _n + '*Powers:* Speech' : '');
		let tier3_effect = (tier >= 3 ? _rn + '**Tier 3**' + _n + '*Ritual cost:* 300gc' + _n + '*EP in use:* 30'    + _n + '*Powers:* Magic Resistance, share senses' : '');
		let tier4_effect = (tier >= 4 ? _rn + '**Tier 4**' + _n + '*Ritual cost:* 400gc' + _n + '*EP in use:* 40-45' + _n + '*Powers:* ' : '');
		let desc = 'A familiar is a magical creature infused with a part of your essence. If you have training in the Conjuration (summon ally) spell, you gain the power to summon one. This requires a ritual that takes 8 hours and costs 100gc per tier you have in Conjuration. Upon completion of the ritual, you summon a familiar. Familiars usually take the form of a small animal, but they can have any appearance you wish. Every familiar has some obvious visual clue that it is a familiar (and not a mundane animal).' +
		_rn + 'When you summon a familiar, you decide how much EP to spend on it, which are considered in use as if the familiar were an active rune. The amount of EP you can spend is limited by your tier in Conjuration and how much you spend on the ritual, so if you have tier 3 in Conjuration and spend 200gc on the ritual, you can spend either 10 or 20 EP on the familiar (see below).' +
		_rn + "A familiar's powers are based on its tier, which is based on how much EP you have in use. A familiar has one tier per 10 EP you spend." +
		_rn + 'Familiars have all four attributes equal to 12, but still use your Conjuration check for any trained skill application. They have a number of Hit Points equal to your Intelligence  their tier. They have 4 squares of movement, and are trained in 4 skill applications per tier. They also have NDR (physical) equal to their tier  4. All familiars have the Tiny Size boon. They also have additional abilities, which are explained below.' +
		_rn + 'If you suffer disadvantage on Conjuration checks for any reason, your familiar loses all of its powers and is fatigued. If you suffer great disadvantage, it is also sickened and slowed (2 AP). Removing disadvantage or great disadvantage alleviates these penalties.' +
		_rn + 'Each time you take a long rest, you can choose to spend a different amount of EP in use on your familiar. If you release all of the EP you have in use for your familiar, you release the familiar. If you release your familiar or it dies, you will need to perform another ritual to get a new one.' +
		_rn + '**Tier 1**' + _n + '*Ritual cost:* 100gc' + _n + '*EP in use:* 10-15' + _n + '*Powers:* Empathic link, share spells, special movement, store spells' +
		tier2_effect + tier3_effect + tier4_effect +
		_rn + "*Empathic link:* You and your familiar share an empathic link, and you can always sense each other's emotional state." +
		_rn + '*Share spells:* Any time you cast a spell that affects you, it also affects your familiar, as long as it is in physical contact with you.' +
		_rn + '*Special Movement:* Every familiar gains one special type of movement, chosen from the list below:' + _bull + '+2 squares of normal movement' + 
		_bull + 'burrow (4 squares)' + _bull + 'climb (4 squares)' + _bull + 'fly (4 squares)' + _bull + 'swim (4 squares)' +
		_rn + "*Store spells:* You can cast a spell into your familiar, of up to an amount of EP you've spent on it. The familiar can cast this spell as a touch spell at any time thereafter, but will otherwise hold it indefinitely. You can store a number of spells in your familiar equal to your tier in Conjuration. Spells stored this way do not disappear if the familiar loses its powers, but are not accessible until it regains them again." +
		tier2_text + tier3_text;
		let roll_text = get_info_text('Summon Ally Power: Familiar', '', desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:displacementbindinfo", function() {
	getAttrs(["displacement_tier", "show_displacement_bind_10_ep", "show_displacement_bind_20_ep", "show_displacement_bind_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst"], function(values) {
		let tier = get_int_or_zero(values.displacement_tier);
		let show_displacement_bind_10_ep = get_bool(values.show_displacement_bind_10_ep);
		let show_displacement_bind_20_ep = get_bool(values.show_displacement_bind_20_ep);
		let show_displacement_bind_30_ep = get_bool(values.show_displacement_bind_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = dur_short_rest_w_checks_1;
		if (show_displacement_bind_20_ep) {
			base_duration = [
				{ name: '10 EP', duration: dur_short_rest_w_checks_1 },
				{ name: '20 EP', duration: dur_short_rest            }
			];
		}
		if (show_displacement_bind_30_ep) {
			base_duration.push({ name: '30 EP', duration: dur_short_rest_p_linger });
		}
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, '0', '0', '0');		
		let tier2_text = (show_displacement_bind_20_ep ? _rn + "The base duration of this spell increases based on the EP spent on it. " : "");
		let desc = "*Bind* prevents affected targets from using *teleport* or being affected by another creatures *teleport* spell or any similar " +
		"effect. This includes even the free power from knowing the *teleport* spell. " + _pow + "You gain advantage on Attack (grapple) checks." + tier2_text;
		let roll_text = get_spell_info('Displacement (bind)', '2 AP', range + ' squares', base_duration, duration_bonus, area_type_list,
		'Creature', 'Mental Resilience', "Target(s) can't *teleport*", desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:displacementbind10ep", function() {
	cast_bind(10);
});

on("clicked:displacementbind20ep", function() {
	cast_bind(20);
});

on("clicked:displacementbind30ep", function() {
	cast_bind(30);
});

on("clicked:displacementchronofieldinfo", function() {
	getAttrs(["displacement_tier", "show_displacement_chronofield_10_ep", "show_displacement_chronofield_20_ep", "show_displacement_chronofield_30_ep", "show_displacement_chronofield_40_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_nova"], function(values) {
		let tier = get_int_or_zero(values.displacement_tier);
		let show_displacement_chronofield_10_ep = get_bool(values.show_displacement_chronofield_10_ep);
		let show_displacement_chronofield_20_ep = get_bool(values.show_displacement_chronofield_20_ep);
		let show_displacement_chronofield_30_ep = get_bool(values.show_displacement_chronofield_30_ep);
		let show_displacement_chronofield_40_ep = get_bool(values.show_displacement_chronofield_40_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = dur_short_rest_w_checks_1;
		if (show_displacement_chronofield_20_ep) {
			base_duration = [
				{ name: 'add AP', duration: dur_concentration         },
				{ name: 'slow',   duration: dur_short_rest_w_checks_1 }
			];
		}
		if (show_displacement_chronofield_30_ep) {
			base_duration[1].name = 'paralyze';
		}
		if (show_displacement_chronofield_40_ep) {
			base_duration[1].name += ', 30 EP';
			base_duration.push({ name: 'paralyze, 40 EP', duration: dur_short_rest_p_linger });
		}
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let nova_area = (values.area_type_nova == 'on' ? `${_n}Nova (${area_size} sq)` : '');
		let tier1_effect = 										  "{{10 EP=&ndash;1 AP}} ";
		let tier2_effect = (show_displacement_chronofield_20_ep ? "{{20 EP=+1 AP" + _or + "&ndash;2 AP}} " : "");
		let tier3_effect = (show_displacement_chronofield_30_ep ? "{{30 EP=+2 AP" + _or + "paralyzed}} " : "");
		let tier4_effect = (show_displacement_chronofield_40_ep ? "{{40 EP=+3 AP" + _or + "paralyzed (permanent)}} " : "");
		let tier2_text = (show_displacement_chronofield_20_ep ? _pow + 'In the first round of every encounter, you gain +1 AP.' : '');
		let desc = "*Chronofield* creates a time field around the target(s), making time move more quickly or slowly for those affected. " +
		"This imposes a penalty or grants a bonus, based on the amount of EP spent. " + tier2_text;
		let roll_text = get_spell_info('Displacement (chronofield)', '2 AP', range + ' squares', base_duration, duration_bonus, 
		`Bolt${nova_area}${_n}Touch`, 'Creature', 'Mental Resilience', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc,
		!show_displacement_chronofield_40_ep);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:displacementchronofield10ep", function() {
	cast_chronofield(10);
});

on("clicked:displacementchronofield20ep", function() {
	cast_chronofield(20);
});

on("clicked:displacementchronofield30ep", function() {
	cast_chronofield(30);
});

on("clicked:displacementchronofield40ep", function() {
	cast_chronofield(40);
});

on("clicked:displacementlevitateinfo", function() {
	getAttrs(["displacement_tier", "show_displacement_levitate_10_ep", "show_displacement_levitate_20_ep", "show_displacement_levitate_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_nova"], function(values) {
		let tier = get_int_or_zero(values.displacement_tier);
		let show_displacement_levitate_10_ep = get_bool(values.show_displacement_levitate_10_ep);
		let show_displacement_levitate_20_ep = get_bool(values.show_displacement_levitate_20_ep);
		let show_displacement_levitate_30_ep = get_bool(values.show_displacement_levitate_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = dur_concentration;
		if (show_displacement_levitate_30_ep) {
			base_duration = [
				{ name: '10 or 20 EP', duration: dur_concentration },
				{ name: '30 EP',       duration: dur_short_rest    }
			];
		}
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let nova_area = (values.area_type_nova == 'on' ? `${_n}Nova (${area_size} sq)` : '');
		let effect_tier = tier_effect_displacement(tier, 1, '');
		let tier1_effect = 								  "{{10 EP=Levitate}} ";
		let tier2_effect = (show_displacement_levitate_20_ep ? "{{20 EP=Fly (speed +" + effect_tier +") squares}} " : "");
		let tier3_effect = (show_displacement_levitate_30_ep ? "{{30 EP=Fly (speed +" + effect_tier +") squares for hours}} " : "");
		let tier1_text = _rn + "For 10 EP, the targets can levitate, moving up or down at their normal speed at will. Levitation does not allow " +
		"horizontal movement, though levitating creatures may find other ways to move themselves horizontally. "
		let tier2_text = (show_displacement_levitate_20_ep ? _rn + "For 20 EP, the targets can fly at a speed (in squares) equal to their " +
		"normal speed +" + effect_tier + "." : "");
		let power = (show_displacement_levitate_30_ep ? _pow + 'You can fly at will at a speed in squares equal to your normal speed + ' + 
		tier_effect_displacement(tier, 1, '') : (show_displacement_levitate_20_ep ? _pow + 'You can levitate up or down at your normal speed at will.' : ''));
		let tier3_text = (show_displacement_levitate_30_ep ? tier2_text.replace('20', '30') + " In addition, the base duration of this spell becomes " +
		"short rest. " : "");
		let desc = "This spell grants the target creatures the ability to levitate or fly. " + power + tier1_text + tier2_text + tier3_text +
		_rn + "When the duration of *levitate* expires, any affected creatures who are still airborne float slowly to the ground as if " +
		"levitating downward for " + tier_effect(tier, 1, ' rounds', 'Displacement', '', 0, 3) + " before falling. " +
		spend_pool_displacement('increase the target creatures fly speed, at a cost of 1 point per extra square of movement.');
		let roll_text = get_spell_info('Displacement (levitate)', '2 AP', range + ' squares', base_duration, duration_bonus, 
		`Bolt${nova_area}${_n}Touch`, 'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:displacementlevitate10ep", function() {
	cast_levitate(10);
});

on("clicked:displacementlevitate20ep", function() {
	cast_levitate(20);
});

on("clicked:displacementlevitate30ep", function() {
	cast_levitate(30);
});

on("clicked:displacementstasisinfo", function() {
	getAttrs(["displacement_tier", "show_displacement_stasis_10_ep", "show_displacement_stasis_20_ep", "show_displacement_stasis_30_ep", "spell_duration_bonus", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.displacement_tier);
		let show_displacement_stasis_10_ep = get_bool(values.show_displacement_stasis_10_ep);
		let show_displacement_stasis_20_ep = get_bool(values.show_displacement_stasis_20_ep);
		let show_displacement_stasis_30_ep = get_bool(values.show_displacement_stasis_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let duration_text = get_duration_text(dur_short_rest_p_linger, duration_bonus);
		let target = "{{Target=Item}} ";
		let resist = "{{Resist=Auto (item)}} ";
		let effect = "{{Effect=Near stasis}} ";
		if (show_displacement_stasis_30_ep) {
			target = "{{Target (10 or 20 EP)=Item}} {{Target (30 EP)=Creature}} ";
			resist = "{{Resist (10 or 20 EP)=Auto (item)}} {{Resist (30 EP)=Mental Resilience}} ";
			effect = "{{Effect (10 or 20 EP)=Near stasis}} {{Effect (30 EP)=Complete stasis}} ";
		}
		let tier1_text = _rn + "For 10 EP, you can hold an " +
		"item in near stasis. The duration unit of this effect is hours. For the duration of the spell, one round passes for the item for every " +
		"hour of the spells duration. This effect only slows the normal effects of time, and does not protect the item in any other way." +
		_rn + "For example, it can be used on the corpse of an ally to get it to someone who can resurrect them, but it doesnt prevent " +
		"anything else from happening to the corpse until then. For the purposes of this spell, a full backpack or small chest counts as one item."
		let tier2_text = (show_displacement_stasis_20_ep ? _rn + "For 20 EP, you can hold an item in very near stasis. This works exactly like the 10 EP " +
		"version of this spell, but the duration unit is days, and one round passes for each day of the spells duration." : "");
		let tier3_text = (show_displacement_stasis_30_ep ? _rn + "For 30 EP, you can target a creature and hold them in complete stasis; the creature can " +
		"make a Mental Resilience (willpower) check to resist. The duration unit of this version of the spell is days. If affected, no time " +
		"passes at all for the target, and it cannot affect or be affected by attack, spell or effect. Any ongoing effects like spells, poison " +
		"or disease are paused until the spell ends, after which they resume normally." : "");
		let effect_text = "{{Casting Time=2 AP}} {{Range=" + range + " squares}} " + duration_text + "{{Area Types=Bolt" + _n + "Touch}} " + 
		target + resist + effect;
		let desc = "This spell allows you to hold a creature or item in near or even complete stasis." + _pow + "As long as they are within a 3-square nova " +
		"of you, time passes more slowly for items  one minute for every hour. This slows things which could spoil, rot, rust, etc." + 
		tier1_text + tier2_text + tier3_text;
		let roll_text = get_info_text('Displacement (stasis)', effect_text, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:displacementstasis10ep", function() {
	cast_stasis(10);
});

on("clicked:displacementstasis20ep", function() {
	cast_stasis(20);
});

on("clicked:displacementstasis30ep", function() {
	cast_stasis(30);
});

on("clicked:displacementtelekinesisinfo", function() {
	getAttrs(["displacement_tier", "show_displacement_telekinesis_10_ep", "show_displacement_telekinesis_20_ep", "show_displacement_telekinesis_30_ep", "show_displacement_telekinesis_40_ep", "spell_duration_bonus", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.displacement_tier);
		let show_displacement_telekinesis_10_ep = get_bool(values.show_displacement_telekinesis_10_ep);
		let show_displacement_telekinesis_20_ep = get_bool(values.show_displacement_telekinesis_20_ep);
		let show_displacement_telekinesis_30_ep = get_bool(values.show_displacement_telekinesis_30_ep);
		let show_displacement_telekinesis_40_ep = get_bool(values.show_displacement_telekinesis_40_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let tier1_targets = tier_effect_displacement(tier, 1, ' targets');
		let tier1_pounds = tier_effect_displacement(tier, 20, ' pounds');
		let tier1_effect = 										  '{{10 EP=Up to ' + tier1_targets + 								 ' of up to ' + tier1_pounds + _or + "Remote Attack check}} ";
		let tier2_effect = (show_displacement_telekinesis_20_ep ? '{{20 EP=Up to ' + tier_effect_displacement(tier, 2, ' targets') + ' of up to ' + tier_effect_displacement(tier,  50, ' pounds') + '}} ' : '');
		let tier3_effect = (show_displacement_telekinesis_30_ep ? '{{30 EP=Up to ' + tier_effect_displacement(tier, 3, ' targets') + ' of up to ' + tier_effect_displacement(tier, 100, ' pounds') + '}} ' : '');
		let tier4_effect = (show_displacement_telekinesis_40_ep ? '{{40 EP=Up to ' + tier_effect_displacement(tier, 4, ' targets') + ' of up to ' + tier_effect_displacement(tier, 250, ' pounds') + '}} ' : '');
		let tier2_text = (show_displacement_telekinesis_20_ep ? _rn + "Spending more EP allows for more items or creatures to be moved, " +
		"and increases their total allowed weight. " : "");
		let desc = "This spell allows you to move objects or creatures with your mind. Creatures can make a Mental Resilience (willpower) " +
		"check to resist if they or an item they are carrying is targeted. " + _pow + "You can spend 1 AP to telekinetically move a single item or " +
		"creature of up to " + tier_effect_displacement(tier, 5, ' pounds') + "." +
		_rn + "For 10 EP, you can move up to " + tier1_targets + ", as long as their total weight is " + tier1_pounds + " or " +
		"less. Alternatively, you can spend 1 AP to make an Attack (melee combat style, reposition or tactical combat) check against any creature " +
		"within range, using your Displacement (telekinesis) check instead of an Attack check, as long as you are trained in that skill " +
		"application. If you choose Attack (melee combat style), you use *telekinesis* on the melee weapon to make it attack, and the damage " +
		"caused is based on your tier in Attack and any relevant passive skills, not on your tier in Displacement. " + tier2_text + 
		_rn + "For all versions of *telekinesis*, each AP you spend moving a target allows you to move it a number of squares equal " +
		"to your spell range, and your telekinesis only extends up to your spell range. You cannot move targets further away from yourself than " +
		"this (although you can of course move in between using *telekinesis*). If you do not spend at least 1 AP per round using *telekinesis* " +
		"on a given target, it begins to float back to the ground as if the spell ended for just that target (see below)." +
		_rn + "*Telekinesis* grants the same amount of manipulation as doing something with one hand, so it can be used to pull " +
		"levers, hit switches, etc. Anything that would be complicated to do with one hand may require a Displacement (telekinesis) check (GMs " +
		"discretion). " +
		_rn + "When the duration of *telekinesis* expires, any affected creatures who are airborne float slowly to the ground as if " +
		"levitating downward (see the *levitate* spell) for " + tier_effect(tier, 1, ' rounds', 'Displacement', '', 0, 3) + " before falling. }}'";
		let roll_text = get_spell_info('Displacement (telekinesis)', '2 AP', range + ' squares', dur_concentration, duration_bonus, 'Self',
		'Creature or item', 'Mental Resilience', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:displacementtelekinesis10ep", function() {
	cast_telekinesis(10);
});

on("clicked:displacementtelekinesis20ep", function() {
	cast_telekinesis(20);
});

on("clicked:displacementtelekinesis30ep", function() {
	cast_telekinesis(30);
});

on("clicked:displacementtelekinesis40ep", function() {
	cast_telekinesis(40);
});

on("clicked:displacementteleportinfo", function() {
	getAttrs(["displacement_tier", "displacement_attribute_name", "displacement_attribute_modifier","show_displacement_teleport_10_ep", "show_displacement_teleport_20_ep", "show_displacement_teleport_30_ep", "show_displacement_teleport_40_ep", "ps_displacement_attack", "spell_duration", "spell_range", "spell_area_size", "area_type_nova"], function(values) {
		let tier = get_int_or_zero(values.displacement_tier);
		let attribute_name = get_int_or_zero(values.displacement_attribute_name);
		let attribute_mod  = get_int_or_zero(values.displacement_attribute_modifier);
		let show_displacement_teleport_10_ep = get_bool(values.show_displacement_teleport_10_ep);
		let show_displacement_teleport_20_ep = get_bool(values.show_displacement_teleport_20_ep);
		let show_displacement_teleport_30_ep = get_bool(values.show_displacement_teleport_30_ep);
		let show_displacement_teleport_40_ep = get_bool(values.show_displacement_teleport_40_ep);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let nova_area = (values.area_type_nova == 'on' ? `${_n}Nova (${area_size} sq)` : '');

		let basic_attack = '';
		let basic_effect = '';
		let tier1_attack = '';
		let tier2_attack = '';
		let tier3_attack = '';
		let tier4_attack = '';
		let attack_text  = '';
		let attack_pool  = '';
		if (get_bool(values.ps_displacement_attack)) {
			let physical_damage = attribute_mod_effect(attribute_name, attribute_mod) + ' physical damage';
			basic_attack =       tier_effect_displacement(tier, 1, 'd6', '', 1) + physical_damage;
			tier1_attack = _or + tier_effect_displacement(tier, 2, 'd6', '', 1) + physical_damage;
			tier2_attack = _or + tier_effect_displacement(tier, 3, 'd6', '', 1) + physical_damage;
			tier3_attack = _or + tier_effect_displacement(tier, 4, 'd6', '', 1) + physical_damage;
			tier4_attack = _or + tier_effect_displacement(tier, 5, 'd6', '', 1) + physical_damage;
			basic_effect = `{{0 EP=${basic_attack}}} {{5 EP=${basic_attack}}} `;
			attack_text  = _rn + "Alternatively, you can use this spell to displace only certain parts of your target(s), causing physical damage. " +
			"This works like Dynamancy (attack), including the basic attack. The physical damage caused is based on how much EP you spend on it.";
			attack_pool = spend_pool_displacement('to increase damage at a cost of 1 point per additional point or 2 points per additional die of physical damage.');
		}

		let effect_100_miles = tier_effect_displacement(tier, 100, ' miles');
		let effect_500_miles = tier_effect_displacement(tier, 500, ' miles');
		let tier1_effect = basic_effect +					   `{{10 EP=Teleport within ${value_effect('range spell statistic', range)} squares${tier1_attack}}} `;
		let tier2_effect = (show_displacement_teleport_20_ep ? `{{20 EP=Teleport within ${effect_100_miles} if successful${tier2_attack}}} ` : '');
		let tier3_effect = (show_displacement_teleport_30_ep ? `{{30 EP=Teleport within ${effect_500_miles} automatically${_or}Teleport to another plane or planet, 1d10 &times; 50 miles from your target${tier3_attack}}} ` : '');
		let tier4_effect = (show_displacement_teleport_40_ep ? `{{40 EP=Teleport anywhere automatically${tier4_attack}}} ` : '');
		let free_effect = (show_displacement_teleport_20_ep ? _pow + "Your normal movement becomes a teleportation effect, although it does not change " +
		"your speed and you must be able to see your destination." : "");
		if (show_displacement_teleport_30_ep) {
			free_effect = free_effect.replace(', although it does not change your speed', ' with a range of ' + 
			value_effect('range spell statistic', range) + ' squares, ');
		}
		let tier1_text = _rn + "For 10 EP, you can teleport the target creatures to anywhere within " + value_effect('range spell statistic', range) + 
		" squares, as long as you are intimately familiar with, or have a clear line of sight to, the destination. The GM decides your level of familiarity. ";
		let tier2_text = (show_displacement_teleport_20_ep ? _rn + "For 20 EP, you can attempt to teleport the target creatures anywhere within " + 
		effect_100_miles + ". You must make a successful Displacement check to do so. The TN of the check is based on your familiarity with the " +
		"destination. The GM decides your level of familiarity, although someone who is intimately familiar with a place can give you a good " +
		"enough description to give you passing familiarity with it." + _rn + "If you fail the check or if the place you're trying to go " +
		"to doesnt exist, the spell fails. If you critically fail, you are instead teleported to a visually or thematically similar location " +
		"within range determined by the GM. " + _rn + " &nbsp; &nbsp; Intimately familiar: TN 24" + _n + " &nbsp; &nbsp; Familiar: TN 30" +
		_n + " &nbsp; &nbsp; Passingly familiar: TN 36" : "");
		let tier3_text = (show_displacement_teleport_30_ep ? _rn + "For 30 EP, you can teleport the target creatures anywhere within " + effect_500_miles + 
		". You do not need to make a check for this, but if the place you're trying to go to doesnt exist, the spell fails." + _rn +
		"Alternatively, you can teleport the target creatures to a different plane or planet, although you arrive 1d10 &times; 50 miles away " +
		"from your intended destination." : "");
		let tier4_text = (show_displacement_teleport_40_ep ? _rn + "For 40 EP, you can teleport the target creatures anywhere, including a different " +
		"plane or planet, and arrive at your intended destination." : "");
		let desc = "This spell instantly transports a creature from one location to another, although it can be risky if you are not familiar with " +
		"the destination. " + free_effect + tier1_text + tier2_text + tier3_text + tier4_text + attack_text + 
		spend_pool_displacement('to increase the distance you can teleport when casting the tier 2 or 3 version of this spell at a cost of 1 point per ' +
		'additional 50 miles.') + attack_pool;
		let roll_text = get_spell_info('Displacement (teleport)', '2 AP', range + ' squares', dur_instantaneous, 0, `Bolt${nova_area}${_n}Touch`,
		'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:displacementteleport10ep", function() {
	cast_teleport(10);
});

on("clicked:displacementteleport20ep", function() {
	cast_teleport(20);
});

on("clicked:displacementteleport30ep", function() {
	cast_teleport(30);
});

on("clicked:displacementteleport40ep", function() {
	cast_teleport(40);
});

on("clicked:displacementteleportattack0ep", function() {
	cast_teleport_attack(0);
});

on("clicked:displacementteleportattack5ep", function() {
	cast_teleport_attack(5);
});

on("clicked:displacementteleportattack10ep", function() {
	cast_teleport_attack(10);
});

on("clicked:displacementteleportattack20ep", function() {
	cast_teleport_attack(20);
});

on("clicked:displacementteleportattack30ep", function() {
	cast_teleport_attack(30);
});

on("clicked:displacementteleportattack40ep", function() {
	cast_teleport_attack(40);
});

on("clicked:divinationanalyzeinfo", function() {
	getAttrs(["divination_tier", "show_divination_analyze_10_ep", "show_divination_analyze_20_ep", "show_divination_analyze_30_ep"], function(values) {
		let tier = get_int_or_zero(values.divination_tier);
		let show_divination_analyze_10_ep = get_bool(values.show_divination_analyze_10_ep);
		let show_divination_analyze_20_ep = get_bool(values.show_divination_analyze_20_ep);
		let show_divination_analyze_30_ep = get_bool(values.show_divination_analyze_30_ep);
		let area_types = 'Touch'
		if (show_divination_analyze_20_ep) {
			area_types = [
				{ name: '10 EP', types: 'Touch'     },
				{ name: '20 EP', types: _bolt_touch }
			];
		}
		let effect_tier_plus_1 = tier_effect_divination(tier, 1, '', '', 1);
		let tier1_effect = "{{10 EP=Analyze up to tier " + effect_tier_plus_1 + "}} ";
		let tier2_effect = (show_divination_analyze_20_ep ? " {{20 EP=Analyze any}} " : "");
		if (show_divination_analyze_30_ep) {
			tier2_effect = tier2_effect.replace('20 EP', '20 or 30 EP');
			area_types[1].name = '20 or 30 EP';
		}
		let tier1_text = _rn + "For 10 EP, you instantly know everything you could normally learn about a spell effect by analyzing it with the " +
		"Arcana skill. That is, whether the effect exists or the item is magical, and if so, the magic skill & spell or the items properties. " +
		_rn + "If you already know that information, it instead tells you the tier of the spell, how much EP was spent on it, and " +
		"what the duration is. If the target is an item, it tells you how it is used (e.g. the activation method or command word " +
		"if there is one). " + _rn + "If the item or effect is more tier " + effect_tier_plus_1 + ", you do not gain this information, " +
		"but you know that it is beyond your ability to analyze.";
		let tier2_text = (show_divination_analyze_20_ep ? _rn + "For 20 EP, you can gain all of the knowledge described in the 10 EP version (in a " +
		"single casting), and it also works on any effect, regardless of the tier." + _rn + "Alternatively,  you can cast the 10 EP " +
		"version of this spell with an area type of bolt." : "");
		let tier3_text = (show_divination_analyze_30_ep ? _rn + "For 30 EP, you can cast the 20 EP version of this spell with an area type of bolt.": "");
		let desc = "This spell grants you knowledge about a spell effect or magic item. " + _pow + 
		"You gain advantage on Arcana checks made to identify an item or spell effect." + tier1_text + tier2_text + tier3_text;
		let roll_text = get_spell_info('Displacement (analyze)', '2 AP', null, dur_instantaneous, 0, area_types,
		'Effect or item', 'Auto (item, willing)', tier1_effect + tier2_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:divinationanalyze10ep", function() {
	cast_analyze(10);
});

on("clicked:divinationanalyze20ep", function() {
	cast_analyze(20);
});

on("clicked:divinationanalyze30ep", function() {
	cast_analyze(30);
});

on("clicked:divinationcomprehendinfo", function() {
	getAttrs(["divination_tier", "show_divination_comprehend_10_ep", "show_divination_comprehend_20_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_nova"], function(values) {
		let tier = get_int_or_zero(values.divination_tier);
		let show_divination_comprehend_10_ep = get_bool(values.show_divination_comprehend_10_ep);
		let show_divination_comprehend_20_ep = get_bool(values.show_divination_comprehend_20_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let effect_languages = tier_effect_divination(tier, 1, ' languages');
		let nova_area = (values.area_type_nova == 'on' ? `${_n}Nova (${area_size} sq)` : '');
		let tier1_effect = 									   '{{10 EP=Understand ' + effect_languages + '}} ';
		let tier2_effect = (show_divination_comprehend_20_ep ? '{{20 EP=Understand all languages}}' : '');
		let tier2_text = (show_divination_comprehend_20_ep ? _rn + "For 20 EP, the targets can speak, read, and write every language, even those only " +
		"spoken on other planes or planets." : '');
		let desc = "This spell grants targets the ability to speak, read, and write languages they dont otherwise know." + _pow + 
		"You can spend one minute listening to someone speak, or studying something written, in an unfamiliar language. " +
		"This gives you the ability to understand and read the language for " + tier_effect_divination(tier, 1, ' hours') + "." +
		_rn + "For 10 EP, the targets can speak, read, and write up to " + effect_languages + ". The languages must be specified by name while casting the spell." + 
		_rn + "Alternatively, if you have something written in a language or can hear someone speaking (or see them signing) a language and you dont know " +
		"its name, you can choose that as one of the languages imparted by this spell. " + tier2_text +
		spend_pool_divination('increase the number of languages you understand, at a cost of two pool points per extra language.');
		let roll_text = get_spell_info('Divination (comprehend)', '2 AP', range + ' squares', dur_short_rest_p_linger, duration_bonus, 
		`Bolt${nova_area}${_n}Touch`, 'Creature', 'Auto (willing)', tier1_effect + tier2_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:divinationcomprehend10ep", function() {
	cast_comprehend(10);
});

on("clicked:divinationcomprehend20ep", function() {
	cast_comprehend(20);
});

on("clicked:divinationdetectinfo", function() {
	getAttrs(["divination_tier", "show_divination_detect_10_ep", "show_divination_detect_20_ep", "spell_duration_bonus", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.divination_tier);
		let show_divination_detect_10_ep = get_bool(values.show_divination_detect_10_ep);
		let show_divination_detect_20_ep = get_bool(values.show_divination_detect_20_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let tier1_effect = 								   "{{5 EP=Detect concrete thing}} " +
														   "{{10 EP=Detect abstract thing}} ";
		let tier2_effect = (show_divination_detect_20_ep ? "{{20 EP=Sense or detect any}} " : "");
		let tier1_text = _rn + "For 5 EP, you can detect any one concrete thing, such as elves, undead creatures, traps, or secret doors. The " +
		"GM will decide what is considered concrete, but in general concrete things are those that you could normally detect with your five " +
		"senses. The subject of your detection will glow when you see it, in a way that makes it obvious to you. The subject of your detection " +
		"will only glow if it is within your spell range and you can see it; this detection is blocked by walls, doors, chests, etc." +
		_rn + "For 10 EP, you can detect any one abstract thing, such as lies, conditions, or illusions. The GM will decide if a given thing " +
		"is an appropriate target for this spell. If you are detecting something like lies, the source of the lies will glow. Detecting " +
		"abstract things can be tricky; e.g. if you are detecting lies, a person may be saying something false, but think its the truth, and " +
		"in such a case they would not glow. ";
		let tier2_text = (show_divination_detect_20_ep ? _rn + "For 20 EP, you can detect a concrete or abstract thing, even through barriers, " +
		"as long as the thing is in your spell range. If you cant actually see the thing, you sense its direction until you can see it. " : "");
		let desc = "This power lets you detect the presence and location of one specific named thing. " + _pow + 
		"You gain advantage on Perception (scan) checks." + tier1_text + tier2_text +
		_rn + "You can choose more than one concrete or abstract thing to detect with a single casting of this spell, but you must pay for " +
		"each separately. When doing so, each type of thing will glow differently so you know which is which. " +
		spend_pool_divination('increase your spell range for the purposes of this spell, at a cost of 1 pool point per extra square of range.');
		let roll_text = get_spell_info('Divination (detect)', '2 AP', range + ' squares', dur_concentration, duration_bonus, 'Self', 
		'Special', 'Auto (willing)', tier1_effect + tier2_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:divinationdetect5ep", function() {
	cast_detect(5);
});

on("clicked:divinationdetect10ep", function() {
	cast_detect(10);
});

on("clicked:divinationdetect20ep", function() {
	cast_detect(20);
});

on("clicked:divinationprowessinfo", function() {
	getAttrs(["divination_tier", "show_divination_prowess_10_ep", "show_divination_prowess_20_ep", "show_divination_prowess_30_ep", "show_divination_prowess_40_ep", "spell_duration_bonus", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.divination_tier);
		let show_divination_prowess_10_ep = get_bool(values.show_divination_prowess_10_ep);
		let show_divination_prowess_20_ep = get_bool(values.show_divination_prowess_20_ep);
		let show_divination_prowess_30_ep = get_bool(values.show_divination_prowess_30_ep);
		let show_divination_prowess_40_ep = get_bool(values.show_divination_prowess_40_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let roll_text = get_prowess_imbue_info(tier, show_divination_prowess_10_ep, show_divination_prowess_20_ep, show_divination_prowess_30_ep, 
		show_divination_prowess_40_ep, duration_bonus, range);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:divinationprowess10ep", function() {
	cast_prowess(10);
});

on("clicked:divinationprowess20ep", function() {
	cast_prowess(20);
});

on("clicked:divinationprowess30ep", function() {
	cast_prowess(30);
});

on("clicked:divinationprowess40ep", function() {
	cast_prowess(40);
});

on("clicked:divinationscryinfo", function() {
	getAttrs(["divination_tier", "show_divination_scry_10_ep", "show_divination_scry_20_ep", "show_divination_scry_30_ep", "spell_duration_bonus", "spell_area_size"], function(values) {
		let tier = get_int_or_zero(values.divination_tier);
		let show_divination_scry_10_ep = get_bool(values.show_divination_scry_10_ep);
		let show_divination_scry_20_ep = get_bool(values.show_divination_scry_20_ep);
		let show_divination_scry_30_ep = get_bool(values.show_divination_scry_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let area_size = get_int_or_zero(values.spell_area_size);
		let effect_50_miles = tier_effect_divination(tier, 50, ' miles');
		let tier1_effect = 								 "{{10 EP=Scry within " + effect_50_miles + "}} ";
		let tier2_effect = (show_divination_scry_20_ep ? "{{20 EP=Scry on same plane or planet}} " : "");
		let tier3_effect = (show_divination_scry_30_ep ? "{{30 EP=Scry anywhere}} " : "");
		let tier1_text = _rn + "For 10 EP you can see and hear targets within " + effect_50_miles + ". If your subject is further away than " +
		"that, the spell fails. " +
		_rn + "You must choose a subject on which to scry. This can be a location, creature or object. When the spell is cast, an " +
		"invisible and incorporeal sensor iscreated that watches the subject of the spell. The sensor remains on the subject, so if you " +
		"successfully cast scry on a creature who moves, the sensor will attempt to follow it for the duration of the spell. The sensor can " +
		"move up to 36 squares per round. " +
		_rn + "The sensor has whatever vision and hearing abilities you have at the time of casting, including any spell effects " +
		"that augment those senses. It can see and/or hear an area centered on the subject equal to a " + 
		value_effect('area size spell statistic', area_size, true, 3) + " square burst." +
		_rn + "Every creature in the area youre scrying gets to make a Mental Resilience (willpower) check to resist the spell. " +
		"If youre scrying an object, and that object is carried by a creature, the creature can attempt to resist on the objects behalf. " +
		"If youre scrying a creature or object it is resisted, the spell fails." +
		_rn + "Any creature that successfully resists *scry* cannot be seen or heard by your spell, even if you can see others in the " +
		"location. Any creature that enters the spells area after it is cast immediately gets a Mental Resilience (willpower) check to resist. " +
		"Creatures that leave and re-enter the spells area multiple times do not need to make more than one check - you either see them or you " +
		"dont based on their initial check. " +
		_rn + "Any creature who fails their Mental Resilience check against the spell gains an immediate Perception (notice) check " +
		"against the spells Target Number. If the creature succeeds, they sense that they are being spied upon, although they do not know the " +
		"source; they will merely have a sense of a presence near them. Creatures who are trained in Divination (scry) gain advantage on this " +
		"check, and if they critically succeed, they know they are being scried. " +
		_rn + "Your familiarity with the subject can affect your Divination (scry) check. You must be at least passingly familiar " +
		"with the subject to make a normal check. If you are unfamiliar with the subject, your check suffers disadvantage. If you are intimately " +
		"familiar with the subject, you gain advantage on your check. The GM decides your level of familiarity, although someone who is " +
		"intimately familiar with a subject can give you a good enough description to give you passing familiarity with it. "
		let tier2_text = (show_divination_scry_20_ep ? _rn + "For 20 EP, you can cast the 10 EP version of this spell, except it works if your " +
		"subject is anywhere on the same plane or planet as you. In addition, you can project the image and sound onto a single reflective " +
		"surface you touch when casting the spell (like a pool of water, a mirror, or a crystal ball)." + _rn + "You may attempt to " +
		"cast Divination (analyze, detect or status), or Neuromancy (telepathy) through this version of *scry*. Each time you do so, roll 1d6. " +
		"If you roll equal to or lower than your tier in Divination, the spell works normally; otherwise the spell fails and your EP are wasted." 
		: "");
		let tier3_text = (show_divination_scry_30_ep ? _rn + "For 30 EP, you can cast the 20 EP version of this spell, except it works even if " +
		"your subject is not on the same plane or planet as you. In addition, you do not risk spell failure when casting Divination (analyze, " +
		"detect or status) or Neuromancy (telepathy) through the *scry* spell." : "");
		let desc = "This spell allows you to see and hear things happening from great distances away." + _pow + 
		"You gain advantage on Perception (notice) checks to notice when youre being scried (see below)." + tier1_text + tier2_text + tier3_text;
		let roll_text = get_spell_info('Divination (scry)', '10 minutes', '', dur_concentration_w_pool, duration_bonus, 'Self', 
		'Special', 'Mental Resilience', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:divinationscry10ep", function() {
	cast_scry(10);
});

on("clicked:divinationscry20ep", function() {
	cast_scry(20);
});

on("clicked:divinationscry30ep", function() {
	cast_scry(30);
});

on("clicked:divinationstatusinfo", function() {
	getAttrs(["divination_tier", "show_divination_status_10_ep", "show_divination_status_20_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_nova"], function(values) {
		let tier = get_int_or_zero(values.divination_tier);
		let show_divination_status_10_ep = get_bool(values.show_divination_status_10_ep);
		let show_divination_status_20_ep = get_bool(values.show_divination_status_20_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let nova_area = (values.area_type_nova == 'on' ? `${_n}Nova (${area_size} sq)` : '');
		let tier1_effect = 								   "{{10 EP=Know status on same plane or planet}} ";
		let tier2_effect = (show_divination_status_20_ep ? "{{20 EP=Know status anywhere}} " : "");
		let tier1_text = _rn + "For 10 EP, you are fully aware of the following for each affected creature for the duration of the spell: " +
		"their exact HP and EP, any conditions they suffer, whether they are affected by spells, poisons, or diseases, and how many of each. " +
		"If any of the creatures are dying, you also know how many failed and successful recovery checks they have made." +
		_rn + "This spell functions as long as targets are on the same plane or planet as you, and ends for any target that ends up on " +
		"a different plane or planet than you." +
		_rn + "You can spend 1 AP to make an Arcana check to see if you can identify a given spell, poison or disease on an affected " +
		"creature. You can only make one such attempt per spell, poison or disease per casting of this spell.";
		let tier2_text = (show_divination_status_20_ep ? _rn + "For 20 EP, you can cast the 10 EP version of this spell, and it works even across " +
		"planes or planets. In addition, you gain advantage on Arcana checks to identify a given spell, poison or disease on an affected creature." 
		: "");
		let desc = "This spell monitors the status of the target creatures." + _pow + "You gain advantage on First Aid (diagnose) checks." + 
		tier1_text + tier2_text;
		let roll_text = get_spell_info('Divination (status)', '2 AP', range + ' squares', dur_short_rest_p_linger, duration_bonus, 
		`Bolt${nova_area}${_n}Touch`, 'Creature', 'Auto (willing)', tier1_effect + tier2_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:divinationstatus10ep", function() {
	cast_status(10);
});

on("clicked:divinationstatus20ep", function() {
	cast_status(20);
});

on("clicked:dynamancyattackinfo", function() {
	getAttrs(["dynamancy_tier", "dynamancy_attribute_modifier", "dynamancy_attribute_name", "bb_natural_magic_dynamancy", "show_dynamancy_attack_10_ep", "show_dynamancy_attack_20_ep", "show_dynamancy_attack_30_ep", "show_dynamancy_attack_40_ep", "spell_duration", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.dynamancy_tier);
		let attribute_name = values.dynamancy_attribute_name;
		let attribute_mod = get_int_or_zero(values.dynamancy_attribute_modifier);
		let show_dynamancy_attack_10_ep = get_bool(values.show_dynamancy_attack_10_ep);
		let show_dynamancy_attack_20_ep = get_bool(values.show_dynamancy_attack_20_ep);
		let show_dynamancy_attack_30_ep = get_bool(values.show_dynamancy_attack_30_ep);
		let show_dynamancy_attack_40_ep = get_bool(values.show_dynamancy_attack_40_ep);
		let natural_magic_dynamancy = get_bool(values.bb_natural_magic_dynamancy);
		let duration = get_int_or_zero(values.spell_duration);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let effect_free_5ep = tier_effect_dynamancy(tier, 1, 'd6', '', 1);
		let effect_10ep = tier_effect_dynamancy(tier, 2, 'd6', '', 1);
		let effect_20ep = tier_effect_dynamancy(tier, 3, 'd6', '', 1);
		let effect_30ep = tier_effect_dynamancy(tier, 4, 'd6', '', 1);
		let effect_40ep = tier_effect_dynamancy(tier, 5, 'd6', '', 1);
		let damage_text = attribute_mod_effect(attribute_name, attribute_mod) + ' damage';
		let tier1_text = `{{5 EP=${effect_free_5ep}${damage_text}}} {{10 EP=${effect_10ep}${damage_text}}} `;
		let tier2_text = (show_dynamancy_attack_20_ep ? `{{20 EP=${effect_20ep}${damage_text}}} ` : '');
		let tier3_text = (show_dynamancy_attack_30_ep ? `{{30 EP=${effect_30ep}${damage_text}}} ` : '');
		let tier4_text = (show_dynamancy_attack_40_ep ? `{{40 EP=${effect_40ep}${damage_text}}} ` : '');
		let effect_text = `{{Basic=${effect_free_5ep}${damage_text}}} `;
		let effect_description = 'how much EP you spend';
		let recharge_prefix = `{{On Recharge${_n}(10 EP)=`;
		let recharge_info = '';
		if (natural_magic_dynamancy) {
			let recharge_effect = effect_10ep;
			if (show_dynamancy_attack_40_ep) {
				recharge_prefix = recharge_prefix.replace('10', '40');
				recharge_effect = effect_40ep;
			}
			else if (show_dynamancy_attack_30_ep) {
				recharge_prefix = recharge_prefix.replace('10', '30');
				recharge_effect = effect_30ep;
			}
			else if (show_dynamancy_attack_20_ep) {
				recharge_prefix = recharge_prefix.replace('10', '20');
				recharge_effect = effect_20ep;
			}
			effect_text += recharge_prefix + recharge_effect + damage_text + '}} {{Recharge (1d6)=**1&ndash;**' + 
			tier_effect_dynamancy(tier, 1, '') + '}} ';
			effect_description = 'which passive skills you know';
			recharge_info = _rn + "After casting a version of *attack* that would normally have an EP cost ('On Recharge' above), " +
			"you must wait for this ability to recharge to cast it again. At the start of each turn, you roll 1d6 against your recharge; " +
			"if successful, this ability recharges and can be used again on that turn. This ability recharges automatically after a short " +
			"or long rest. This ability is unusable if you have disadvantage on Dynamancy checks.";
		}
		else {
			effect_text += tier1_text + tier2_text + tier3_text + tier4_text;
		}
		
		let desc = "Dynamancy (attack) causes damage of any type you know. The amount of damage you cause is based on your tier and " + 
		effect_description + "." + _pow + "You can make a basic magic attack for 1 AP and 0 EP. This attack must have an area type of either touch or bolt. " +
		"If you make more than one such attack in a round, all attacks after the first suffer disadvantage. Disadvantage from secondary basic attacks does " +
		"not make you lose Dynamancy powers." +
		get_crit_text('you cause double damage', 'magic resonance causes you to lose your next Action Point', true) + recharge_info +
		spend_pool_dynamancy('increase the damage further, at a cost of 1 point per additional point of damage, or 2 points per additional die of damage. ' +
		'If you know the secondary effect for a damage type this spell causes, you can spend 3 pool points to make targets suffer the secondary effect of ' +
		'that damage type. If the secondary effect is additional damage, targets suffer the base damage of the spell plus your Intelligence modifier, ' +
		'without the tier bonus.');
		let roll_text = get_spell_info('Dynamancy (attack)', '2 AP', range + ' squares', dur_instantaneous, 0, area_type_list, 
		'Creature', 'Physical Resilience', effect_text, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:dynamancyattackbasic", function() {
	cast_attack(0);
});

on("clicked:dynamancyattack5ep", function() {
	cast_attack(5);
});

on("clicked:dynamancyattack10ep", function() {
	cast_attack(10);
});

on("clicked:dynamancyattack20ep", function() {
	cast_attack(20);
});

on("clicked:dynamancyattack30ep", function() {
	cast_attack(30);
});

on("clicked:dynamancyattack40ep", function() {
	cast_attack(40);
});

on("clicked:dynamancydurationattackinfo", function() {
	getAttrs(["dynamancy_tier", "dynamancy_attribute_modifier", "dynamancy_attribute_name", "bb_natural_magic_dynamancy", "show_dynamancy_duration_attack_10_ep", "show_dynamancy_duration_attack_20_ep", "show_dynamancy_duration_attack_30_ep", "show_dynamancy_duration_attack_40_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.dynamancy_tier);
		let attribute_name = values.dynamancy_attribute_name;
		let attribute_mod = get_int_or_zero(values.dynamancy_attribute_modifier);
		let show_dynamancy_duration_attack_10_ep = get_bool(values.show_dynamancy_duration_attack_10_ep);
		let show_dynamancy_duration_attack_20_ep = get_bool(values.show_dynamancy_duration_attack_20_ep);
		let show_dynamancy_duration_attack_30_ep = get_bool(values.show_dynamancy_duration_attack_30_ep);
		let show_dynamancy_duration_attack_40_ep = get_bool(values.show_dynamancy_duration_attack_40_ep);
		let natural_magic_dynamancy = get_bool(values.bb_natural_magic_dynamancy);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let effect_10ep = tier_effect_dynamancy(tier, 1, 'd6');
		let effect_20ep = tier_effect_dynamancy(tier, 1, 'd10');
		let effect_30ep = tier_effect_dynamancy(tier, 2, 'd6');
		let effect_40ep = tier_effect_dynamancy(tier, 2, 'd10');
		let damage_text = attribute_mod_effect(attribute_name, attribute_mod) + ' damage';
		let tier1_text = 										 `{{10 EP=${effect_10ep}${damage_text}}} `
		let tier2_text = (show_dynamancy_duration_attack_20_ep ? `{{20 EP=${effect_20ep}${damage_text}}} ` : '');
		let tier3_text = (show_dynamancy_duration_attack_30_ep ? `{{30 EP=${effect_30ep}${damage_text}}} ` : '');
		let tier4_text = (show_dynamancy_duration_attack_40_ep ? `{{40 EP=${effect_40ep}${damage_text}}} ` : '');

		let effect_text = '';
		let effect_description = 'how much EP you spend';
		let recharge_prefix = `{{On Recharge${_n}(10 EP)=`;
		let recharge_info = '';
		if (natural_magic_dynamancy) {
			let recharge_effect = effect_10ep;
			if (show_dynamancy_duration_attack_40_ep) {
				recharge_prefix = recharge_prefix.replace('10', '40');
				recharge_effect = effect_40ep;
			}
			else if (show_dynamancy_duration_attack_30_ep) {
				recharge_prefix = recharge_prefix.replace('10', '30');
				recharge_effect = effect_30ep;
			}
			else if (show_dynamancy_duration_attack_20_ep) {
				recharge_prefix = recharge_prefix.replace('10', '20');
				recharge_effect = effect_20ep;
			}
			effect_text += recharge_prefix + recharge_effect + damage_text + '}} {{Recharge (1d6)=**1-**' + 
			tier_effect_dynamancy(tier, 1, '') + '}} ';
			effect_description = "which passive skills you know";
			recharge_info = _rn + "After casting a version of *duration attack* that would normally have an EP cost ('On Recharge' above), " +
			"you must wait for this ability to recharge to cast it again. At the start of each turn, you roll 1d6 against your recharge; " +
			"if successful, this ability recharges and can be used again on that turn. This ability recharges automatically after a short " +
			"or long rest. This ability is unusable if you have disadvantage on Dynamancy checks.";
		}
		else {
			effect_text += tier1_text + tier2_text + tier3_text + tier4_text;
		}

		let desc = "This spell causes damage of any type you know. On the round you cast it, and at the beginning of each of your turns " +
		"thereafter until the spells duration runs out, it causes damage to all affected creatures. The amount of damage you cause is based " + 
		"on your tier and " + effect_description + "." +
		_rn + "Each time the spell causes damage, you make a Dynamancy (duration attack) check to set the TN for that round, and " +
		"each affected creature can make a Physical Resilience (fortitude) check to resist it. " +
		_rn + "Each time you cast this spell, you choose to either target the area itself, or the creatures in the area at the time " +
		"of casting." + recharge_info +
		spend_pool_dynamancy('increase the damage further, at a cost of 3 points per additional die. If you know the secondary effect for a damage ' +
		'type this spell causes, you can spend 3 pool points to make targets suffer the secondary effect of that damage type. They suffer these effects ' +
		'for ' + tier_effect_dynamancy(tier, 1, ' rounds') + ', starting on the second round of the spell. If the secondary effect is additional ' +
		'damage, calculate the damage as if your tier in Dynamancy is one higher than it actually is.');
		let roll_text = get_spell_info('Dynamancy (duration attack)', '2 AP', range + ' squares', dur_short_rest_w_checks_1, duration_bonus, 
		area_type_list, 'Area or creature', 'Physical Resilience', effect_text, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:dynamancydurationattack10ep", function() {
	cast_duration_attack(10);
});

on("clicked:dynamancydurationattack20ep", function() {
	cast_duration_attack(20);
});

on("clicked:dynamancydurationattack30ep", function() {
	cast_duration_attack(30);
});

on("clicked:dynamancydurationattack40ep", function() {
	cast_duration_attack(40);
});

on("clicked:dynamancyforceeffectinfo", function() {
	getAttrs(["dynamancy_tier", "dynamancy_attribute_modifier", "dynamancy_attribute_name", "bb_natural_magic_dynamancy", "show_dynamancy_force_effect_15_ep", "show_dynamancy_force_effect_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.dynamancy_tier);
		let attribute_name = values.dynamancy_attribute_name;
		let attribute_mod = get_int_or_zero(values.dynamancy_attribute_modifier);
		let natural_magic_dynamancy = get_bool(values.bb_natural_magic_dynamancy);
		let show_dynamancy_force_effect_15_ep = get_bool(values.show_dynamancy_force_effect_15_ep);
		let show_dynamancy_force_effect_30_ep = get_bool(values.show_dynamancy_force_effect_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = [
			{ name: 'offensive', duration: dur_instantaneous },
			{ name: 'defensive', duration: dur_concentration }
		];
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let effect_15ep_off = 'Move creatures';
		let effect_15ep_def = 'Wall of force';
		let effect_30ep_off = effect_15ep_off + ' and knock them prone';
		let effect_30ep_def = effect_15ep_def + ' that moves creatures';
		let tier1_effect_off = `{{15 EP offensive=${effect_15ep_off}}} `;
		let tier1_effect_def = `{{15 EP defensive=${effect_15ep_def}}} `;
		let tier2_effect_off = (show_dynamancy_force_effect_30_ep) ? `{{30 EP offensive=${effect_30ep_off}}} ` : '';
		let tier2_effect_def = (show_dynamancy_force_effect_30_ep) ? `{{30 EP defensive=${effect_30ep_def}}} ` : '';
		let tier1_header_parens = (natural_magic_dynamancy ? '' : ' (15 EP)');
		let tier1_desc_off = header_text('Offensive' + tier1_header_parens) + "Every creature in the area must make an Attack (reposition) " +
		"check against the spells TN or be moved " + value_effect('This is your tier in Dynamancy plus your ' + attribute_name + ' modifier', 
		tier + attribute_mod) + " **squares**. The direction of the movement can be from the center outwards, from the edges inwards, or from " +
		"one edge of the spell's area to the opposite edge (choose one when the spell is cast).";
		let tier1_desc_def = header_text('Defensive' + tier1_header_parens) + "The edges of the spells area become a wall of force that " +
		"prevent creatures from passing through. They must make an Attack (reposition) check against the spells TN to pass the wall in either " +
		"direction. Missile attacks must have an Attack (missile combat style) check that is equal to or higher than the spells TN to pass " +
		"through the wall, though spell effects ignore it.";
		let tier2_desc_off = (show_dynamancy_force_effect_30_ep ? (natural_magic_dynamancy ? _rn : header_text('Offensive (30 EP)')) + 
		"Creatures that fail their Attack (reposition) checks are both moved and knocked prone. " : "");
		let tier2_desc_def = (show_dynamancy_force_effect_30_ep ? (natural_magic_dynamancy ? _rn : header_text('Defensive (30 EP)')) + 
		"Creatures that fail their Attack (reposition) checks to move into the area are instead moved back as if it were the offensive version " +
		"of this spell." : "");
		
		let effect_text = '';
		let recharge_effect = `{{On Recharge${_n}Offensive (15 EP)=${effect_15ep_off}}} {{On Recharge${_n}Defensive (15 EP)=${effect_15ep_def}}} `;
		let recharge_info = '';
		if (natural_magic_dynamancy) {
			if (show_dynamancy_force_effect_30_ep) {
				recharge_effect = recharge_effect.replaceAll('15', '30').replace(effect_15ep_off, effect_30ep_off).replace(effect_15ep_def, effect_30ep_def);
			}
			effect_text += recharge_effect + '{{Recharge (1d6)=**1-**' + tier_effect_dynamancy(tier, 1, '') + '}} ';
			recharge_info = _rn + "After casting a version of *force effect* that would normally have an EP cost ('On Recharge' above), " +
			"you must wait for this ability to recharge to cast it again. At the start of each turn, you roll 1d6 against your recharge; " +
			"if successful, this ability recharges and can be used again on that turn. This ability recharges automatically after a short " +
			"or long rest. This ability is unusable if you have disadvantage on Dynamancy checks.";
		}
		else {
			effect_text += tier1_effect_off + tier2_effect_off + tier1_effect_def + tier2_effect_def;
		}

		let desc = "This spell causes magical force to push creatures in its area. It can be cast offensively or defensively. " +
		_pow + "You gain advantage on Attack (reposition) checks." + tier1_desc_off + tier2_desc_off + tier1_desc_def + tier2_desc_def + recharge_info +
		spend_pool_dynamancy('move creatures more squares at a cost of 1 point per additional square of movement.');
		let roll_text = get_spell_info('Dynamancy (force effect)', '2 AP', range + ' squares', base_duration, duration_bonus, 
		area_type_list, 'Area', 'N/A', effect_text, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:dynamancyforceeffectoffensive15ep", function() {
	cast_dynamancy_force_effect(15);
});

on("clicked:dynamancyforceeffectdefensive15ep", function() {
	cast_dynamancy_force_effect(15, false);
});

on("clicked:dynamancyforceeffectoffensive30ep", function() {
	cast_dynamancy_force_effect(30);
});

on("clicked:dynamancyforceeffectdefensive30ep", function() {
	cast_dynamancy_force_effect(30, false);
});

on("change:illusion_tier", function() {
	getAttrs(["illusion_tier"], function(values) {
		let illusion_tier = get_int_or_zero(values.illusion_tier);

		setAttrs({
			"mirror_image_recharge_roll": `1d6cs<${illusion_tier}cf>${(illusion_tier + 1)}`
		});
	});	
});

function get_interacting_with_illusions_text() {
	let text = header_text('Interacting with Illusions') + 'Creatures that interact with the illusion get a Mental Resilience (willpower) check to disbelieve ' +
	'it. Usually this happens when they first see it.' + _rn + 'Creatures who fail their checks assume the illusion is the truth. However, if they have some ' +
	'other reason to suspect the illusion, they get a second Mental Resilience check at disadvantage to disbelieve the illusion; this can only be done once ' +
	'per creature per spell. The two most common reasons a creature might get this secondary check are:' + _bull + 'The creature interacts with the ' +
	'illusion in a way that might betray the truth, such as perceiving a property of an object thats not disguised, or being unconvinced that a person is who ' +
	'they are impersonating.' + _bull + 'Another creature who succeeded their check tells them that its an illusion.' + _rn + 'Creatures who succeed their ' +
	'checks are aware of the illusion, but still perceive it. They may spend 1 AP per round concentrating on the illusion to pierce it and see the truth.' + _rn +
	'Creatures who critically succeed their checks see the truth, but also see a shadowy version of the illusion. They can perceive both without concentrating.';
	return text;
}

on("clicked:illusiondisguiseinfo", function() {
	getAttrs(["illusion_total", "illusion_tier", "show_illusion_disguise_10_ep", "show_illusion_disguise_20_ep", "show_illusion_disguise_30_ep", "show_illusion_disguise_40_ep", "spell_range", "spell_duration_bonus", "spell_area_size", "area_type_blast"], function(values) {
		let total = get_int_or_zero(values.illusion_total);
		let tier = get_int_or_zero(values.illusion_tier);
		let show_illusion_disguise_10_ep = get_bool(values.show_illusion_disguise_10_ep);
		let show_illusion_disguise_20_ep = get_bool(values.show_illusion_disguise_20_ep);
		let show_illusion_disguise_30_ep = get_bool(values.show_illusion_disguise_30_ep);
		let show_illusion_disguise_40_ep = get_bool(values.show_illusion_disguise_40_ep);
		let range = get_int_or_zero(values.spell_range);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = dur_concentration;
		let area_size = get_int_or_zero(values.spell_area_size);
		let blast_area = (values.area_type_blast == 'on' ? `Blast (${area_size} sq)${_n}` : '');
		let area_types = _bolt_touch;
		if (show_illusion_disguise_20_ep) {
			area_types = [
				{ name: '10 EP', types: _bolt_touch              },
				{ name: '20 EP', types: blast_area + _bolt_touch }
			];
		}
		let tier1_effect =								   "{{5 EP=Disguise one small part or 1 cubic foot}} {{10 EP=Disguise single target's sight and sound}} ";
		let tier2_effect = (show_illusion_disguise_20_ep ? `{{20 EP=Disguise all senses of single target, change size one step${_or}Disguise all targets sight and sound}} ` : '');
		let tier3_effect = (show_illusion_disguise_30_ep ? '{{30 EP=Disguise all senses of all targets, change size two steps}} ' : '');
		if (show_illusion_disguise_30_ep) {
			base_duration = [
				{ name: '10 or 20 EP', duration: dur_concentration        },
				{ name: '30 EP',       duration: dur_concentration_w_pool }
			];
			area_types[1].name = '20 or 30 EP';
		}
		if (show_illusion_disguise_40_ep) {
			base_duration.push({ name: '40 EP', duration: dur_short_rest_p_linger });
			area_types[1].name = '20-40 EP';
			tier3_effect = tier3_effect.replace('30 EP', '30 or 40 EP');
		}
		let tier1_text = _rn + "For 5 EP, you can disguise the appearance of a small part of the target creature (as per the free power described above), or a " +
		"single item that would fit inside a one-foot cube." + _rn + "For 10 EP, you can disguise a single targets sight and sound; the targets appearance " +
		"cannot be so different that it would gain a size boon. For creatures, their appearance and voice change. For items, their appearance and whatever sound " +
		"they might make changes (as applicable). ";
		let tier2_text = (show_illusion_disguise_20_ep ? _rn + "For 20 EP, you can disguise a target completely, including all senses; you can also change their " +
		"size by one step. You can choose to disguise a creature as a specific other creature, which grants them great advantage on Persuade (bluff) checks made " +
		"to impersonate that creature." + _rn + "Alternatively, you can cast the 10 EP version of this spell with an area type of blast. You must choose to target " +
		"either creatures in the area, or the area itself (which also includes items in the area, but not creatures)." : "");
		let tier3_text = (show_illusion_disguise_30_ep ? _rn + "For 30 EP, you can cast the 20 EP version of this spell with an area type of blast, a base duration " +
		"concentration with pool points, and it affects all creatures and items in the area, as well as the area itself. In addition, you can change any targets size by two " +
		"steps. " : "");
		let tier4_text = (show_illusion_disguise_40_ep ? _rn + "For 40 EP, you can cast the 30 EP version of this spell, with a base duration of short rest plus linger. " : "");
		let desc = "This spell alters the properties of the target(s) with an illusion." + _pow + "You can spend 1 AP to disguise the appearance of a small " +
		"part of yourself, such as your face or one arm, with a base duration of concentration. " +
		"You can only have " + tier_effect_illusion(tier, 1, '') + " such effect(s) active at a time. " + tier1_text + tier2_text + tier3_text + tier4_text +
		get_interacting_with_illusions_text();
		let roll_text = get_spell_info('Illusion (disguise)', '2 AP', range + ' squares', base_duration, duration_bonus, area_types, 
		'Area, creature or item', 'Mental Resilience', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:illusiondisguise10ep", function() {
	cast_disguise(10);
});

on("clicked:illusiondisguise20ep", function() {
	cast_disguise(20);
});

on("clicked:illusiondisguise30ep", function() {
	cast_disguise(30);
});

on("clicked:illusiondisguise40ep", function() {
	cast_disguise(40);
});

on("clicked:illusionholograminfo", function() {
	getAttrs(["illusion_total", "illusion_tier", "illusion_attribute_modifier", "illusion_attribute_name", "show_illusion_hologram_10_ep", "show_illusion_hologram_20_ep", "show_illusion_hologram_30_ep", "show_illusion_hologram_40_ep", "spell_range", "spell_duration_bonus", "spell_area_size", "area_type_blast"], function(values) {
		let total = get_int_or_zero(values.illusion_total);
		let tier = get_int_or_zero(values.illusion_tier);
		let attribute_mod = get_int_or_zero(values.illusion_attribute_modifier);
		let attribute_name = values.illusion_attribute_name;
		let show_illusion_hologram_10_ep = get_bool(values.show_illusion_hologram_10_ep);
		let show_illusion_hologram_20_ep = get_bool(values.show_illusion_hologram_20_ep);
		let show_illusion_hologram_30_ep = get_bool(values.show_illusion_hologram_30_ep);
		let show_illusion_hologram_40_ep = get_bool(values.show_illusion_hologram_40_ep);
		let range = get_int_or_zero(values.spell_range);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = dur_concentration;
		let area_size = get_int_or_zero(values.spell_area_size);
		let blast_area = (values.area_type_blast == 'on' ? `Blast (${area_size} sq)${_n}` : '');
		let area_types = _bolt_touch;
		if (show_illusion_hologram_20_ep) {
			area_types = [
				{ name: '10 EP', types: _bolt_touch              },
				{ name: '20 EP', types: blast_area + _bolt_touch }
			];
		}
		if (show_illusion_hologram_30_ep) {
			base_duration =[
				{ name: '10 or 20 EP', duration: dur_concentration        },
				{ name: '30 EP',       duration: dur_concentration_w_pool }
			];
			area_types[1].name = '20 or 30 EP';
		}
		if (show_illusion_hologram_40_ep) {
			base_duration.push({ name: '40 EP', duration: dur_short_rest_p_linger });
			area_types[1].name = '20-40 EP';
		}
		let tier1_effect =								   "{{5 EP=Visual hologram, 3 cubic feet}} {{10 EP=Sight and sound person-sized animated hologram}} ";
		let tier2_effect = (show_illusion_hologram_20_ep ? `{{20 EP=Five senses Large animated hologram${_or}Several sight and sound person-sized animated holograms}} ` : '');
		let tier3_effect = (show_illusion_hologram_30_ep ? `{{30 EP=Five senses Huge animated hologram that can attack${_or}Several five senses Large animated holograms}} ` : '');
		let tier4_effect = (show_illusion_hologram_40_ep ? '{{40 EP=Several five senses Huge animated holograms that can attack}}' : '');
		let tier1_text = _rn + "For 5 EP, you can make a hologram of up to 3 cubic feet. The hologram is visual only, and is completely static." + _rn + "For 10 " +
		"EP, you can create a hologram up to the size of a person. It only has sight and sound, and can make noise as loud as one person yelling. The hologram " +
		"is animated; you can spend 1 AP to change what it does, which can be whatever you want (subject to GM discretion). When you cast the spell, you choose " +
		"to anchor the hologram to yourself or a square. The hologram cannot move within a distance from its anchor equal to your range spell statistic. If it " +
		"does so, it winks out of existence and the spell ends. ";
		let tier2_text = (show_illusion_hologram_20_ep ? _rn + "For 20 EP, you can create a hologram up to the size of a Large creature. It has all five senses, " +
		"and can make noise as loud as several people yelling. Otherwise this works like the 10 EP version of the spell." + _rn + "Alternatively, you can cast " +
		"the 10 EP version of this spell with an area type of blast, which can contain up to one separate hologram per square. The holograms can be animated " +
		"separately, but you must choose one anchor point for all of them. " : "");
		let tier3_text = (show_illusion_hologram_30_ep ? _rn + "For 30 EP, you can create a hologram up to the size of a Huge creature. It has all five senses, " +
		"and can make noise as loud as scores of people yelling. Once per round, the hologram can make an attack that can cause damage to a creature that " +
		"believes the illusion. Make an Illusion (hologram) check versus the targets Defend check. If it hits, the attack causes an amount of damage equal to " +
		tier_effect_illusion(tier, 1, 'd6') + attribute_mod_effect(attribute_name, attribute_mod) + ". Otherwise this works like the 10 EP version of " +
		"the spell." + _rn + "Alternatively, you can cast the 20 EP version of this spell with an area type of blast, which can contain up to one separate " +
		"hologram per square (or fewer, if they are Large). The holograms can be animated separately, but you must choose one anchor point for all of them." + 
		_rn + "Both of these versions of the spell have a base duration of concentration with pool points. " : "");
		let tier4_text = (show_illusion_hologram_40_ep ? _rn + "For 40 EP, you can cast the 30 EP version of this spell with an area type of blast, which can " +
		"contain up to one separate hologram per square (or fewer, if they are Large or Huge). The holograms can be animated separately, but you must choose one " +
		"anchor point for all of them. This version of the spell has a base duration of short rest plus linger. " : "");
		let desc = "This spell creates an illusory hologram." + _pow + "You can spend 1 AP to create a visual hologram in your hand no larger than a one-foot " +
		"cube, which has a base duration of concentration. " + 
		tier1_text + tier2_text + tier3_text + tier4_text + get_interacting_with_illusions_text();;
		let roll_text = get_spell_info('Illusion (hologram)', '2 AP', range + ' squares', base_duration, duration_bonus, area_types, 
		'Area, creature or item', 'Mental Resilience', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:illusionhologram10ep", function() {
	cast_hologram(10);
});

on("clicked:illusionhologram20ep", function() {
	cast_hologram(20);
});

on("clicked:illusionhologram30ep", function() {
	cast_hologram(30);
});

on("clicked:illusionhologram40ep", function() {
	cast_hologram(40);
});

on("clicked:illusionmirrorimageinfo", function() {
	getAttrs(["illusion_total", "illusion_tier", "show_illusion_mirror_image_10_ep", "show_illusion_mirror_image_20_ep", "show_illusion_mirror_image_30_ep", "spell_duration_bonus"], function(values) {
		let total = get_int_or_zero(values.illusion_total);
		let tier = get_int_or_zero(values.illusion_tier);
		let show_illusion_mirror_image_10_ep = get_bool(values.show_illusion_mirror_image_10_ep);
		let show_illusion_mirror_image_20_ep = get_bool(values.show_illusion_mirror_image_20_ep);
		let show_illusion_mirror_image_30_ep = get_bool(values.show_illusion_mirror_image_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let effect_tier = tier_effect_illusion(tier, 1, '');
		let effect_tier_d6 = tier_effect_illusion(tier, 1, 'd6');
		let effect_tier_2_2 = tier_effect_illusion(tier, 2, ' illusory doubles', '', 1);
		let tier1_effect = 									   `{{10 EP=${effect_tier_2_2}}} `;
		let tier2_effect = (show_illusion_mirror_image_20_ep ? `{{20 EP=Destroyed doubles reappear on a d6 roll of 1-${effect_tier}}} ` : '');
		let tier3_effect = (show_illusion_mirror_image_30_ep ? `{{30 EP=Doubles attacks are semi-real and add ${effect_tier_d6} + [double count] damage}} ` : '');
		let tier1_text = _rn + "For 10 EP, you create " + effect_tier_2_2 + ". The doubles mimic your every movement, including spellcasting, " +
		"although their attacks and spells are illusory and have no effect. Any time you are hit by an Attack check or a single-target " +
		"Dynamancy check, randomly determine whether you or one of the doubles has been hit. If a double is hit, it is destroyed. If it is a " +
		"critical hit, two doubles are destroyed."
		let tier2_text = (show_illusion_mirror_image_20_ep ? _rn + "For 20 EP, you create illusory doubles exactly like the 10 EP version, " +
		"except there is a chance each round that destroyed doubles reappear. As long as at least one double has been destroyed, at the " +
		"beginning of your turn each round, roll 1d6. If the result is equal to or lower than " + effect_tier + ", the spell recharges and all " +
		"destroyed doubles reappear." : "");
		let tier3_text = (show_illusion_mirror_image_30_ep ? _rn + "For 30 EP, you create illusory doubles exactly like the 20 EP version, " +
		"except that now the doubles attacks are semi-real. Any time you hit a creature with an Attack check or a single-target Dynamancy check " +
		"that causes damage, the doubles add an amount of damage equal to " + effect_tier_d6 + " + the number of doubles that are left. " : "");
		let desc = "This spell creates illusory doubles of you that inhabit your space, making it hard for enemies to target you. " +
		_pow + "You can spend 1 AP to create " + tier_effect_illusion(tier, 1, ' illusory doubles') + ", which last(s) for one round." +
		tier1_text + tier2_text + tier3_text +
		_rn + "Illusory doubles do not crowd your space, and are immune to area effects. They do not have any effect on spells cast on you " +
		"other than whats described above. " +
		spend_pool_illusion('add more illusory doubles, at a cost of 2 pool points per additional double created.');
		let roll_text = get_spell_info('Illusion (mirror image)', '2 AP', '', dur_concentration, duration_bonus, 'Self', 
		'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:illusionmirrorimage10ep", function() {
	cast_mirror_image(10);
});

on("clicked:illusionmirrorimage20ep", function() {
	cast_mirror_image(20);
});

on("clicked:illusionmirrorimage30ep", function() {
	cast_mirror_image(30);
});

on("clicked:illusionobscureinfo", function() {
	getAttrs(["illusion_total", "illusion_tier", "show_illusion_obscure_10_ep", "show_illusion_obscure_20_ep", "show_illusion_obscure_30_ep", "spell_range", "spell_duration_bonus", "spell_area_size", "area_type_nova"], function(values) {
		let total = get_int_or_zero(values.illusion_total);
		let tier = get_int_or_zero(values.illusion_tier);
		let show_illusion_obscure_10_ep = get_bool(values.show_illusion_obscure_10_ep);
		let show_illusion_obscure_20_ep = get_bool(values.show_illusion_obscure_20_ep);
		let show_illusion_obscure_30_ep = get_bool(values.show_illusion_obscure_30_ep);
		let range = get_int_or_zero(values.spell_range);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let area_size = get_int_or_zero(values.spell_area_size);
		let nova_area = (values.area_type_nova == 'on' ? `${_n}Nova (${area_size} sq)` : '');
		let tier1_effect =								  "{{10 EP=Obscure one sense, ends with attack}} ";
		let tier2_effect = (show_illusion_obscure_20_ep ? "{{20 EP=Obscure one sense for duration}} " : "");
		let tier3_effect = (show_illusion_obscure_30_ep ? "{{30 EP=Obscure one sense except from each other}} " : "");
		let tier1_text = _rn + "For 10 EP, you can obscure targets from either sight, sound or smell, the effects of which are described below. " +
		"You can choose to obscure more than one sense with a single casting of this spell, but each must be paid for separately." +
		header_text('Sight') + "Targets are invisible. Against any creatures that rely on sight (including infravision and ultravision), they " +
		"gain advantage on Attack, Defend and Sneak checks. Sighted creatures attacking an invisible target must figure out which square theyre " + 
		"in, and even then, automatically miss if their Attack check is odd." +
		header_text('Sound') + "Targets do not make any noise through normal actions (though they can speak normally if they so choose). They " +
		"gain advantage on Sneak checks, and are effectively invisible to creatures that rely on echolocation." +
		header_text('Smell') + "Targets are undetectable by smell, and untrackable by creatures that rely on scent." +
		_rn + "Even if creatures are obscured by sight, sound and smell, they may still leave evidence of their location, such as footprints, " +
		"displacing water, etc. This version of the spell automatically ends (regardless of the duration) for a target if it targets any other " +
		"creature with an attack or spell.";
		let tier2_text = (show_illusion_obscure_20_ep ? _rn + "For 20 EP, you can obscure targets just like the 10 EP version, only the spell " +
		"does not end prematurely if any of the targets targets creatures with attacks or spells." : "");
		let tier3_text = (show_illusion_obscure_30_ep ? _rn + "For 30 EP, you can obscure targets just like the 20 EP version, only targets can " +
		"see, hear and smell each other normally." : "");
		let desc = "This spell obscures the target creatures from one or more senses." + _pow + "You gain advantage on Sneak (stealth) checks." + 
		tier1_text + tier2_text + tier3_text;
		let roll_text = get_spell_info('Illusion (obscure)', '2 AP', range + ' squares', dur_concentration, duration_bonus, `Bolt${nova_area}${_n}Touch`, 
		'Creature', 'Auto (willing)', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:illusionobscure10ep", function() {
	cast_obscure(10);
});

on("clicked:illusionobscure20ep", function() {
	cast_obscure(20);
});

on("clicked:illusionobscure30ep", function() {
	cast_obscure(30);
});

on("clicked:necromancycontrolundeadinfo", function() {
	getAttrs(["necromancy_total", "necromancy_tier", "necromancy_pool_total", "show_necromancy_control_undead_20_ep", "show_necromancy_control_undead_40_ep", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let total = get_int_or_zero(values.necromancy_total);
		let tier = get_int_or_zero(values.necromancy_tier);
		let pool = get_int_or_zero(values.necromancy_pool_total);
		let show_necromancy_control_undead_20_ep = get_bool(values.show_necromancy_control_undead_20_ep);
		let show_necromancy_control_undead_40_ep = get_bool(values.show_necromancy_control_undead_40_ep);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let effect_cp_base = value_effect('tier in Necromancy &times; your Necromancy total &times; 10', tier * total * 10);
		let effect_cp_base_max = value_effect('(tier in Necromancy + your Necromancy pool total) &times; your Necromancy total &times; 10', 
		(tier + pool) * total * 10);
		let tier1_effect = 										   '{{20 EP=Mindless undead}} ';
		let tier2_effect = (show_necromancy_control_undead_40_ep ? '{{40 EP=Any undead}} ' : '');
		let tier1_text = _rn + "For 20 EP, you can attempt to control mindless undead creatures. Such creatures automatically fail to resist " +
		"this spell, unless they are controlled by another caster. In that case, the caster can choose to resist this spell with either a " +
		"Mental Resilience (willpower) or a Necromancy (control undead) check.";
		let tier2_text = (show_necromancy_control_undead_40_ep ? _rn + "For 40 EP, you can attempt to control undead creatures regardless of " +
		"whether they are mindless. If a non-mindless target creature is controlled by another caster, it can attempt to resist the spell, and " +
		"the caster can also attempt to resist; the spell fails to affect that creature if either is successful." : "");
		let desc = "This power allows you to control one or more undead creatures. The control granted by this spell is absolute; the creatures " +
		"must obey your every command. You can release one or more creatures from your control at any time by spending 1 AP, but released " +
		"undead are immediately hostile to you (even if they are mindless)." + tier1_text + tier2_text +
		_rn + "You can only maintain control of " + effect_cp_base + " CP worth of undead creatures. If you attempt to cast this spell on " +
		"creatures that exceed this limit, that casting of the spell fails." +
		spend_pool_necromancy('increase the total CP worth of undead creatures you control, by increasing your effective tier in Necromancy. ' +
		'Using all your pool points would allow you to control ' + effect_cp_base_max + ' CP worth of undead creatures. Points spent in this ' +
		'way are unavailable for this or any other Necromancy spell while in use.');
		let roll_text = get_spell_info('Necromancy (control undead)', '2 AP', range + ' squares', dur_permanent, 0, area_type_list, 
		'Creature', 'Mental Resilience or Necromancy', tier1_effect + tier2_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:metamancydispelmagicinfo", function() {
	getAttrs(["metamancy_tier", "show_metamancy_dispel_magic_10_ep", "show_metamancy_dispel_magic_20_ep", "show_metamancy_dispel_magic_30_ep", "show_metamancy_dispel_magic_40_ep", "spell_duration_bonus", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.metamancy_tier);
		let show_metamancy_dispel_magic_10_ep = get_bool(values.show_metamancy_dispel_magic_10_ep);
		let show_metamancy_dispel_magic_20_ep = get_bool(values.show_metamancy_dispel_magic_20_ep);
		let show_metamancy_dispel_magic_30_ep = get_bool(values.show_metamancy_dispel_magic_30_ep);
		let show_metamancy_dispel_magic_40_ep = get_bool(values.show_metamancy_dispel_magic_40_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = [
			{ name: 'dispel',   duration: dur_instantaneous         },
			{ name: 'suppress', duration: dur_short_rest_w_checks_1 }
		];
		if (show_metamancy_dispel_magic_40_ep) {
			base_duration.push({ name: 'disjoin', duration: dur_instantaneous });
		}
		let range = get_int_or_zero(values.spell_range);
		let tier1_effect = 										`{{10 EP=Dispel tier 1 effect${_or}Suppress magic item}} `;
		let tier2_effect = (show_metamancy_dispel_magic_20_ep ? `{{20 EP=Dispel tier 2 effect${_or}Suppress eldritch item}} ` : '');
		let tier3_effect = (show_metamancy_dispel_magic_30_ep ? `{{30 EP=Dispel tier 3 effect${_or}Suppress epic item}} ` : '');
		let tier4_effect = (show_metamancy_dispel_magic_40_ep ? `{{40 EP=Dispel tier 4 effect${_or}Suppress legendary item${_or}Disjoin item}} ` : '');
		let tier1_text = _rn + "Alternatively, for 10 EP, you can suppress the powers of a magic item; this version of the spell has a base duration of short rest with checks (1 success). " +
		"Unattended magic items have a TN of 20 to suppress, and if the item is carried by a creature, the creature can make a Mental Resilience (willpower) " +
		"check to resist. If successful, the item ceases to be magic or have any magic properties for the duration.";
		let tier2_text = (show_metamancy_dispel_magic_20_ep ? _rn + "For 20 EP, you can suppress the powers of an eldritch item. This works like suppressing a " +
		"magic item, but it applies to eldritch items and the TN for an unattended item is 30." : '');
		let tier3_text = (show_metamancy_dispel_magic_30_ep ? _rn + "For 30 EP, you can suppress the powers of an epic item. This works like suppressing " +
		"a magic item, but it applies to epic items and the TN for an unattended item is 40." : '');
		let tier4_text = (show_metamancy_dispel_magic_40_ep ? _rn + "For 40 EP, you can suppress the powers of a legendary item. This works like " +
		"suppressing a magic item, but it applies to legendary items and the TN for an unattended item is 50." +
		_rn + "Alternatively, you can attempt to completely disjoin a magic, eldritch, epic, or legendary item. " +
		"This destroys the magic in the item and renders it mundane, though it has no effect on the physical item itself. This version of the spell has a " +
		"casting time of one hour and a duration of instantaneous." + _rn + "Only unattended items can be disjoined, and each type has a specific TN you " +
		"must meet with your Metamancy (dispel magic) check. In addition, this version of the spell requires expensive materials that are consumed in the " +
		"casting of the spell, equal to 30% of the items value. If you fail, the materials are wasted and nothing happens to the item." + _rn +
		"Below are the TNs and typical costs to disjoin each type of item." + _bull + "Magic: TN 30; 300gc" + _bull + "Eldritch: TN 40; 900gc" + _bull + 
		"Epic: TN 50; 3,000gc" + _bull + "Legendary: TN 60; 9,000gc" : '');
		let desc = "This power allows you to end an ongoing magical effect (i.e. a magic trap or an active spell with a duration other than instantaneous)." +
		_rn + "You must first have identified the effect with the Arcana skill, then you can spend 10 EP per tier of the effect and make a " +
		"Metamancy check to see if you can end it. The TN of the check is equal to the magic skill check used to create the effect (or " +
		"the TN of the magical trap, if applicable). If your Metamancy check is successful, the magic effect ceases altogether. " + 
		_rn + "*Dispel magic* only works on effects up to tier " + tier_effect_metamancy(tier, 1, '') + ", and you can choose to attempt to dispel an " +
		"effect one tier higher than that by taking great disadvantage on your Metamancy (dispel magic) check. This spell automatically fails if used " +
		"on a magic effect with a tier two or more higher than you have in Metamancy." + tier1_text + tier2_text + tier3_text + tier4_text + 
		_rn + "This spell can also be used to replace any other spell when counterspelling.";
		let roll_text = get_spell_info('Metamancy (dispel magic)', '2 AP', range + ' squares', base_duration, duration_bonus, _bolt_touch, 
		'Effect', 'Special', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:metamancydispelmagic10ep", function() {
	cast_dispel_magic(10);
});

on("clicked:metamancydispelmagic20ep", function() {
	cast_dispel_magic(20);
});

on("clicked:metamancydispelmagic30ep", function() {
	cast_dispel_magic(30);
});

on("clicked:metamancydispelmagic40ep", function() {
	cast_dispel_magic(40);
});

function get_rune_desc(tier, rune_type) {
	let effect = '';
	if (rune_type == 'charge') {
		effect = " can be triggered later by expending a charge";
	}
	else if (rune_type == 'duration') {
		effect = "'s duration is greatly extended";
	}
	let desc = 'You inscribe a ' + rune_type + ' rune on an item or creature, and when a spell is cast into, or bound, to the rune (the bound spell), the ' + 
	'spell' + effect + '. Inscribing the rune requires no special materials, but it will look different if you trace it with your finger versus draw it with ' +
	'a calligraphy pen.' + _rn + 'You decide how much EP you spend when you inscribe the rune, and that sets the tier limit of the spell bound to it. If you ' +
	'attempt to cast a spell of a higher tier than this limit, the spell fails to be bound to the rune and your EP are wasted. You cannot create a ' +
	rune_type + ' rune that contains a spell tier higher than ' + tier_effect_metamancy(tier, 1, '') + '.';
	return desc;
}

on("clicked:metamancyinscribechargeruneinfo", function() {
	getAttrs(["metamancy_tier", "spell_range", "spell_duration_bonus"], function(values) {
		let tier = get_int_or_zero(values.metamancy_tier);
		let range = get_int_or_zero(values.spell_range);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let tier1_effect = '{{EP Cost=10 per tier of the bound spell}} ';
		let desc = get_rune_desc(tier, 'charge') + _rn + "A charge rune can hold up to " + tier_effect_metamancy(tier, 5, ' charges') + ". When binding a " +
		"spell to a charge rune, you cast it once for each charge. The EP you spend on the charge rune and the spell bound to it cannot be recovered until " +
		"the spell ends, which happens when the last charge is expended (or it is dispelled)." + _rn + "When binding a spell to a charge rune, you make all " +
		"decisions about the area type, effect, etc., and every charge must be the same for a single rune." + _rn + "When inscribing a charge rune, you " +
		"determine a command word or special action that can trigger it. Once the rune is active, the creature on whom it is inscribed or who holds the item " +
		"its inscribed on can say that word or perform that action for 1 AP, and the spell is triggered as if the creature had cast it.";
		let roll_text = get_spell_info('Metamancy (inscribe charge rune)', '10 minutes', range + ' squares', 
		dur_short_rest_p_linger, duration_bonus, 'Touch', 'Creature or item', 'Auto (willing, item)', tier1_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:metamancyinscribechargerune10ep", function() {
	cast_inscribe_charge_rune(10);
});

on("clicked:metamancyinscribechargerune20ep", function() {
	cast_inscribe_charge_rune(20);
});

on("clicked:metamancyinscribechargerune30ep", function() {
	cast_inscribe_charge_rune(30);
});

on("clicked:metamancyinscribechargerune40ep", function() {
	cast_inscribe_charge_rune(40);
});

on("clicked:metamancyinscribedurationruneinfo", function() {
	getAttrs(["metamancy_tier", "show_metamancy_inscribe_duration_rune_30_ep", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.metamancy_tier);
		let show_metamancy_inscribe_duration_rune_30_ep = get_bool(values.show_metamancy_inscribe_duration_rune_30_ep);
		let range = get_int_or_zero(values.spell_range);
		let base_duration = [{ duration: "Bound spell's base duration + 2", custom: true }];
		let tier1_effect = '{{EP Cost=10 per tier of the bound spell}} ';
		let tier3_text = (show_metamancy_inscribe_duration_rune_30_ep ? _rn + "Alternatively, you can inscribe a duration rune that makes the bound spells " +
		"duration permanent, but the bound spell must be two tiers lower than the rune." : '');
		let desc = get_rune_desc(tier, 'duration') + _rn + "Once a spell is successfully bound to a rune, its duration increases by two steps, up to a " +
		"maximum duration of permanent. For example, if you bind a Conjuration (armor) spell to a rune, the duration becomes short rest plus linger." + 
		_rn + "You can increase the duration of the bound spell further by casting a spell of a lower tier into the duration rune. The duration " +
		"increases by the difference between the duration runes tier and the spells tier. For example if you cast a tier 3 duration rune and bind a " +
		"tier 1 spell to it, the duration increases by four steps." +
		_rn + "While a duration rune is active, you may not recover the EP spent on either the rune itself nor the spell bound to it. Once the " +
		"runes duration is over (or it is dispelled), you recover the EP spent on it normally." + tier3_text;
		let roll_text = get_spell_info('Metamancy (inscribe duration rune)', '10 minutes', range + ' squares',
		base_duration, 0, 'Touch', 'Creature or item', 'Auto (willing, item)', tier1_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:metamancyinscribedurationrune10ep", function() {
	cast_inscribe_duration_rune(10);
});

on("clicked:metamancyinscribedurationrune20ep", function() {
	cast_inscribe_duration_rune(20);
});

on("clicked:metamancyinscribedurationrune30ep", function() {
	cast_inscribe_duration_rune(30);
});

on("clicked:metamancyinscribedurationrune40ep", function() {
	cast_inscribe_duration_rune(40);
});

on("clicked:metamancyimbueinfo", function() {
	getAttrs(["metamancy_tier", "show_metamancy_imbue_20_ep", "show_metamancy_imbue_40_ep", "show_metamancy_imbue_60_ep", "show_metamancy_imbue_80_ep", "spell_duration_bonus", "spell_range"], function(values) {
		let tier = get_int_or_zero(values.metamancy_tier);
		let show_metamancy_imbue_20_ep = get_bool(values.show_metamancy_imbue_20_ep);
		let show_metamancy_imbue_40_ep = get_bool(values.show_metamancy_imbue_40_ep);
		let show_metamancy_imbue_60_ep = get_bool(values.show_metamancy_imbue_60_ep);
		let show_metamancy_imbue_80_ep = get_bool(values.show_metamancy_imbue_80_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let roll_text = get_prowess_imbue_info(tier, show_metamancy_imbue_20_ep, show_metamancy_imbue_40_ep, show_metamancy_imbue_60_ep, 
		show_metamancy_imbue_80_ep, duration_bonus, range, false);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:metamancyimbue20ep", function() {
	cast_imbue(20);
});

on("clicked:metamancyimbue40ep", function() {
	cast_imbue(40);
});

on("clicked:metamancyimbue60ep", function() {
	cast_imbue(60);
});

on("clicked:metamancyimbue80ep", function() {
	cast_imbue(80);
});

on("clicked:necromancycontrolundead20ep", function() {
	cast_control_undead(20);
});

on("clicked:necromancycontrolundead40ep", function() {
	cast_control_undead(40);
});

on("clicked:necromancycreateundeadinfo", function() {
	getAttrs(["necromancy_total", "necromancy_tier", "show_necromancy_create_undead_20_ep", "show_necromancy_create_undead_40_ep", "show_necromancy_create_undead_60_ep", "show_necromancy_create_undead_80_ep", "spell_range"], function(values) {
		let total = get_int_or_zero(values.necromancy_total);
		let tier = get_int_or_zero(values.necromancy_tier);
		let show_necromancy_create_undead_20_ep = get_bool(values.show_necromancy_create_undead_20_ep);
		let show_necromancy_create_undead_40_ep = get_bool(values.show_necromancy_create_undead_40_ep);
		let show_necromancy_create_undead_60_ep = get_bool(values.show_necromancy_create_undead_60_ep);
		let show_necromancy_create_undead_80_ep = get_bool(values.show_necromancy_create_undead_80_ep);
		let range = get_int_or_zero(values.spell_range);
		let tier1_effect = 										  '{{20 EP=human sized skeleton or zombie}} ';
		let tier2_effect = (show_necromancy_create_undead_40_ep ? `{{40 EP=Large Size${_or}human sized + boon${_or}**2** human sized skeletons or zombies}} ` : '');
		let tier3_effect = (show_necromancy_create_undead_60_ep ? `{{60 EP=Huge Size${_or}Large Size + boon${_or}human sized + 2 boons${_or}**2** 40 EP items}} ` : '');
		let tier4_effect = (show_necromancy_create_undead_80_ep ? `{{80 EP=Huge Size + boon${_or}Large Size + 2 boons${_or}human sized + 3 boons${_or}**2** 60 EP items}} ` : '');
		let desc = "You transform a corpse into an undead creature, i.e. one with either the Undead (skeletal) or Undead (zombified) monstrous " +
		"boon. Newly created undead have a 30% chance (1-3 on a d10 roll) of being hostile to you, otherwise they are indifferent. " +
		_rn + "Higher tiers of this spell allow you to create undead of larger sizes and add boons to the undead you create. The list of " +
		"available boons is as follows: Preternatural Cunning, Natural Dynamancy (must have Preternatural Cunning first), Supernatural Toughness.";
		let roll_text = get_spell_info('Necromancy (create undead)', '10 minutes', range + ' squares', dur_instantaneous, 0, _bolt_touch, 
		'Item', 'Auto (item)', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:necromancycreateundead20ep", function() {
	cast_create_undead(20);
});

on("clicked:necromancycreateundead40ep", function() {
	cast_create_undead(40);
});

on("clicked:necromancycreateundead60ep", function() {
	cast_create_undead(60);
});

on("clicked:necromancycreateundead80ep", function() {
	cast_create_undead(80);
});

on("clicked:necromancydecrepifyinfo", function() {
	getAttrs(["necromancy_tier", "show_necromancy_decrepify_10_ep", "show_necromancy_decrepify_20_ep", "show_necromancy_decrepify_30_ep", "spell_duration_bonus", "spell_range"], function(values) {
		let total = get_int_or_zero(values.necromancy_total);
		let tier = get_int_or_zero(values.necromancy_tier);
		let show_necromancy_decrepify_10_ep = get_bool(values.show_necromancy_decrepify_10_ep);
		let show_necromancy_decrepify_20_ep = get_bool(values.show_necromancy_decrepify_20_ep);
		let show_necromancy_decrepify_30_ep = get_bool(values.show_necromancy_decrepify_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let tier1_effect = 									  `{{10 EP=deafened${_or}fatigued}} `;
		let tier2_effect = (show_necromancy_decrepify_20_ep ? `{{20 EP=blinded${_or}fatigued and sickened}} ` : '');
		let tier3_effect = (show_necromancy_decrepify_30_ep ? `{{30 EP=blinded and deafened${_or}nauseated}} ` : '');
		let desc = "This power adversely affects the biology of a living creature, causing one or more conditions. *Decrepify* automatically " +
		"fails if cast on anything other than a living creature. " +
		spend_pool_necromancy('slow the target in addition to the other conditions it suffers, for 3 pool points per AP of slowness.');
		let roll_text = get_spell_info('Necromancy (decrepify)', '2 AP', range + ' squares', dur_short_rest_w_checks_1, duration_bonus, _bolt_touch, 
		'Creature', 'Physical Resilience', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:necromancydecrepify10ep", function() {
	cast_decrepify(10);
});

on("clicked:necromancydecrepify20ep", function() {
	cast_decrepify(20);
});

on("clicked:necromancydecrepify30ep", function() {
	cast_decrepify(30);
});

on("clicked:necromancyshapecorpseinfo", function() {
	getAttrs(["necromancy_tier", "necromancy_attribute_name", "necromancy_attribute_modifier", "show_necromancy_shape_corpse_10_ep", "show_necromancy_shape_corpse_20_ep", "show_necromancy_shape_corpse_30_ep", "show_necromancy_shape_corpse_40_ep", "spell_duration", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.necromancy_tier);
		let attribute_mod = get_int_or_zero(values.necromancy_attribute_modifier);
		let attribute_name = values.necromancy_attribute_name;
		let show_necromancy_shape_corpse_10_ep = get_bool(values.show_necromancy_shape_corpse_10_ep);
		let show_necromancy_shape_corpse_20_ep = get_bool(values.show_necromancy_shape_corpse_20_ep);
		let show_necromancy_shape_corpse_30_ep = get_bool(values.show_necromancy_shape_corpse_30_ep);
		let show_necromancy_shape_corpse_40_ep = get_bool(values.show_necromancy_shape_corpse_40_ep);
		let duration = get_int_or_zero(values.spell_duration);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);

		let damage_text = attribute_mod_effect(attribute_name, attribute_mod) + ' damage'; 
		let tier1_effect = 										 '{{5 EP=Shape corpses'			  + _or + 'Heal ' + tier_effect_necromancy(tier, 1, 'd6',  '', 1) + damage_text + '}} ' +
																 '{{10 EP=Assemble corpses' 	  + _or + 'Heal ' + tier_effect_necromancy(tier, 1, 'd10', '', 1) + damage_text + '}} ';
		let tier2_effect = (show_necromancy_shape_corpse_20_ep ? '{{20 EP=Assemble Large corpses' + _or + 'Heal ' + tier_effect_necromancy(tier, 2, 'd6',  '', 1) + damage_text + '}} ' : '');
		let tier3_effect = (show_necromancy_shape_corpse_30_ep ? '{{30 EP=Assemble Huge corpses'  + _or + 'Heal ' + tier_effect_necromancy(tier, 2, 'd10', '', 1) + damage_text + '}} ' : '');
		let tier4_effect = (show_necromancy_shape_corpse_40_ep ? '{{40 EP='								+ 'Heal ' + tier_effect_necromancy(tier, 4, 'd6',  '', 1) + damage_text + '}} ' : '');

		let tier1_text = _rn + "For 5 EP, you can remove or restore the flesh of human-sized corpses in the area to make them suitable for " +
		"creating skeletons or zombies. " + _rn + "For 10 EP, you can assemble body parts in the area into human-sized corpses suitable for " +
		"creating skeletons or zombies (up to one corpse per square of the area). "
		let tier2_text = (show_necromancy_shape_corpse_20_ep ? _rn + "For 20 EP, you can assemble body parts in the area into human or Large " +
		"Size corpses suitable for creating skeletons or zombies (Large Size corpses take up a 22 square). " : "");
		let tier3_text = (show_necromancy_shape_corpse_30_ep ? _rn + "For 30 EP, you can assemble body parts in the area into human, Large or " +
		"Huge Size corpses suitable for creating skeletons or zombies (Huge Size corpses take up a 33 square). " : "");
		let desc = "This power can shape corpses to be suitable for creating undead, or heal undead creatures. " +
		_rn + "The type and size or corpses you can shape and the amount of damage you heal is based on your tier and how much EP you spend. " +
		tier1_text + tier2_text + tier3_text + spend_pool_necromancy('increase the healing further, at a cost of 2 points per additional die.');
		let roll_text = get_spell_info('Necromancy (shape corpse)', '2 AP', range + ' squares', dur_instantaneous, 0, area_type_list, 
		'Creature or item', 'Auto (item, willing)', tier1_effect + tier2_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:necromancyshapecorpse5ep", function() {
	cast_shape_corpse(5);
});

on("clicked:necromancyshapecorpse10ep", function() {
	cast_shape_corpse(10);
});

on("clicked:necromancyshapecorpse20ep", function() {
	cast_shape_corpse(20);
});

on("clicked:necromancyshapecorpse30ep", function() {
	cast_shape_corpse(30);
});

on("clicked:necromancyshapecorpse40ep", function() {
	cast_shape_corpse(40);
});

on("clicked:neuromancycharminfo", function() {
	getAttrs(["neuromancy_tier", "show_neuromancy_charm_10_ep", "show_neuromancy_charm_20_ep", "show_neuromancy_charm_30_ep", "show_neuromancy_charm_40_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.neuromancy_tier);
		let show_neuromancy_charm_10_ep = get_bool(values.show_neuromancy_charm_10_ep);
		let show_neuromancy_charm_20_ep = get_bool(values.show_neuromancy_charm_20_ep);
		let show_neuromancy_charm_30_ep = get_bool(values.show_neuromancy_charm_30_ep);
		let show_neuromancy_charm_40_ep = get_bool(values.show_neuromancy_charm_40_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = dur_short_rest_w_checks_2;
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let area_types = _bolt_touch;
		let tier1_effect = 								  "{{10 EP=Target sees you as a friend}} ";
		let tier3_effect = (show_neuromancy_charm_30_ep ? "{{30 EP=Targets see you as a friend}} " : "");
		let tier4_effect = (show_neuromancy_charm_40_ep ? "{{40 EP=Target is dominated}} " : "");
		if (show_neuromancy_charm_20_ep) {
			base_duration = [
				{ name: '10 EP', duration: dur_short_rest_w_checks_2 },
				{ name: '20 EP', duration: dur_short_rest_p_linger   }
			];
			tier1_effect = tier1_effect.replace('10 EP', '10 or 20 EP');
		}
		if (show_neuromancy_charm_30_ep) {
			base_duration[1].name = '20 or 30 EP';
			area_types = [
				{ name: '10 or 20 EP', types: _bolt_touch    },
				{ name: '30 EP',       types: area_type_list }
			];
		}
		if (show_neuromancy_charm_40_ep) {
			base_duration[1].name = '20-40 EP';
			area_types[0].name = '10, 20 or 40 EP';
		}
		let tier1_text = _rn + "For 10 EP, the target sees you as a friend, and you gain advantage on Persuade checks against them. If you fail, the target can " +
		"make a TN 24 Perception (notice) check to notice the mental intrusion." + get_crit_text('you gain great advantage on Persuade checks against the target.', 
		'the target automatically notices the mental intrusion, and knows that it was you.', true);
		let tier2_text = (show_neuromancy_charm_20_ep ? _rn + 'For 20 EP, you can cast *charm* with a base duration of short rest plus linger. ' : '');
		let tier3_text = (show_neuromancy_charm_30_ep ? _rn + 'For 30 EP, you can cast *charm* with a base duration of short rest plus linger and any area type. ' : '');
		let tier4_text = (show_neuromancy_charm_40_ep ? _rn + 'For 40 EP, you can completely dominate a single target, and the base duration is short rest plus linger. The target ' +
		'gains advantage on their initial Mental Resilience (willpower) check to resist this spell, and they can make another Mental Resilience check each day ' +
		'to see if they can break the spell. A dominated target must obey any and all commands you give it. ' : '');
		let desc = "This spell makes the target regard you as a friend." + _pow + "You gain advantage on Persuade (diplomacy) checks." + 
		tier1_text + tier2_text + tier3_text + tier4_text;
		let roll_text = get_spell_info('Neuromancy (charm)', '2 AP', range + ' squares', base_duration, duration_bonus, area_types, 
		'Creature', 'Mental Resilience', tier1_effect + tier3_effect + tier4_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:neuromancycharm10ep", function() {
	cast_charm(10);
});

on("clicked:neuromancycharm20ep", function() {
	cast_charm(20);
});

on("clicked:neuromancycharm30ep", function() {
	cast_charm(30);
});

on("clicked:neuromancycharm40ep", function() {
	cast_charm(40);
});

on("clicked:neuromancyfearinfo", function() {
	getAttrs(["neuromancy_tier", "show_neuromancy_fear_10_ep", "show_neuromancy_fear_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.neuromancy_tier);
		let show_neuromancy_fear_10_ep = get_bool(values.show_neuromancy_fear_10_ep);
		let show_neuromancy_fear_30_ep = get_bool(values.show_neuromancy_fear_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let tier1_effect = 								 "{{10 EP=Targets are **scared**}} ";
		let tier3_effect = (show_neuromancy_fear_30_ep ? "{{30 EP=Targets are **terrified**}} " : "");
		let tier1_text = _rn + "For 10 EP, you scare the target(s), imposing the scared condition on them for the duration." +
		get_crit_text('the target is **terrified** instead of **scared**', "you are **scared** for the spell's duration", true);
		let tier3_text = (show_neuromancy_fear_30_ep ? _rn + "For 30 EP, you can impose the **terrified** condition on the target(s)." : "");
		let desc = "This spell allows you to scare or terrify the targets." + _pow + "You gain advantage on Persuade (intimidate) checks." +
		tier1_text + tier3_text + spend_pool_neuromancy('increase the duration, at a cost of 1 point per extra round.');
		let roll_text = get_spell_info('Neuromancy (fear)', '2 AP', range + ' squares', dur_short_rest_w_checks_1, duration_bonus, area_type_list, 
		'Creature', 'Mental Resilience', tier1_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:neuromancyfear10ep", function() {
	cast_fear(10);
});

on("clicked:neuromancyfear30ep", function() {
	cast_fear(30);
});

on("clicked:neuromancyinfluenceinfo", function() {
	getAttrs(["neuromancy_tier", "show_neuromancy_influence_10_ep", "show_neuromancy_influence_20_ep", "show_neuromancy_influence_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.neuromancy_tier);
		let show_neuromancy_influence_10_ep = get_bool(values.show_neuromancy_influence_10_ep);
		let show_neuromancy_influence_20_ep = get_bool(values.show_neuromancy_influence_20_ep);
		let show_neuromancy_influence_30_ep = get_bool(values.show_neuromancy_influence_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = [{ duration: '[[1]] round', custom: true }];
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let area_types = _bolt_touch;
		let tier1_effect = 								      '{{10 EP=One-word command}} ';
		let tier2_effect = (show_neuromancy_influence_20_ep ? '{{20 EP=One-sentence suggestion}} ' : '');
		let tier3_effect = (show_neuromancy_influence_30_ep ? `{{30 EP=One-word command${_or}One-sentence suggestion}} ` : '');
		if (show_neuromancy_influence_20_ep) {
			base_duration = [
				{ name: '10 EP', duration: '[[1]] round', custom: true },
				{ name: '20 EP', duration: dur_short_rest_w_checks_2   }
			];
		}
		if (show_neuromancy_influence_30_ep) {
			base_duration.push(
				{ name: '30 EP command', duration: dur_short_rest_w_checks_1 },
				{ name: '30 EP suggest', duration: dur_short_rest_w_checks_2 }
			);
			area_types = [
				{ name: '10 or 20 EP', types: _bolt_touch    },
				{ name: '30 EP',       types: area_type_list }				
			];
		}
		let tier1_text = _rn + "For 10 EP, you can issue a one-word command to the target, chosen from the list below. If the target fails their Mental " +
		"Resilience (willpower) check, it follows the command to the best of their ability on its next turn, then the spell ends. If anything prevents the " +
		"target from carrying out the command, the spell fails." + _n + _bull + "*Approach:* the target spends all its AP to move as close to you as " +
		"possible as quickly as possible, and can take no other actions that round." + _bull + "*Drop:* the target drops everything theyre holding, and " +
		"cant pick up what it drops until their next turn." + _bull + "*Fall:* the target drops prone and may not get up for one round, but can otherwise " +
		"act normally." + _bull + "*Flee:* the target spends all its AP to move as far away from you as possible as quickly as possible, and can take no " +
		"other actions that round." + _bull + "*Halt:* the target stays in place for one round and may take no other actions, but can still defend " +
		"themselves normally.";
		let tier2_text = (show_neuromancy_influence_20_ep ? _rn + "For 20 EP, you can issue a suggestion to a single target, in the form of a single sentence. " +
		"If the target fails their Mental Resilience (willpower) check, they must carry out the suggestion to the best of their ability. Particularly " +
		"reasonable suggestions might incur disadvantage or great disadvantage on the targets Mental Resilience check, while particularly unreasonable " +
		"suggestions might grant advantage or great advantage, which will be determined by the Game Master. Totally unreasonable suggestions will " +
		"automatically fail. " + _rn + "This version of the spell has a base duration of short rest with checks (2 successes). An affected target will attempt to follow the suggestion to " +
		"the best of their ability until the spells duration runs out. If they successfully complete the suggestion, the spell ends." : '');
		let tier3_text = (show_neuromancy_influence_30_ep ? _rn + "For 30 EP, you can cast either the 10 EP command or the 20 EP suggestion on creatures in " +
		"any area type." + _rn + "If you choose command, you issue a single command, and the base duration is short rest with checks (1 success). All affected creatures must make a " +
		"Mental Resilience (willpower) check each round or follow that command." + _rn + "If you choose suggest, you make a single suggestion, and the " +
		"base duration is short rest with checks (2 successes). All affected creatures must attempt to follow the suggestion." : '');
		let desc = "This spell allows you to issue a command or a suggestion that the target must follow." + 
		_pow + "You gain advantage on Persuade (bluff) checks." + tier1_text + tier2_text + tier3_text;
		let roll_text = get_spell_info('Neuromancy (influence)', '2 AP', range + ' squares', base_duration, duration_bonus, area_types, 
		'Creature', 'Mental Resilience', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:neuromancyinfluence10ep", function() {
	cast_influence(10);
});

on("clicked:neuromancyinfluence20ep", function() {
	cast_influence(20);
});

on("clicked:neuromancyinfluence30ep", function() {
	cast_influence(30);
});

on("clicked:neuromancysleepinfo", function() {
	getAttrs(["neuromancy_tier", "show_neuromancy_sleep_10_ep", "show_neuromancy_sleep_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.neuromancy_tier);
		let show_neuromancy_sleep_10_ep= get_bool(values.show_neuromancy_sleep_10_ep);
		let show_neuromancy_sleep_30_ep= get_bool(values.show_neuromancy_sleep_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let tier1_effect = 								  "{{10 EP=Targets are **sleepy**}} ";
		let tier3_effect = (show_neuromancy_sleep_30_ep ? "{{30 EP=Targets are **asleep**}} " : "");
		let tier3_text = (show_neuromancy_sleep_30_ep ? _rn + "For 30 EP, you can impose the **asleep** condition on the target(s)." : "");
		let desc = "This power makes the target(s) sleepy, imposing the **sleepy** condition on them for the duration. " +
		get_crit_text('the target is **asleep** instead of **sleepy**', "you are **sleepy** for the spell's duration", true) + tier3_text;
		let roll_text = get_spell_info('Neuromancy (sleep)', '2 AP', range + ' squares', dur_short_rest_w_checks_1, duration_bonus, area_type_list, 
		'Creature', 'Mental Resilience', tier1_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:neuromancysleep10ep", function() {
	cast_sleep(10);
});

on("clicked:neuromancysleep30ep", function() {
	cast_sleep(30);
});

on("clicked:neuromancytelepathyinfo", function() {
	getAttrs(["neuromancy_tier", "show_neuromancy_telepathy_10_ep", "show_neuromancy_telepathy_20_ep", "show_neuromancy_telepathy_30_ep", "spell_duration_bonus", "spell_range", "spell_area_size", "area_type_blast", "area_type_burst", "area_type_line", "area_type_nova", "area_type_wall"], function(values) {
		let tier = get_int_or_zero(values.neuromancy_tier);
		let show_neuromancy_telepathy_10_ep = get_bool(values.show_neuromancy_telepathy_10_ep);
		let show_neuromancy_telepathy_20_ep = get_bool(values.show_neuromancy_telepathy_20_ep);
		let show_neuromancy_telepathy_30_ep = get_bool(values.show_neuromancy_telepathy_30_ep);
		let duration_bonus = get_int_or_zero(values.spell_duration_bonus);
		let base_duration = [
			{ name: 'read surface thoughts', duration: dur_short_rest_w_checks_2 },
			{ name:	'two-way connection',    duration: dur_concentration_w_pool  },
			{ name:	'send message',          duration: dur_instantaneous         }
		];
		if (show_neuromancy_telepathy_20_ep) {
			base_duration.push({ name: 'willing true telepathy', duration: dur_concentration_w_pool });
		}
		if (show_neuromancy_telepathy_30_ep) {
			base_duration.push({ name: 'unwilling true telepathy', duration: dur_short_rest_w_checks_1 });
		}
		let range = get_int_or_zero(values.spell_range);
		let area_size = get_int_or_zero(values.spell_area_size);
		let area_type_list = get_area_type_list(area_size, values.area_type_blast, values.area_type_burst, values.area_type_line, values.area_type_nova, values.area_type_wall);
		let area_types = [
			{ name: 'normal',   types: _bolt_touch    },
			{ name: 'lower EP', types: area_type_list }
		];
		let tier1_effect = 								      '{{5 EP=One-sentence message to one target}} ' +
															  `{{10 EP=Read surface thoughts of one target${_or}One-sentence message to many targets}} `;
		let tier2_effect = (show_neuromancy_telepathy_20_ep ? '{{20 EP=True telepathy with one willing target}} ' : '');
		let tier3_effect = (show_neuromancy_telepathy_30_ep ? `{{30 EP=Read surface thoughts of many targets${_or}True telepathy with many willing targets${_or}True telepathy with one unwilling target}} ` : '');
		let power = '';
		if (show_neuromancy_telepathy_20_ep) {
			power = _pow + 'You can establish a shallow two-way telepathic connection with a willing target as per the 10 EP version of this spell. ' +
			'The base duration of this power is concentration.';
		}
		let tier1_text = _rn + "For 5 EP, you can send a single telepathic message to a single target, up to one sentence. This version of the spell has a " +
		"duration of instantaneous." + _rn + "For 10 EP, you can establish a shallow connection with a single target. If affected, you can read the targets " +
		"surface thoughts for 1 AP, which grants you advantage on Defend and Persuade (intuition) checks against them. In addition, you might gain some useful " +
		"information, depending on what they are thinking about. This version of the spell has a base duration of short rest with checks (2 successes)." + _rn + "As soon as a target is " +
		"affected, they can make a TN 24 Perception (notice) check to notice the mental intrusion. If they succeed, you must make a Neuromancy (telepathy) " +
		"check versus their Mental Resilience (willpower) check each time you attempt to read their surface thoughts for the duration of the spell." + _rn +
		"If you so choose, you can make the connection two-way, and allow the target to read your surface thoughts as well - for example, if you cast the spell " +
		"on a willing ally. In this case, assuming you have at least one language in common with the target, you can communicate telepathically, but you must " +
		"each spend 1 AP or 2 Neuromancy pool points each round concentrating on the connection to do so. This version of the spell has a base duration of concentration with pool points." + _rn + 
		"Alternatively, you can cast the 5 EP version of this spell with any area type.";
		let tier2_text = (show_neuromancy_telepathy_20_ep ? _rn + "For 20 EP, you can establish a true telepathic connection with a single willing target. You " +
		"can communicate with the target freely, regardless of whether or not you have a language in common. This version of the spell has a base duration unit of " +
		"concentration with pool points" : '');
		let tier3_text = (show_neuromancy_telepathy_30_ep ? _rn + "For 30 EP, you can cast either the 10 or 20 EP version of this spell with any area type." + 
		_rn + "Alternatively, you can attempt to establish a true telepathic connection with a single unwilling target. This version of the spell has a base " +
		"duration of short rest with checks (1 success). If the target fails their Mental Resilience (willpower) check, you can spend 3 AP to dig through their mind for information." +
		_rn + "Each time you do, you must make a Neuromancy (telepathy) check versus their Mental Resilience (willpower) check to see if you are successful. " +
		"Depending on the information and how deeply buried it might be, you may suffer disadvantage or great disadvantage on your check, and your target may " +
		"gain disadvantage or great disadvantage on theirs, as determined by the Game Master." + _rn + "As soon as a target is affected, they can make a TN 24 " +
		"Perception (notice) check to notice the mental intrusion. If they succeed, you must make opposed skill tests rather than skill checks each time you " +
		"attempt to read their thoughts for the duration of the spell, at the advantage/disadvantage levels set by the Game Master." : '');
		let desc = "This spell allows you to establish a telepathic connection with the target." + power + tier1_text + tier2_text + tier3_text;
		let roll_text = get_spell_info('Neuromancy (telepathy)', '2 AP', range + ' squares', base_duration, duration_bonus, area_types, 
		'Creature', 'Mental Resilience', tier1_effect + tier2_effect + tier3_effect, desc);
		startRoll(roll_text, (results) => {
			finishRoll(results.rollId);
		});
	});
});

on("clicked:neuromancytelepathy5ep", function() {
	cast_telepathy(5);
});

on("clicked:neuromancytelepathy10ep", function() {
	cast_telepathy(10);
});

on("clicked:neuromancytelepathy20ep", function() {
	cast_telepathy(20);
});

on("clicked:neuromancytelepathy30ep", function() {
	cast_telepathy(30);
});

</script>